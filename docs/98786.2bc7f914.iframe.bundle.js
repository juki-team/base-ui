/*! For license information please see 98786.2bc7f914.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[98786],{"./node_modules/cytoscape/dist/cytoscape.esm.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _createClass(e,r,t){return r&&function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e){t&&(r=t);var n=0,F=function(){};return{s:F,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return a=r.done,r},e:function(r){u=!0,o=r},f:function(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _defineProperty$1(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof i?i:i+""}function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}__webpack_require__.d(__webpack_exports__,{A:()=>cytoscape});var _window="undefined"==typeof window?null:window,navigator=_window?_window.navigator:null;_window&&_window.document;var isObject_1,hasRequiredIsObject,_freeGlobal,hasRequired_freeGlobal,_root,hasRequired_root,now_1,hasRequiredNow,_trimmedEndIndex,hasRequired_trimmedEndIndex,_baseTrim,hasRequired_baseTrim,_Symbol,hasRequired_Symbol,_getRawTag,hasRequired_getRawTag,_objectToString,hasRequired_objectToString,_baseGetTag,hasRequired_baseGetTag,isObjectLike_1,hasRequiredIsObjectLike,isSymbol_1,hasRequiredIsSymbol,toNumber_1,hasRequiredToNumber,debounce_1,hasRequiredDebounce,typeofstr=_typeof(""),typeofobj=_typeof({}),typeoffn=_typeof(function(){}),typeofhtmlele="undefined"==typeof HTMLElement?"undefined":_typeof(HTMLElement),instanceStr=function instanceStr(obj){return obj&&obj.instanceString&&fn$6(obj.instanceString)?obj.instanceString():null},string=function string(obj){return null!=obj&&_typeof(obj)==typeofstr},fn$6=function fn(obj){return null!=obj&&_typeof(obj)===typeoffn},array=function array(obj){return!elementOrCollection(obj)&&(Array.isArray?Array.isArray(obj):null!=obj&&obj instanceof Array)},plainObject=function plainObject(obj){return null!=obj&&_typeof(obj)===typeofobj&&!array(obj)&&obj.constructor===Object},number$1=function number(obj){return null!=obj&&_typeof(obj)===_typeof(1)&&!isNaN(obj)},htmlElement=function htmlElement(obj){return"undefined"===typeofhtmlele?void 0:null!=obj&&obj instanceof HTMLElement},elementOrCollection=function elementOrCollection(obj){return element(obj)||collection(obj)},element=function element(obj){return"collection"===instanceStr(obj)&&obj._private.single},collection=function collection(obj){return"collection"===instanceStr(obj)&&!obj._private.single},core=function core(obj){return"core"===instanceStr(obj)},stylesheet=function stylesheet(obj){return"stylesheet"===instanceStr(obj)},emptyString=function emptyString(obj){return null==obj||!(""!==obj&&!obj.match(/^\s+$/))},promise=function promise(obj){return function object(obj){return null!=obj&&_typeof(obj)===typeofobj}(obj)&&fn$6(obj.then)},memoize=function memoize(fn,keyFn){keyFn||(keyFn=function keyFn(){if(1===arguments.length)return arguments[0];if(0===arguments.length)return"undefined";for(var args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);return args.join("$")});var _memoizedFn=function memoizedFn(){var ret,args=arguments,k=keyFn.apply(this,args),cache=_memoizedFn.cache;return(ret=cache[k])||(ret=cache[k]=fn.apply(this,args)),ret};return _memoizedFn.cache={},_memoizedFn},camel2dash=memoize(function(str){return str.replace(/([A-Z])/g,function(v){return"-"+v.toLowerCase()})}),dash2camel=memoize(function(str){return str.replace(/(-\w)/g,function(v){return v[1].toUpperCase()})}),prependCamel=memoize(function(prefix,str){return prefix+str[0].toUpperCase()+str.substring(1)},function(prefix,str){return prefix+"$"+str}),capitalize=function capitalize(str){return emptyString(str)?str:str.charAt(0).toUpperCase()+str.substring(1)},endsWith=function endsWith(string,suffix){return string.slice(-1*suffix.length)===suffix},number="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",rgba="rgb[a]?\\(("+number+"[%]?)\\s*,\\s*("+number+"[%]?)\\s*,\\s*("+number+"[%]?)(?:\\s*,\\s*("+number+"))?\\)",rgbaNoBackRefs="rgb[a]?\\((?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)(?:\\s*,\\s*(?:"+number+"))?\\)",hsla="hsl[a]?\\(("+number+")\\s*,\\s*("+number+"[%])\\s*,\\s*("+number+"[%])(?:\\s*,\\s*("+number+"))?\\)",hslaNoBackRefs="hsl[a]?\\((?:"+number+")\\s*,\\s*(?:"+number+"[%])\\s*,\\s*(?:"+number+"[%])(?:\\s*,\\s*(?:"+number+"))?\\)",ascending=function ascending(a,b){return a<b?-1:a>b?1:0},extend=null!=Object.assign?Object.assign.bind(Object):function(tgt){for(var args=arguments,i=1;i<args.length;i++){var obj=args[i];if(null!=obj)for(var keys=Object.keys(obj),j=0;j<keys.length;j++){var k=keys[j];tgt[k]=obj[k]}}return tgt},color2tuple=function color2tuple(color){return(array(color)?color:null)||function colorname2tuple(color){return colors[color.toLowerCase()]}(color)||function hex2tuple(hex){var r,g,b;if((4===hex.length||7===hex.length)&&"#"===hex[0])return 4===hex.length?(r=parseInt(hex[1]+hex[1],16),g=parseInt(hex[2]+hex[2],16),b=parseInt(hex[3]+hex[3],16)):(r=parseInt(hex[1]+hex[2],16),g=parseInt(hex[3]+hex[4],16),b=parseInt(hex[5]+hex[6],16)),[r,g,b]}(color)||function rgb2tuple(rgb){var ret,m=new RegExp("^"+rgba+"$").exec(rgb);if(m){ret=[];for(var isPct=[],i=1;i<=3;i++){var channel=m[i];if("%"===channel[channel.length-1]&&(isPct[i]=!0),channel=parseFloat(channel),isPct[i]&&(channel=channel/100*255),channel<0||channel>255)return;ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3],allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct)return;var alpha=m[4];if(void 0!==alpha){if((alpha=parseFloat(alpha))<0||alpha>1)return;ret.push(alpha)}}return ret}(color)||function hsl2tuple(hsl){var ret,h,s,l,a,r,g,b;function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}var m=new RegExp("^"+hsla+"$").exec(hsl);if(m){if((h=parseInt(m[1]))<0?h=(360- -1*h%360)%360:h>360&&(h%=360),h/=360,(s=parseFloat(m[2]))<0||s>100)return;if(s/=100,(l=parseFloat(m[3]))<0||l>100)return;if(l/=100,void 0!==(a=m[4])&&((a=parseFloat(a))<0||a>1))return;if(0===s)r=g=b=Math.round(255*l);else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3)),g=Math.round(255*hue2rgb(p,q,h)),b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret}(color)},colors={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},setMap=function setMap(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];if(plainObject(key))throw Error("Tried to set map with object key");i<keys.length-1?(null==obj[key]&&(obj[key]={}),obj=obj[key]):obj[key]=options.value}},getMap=function getMap(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;i<l;i++){var key=keys[i];if(plainObject(key))throw Error("Tried to get map with object key");if(null==(obj=obj[key]))return obj}return obj},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function requireIsObject(){if(hasRequiredIsObject)return isObject_1;return hasRequiredIsObject=1,isObject_1=function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}}function require_root(){if(hasRequired_root)return _root;hasRequired_root=1;var freeGlobal=function require_freeGlobal(){if(hasRequired_freeGlobal)return _freeGlobal;hasRequired_freeGlobal=1;var freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal;return _freeGlobal=freeGlobal}(),freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();return _root=root}function require_baseTrim(){if(hasRequired_baseTrim)return _baseTrim;hasRequired_baseTrim=1;var trimmedEndIndex=function require_trimmedEndIndex(){if(hasRequired_trimmedEndIndex)return _trimmedEndIndex;hasRequired_trimmedEndIndex=1;var reWhitespace=/\s/;return _trimmedEndIndex=function trimmedEndIndex(string){for(var index=string.length;index--&&reWhitespace.test(string.charAt(index)););return index},_trimmedEndIndex}(),reTrimStart=/^\s+/;return _baseTrim=function baseTrim(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string},_baseTrim}function require_Symbol(){if(hasRequired_Symbol)return _Symbol;hasRequired_Symbol=1;var Symbol=require_root().Symbol;return _Symbol=Symbol}function require_baseGetTag(){if(hasRequired_baseGetTag)return _baseGetTag;hasRequired_baseGetTag=1;var Symbol=require_Symbol(),getRawTag=function require_getRawTag(){if(hasRequired_getRawTag)return _getRawTag;hasRequired_getRawTag=1;var Symbol=require_Symbol(),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol?Symbol.toStringTag:void 0;return _getRawTag=function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result}}(),objectToString=function require_objectToString(){if(hasRequired_objectToString)return _objectToString;hasRequired_objectToString=1;var nativeObjectToString=Object.prototype.toString;return _objectToString=function objectToString(value){return nativeObjectToString.call(value)}}(),symToStringTag=Symbol?Symbol.toStringTag:void 0;return _baseGetTag=function baseGetTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}}function requireIsSymbol(){if(hasRequiredIsSymbol)return isSymbol_1;hasRequiredIsSymbol=1;var baseGetTag=require_baseGetTag(),isObjectLike=function requireIsObjectLike(){return hasRequiredIsObjectLike?isObjectLike_1:(hasRequiredIsObjectLike=1,isObjectLike_1=function isObjectLike(value){return null!=value&&"object"==typeof value})}();return isSymbol_1=function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&"[object Symbol]"==baseGetTag(value)}}var debounce=getDefaultExportFromCjs(function requireDebounce(){if(hasRequiredDebounce)return debounce_1;hasRequiredDebounce=1;var isObject=requireIsObject(),now=function requireNow(){if(hasRequiredNow)return now_1;hasRequiredNow=1;var root=require_root();return now_1=function(){return root.Date.now()}}(),toNumber=function requireToNumber(){if(hasRequiredToNumber)return toNumber_1;hasRequiredToNumber=1;var baseTrim=require_baseTrim(),isObject=requireIsObject(),isSymbol=requireIsSymbol(),reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;return toNumber_1=function toNumber(value){if("number"==typeof value)return value;if(isSymbol(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}}(),nativeMax=Math.max,nativeMin=Math.min;return debounce_1=function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function remainingWait(time){var timeWaiting=wait-(time-lastCallTime);return maxing?nativeMin(timeWaiting,maxWait-(time-lastInvokeTime)):timeWaiting}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}(lastCallTime);if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function flush(){return void 0===timerId?result:trailingEdge(now())},debounced}}()),performance$1=_window?_window.performance:null,pnow=performance$1&&performance$1.now?function(){return performance$1.now()}:function(){return Date.now()},raf=function(){if(_window){if(_window.requestAnimationFrame)return function(fn){_window.requestAnimationFrame(fn)};if(_window.mozRequestAnimationFrame)return function(fn){_window.mozRequestAnimationFrame(fn)};if(_window.webkitRequestAnimationFrame)return function(fn){_window.webkitRequestAnimationFrame(fn)};if(_window.msRequestAnimationFrame)return function(fn){_window.msRequestAnimationFrame(fn)}}return function(fn){fn&&setTimeout(function(){fn(pnow())},1e3/60)}}(),requestAnimationFrame=function requestAnimationFrame(fn){return raf(fn)},performanceNow=pnow,hashIterableInts=function hashIterableInts(iterator){for(var entry,hash=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261;!(entry=iterator.next()).done;)hash=65599*hash+entry.value|0;return hash},hashInt=function hashInt(num){return 65599*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261)+num|0},hashIntAlt=function hashIntAlt(num){var seed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5381;return(seed<<5)+seed+num|0},combineHashesArray=function combineHashesArray(hashes){return 2097152*hashes[0]+hashes[1]},hashArrays=function hashArrays(hashes1,hashes2){return[hashInt(hashes1[0],hashes2[0]),hashIntAlt(hashes1[1],hashes2[1])]},hashIntsArray=function hashIntsArray(ints,seed){var entry={value:0,done:!1},i=0,length=ints.length;return hashIterableInts({next:function next(){return i<length?entry.value=ints[i++]:entry.done=!0,entry}},seed)},hashString=function hashString(str,seed){var entry={value:0,done:!1},i=0,length=str.length;return hashIterableInts({next:function next(){return i<length?entry.value=str.charCodeAt(i++):entry.done=!0,entry}},seed)},hashStrings=function hashStrings(){return hashStringsArray(arguments)},hashStringsArray=function hashStringsArray(strs){for(var hash,i=0;i<strs.length;i++){var str=strs[i];hash=0===i?hashString(str):hashString(str,hash)}return hash};function rotatePosAndSkewByBox(pos,box,angleDegrees){if(0===angleDegrees)return pos;var centerX=(box.x1+box.x2)/2,centerY=(box.y1+box.y2)/2,skewX=box.w/box.h,skewY=1/skewX,rotated=function rotatePoint(x,y,centerX,centerY,angleDegrees){var angleRadians=angleDegrees*Math.PI/180;return{x:Math.cos(angleRadians)*(x-centerX)-Math.sin(angleRadians)*(y-centerY)+centerX,y:Math.sin(angleRadians)*(x-centerX)+Math.cos(angleRadians)*(y-centerY)+centerY}}(pos.x,pos.y,centerX,centerY,angleDegrees),skewed=function movePointByBoxAspect(x,y,boxX,boxY,skewX,skewY){return{x:(x-boxX)*skewX+boxX,y:(y-boxY)*skewY+boxY}}(rotated.x,rotated.y,centerX,centerY,skewX,skewY);return{x:skewed.x,y:skewed.y}}var warningsEnabled=!0,warnSupported=null!=console.warn,traceSupported=null!=console.trace,MAX_INT$1=Number.MAX_SAFE_INTEGER||9007199254740991,trueify=function trueify(){return!0},falsify=function falsify(){return!1},zeroify=function zeroify(){return 0},noop$1=function noop(){},error=function error(msg){throw new Error(msg)},warnings=function warnings(enabled){if(void 0===enabled)return warningsEnabled;warningsEnabled=!!enabled},warn=function warn(msg){warnings()&&(warnSupported?console.warn(msg):(console.log(msg),traceSupported&&console.trace()))},copy=function copy(obj){return null==obj?obj:array(obj)?obj.slice():plainObject(obj)?function clone(obj){return extend({},obj)}(obj):obj},uuid=function uuid(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b},_staticEmptyObject={},staticEmptyObject=function staticEmptyObject(){return _staticEmptyObject},defaults$g=function defaults(_defaults){var keys=Object.keys(_defaults);return function(opts){for(var filledOpts={},i=0;i<keys.length;i++){var key=keys[i],optVal=null==opts?void 0:opts[key];filledOpts[key]=void 0===optVal?_defaults[key]:optVal}return filledOpts}},removeFromArray=function removeFromArray(arr,ele,oneCopy){for(var i=arr.length-1;i>=0;i--)arr[i]===ele&&arr.splice(i,1)},clearArray=function clearArray(arr){arr.splice(0,arr.length)},getPrefixedProperty=function getPrefixedProperty(obj,propName,prefix){return prefix&&(propName=prependCamel(prefix,propName)),obj[propName]},setPrefixedProperty=function setPrefixedProperty(obj,propName,prefix,value){prefix&&(propName=prependCamel(prefix,propName)),obj[propName]=value},Map$1="undefined"!=typeof Map?Map:function(){return _createClass(function ObjectMap(){_classCallCheck(this,ObjectMap),this._obj={}},[{key:"set",value:function set(key,val){return this._obj[key]=val,this}},{key:"delete",value:function _delete(key){return this._obj[key]=void 0,this}},{key:"clear",value:function clear(){this._obj={}}},{key:"has",value:function has(key){return void 0!==this._obj[key]}},{key:"get",value:function get(key){return this._obj[key]}}])}(),ObjectSet=function(){return _createClass(function ObjectSet(arrayOrObjectSet){if(_classCallCheck(this,ObjectSet),this._obj=Object.create(null),this.size=0,null!=arrayOrObjectSet){var arr;arr=null!=arrayOrObjectSet.instanceString&&arrayOrObjectSet.instanceString()===this.instanceString()?arrayOrObjectSet.toArray():arrayOrObjectSet;for(var i=0;i<arr.length;i++)this.add(arr[i])}},[{key:"instanceString",value:function instanceString(){return"set"}},{key:"add",value:function add(val){var o=this._obj;1!==o[val]&&(o[val]=1,this.size++)}},{key:"delete",value:function _delete(val){var o=this._obj;1===o[val]&&(o[val]=0,this.size--)}},{key:"clear",value:function clear(){this._obj=Object.create(null)}},{key:"has",value:function has(val){return 1===this._obj[val]}},{key:"toArray",value:function toArray(){var _this=this;return Object.keys(this._obj).filter(function(key){return _this.has(key)})}},{key:"forEach",value:function forEach(callback,thisArg){return this.toArray().forEach(callback,thisArg)}}])}(),Set$1="undefined"!==("undefined"==typeof Set?"undefined":_typeof(Set))?Set:ObjectSet,Element=function Element(cy,params){var restore=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0!==cy&&void 0!==params&&core(cy)){var group=params.group;if(null==group&&(group=params.data&&null!=params.data.source&&null!=params.data.target?"edges":"nodes"),"nodes"===group||"edges"===group){this.length=1,this[0]=this;var _p=this._private={cy,single:!0,data:params.data||{},position:params.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!params.selected,selectable:void 0===params.selectable||!!params.selectable,locked:!!params.locked,grabbed:!1,grabbable:void 0===params.grabbable||!!params.grabbable,pannable:void 0===params.pannable?"edges"===group:!!params.pannable,active:!1,classes:new Set$1,animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[],parent:params.parent&&params.parent.isNode()?params.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(null==_p.position.x&&(_p.position.x=0),null==_p.position.y&&(_p.position.y=0),params.renderedPosition){var rpos=params.renderedPosition,pan=cy.pan(),zoom=cy.zoom();_p.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}var classes=[];array(params.classes)?classes=params.classes:string(params.classes)&&(classes=params.classes.split(/\s+/));for(var i=0,l=classes.length;i<l;i++){var cls=classes[i];cls&&""!==cls&&_p.classes.add(cls)}this.createEmitter(),(void 0===restore||restore)&&this.restore();var bypass=params.style||params.css;bypass&&(warn("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(bypass))}else error("An element must be of type `nodes` or `edges`; you specified `"+group+"`")}else error("An element must have a core reference and parameters set")},defineSearch=function defineSearch(params){return params={bfs:params.bfs||!params.dfs,dfs:params.dfs||!params.bfs},function searchFn(roots,fn,directed){var options;plainObject(roots)&&!elementOrCollection(roots)&&(roots=(options=roots).roots||options.root,fn=options.visit,directed=options.directed),directed=2!==arguments.length||fn$6(fn)?directed:fn,fn=fn$6(fn)?fn:function(){};for(var found,cy=this._private.cy,v=roots=string(roots)?this.filter(roots):roots,Q=[],connectedNodes=[],connectedBy={},id2depth={},V={},j=0,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,i=0;i<v.length;i++){var vi=v[i],viId=vi.id();vi.isNode()&&(Q.unshift(vi),params.bfs&&(V[viId]=!0,connectedNodes.push(vi)),id2depth[viId]=0)}for(var _ret,_loop=function _loop(){var v=params.bfs?Q.shift():Q.pop(),vId=v.id();if(params.dfs){if(V[vId])return 0;V[vId]=!0,connectedNodes.push(v)}var ret,depth=id2depth[vId],prevEdge=connectedBy[vId],src=null!=prevEdge?prevEdge.source():null,tgt=null!=prevEdge?prevEdge.target():null,prevNode=null==prevEdge?void 0:v.same(src)?tgt[0]:src[0];if(!0===(ret=fn(v,prevEdge,prevNode,j++,depth)))return found=v,1;if(!1===ret)return 1;for(var vwEdges=v.connectedEdges().filter(function(e){return(!directed||e.source().same(v))&&edges.has(e)}),_i2=0;_i2<vwEdges.length;_i2++){var e=vwEdges[_i2],w=e.connectedNodes().filter(function(n){return!n.same(v)&&nodes.has(n)}),wId=w.id();0===w.length||V[wId]||(w=w[0],Q.push(w),params.bfs&&(V[wId]=!0,connectedNodes.push(w)),connectedBy[wId]=e,id2depth[wId]=id2depth[vId]+1)}};0!==Q.length&&(0===(_ret=_loop())||1!==_ret););for(var connectedEles=cy.collection(),_i=0;_i<connectedNodes.length;_i++){var node=connectedNodes[_i],edge=connectedBy[node.id()];null!=edge&&connectedEles.push(edge),connectedEles.push(node)}return{path:cy.collection(connectedEles),found:cy.collection(found)}}},elesfn$v={breadthFirstSearch:defineSearch({bfs:!0}),depthFirstSearch:defineSearch({dfs:!0})};elesfn$v.bfs=elesfn$v.breadthFirstSearch,elesfn$v.dfs=elesfn$v.depthFirstSearch;var hasRequiredHeap$1,heap,hasRequiredHeap,heap$2={exports:{}},heap$1=heap$2.exports;function requireHeap$1(){return hasRequiredHeap$1||(hasRequiredHeap$1=1,module=heap$2,function(){var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min,defaultCmp=function(x,y){return x<y?-1:x>y?1:0},insort=function(a,x,lo,hi,cmp){var mid;if(null==lo&&(lo=0),null==cmp&&(cmp=defaultCmp),lo<0)throw new Error("lo must be non-negative");for(null==hi&&(hi=a.length);lo<hi;)cmp(x,a[mid=floor((lo+hi)/2)])<0?hi=mid:lo=mid+1;return[].splice.apply(a,[lo,lo-lo].concat(x)),x},heappush=function(array,item,cmp){return null==cmp&&(cmp=defaultCmp),array.push(item),_siftdown(array,0,array.length-1,cmp)},heappop=function(array,cmp){var lastelt,returnitem;return null==cmp&&(cmp=defaultCmp),lastelt=array.pop(),array.length?(returnitem=array[0],array[0]=lastelt,_siftup(array,0,cmp)):returnitem=lastelt,returnitem},heapreplace=function(array,item,cmp){var returnitem;return null==cmp&&(cmp=defaultCmp),returnitem=array[0],array[0]=item,_siftup(array,0,cmp),returnitem},heappushpop=function(array,item,cmp){var _ref;return null==cmp&&(cmp=defaultCmp),array.length&&cmp(array[0],item)<0&&(item=(_ref=[array[0],item])[0],array[0]=_ref[1],_siftup(array,0,cmp)),item},heapify=function(array,cmp){var i,_i,_len,_ref1,_results,_results1;for(null==cmp&&(cmp=defaultCmp),_results=[],_i=0,_len=(_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--)_results1.push(_j);return _results1}.apply(this).reverse()).length;_i<_len;_i++)i=_ref1[_i],_results.push(_siftup(array,i,cmp));return _results},updateItem=function(array,item,cmp){var pos;if(null==cmp&&(cmp=defaultCmp),-1!==(pos=array.indexOf(item)))return _siftdown(array,0,pos,cmp),_siftup(array,pos,cmp)},nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(null==cmp&&(cmp=defaultCmp),!(result=array.slice(0,n)).length)return result;for(heapify(result,cmp),_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)elem=_ref[_i],heappushpop(result,elem,cmp);return result.sort(cmp).reverse()},nsmallest=function(array,n,cmp){var elem,los,result,_i,_j,_len,_ref,_ref1,_results;if(null==cmp&&(cmp=defaultCmp),10*n<=array.length){if(!(result=array.slice(0,n).sort(cmp)).length)return result;for(los=result[result.length-1],_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)cmp(elem=_ref[_i],los)<0&&(insort(result,elem,0,null,cmp),result.pop(),los=result[result.length-1]);return result}for(heapify(array,cmp),_results=[],_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;0<=_ref1?++_j:--_j)_results.push(heappop(array,cmp));return _results},_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;for(null==cmp&&(cmp=defaultCmp),newitem=array[pos];pos>startpos&&cmp(newitem,parent=array[parentpos=pos-1>>1])<0;)array[pos]=parent,pos=parentpos;return array[pos]=newitem},_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;for(null==cmp&&(cmp=defaultCmp),endpos=array.length,startpos=pos,newitem=array[pos],childpos=2*pos+1;childpos<endpos;)(rightpos=childpos+1)<endpos&&!(cmp(array[childpos],array[rightpos])<0)&&(childpos=rightpos),array[pos]=array[childpos],childpos=2*(pos=childpos)+1;return array[pos]=newitem,_siftdown(array,startpos,pos,cmp)},Heap=function(){function Heap(cmp){this.cmp=null!=cmp?cmp:defaultCmp,this.nodes=[]}return Heap.push=heappush,Heap.pop=heappop,Heap.replace=heapreplace,Heap.pushpop=heappushpop,Heap.heapify=heapify,Heap.updateItem=updateItem,Heap.nlargest=nlargest,Heap.nsmallest=nsmallest,Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)},Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)},Heap.prototype.peek=function(){return this.nodes[0]},Heap.prototype.contains=function(x){return-1!==this.nodes.indexOf(x)},Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)},Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)},Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)},Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)},Heap.prototype.clear=function(){return this.nodes=[]},Heap.prototype.empty=function(){return 0===this.nodes.length},Heap.prototype.size=function(){return this.nodes.length},Heap.prototype.clone=function(){var heap;return(heap=new Heap).nodes=this.nodes.slice(0),heap},Heap.prototype.toArray=function(){return this.nodes.slice(0)},Heap.prototype.insert=Heap.prototype.push,Heap.prototype.top=Heap.prototype.peek,Heap.prototype.front=Heap.prototype.peek,Heap.prototype.has=Heap.prototype.contains,Heap.prototype.copy=Heap.prototype.clone,Heap}(),module.exports=Heap}.call(heap$1)),heap$2.exports;var module}var _Math$hypot,Heap=getDefaultExportFromCjs(function requireHeap(){return hasRequiredHeap?heap:(hasRequiredHeap=1,heap=requireHeap$1())}()),dijkstraDefaults=defaults$g({root:null,weight:function weight(edge){return 1},directed:!1}),elesfn$u={dijkstra:function dijkstra(options){if(!plainObject(options)){var args=arguments;options={root:args[0],weight:args[1],directed:args[2]}}var _dijkstraDefaults=dijkstraDefaults(options),root=_dijkstraDefaults.root,weight=_dijkstraDefaults.weight,directed=_dijkstraDefaults.directed,eles=this,weightFn=weight,source=string(root)?this.filter(root)[0]:root[0],dist={},prev={},knownDist={},_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy(function(ele){return ele.isLoop()});for(var getDist=function getDist(node){return dist[node.id()]},setDist=function setDist(node,d){dist[node.id()]=d,Q.updateItem(node)},Q=new Heap(function(a,b){return getDist(a)-getDist(b)}),i=0;i<nodes.length;i++){var node=nodes[i];dist[node.id()]=node.same(source)?0:1/0,Q.push(node)}for(var distBetween=function distBetween(u,v){for(var smallestEdge,uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges),smallestDistance=1/0,_i=0;_i<uvs.length;_i++){var edge=uvs[_i],_weight=weightFn(edge);(_weight<smallestDistance||!smallestEdge)&&(smallestDistance=_weight,smallestEdge=edge)}return{edge:smallestEdge,dist:smallestDistance}};Q.size()>0;){var u=Q.pop(),smalletsDist=getDist(u),uid=u.id();if(knownDist[uid]=smalletsDist,smalletsDist!==1/0)for(var neighbors=u.neighborhood().intersect(nodes),_i2=0;_i2<neighbors.length;_i2++){var v=neighbors[_i2],vid=v.id(),vDist=distBetween(u,v),alt=smalletsDist+vDist.dist;alt<getDist(v)&&(setDist(v,alt),prev[vid]={node:u,edge:vDist.edge})}}return{distanceTo:function distanceTo(node){var target=string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function pathTo(node){var target=string(node)?nodes.filter(node)[0]:node[0],S=[],u=target,uid=u.id();if(target.length>0)for(S.unshift(target);prev[uid];){var p=prev[uid];S.unshift(p.edge),S.unshift(p.node),uid=(u=p.node).id()}return eles.spawn(S)}}}},elesfn$t={kruskal:function kruskal(weightFn){weightFn=weightFn||function(edge){return 1};for(var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,numNodes=nodes.length,forest=new Array(numNodes),A=nodes,findSetIndex=function findSetIndex(ele){for(var i=0;i<forest.length;i++){if(forest[i].has(ele))return i}},i=0;i<numNodes;i++)forest[i]=this.spawn(nodes[i]);for(var S=edges.sort(function(a,b){return weightFn(a)-weightFn(b)}),_i=0;_i<S.length;_i++){var edge=S[_i],u=edge.source()[0],v=edge.target()[0],setUIndex=findSetIndex(u),setVIndex=findSetIndex(v),setU=forest[setUIndex],setV=forest[setVIndex];setUIndex!==setVIndex&&(A.merge(edge),setU.merge(setV),forest.splice(setVIndex,1))}return A}},aStarDefaults=defaults$g({root:null,goal:null,weight:function weight(edge){return 1},heuristic:function heuristic(edge){return 0},directed:!1}),elesfn$s={aStar:function aStar(options){var cy=this.cy(),_aStarDefaults=aStarDefaults(options),root=_aStarDefaults.root,goal=_aStarDefaults.goal,heuristic=_aStarDefaults.heuristic,directed=_aStarDefaults.directed,weight=_aStarDefaults.weight;root=cy.collection(root)[0],goal=cy.collection(goal)[0];var cMin,cMinId,sid=root.id(),tid=goal.id(),gScore={},fScore={},closedSetIds={},openSet=new Heap(function(a,b){return fScore[a.id()]-fScore[b.id()]}),openSetIds=new Set$1,cameFrom={},cameFromEdge={},addToOpenSet=function addToOpenSet(ele,id){openSet.push(ele),openSetIds.add(id)},popFromOpenSet=function popFromOpenSet(){cMin=openSet.pop(),cMinId=cMin.id(),openSetIds.delete(cMinId)},isInOpenSet=function isInOpenSet(id){return openSetIds.has(id)};addToOpenSet(root,sid),gScore[sid]=0,fScore[sid]=heuristic(root);for(var steps=0;openSet.size()>0;){if(popFromOpenSet(),steps++,cMinId===tid){for(var path=[],pathNode=goal,pathNodeId=tid,pathEdge=cameFromEdge[pathNodeId];path.unshift(pathNode),null!=pathEdge&&path.unshift(pathEdge),null!=(pathNode=cameFrom[pathNodeId]);)pathEdge=cameFromEdge[pathNodeId=pathNode.id()];return{found:!0,distance:gScore[cMinId],path:this.spawn(path),steps}}closedSetIds[cMinId]=!0;for(var vwEdges=cMin._private.edges,i=0;i<vwEdges.length;i++){var e=vwEdges[i];if(this.hasElementWithId(e.id())&&(!directed||e.data("source")===cMinId)){var wSrc=e.source(),wTgt=e.target(),w=wSrc.id()!==cMinId?wSrc:wTgt,wid=w.id();if(this.hasElementWithId(wid)&&!closedSetIds[wid]){var tempScore=gScore[cMinId]+weight(e);isInOpenSet(wid)?tempScore<gScore[wid]&&(gScore[wid]=tempScore,fScore[wid]=tempScore+heuristic(w),cameFrom[wid]=cMin,cameFromEdge[wid]=e):(gScore[wid]=tempScore,fScore[wid]=tempScore+heuristic(w),addToOpenSet(w,wid),cameFrom[wid]=cMin,cameFromEdge[wid]=e)}}}}return{found:!1,distance:void 0,path:void 0,steps}}},floydWarshallDefaults=defaults$g({weight:function weight(edge){return 1},directed:!1}),elesfn$r={floydWarshall:function floydWarshall(options){for(var cy=this.cy(),_floydWarshallDefault=floydWarshallDefaults(options),weight=_floydWarshallDefault.weight,directed=_floydWarshallDefault.directed,weightFn=weight,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,N=nodes.length,Nsq=N*N,indexOf=function indexOf(node){return nodes.indexOf(node)},atIndex=function atIndex(i){return nodes[i]},dist=new Array(Nsq),n=0;n<Nsq;n++){var j=n%N,i=(n-j)/N;dist[n]=i===j?0:1/0}for(var next=new Array(Nsq),edgeNext=new Array(Nsq),_i=0;_i<edges.length;_i++){var edge=edges[_i],src=edge.source()[0],tgt=edge.target()[0];if(src!==tgt){var s=indexOf(src),t=indexOf(tgt),st=s*N+t,_weight=weightFn(edge);if(dist[st]>_weight&&(dist[st]=_weight,next[st]=t,edgeNext[st]=edge),!directed){var ts=t*N+s;!directed&&dist[ts]>_weight&&(dist[ts]=_weight,next[ts]=s,edgeNext[ts]=edge)}}}for(var k=0;k<N;k++)for(var _i2=0;_i2<N;_i2++)for(var ik=_i2*N+k,_j=0;_j<N;_j++){var ij=_i2*N+_j,kj=k*N+_j;dist[ik]+dist[kj]<dist[ij]&&(dist[ij]=dist[ik]+dist[kj],next[ij]=next[ik])}var indexOfArgEle=function indexOfArgEle(ele){return indexOf(function getArgEle(ele){return(string(ele)?cy.filter(ele):ele)[0]}(ele))},res={distance:function distance(from,to){var i=indexOfArgEle(from),j=indexOfArgEle(to);return dist[i*N+j]},path:function path(from,to){var i=indexOfArgEle(from),j=indexOfArgEle(to),fromNode=atIndex(i);if(i===j)return fromNode.collection();if(null==next[i*N+j])return cy.collection();var edge,path=cy.collection(),prev=i;for(path.merge(fromNode);i!==j;)prev=i,i=next[i*N+j],edge=edgeNext[prev*N+i],path.merge(edge),path.merge(atIndex(i));return path}};return res}},bellmanFordDefaults=defaults$g({weight:function weight(edge){return 1},directed:!1,root:null}),elesfn$q={bellmanFord:function bellmanFord(options){var _this=this,_bellmanFordDefaults=bellmanFordDefaults(options),weight=_bellmanFordDefaults.weight,directed=_bellmanFordDefaults.directed,root=_bellmanFordDefaults.root,weightFn=weight,eles=this,cy=this.cy(),_this$byGroup=this.byGroup(),edges=_this$byGroup.edges,nodes=_this$byGroup.nodes,numNodes=nodes.length,infoMap=new Map$1,hasNegativeWeightCycle=!1,negativeWeightCycles=[];root=cy.collection(root)[0],edges.unmergeBy(function(edge){return edge.isLoop()});for(var numEdges=edges.length,getInfo=function getInfo(node){var obj=infoMap.get(node.id());return obj||(obj={},infoMap.set(node.id(),obj)),obj},getNodeFromTo=function getNodeFromTo(to){return(string(to)?cy.$(to):to)[0]},i=0;i<numNodes;i++){var node=nodes[i],info=getInfo(node);node.same(root)?info.dist=0:info.dist=1/0,info.pred=null,info.edge=null}for(var replacedEdge=!1,checkForEdgeReplacement=function checkForEdgeReplacement(node1,node2,edge,info1,info2,weight){var dist=info1.dist+weight;dist<info2.dist&&!edge.same(info1.edge)&&(info2.dist=dist,info2.pred=node1,info2.edge=edge,replacedEdge=!0)},_i=1;_i<numNodes;_i++){replacedEdge=!1;for(var e=0;e<numEdges;e++){var edge=edges[e],src=edge.source(),tgt=edge.target(),_weight=weightFn(edge),srcInfo=getInfo(src),tgtInfo=getInfo(tgt);checkForEdgeReplacement(src,0,edge,srcInfo,tgtInfo,_weight),directed||checkForEdgeReplacement(tgt,0,edge,tgtInfo,srcInfo,_weight)}if(!replacedEdge)break}if(replacedEdge)for(var negativeWeightCycleIds=[],_e=0;_e<numEdges;_e++){var _edge=edges[_e],_src=_edge.source(),_tgt=_edge.target(),_weight2=weightFn(_edge),srcDist=getInfo(_src).dist,tgtDist=getInfo(_tgt).dist;if(srcDist+_weight2<tgtDist||!directed&&tgtDist+_weight2<srcDist){if(hasNegativeWeightCycle||(warn("Graph contains a negative weight cycle for Bellman-Ford"),hasNegativeWeightCycle=!0),!1===options.findNegativeWeightCycles)break;var negativeNodes=[];srcDist+_weight2<tgtDist&&negativeNodes.push(_src),!directed&&tgtDist+_weight2<srcDist&&negativeNodes.push(_tgt);for(var numNegativeNodes=negativeNodes.length,n=0;n<numNegativeNodes;n++){var start=negativeNodes[n],cycle=[start];cycle.push(getInfo(start).edge);for(var _node=getInfo(start).pred;-1===cycle.indexOf(_node);)cycle.push(_node),cycle.push(getInfo(_node).edge),_node=getInfo(_node).pred;for(var smallestId=(cycle=cycle.slice(cycle.indexOf(_node)))[0].id(),smallestIndex=0,c=2;c<cycle.length;c+=2)cycle[c].id()<smallestId&&(smallestId=cycle[c].id(),smallestIndex=c);(cycle=cycle.slice(smallestIndex).concat(cycle.slice(0,smallestIndex))).push(cycle[0]);var cycleId=cycle.map(function(el){return el.id()}).join(",");-1===negativeWeightCycleIds.indexOf(cycleId)&&(negativeWeightCycles.push(eles.spawn(cycle)),negativeWeightCycleIds.push(cycleId))}}}return{distanceTo:function distanceTo(to){return getInfo(getNodeFromTo(to)).dist},pathTo:function pathTo(to){for(var thisStart=arguments.length>1&&void 0!==arguments[1]?arguments[1]:root,path=[],node=getNodeFromTo(to);;){if(null==node)return _this.spawn();var _getInfo=getInfo(node),edge=_getInfo.edge,pred=_getInfo.pred;if(path.unshift(node[0]),node.same(thisStart)&&path.length>0)break;null!=edge&&path.unshift(edge),node=pred}return eles.spawn(path)},hasNegativeWeightCycle,negativeWeightCycles}}},sqrt2=Math.sqrt(2),collapse=function collapse(edgeIndex,nodeMap,remainingEdges){0===remainingEdges.length&&error("Karger-Stein must be run on a connected (sub)graph");for(var edgeInfo=remainingEdges[edgeIndex],sourceIn=edgeInfo[1],targetIn=edgeInfo[2],partition1=nodeMap[sourceIn],partition2=nodeMap[targetIn],newEdges=remainingEdges,i=newEdges.length-1;i>=0;i--){var edge=newEdges[i],src=edge[1],tgt=edge[2];(nodeMap[src]===partition1&&nodeMap[tgt]===partition2||nodeMap[src]===partition2&&nodeMap[tgt]===partition1)&&newEdges.splice(i,1)}for(var _i=0;_i<newEdges.length;_i++){var _edge=newEdges[_i];_edge[1]===partition2?(newEdges[_i]=_edge.slice(),newEdges[_i][1]=partition1):_edge[2]===partition2&&(newEdges[_i]=_edge.slice(),newEdges[_i][2]=partition1)}for(var _i2=0;_i2<nodeMap.length;_i2++)nodeMap[_i2]===partition2&&(nodeMap[_i2]=partition1);return newEdges},contractUntil=function contractUntil(metaNodeMap,remainingEdges,size,sizeLimit){for(;size>sizeLimit;){var edgeIndex=Math.floor(Math.random()*remainingEdges.length);remainingEdges=collapse(edgeIndex,metaNodeMap,remainingEdges),size--}return remainingEdges},elesfn$p={kargerStein:function kargerStein(){var _this=this,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy(function(edge){return edge.isLoop()});var numNodes=nodes.length,numEdges=edges.length,numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2)),stopSize=Math.floor(numNodes/sqrt2);if(!(numNodes<2)){for(var edgeIndexes=[],i=0;i<numEdges;i++){var e=edges[i];edgeIndexes.push([i,nodes.indexOf(e.source()),nodes.indexOf(e.target())])}for(var minCutSize=1/0,minCutEdgeIndexes=[],minCutNodeMap=new Array(numNodes),metaNodeMap=new Array(numNodes),metaNodeMap2=new Array(numNodes),copyNodesMap=function copyNodesMap(from,to){for(var _i3=0;_i3<numNodes;_i3++)to[_i3]=from[_i3]},iter=0;iter<=numIter;iter++){for(var _i4=0;_i4<numNodes;_i4++)metaNodeMap[_i4]=_i4;var edgesState=contractUntil(metaNodeMap,edgeIndexes.slice(),numNodes,stopSize),edgesState2=edgesState.slice();copyNodesMap(metaNodeMap,metaNodeMap2);var res1=contractUntil(metaNodeMap,edgesState,stopSize,2),res2=contractUntil(metaNodeMap2,edgesState2,stopSize,2);res1.length<=res2.length&&res1.length<minCutSize?(minCutSize=res1.length,minCutEdgeIndexes=res1,copyNodesMap(metaNodeMap,minCutNodeMap)):res2.length<=res1.length&&res2.length<minCutSize&&(minCutSize=res2.length,minCutEdgeIndexes=res2,copyNodesMap(metaNodeMap2,minCutNodeMap))}for(var cut=this.spawn(minCutEdgeIndexes.map(function(e){return edges[e[0]]})),partition1=this.spawn(),partition2=this.spawn(),witnessNodePartition=minCutNodeMap[0],_i5=0;_i5<minCutNodeMap.length;_i5++){var partitionId=minCutNodeMap[_i5],node=nodes[_i5];partitionId===witnessNodePartition?partition1.merge(node):partition2.merge(node)}var constructComponent=function constructComponent(subset){var component=_this.spawn();return subset.forEach(function(node){component.merge(node),node.connectedEdges().forEach(function(edge){_this.contains(edge)&&!cut.contains(edge)&&component.merge(edge)})}),component},components=[constructComponent(partition1),constructComponent(partition2)];return{cut,components,partition1,partition2}}error("At least 2 nodes are required for Karger-Stein algorithm")}},modelToRenderedPosition$1=function modelToRenderedPosition(p,zoom,pan){return{x:p.x*zoom+pan.x,y:p.y*zoom+pan.y}},renderedToModelPosition=function renderedToModelPosition(p,zoom,pan){return{x:(p.x-pan.x)/zoom,y:(p.y-pan.y)/zoom}},array2point=function array2point(arr){return{x:arr[0],y:arr[1]}},getAngleFromDisp=function getAngleFromDisp(dispX,dispY){return Math.atan2(dispY,dispX)-Math.PI/2},log2=Math.log2||function(n){return Math.log(n)/Math.log(2)},signum=function signum(x){return x>0?1:x<0?-1:0},dist=function dist(p1,p2){return Math.sqrt(sqdist(p1,p2))},sqdist=function sqdist(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},inPlaceSumNormalize=function inPlaceSumNormalize(v){for(var length=v.length,total=0,i=0;i<length;i++)total+=v[i];for(var _i=0;_i<length;_i++)v[_i]=v[_i]/total;return v},qbezierAt=function qbezierAt(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2},qbezierPtAt=function qbezierPtAt(p0,p1,p2,t){return{x:qbezierAt(p0.x,p1.x,p2.x,t),y:qbezierAt(p0.y,p1.y,p2.y,t)}},bound=function bound(min,val,max){return Math.max(min,Math.min(max,val))},makeBoundingBox=function makeBoundingBox(bb){if(null==bb)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(null!=bb.x1&&null!=bb.y1){if(null!=bb.x2&&null!=bb.y2&&bb.x2>=bb.x1&&bb.y2>=bb.y1)return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1};if(null!=bb.w&&null!=bb.h&&bb.w>=0&&bb.h>=0)return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}},updateBoundingBox=function updateBoundingBox(bb1,bb2){bb1.x1=Math.min(bb1.x1,bb2.x1),bb1.x2=Math.max(bb1.x2,bb2.x2),bb1.w=bb1.x2-bb1.x1,bb1.y1=Math.min(bb1.y1,bb2.y1),bb1.y2=Math.max(bb1.y2,bb2.y2),bb1.h=bb1.y2-bb1.y1},expandBoundingBoxByPoint=function expandBoundingBoxByPoint(bb,x,y){bb.x1=Math.min(bb.x1,x),bb.x2=Math.max(bb.x2,x),bb.w=bb.x2-bb.x1,bb.y1=Math.min(bb.y1,y),bb.y2=Math.max(bb.y2,y),bb.h=bb.y2-bb.y1},expandBoundingBox=function expandBoundingBox(bb){var padding=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return bb.x1-=padding,bb.x2+=padding,bb.y1-=padding,bb.y2+=padding,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,bb},expandBoundingBoxSides=function expandBoundingBoxSides(bb){var top,right,bottom,left,padding=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];if(1===padding.length)top=right=bottom=left=padding[0];else if(2===padding.length)top=bottom=padding[0],left=right=padding[1];else if(4===padding.length){var _padding=_slicedToArray(padding,4);top=_padding[0],right=_padding[1],bottom=_padding[2],left=_padding[3]}return bb.x1-=left,bb.x2+=right,bb.y1-=top,bb.y2+=bottom,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,bb},assignBoundingBox=function assignBoundingBox(bb1,bb2){bb1.x1=bb2.x1,bb1.y1=bb2.y1,bb1.x2=bb2.x2,bb1.y2=bb2.y2,bb1.w=bb1.x2-bb1.x1,bb1.h=bb1.y2-bb1.y1},boundingBoxesIntersect=function boundingBoxesIntersect(bb1,bb2){return!(bb1.x1>bb2.x2)&&(!(bb2.x1>bb1.x2)&&(!(bb1.x2<bb2.x1)&&(!(bb2.x2<bb1.x1)&&(!(bb1.y2<bb2.y1)&&(!(bb2.y2<bb1.y1)&&(!(bb1.y1>bb2.y2)&&!(bb2.y1>bb1.y2)))))))},inBoundingBox=function inBoundingBox(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2},pointInBoundingBox=function pointInBoundingBox(bb,pt){return inBoundingBox(bb,pt.x,pt.y)},boundingBoxInBoundingBox=function boundingBoxInBoundingBox(bb1,bb2){return inBoundingBox(bb1,bb2.x1,bb2.y1)&&inBoundingBox(bb1,bb2.x2,bb2.y2)},hypot=null!==(_Math$hypot=Math.hypot)&&void 0!==_Math$hypot?_Math$hypot:function(x,y){return Math.sqrt(x*x+y*y)};function miterBox(pts,centerX,centerY,width,height,strokeWidth){var offsetPoints=function inflatePolygon(polygon,d){if(polygon.length<3)throw new Error("Need at least 3 vertices");var add=function add(a,b){return{x:a.x+b.x,y:a.y+b.y}},sub=function sub(a,b){return{x:a.x-b.x,y:a.y-b.y}},scale=function scale(v,s){return{x:v.x*s,y:v.y*s}},cross=function cross(u,v){return u.x*v.y-u.y*v.x},normalize=function normalize(v){var len=hypot(v.x,v.y);return 0===len?{x:0,y:0}:{x:v.x/len,y:v.y/len}},intersectLines=function intersectLines(p1,p2,p3,p4){var r=sub(p2,p1),s=sub(p4,p3),denom=cross(r,s);if(Math.abs(denom)<1e-9)return add(p1,scale(r,.5));var t=cross(sub(p3,p1),s)/denom;return add(p1,scale(r,t))},pts=polygon.map(function(p){return{x:p.x,y:p.y}});(function signedArea(pts){for(var A=0,i=0;i<pts.length;i++){var p=pts[i],q=pts[(i+1)%pts.length];A+=p.x*q.y-q.x*p.y}return A/2})(pts)<0&&pts.reverse();for(var n=pts.length,normals=[],i=0;i<n;i++){var p=pts[i],q=pts[(i+1)%n],edge=sub(q,p),out=normalize({x:edge.y,y:-edge.x});normals.push(out)}for(var offsetEdges=normals.map(function(nrm,i){return{p1:add(pts[i],scale(nrm,d)),p2:add(pts[(i+1)%n],scale(nrm,d))}}),inflated=[],_i2=0;_i2<n;_i2++){var prevEdge=offsetEdges[(_i2-1+n)%n],currEdge=offsetEdges[_i2],ip=intersectLines(prevEdge.p1,prevEdge.p2,currEdge.p1,currEdge.p2);inflated.push(ip)}return inflated}(transformPoints(pts,centerX,centerY,width,height),strokeWidth),bb=makeBoundingBox();return offsetPoints.forEach(function(pt){return expandBoundingBoxByPoint(bb,pt.x,pt.y)}),bb}var roundRectangleIntersectLine=function roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding){var straightLineIntersections,arcIntersections,radius=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"auto",cornerRadius="auto"===radius?getRoundRectangleRadius(width,height):radius,halfWidth=width/2,halfHeight=height/2,doWidth=(cornerRadius=Math.min(cornerRadius,halfWidth,halfHeight))!==halfWidth,doHeight=cornerRadius!==halfHeight;if(doWidth){var topStartY=nodeY-halfHeight-padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-halfWidth+cornerRadius-padding,topStartY,nodeX+halfWidth-cornerRadius+padding,topStartY,!1)).length>0)return straightLineIntersections}if(doHeight){var rightStartX=nodeX+halfWidth+padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,nodeY-halfHeight+cornerRadius-padding,rightStartX,nodeY+halfHeight-cornerRadius+padding,!1)).length>0)return straightLineIntersections}if(doWidth){var bottomStartY=nodeY+halfHeight+padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-halfWidth+cornerRadius-padding,bottomStartY,nodeX+halfWidth-cornerRadius+padding,bottomStartY,!1)).length>0)return straightLineIntersections}if(doHeight){var leftStartX=nodeX-halfWidth-padding;if((straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,nodeY-halfHeight+cornerRadius-padding,leftStartX,nodeY+halfHeight-cornerRadius+padding,!1)).length>0)return straightLineIntersections}var topLeftCenterX=nodeX-halfWidth+cornerRadius,topLeftCenterY=nodeY-halfHeight+cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY)return[arcIntersections[0],arcIntersections[1]];var topRightCenterX=nodeX+halfWidth-cornerRadius,topRightCenterY=nodeY-halfHeight+cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomRightCenterX=nodeX+halfWidth-cornerRadius,bottomRightCenterY=nodeY+halfHeight-cornerRadius;if((arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomLeftCenterX=nodeX-halfWidth+cornerRadius,bottomLeftCenterY=nodeY+halfHeight-cornerRadius;return(arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding)).length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY?[arcIntersections[0],arcIntersections[1]]:[]},inLineVicinity=function inLineVicinity(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance,x1=Math.min(lx1,lx2),x2=Math.max(lx1,lx2),y1=Math.min(ly1,ly2),y2=Math.max(ly1,ly2);return x1-t<=x&&x<=x2+t&&y1-t<=y&&y<=y2+t},inBezierVicinity=function inBezierVicinity(x,y,x1,y1,x2,y2,x3,y3,tolerance){var bb_x1=Math.min(x1,x3,x2)-tolerance,bb_x2=Math.max(x1,x3,x2)+tolerance,bb_y1=Math.min(y1,y3,y2)-tolerance,bb_y2=Math.max(y1,y3,y2)+tolerance;return!(x<bb_x1||x>bb_x2||y<bb_y1||y>bb_y2)},sqdistToQuadraticBezier=function sqdistToQuadraticBezier(x,y,x1,y1,x2,y2,x3,y3){var roots=[];!function solveCubic(a,b,c,d,result){var discriminant,q,r,dum1,s,t,term1,r13;0===a&&(a=1e-5),r=-27*(d/=a)+(b/=a)*(9*(c/=a)-b*b*2),discriminant=(q=(3*c-b*b)/9)*q*q+(r/=54)*r,result[1]=0,term1=b/3,discriminant>0?(s=(s=r+Math.sqrt(discriminant))<0?-Math.pow(-s,1/3):Math.pow(s,1/3),t=(t=r-Math.sqrt(discriminant))<0?-Math.pow(-t,1/3):Math.pow(t,1/3),result[0]=-term1+s+t,term1+=(s+t)/2,result[4]=result[2]=-term1,term1=Math.sqrt(3)*(-t+s)/2,result[3]=term1,result[5]=-term1):(result[5]=result[3]=0,0===discriminant?(r13=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3),result[0]=2*r13-term1,result[4]=result[2]=-(r13+term1)):(dum1=(q=-q)*q*q,dum1=Math.acos(r/Math.sqrt(dum1)),r13=2*Math.sqrt(q),result[0]=-term1+r13*Math.cos(dum1/3),result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3),result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3)))}(1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3,9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3,3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y,1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y,roots);for(var params=[],index=0;index<6;index+=2)Math.abs(roots[index+1])<1e-7&&roots[index]>=0&&roots[index]<=1&&params.push(roots[index]);params.push(1),params.push(0);for(var curX,curY,distSquared,minDistanceSquared=-1,i=0;i<params.length;i++)curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3,curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3,distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2),minDistanceSquared>=0?distSquared<minDistanceSquared&&(minDistanceSquared=distSquared):minDistanceSquared=distSquared;return minDistanceSquared},sqdistToFiniteLine=function sqdistToFiniteLine(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1],line=[x2-x1,y2-y1],lineSq=line[0]*line[0]+line[1]*line[1],hypSq=offset[0]*offset[0]+offset[1]*offset[1],dotProduct=offset[0]*line[0]+offset[1]*line[1],adjSq=dotProduct*dotProduct/lineSq;return dotProduct<0?hypSq:adjSq>lineSq?(x-x2)*(x-x2)+(y-y2)*(y-y2):hypSq-adjSq},pointInsidePolygonPoints=function pointInsidePolygonPoints(x,y,points){for(var x1,y1,x2,y2,up=0,i=0;i<points.length/2;i++)if(x1=points[2*i],y1=points[2*i+1],i+1<points.length/2?(x2=points[2*(i+1)],y2=points[2*(i+1)+1]):(x2=points[2*(i+1-points.length/2)],y2=points[2*(i+1-points.length/2)+1]),x1==x&&x2==x);else{if(!(x1>=x&&x>=x2||x1<=x&&x<=x2))continue;(x-x1)/(x2-x1)*(y2-y1)+y1>y&&up++}return up%2!=0},pointInsidePolygon=function pointInsidePolygon(x,y,basePoints,centerX,centerY,width,height,direction,padding){var angle,transformedPoints=new Array(basePoints.length);null!=direction[0]?(angle=Math.atan(direction[1]/direction[0]),direction[0]<0?angle+=Math.PI/2:angle=-angle-Math.PI/2):angle=direction;for(var points,cos=Math.cos(-angle),sin=Math.sin(-angle),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=width/2*(basePoints[2*i]*cos-basePoints[2*i+1]*sin),transformedPoints[2*i+1]=height/2*(basePoints[2*i+1]*cos+basePoints[2*i]*sin),transformedPoints[2*i]+=centerX,transformedPoints[2*i+1]+=centerY;if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else points=transformedPoints;return pointInsidePolygonPoints(x,y,points)},joinLines=function joinLines(lineSet){for(var currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,vertices=new Array(lineSet.length/2),i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[4*i],currentLineStartY=lineSet[4*i+1],currentLineEndX=lineSet[4*i+2],currentLineEndY=lineSet[4*i+3],i<lineSet.length/4-1?(nextLineStartX=lineSet[4*(i+1)],nextLineStartY=lineSet[4*(i+1)+1],nextLineEndX=lineSet[4*(i+1)+2],nextLineEndY=lineSet[4*(i+1)+3]):(nextLineStartX=lineSet[0],nextLineStartY=lineSet[1],nextLineEndX=lineSet[2],nextLineEndY=lineSet[3]);var intersection=finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,!0);vertices[2*i]=intersection[0],vertices[2*i+1]=intersection[1]}return vertices},expandPolygon=function expandPolygon(points,pad){for(var currentPointX,currentPointY,nextPointX,nextPointY,expandedLineSet=new Array(2*points.length),i=0;i<points.length/2;i++){currentPointX=points[2*i],currentPointY=points[2*i+1],i<points.length/2-1?(nextPointX=points[2*(i+1)],nextPointY=points[2*(i+1)+1]):(nextPointX=points[0],nextPointY=points[1]);var offsetX=nextPointY-currentPointY,offsetY=-(nextPointX-currentPointX),offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY),normalizedOffsetX=offsetX/offsetLength,normalizedOffsetY=offsetY/offsetLength;expandedLineSet[4*i]=currentPointX+normalizedOffsetX*pad,expandedLineSet[4*i+1]=currentPointY+normalizedOffsetY*pad,expandedLineSet[4*i+2]=nextPointX+normalizedOffsetX*pad,expandedLineSet[4*i+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet},checkInEllipse=function checkInEllipse(x,y,width,height,centerX,centerY,padding){return x-=centerX,y-=centerY,(x/=width/2+padding)*x+(y/=height/2+padding)*y<=1},intersectLineCircle=function intersectLineCircle(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1],f=[x1-centerX,y1-centerY],a=d[0]*d[0]+d[1]*d[1],b=2*(f[0]*d[0]+f[1]*d[1]),discriminant=b*b-4*a*(f[0]*f[0]+f[1]*f[1]-radius*radius);if(discriminant<0)return[];var t1=(-b+Math.sqrt(discriminant))/(2*a),t2=(-b-Math.sqrt(discriminant))/(2*a),tMin=Math.min(t1,t2),tMax=Math.max(t1,t2),inRangeParams=[];if(tMin>=0&&tMin<=1&&inRangeParams.push(tMin),tMax>=0&&tMax<=1&&inRangeParams.push(tMax),0===inRangeParams.length)return[];var nearIntersectionX=inRangeParams[0]*d[0]+x1,nearIntersectionY=inRangeParams[0]*d[1]+y1;return inRangeParams.length>1?inRangeParams[0]==inRangeParams[1]?[nearIntersectionX,nearIntersectionY]:[nearIntersectionX,nearIntersectionY,inRangeParams[1]*d[0]+x1,inRangeParams[1]*d[1]+y1]:[nearIntersectionX,nearIntersectionY]},midOfThree=function midOfThree(a,b,c){return b<=a&&a<=c||c<=a&&a<=b?a:a<=b&&b<=c||c<=b&&b<=a?b:c},finiteLinesIntersect=function finiteLinesIntersect(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var dx13=x1-x3,dx21=x2-x1,dx43=x4-x3,dy13=y1-y3,dy21=y2-y1,dy43=y4-y3,ua_t=dx43*dy13-dy43*dx13,ub_t=dx21*dy13-dy21*dx13,u_b=dy43*dx21-dx43*dy21;if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b;return-.001<=ua&&ua<=1.001&&-.001<=ub&&ub<=1.001||infiniteLines?[x1+ua*dx21,y1+ua*dy21]:[]}return 0===ua_t||0===ub_t?midOfThree(x1,x2,x4)===x4?[x4,y4]:midOfThree(x1,x2,x3)===x3?[x3,y3]:midOfThree(x3,x4,x2)===x2?[x2,y2]:[]:[]},transformPoints=function transformPoints(points,centerX,centerY,width,height){var ret=[],halfW=width/2,halfH=height/2,x=centerX,y=centerY;ret.push({x:x+halfW*points[0],y:y+halfH*points[1]});for(var i=1;i<points.length/2;i++)ret.push({x:x+halfW*points[2*i],y:y+halfH*points[2*i+1]});return ret},polygonIntersectLine=function polygonIntersectLine(x,y,basePoints,centerX,centerY,width,height,padding){var intersection,points,currentX,currentY,nextX,nextY,intersections=[],transformedPoints=new Array(basePoints.length),doTransform=!0;if(null==width&&(doTransform=!1),doTransform){for(var i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=basePoints[2*i]*width+centerX,transformedPoints[2*i+1]=basePoints[2*i+1]*height+centerY;if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else points=transformedPoints}else points=basePoints;for(var _i3=0;_i3<points.length/2;_i3++)currentX=points[2*_i3],currentY=points[2*_i3+1],_i3<points.length/2-1?(nextX=points[2*(_i3+1)],nextY=points[2*(_i3+1)+1]):(nextX=points[0],nextY=points[1]),0!==(intersection=finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY)).length&&intersections.push(intersection[0],intersection[1]);return intersections},shortenIntersection=function shortenIntersection(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]],length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]),lenRatio=(length-amount)/length;return lenRatio<0&&(lenRatio=1e-5),[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]},generateUnitNgonPointsFitToSquare=function generateUnitNgonPointsFitToSquare(sides,rotationRadians){var points=generateUnitNgonPoints(sides,rotationRadians);return points=fitPolygonToSquare(points)},fitPolygonToSquare=function fitPolygonToSquare(points){for(var x,y,sides=points.length/2,minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i<sides;i++)x=points[2*i],y=points[2*i+1],minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);for(var sx=2/(maxX-minX),sy=2/(maxY-minY),_i5=0;_i5<sides;_i5++)x=points[2*_i5]=points[2*_i5]*sx,y=points[2*_i5+1]=points[2*_i5+1]*sy,minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);if(minY<-1)for(var _i6=0;_i6<sides;_i6++)y=points[2*_i6+1]=points[2*_i6+1]+(-1-minY);return points},generateUnitNgonPoints=function generateUnitNgonPoints(sides,rotationRadians){var increment=1/sides*2*Math.PI,startAngle=sides%2==0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;for(var currentAngle,points=new Array(2*sides),i=0;i<sides;i++)currentAngle=i*increment+startAngle,points[2*i]=Math.cos(currentAngle),points[2*i+1]=Math.sin(-currentAngle);return points},getRoundRectangleRadius=function getRoundRectangleRadius(width,height){return Math.min(width/4,height/4,8)},getRoundPolygonRadius=function getRoundPolygonRadius(width,height){return Math.min(width/10,height/10,8)},getBarrelCurveConstants=function getBarrelCurveConstants(width,height){return{heightOffset:Math.min(15,.05*height),widthOffset:Math.min(100,.25*width),ctrlPtOffsetPct:.05}};function satPolygonIntersection(poly1,poly2){function getAxes(polygon){for(var axes=[],i=0;i<polygon.length;i++){var p1=polygon[i],p2=polygon[(i+1)%polygon.length],edge={x:p2.x-p1.x,y:p2.y-p1.y},normal={x:-edge.y,y:edge.x},length=Math.sqrt(normal.x*normal.x+normal.y*normal.y);axes.push({x:normal.x/length,y:normal.y/length})}return axes}function project(polygon,axis){var _step,min=1/0,max=-1/0,_iterator=_createForOfIteratorHelper(polygon);try{for(_iterator.s();!(_step=_iterator.n()).done;){var point=_step.value,projection=point.x*axis.x+point.y*axis.y;min=Math.min(min,projection),max=Math.max(max,projection)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{min,max}}function overlaps(proj1,proj2){return!(proj1.max<proj2.min||proj2.max<proj1.min)}var _step2,_iterator2=_createForOfIteratorHelper([].concat(_toConsumableArray(getAxes(poly1)),_toConsumableArray(getAxes(poly2))));try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var axis=_step2.value;if(!overlaps(project(poly1,axis),project(poly2,axis)))return!1}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return!0}var pageRankDefaults=defaults$g({dampingFactor:.8,precision:1e-6,iterations:200,weight:function weight(edge){return 1}}),elesfn$o={pageRank:function pageRank(options){for(var _pageRankDefaults=pageRankDefaults(options),dampingFactor=_pageRankDefaults.dampingFactor,precision=_pageRankDefaults.precision,iterations=_pageRankDefaults.iterations,weight=_pageRankDefaults.weight,cy=this._private.cy,_this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges,numNodes=nodes.length,numNodesSqd=numNodes*numNodes,numEdges=edges.length,matrix=new Array(numNodesSqd),columnSum=new Array(numNodes),additionalProb=(1-dampingFactor)/numNodes,i=0;i<numNodes;i++){for(var j=0;j<numNodes;j++){matrix[i*numNodes+j]=0}columnSum[i]=0}for(var _i=0;_i<numEdges;_i++){var edge=edges[_i],srcId=edge.data("source"),tgtId=edge.data("target");if(srcId!==tgtId){var s=nodes.indexOfId(srcId),t=nodes.indexOfId(tgtId),w=weight(edge);matrix[t*numNodes+s]+=w,columnSum[s]+=w}}for(var p=1/numNodes+additionalProb,_j=0;_j<numNodes;_j++)if(0===columnSum[_j])for(var _i2=0;_i2<numNodes;_i2++){matrix[_i2*numNodes+_j]=p}else for(var _i3=0;_i3<numNodes;_i3++){var _n3=_i3*numNodes+_j;matrix[_n3]=matrix[_n3]/columnSum[_j]+additionalProb}for(var previous,eigenvector=new Array(numNodes),temp=new Array(numNodes),_i4=0;_i4<numNodes;_i4++)eigenvector[_i4]=1;for(var iter=0;iter<iterations;iter++){for(var _i5=0;_i5<numNodes;_i5++)temp[_i5]=0;for(var _i6=0;_i6<numNodes;_i6++)for(var _j2=0;_j2<numNodes;_j2++){var _n4=_i6*numNodes+_j2;temp[_i6]+=matrix[_n4]*eigenvector[_j2]}inPlaceSumNormalize(temp),previous=eigenvector,eigenvector=temp,temp=previous;for(var diff=0,_i7=0;_i7<numNodes;_i7++){var delta=previous[_i7]-eigenvector[_i7];diff+=delta*delta}if(diff<precision)break}return{rank:function rank(node){return node=cy.collection(node)[0],eigenvector[nodes.indexOf(node)]}}}},defaults$f=defaults$g({root:null,weight:function weight(edge){return 1},directed:!1,alpha:0}),elesfn$n={degreeCentralityNormalized:function degreeCentralityNormalized(options){options=defaults$f(options);var cy=this.cy(),nodes=this.nodes(),numNodes=nodes.length;if(options.directed){for(var indegrees={},outdegrees={},maxIndegree=0,maxOutdegree=0,_i=0;_i<numNodes;_i++){var _node=nodes[_i],id=_node.id();options.root=_node;var _currDegree=this.degreeCentrality(options);maxIndegree<_currDegree.indegree&&(maxIndegree=_currDegree.indegree),maxOutdegree<_currDegree.outdegree&&(maxOutdegree=_currDegree.outdegree),indegrees[id]=_currDegree.indegree,outdegrees[id]=_currDegree.outdegree}return{indegree:function indegree(node){return 0==maxIndegree?0:(string(node)&&(node=cy.filter(node)),indegrees[node.id()]/maxIndegree)},outdegree:function outdegree(node){return 0===maxOutdegree?0:(string(node)&&(node=cy.filter(node)),outdegrees[node.id()]/maxOutdegree)}}}for(var degrees={},maxDegree=0,i=0;i<numNodes;i++){var node=nodes[i];options.root=node;var currDegree=this.degreeCentrality(options);maxDegree<currDegree.degree&&(maxDegree=currDegree.degree),degrees[node.id()]=currDegree.degree}return{degree:function degree(node){return 0===maxDegree?0:(string(node)&&(node=cy.filter(node)),degrees[node.id()]/maxDegree)}}},degreeCentrality:function degreeCentrality(options){options=defaults$f(options);var cy=this.cy(),callingEles=this,_options=options,root=_options.root,weight=_options.weight,directed=_options.directed,alpha=_options.alpha;if(root=cy.collection(root)[0],directed){for(var edges=root.connectedEdges(),incoming=edges.filter(function(edge){return edge.target().same(root)&&callingEles.has(edge)}),outgoing=edges.filter(function(edge){return edge.source().same(root)&&callingEles.has(edge)}),k_in=incoming.length,k_out=outgoing.length,s_in=0,s_out=0,_i2=0;_i2<incoming.length;_i2++)s_in+=weight(incoming[_i2]);for(var _i3=0;_i3<outgoing.length;_i3++)s_out+=weight(outgoing[_i3]);return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}for(var connEdges=root.connectedEdges().intersection(callingEles),k=connEdges.length,s=0,i=0;i<connEdges.length;i++)s+=weight(connEdges[i]);return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}}};elesfn$n.dc=elesfn$n.degreeCentrality,elesfn$n.dcn=elesfn$n.degreeCentralityNormalised=elesfn$n.degreeCentralityNormalized;var defaults$e=defaults$g({harmonic:!0,weight:function weight(){return 1},directed:!1,root:null}),elesfn$m={closenessCentralityNormalized:function closenessCentralityNormalized(options){for(var _defaults=defaults$e(options),harmonic=_defaults.harmonic,weight=_defaults.weight,directed=_defaults.directed,cy=this.cy(),closenesses={},maxCloseness=0,nodes=this.nodes(),fw=this.floydWarshall({weight,directed}),i=0;i<nodes.length;i++){for(var currCloseness=0,node_i=nodes[i],j=0;j<nodes.length;j++)if(i!==j){var d=fw.distance(node_i,nodes[j]);currCloseness+=harmonic?1/d:d}harmonic||(currCloseness=1/currCloseness),maxCloseness<currCloseness&&(maxCloseness=currCloseness),closenesses[node_i.id()]=currCloseness}return{closeness:function closeness(node){return 0==maxCloseness?0:(node=string(node)?cy.filter(node)[0].id():node.id(),closenesses[node]/maxCloseness)}}},closenessCentrality:function closenessCentrality(options){var _defaults2=defaults$e(options),root=_defaults2.root,weight=_defaults2.weight,directed=_defaults2.directed,harmonic=_defaults2.harmonic;root=this.filter(root)[0];for(var dijkstra=this.dijkstra({root,weight,directed}),totalDistance=0,nodes=this.nodes(),i=0;i<nodes.length;i++){var n=nodes[i];if(!n.same(root)){var d=dijkstra.distanceTo(n);totalDistance+=harmonic?1/d:d}}return harmonic?totalDistance:1/totalDistance}};elesfn$m.cc=elesfn$m.closenessCentrality,elesfn$m.ccn=elesfn$m.closenessCentralityNormalised=elesfn$m.closenessCentralityNormalized;var defaults$d=defaults$g({weight:null,directed:!1}),elesfn$l={betweennessCentrality:function betweennessCentrality(options){for(var _defaults=defaults$d(options),directed=_defaults.directed,weight=_defaults.weight,weighted=null!=weight,cy=this.cy(),V=this.nodes(),A={},_C={},max=0,C_set=function set(key,val){_C[key]=val,val>max&&(max=val)},C_get=function get(key){return _C[key]},i=0;i<V.length;i++){var v=V[i],vid=v.id();A[vid]=directed?v.outgoers().nodes():v.openNeighborhood().nodes(),C_set(vid,0)}for(var _loop=function _loop(){for(var sid=V[s].id(),S=[],P={},g={},d={},Q=new Heap(function(a,b){return d[a]-d[b]}),_i=0;_i<V.length;_i++){var _vid=V[_i].id();P[_vid]=[],g[_vid]=0,d[_vid]=1/0}for(g[sid]=1,d[sid]=0,Q.push(sid);!Q.empty();){var _v=Q.pop();if(S.push(_v),weighted)for(var j=0;j<A[_v].length;j++){var w=A[_v][j],vEle=cy.getElementById(_v),edge=void 0;edge=vEle.edgesTo(w).length>0?vEle.edgesTo(w)[0]:w.edgesTo(vEle)[0];var edgeWeight=weight(edge);w=w.id(),d[w]>d[_v]+edgeWeight&&(d[w]=d[_v]+edgeWeight,Q.nodes.indexOf(w)<0?Q.push(w):Q.updateItem(w),g[w]=0,P[w]=[]),d[w]==d[_v]+edgeWeight&&(g[w]=g[w]+g[_v],P[w].push(_v))}else for(var _j=0;_j<A[_v].length;_j++){var _w=A[_v][_j].id();d[_w]==1/0&&(Q.push(_w),d[_w]=d[_v]+1),d[_w]==d[_v]+1&&(g[_w]=g[_w]+g[_v],P[_w].push(_v))}}for(var e={},_i2=0;_i2<V.length;_i2++)e[V[_i2].id()]=0;for(;S.length>0;){for(var _w2=S.pop(),_j2=0;_j2<P[_w2].length;_j2++){var _v2=P[_w2][_j2];e[_v2]=e[_v2]+g[_v2]/g[_w2]*(1+e[_w2])}_w2!=V[s].id()&&C_set(_w2,C_get(_w2)+e[_w2])}},s=0;s<V.length;s++)_loop();var ret={betweenness:function betweenness(node){var id=cy.collection(node).id();return C_get(id)},betweennessNormalized:function betweennessNormalized(node){if(0==max)return 0;var id=cy.collection(node).id();return C_get(id)/max}};return ret.betweennessNormalised=ret.betweennessNormalized,ret}};elesfn$l.bc=elesfn$l.betweennessCentrality;var defaults$c=defaults$g({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(edge){return 1}]}),getSimilarity$1=function getSimilarity(edge,attributes){for(var total=0,i=0;i<attributes.length;i++)total+=attributes[i](edge);return total},normalize=function normalize(M,n){for(var sum,col=0;col<n;col++){sum=0;for(var row=0;row<n;row++)sum+=M[row*n+col];for(var _row=0;_row<n;_row++)M[_row*n+col]=M[_row*n+col]/sum}},mmult=function mmult(A,B,n){for(var C=new Array(n*n),i=0;i<n;i++){for(var j=0;j<n;j++)C[i*n+j]=0;for(var k=0;k<n;k++)for(var _j=0;_j<n;_j++)C[i*n+_j]+=A[i*n+k]*B[k*n+_j]}return C},expand=function expand(M,n,expandFactor){for(var _M=M.slice(0),p=1;p<expandFactor;p++)M=mmult(M,_M,n);return M},inflate=function inflate(M,n,inflateFactor){for(var _M=new Array(n*n),i=0;i<n*n;i++)_M[i]=Math.pow(M[i],inflateFactor);return normalize(_M,n),_M},hasConverged=function hasConverged(M,_M,n2,roundFactor){for(var i=0;i<n2;i++){if(Math.round(M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor)!==Math.round(_M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor))return!1}return!0},isDuplicate=function isDuplicate(c1,c2){for(var i=0;i<c1.length;i++)if(!c2[i]||c1[i].id()!==c2[i].id())return!1;return!0},markovClustering=function markovClustering(options){for(var nodes=this.nodes(),edges=this.edges(),cy=this.cy(),opts=function setOptions(options){return defaults$c(options)}(options),id2position={},i=0;i<nodes.length;i++)id2position[nodes[i].id()]=i;for(var _M,n=nodes.length,n2=n*n,M=new Array(n2),_i=0;_i<n2;_i++)M[_i]=0;for(var e=0;e<edges.length;e++){var edge=edges[e],_i2=id2position[edge.source().id()],j=id2position[edge.target().id()],sim=getSimilarity$1(edge,opts.attributes);M[_i2*n+j]+=sim,M[j*n+_i2]+=sim}!function addLoops(M,n,val){for(var i=0;i<n;i++)M[i*n+i]=val}(M,n,opts.multFactor),normalize(M,n);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;)isStillMoving=!1,_M=expand(M,n,opts.expandFactor),M=inflate(_M,n,opts.inflateFactor),hasConverged(M,_M,n2,4)||(isStillMoving=!0),iterations++;var clusters=function assign(M,n,nodes,cy){for(var clusters=[],i=0;i<n;i++){for(var cluster=[],j=0;j<n;j++)Math.round(1e3*M[i*n+j])/1e3>0&&cluster.push(nodes[j]);0!==cluster.length&&clusters.push(cy.collection(cluster))}return clusters}(M,n,nodes,cy);return clusters=function removeDuplicates(clusters){for(var i=0;i<clusters.length;i++)for(var j=0;j<clusters.length;j++)i!=j&&isDuplicate(clusters[i],clusters[j])&&clusters.splice(j,1);return clusters}(clusters),clusters},markovClustering$1={markovClustering,mcl:markovClustering},identity$1=function identity(x){return x},absDiff=function absDiff(p,q){return Math.abs(q-p)},addAbsDiff=function addAbsDiff(total,p,q){return total+absDiff(p,q)},addSquaredDiff=function addSquaredDiff(total,p,q){return total+Math.pow(q-p,2)},sqrt=function sqrt(x){return Math.sqrt(x)},maxAbsDiff=function maxAbsDiff(currentMax,p,q){return Math.max(currentMax,absDiff(p,q))},getDistance=function getDistance(length,getP,getQ,init,visit){for(var post=arguments.length>5&&void 0!==arguments[5]?arguments[5]:identity$1,ret=init,dim=0;dim<length;dim++)ret=visit(ret,getP(dim),getQ(dim));return post(ret)},distances={euclidean:function euclidean(length,getP,getQ){return length>=2?getDistance(length,getP,getQ,0,addSquaredDiff,sqrt):getDistance(length,getP,getQ,0,addAbsDiff)},squaredEuclidean:function squaredEuclidean(length,getP,getQ){return getDistance(length,getP,getQ,0,addSquaredDiff)},manhattan:function manhattan(length,getP,getQ){return getDistance(length,getP,getQ,0,addAbsDiff)},max:function max(length,getP,getQ){return getDistance(length,getP,getQ,-1/0,maxAbsDiff)}};function clusteringDistance(method,length,getP,getQ,nodeP,nodeQ){var impl;return impl=fn$6(method)?method:distances[method]||distances.euclidean,0===length&&fn$6(method)?impl(nodeP,nodeQ):impl(length,getP,getQ,nodeP,nodeQ)}distances["squared-euclidean"]=distances.squaredEuclidean,distances.squaredeuclidean=distances.squaredEuclidean;var defaults$b=defaults$g({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),setOptions$2=function setOptions(options){return defaults$b(options)},getDist=function getDist(type,node,centroid,attributes,mode){var getP="kMedoids"!==mode?function(i){return centroid[i]}:function(i){return attributes[i](centroid)},nodeP=centroid,nodeQ=node;return clusteringDistance(type,attributes.length,getP,function getQ(i){return attributes[i](node)},nodeP,nodeQ)},randomCentroids=function randomCentroids(nodes,k,attributes){for(var ndim=attributes.length,min=new Array(ndim),max=new Array(ndim),centroids=new Array(k),centroid=null,i=0;i<ndim;i++)min[i]=nodes.min(attributes[i]).value,max[i]=nodes.max(attributes[i]).value;for(var c=0;c<k;c++){centroid=[];for(var _i=0;_i<ndim;_i++)centroid[_i]=Math.random()*(max[_i]-min[_i])+min[_i];centroids[c]=centroid}return centroids},classify=function classify(node,centroids,distance,attributes,type){for(var min=1/0,index=0,i=0;i<centroids.length;i++){var dist=getDist(distance,node,centroids[i],attributes,type);dist<min&&(min=dist,index=i)}return index},buildCluster=function buildCluster(centroid,nodes,assignment){for(var cluster=[],node=null,n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]===centroid&&cluster.push(node);return cluster},haveValuesConverged=function haveValuesConverged(v1,v2,sensitivityThreshold){return Math.abs(v2-v1)<=sensitivityThreshold},haveMatricesConverged=function haveMatricesConverged(v1,v2,sensitivityThreshold){for(var i=0;i<v1.length;i++)for(var j=0;j<v1[i].length;j++){if(Math.abs(v1[i][j]-v2[i][j])>sensitivityThreshold)return!1}return!0},seenBefore=function seenBefore(node,medoids,n){for(var i=0;i<n;i++)if(node===medoids[i])return!0;return!1},randomMedoids=function randomMedoids(nodes,k){var medoids=new Array(k);if(nodes.length<50)for(var i=0;i<k;i++){for(var node=nodes[Math.floor(Math.random()*nodes.length)];seenBefore(node,medoids,i);)node=nodes[Math.floor(Math.random()*nodes.length)];medoids[i]=node}else for(var _i2=0;_i2<k;_i2++)medoids[_i2]=nodes[Math.floor(Math.random()*nodes.length)];return medoids},findCost=function findCost(potentialNewMedoid,cluster,attributes){for(var cost=0,n=0;n<cluster.length;n++)cost+=getDist("manhattan",cluster[n],potentialNewMedoid,attributes,"kMedoids");return cost},updateCentroids=function updateCentroids(centroids,nodes,U,weight,opts){for(var numerator,denominator,n=0;n<nodes.length;n++)for(var c=0;c<centroids.length;c++)weight[n][c]=Math.pow(U[n][c],opts.m);for(var _c=0;_c<centroids.length;_c++)for(var dim=0;dim<opts.attributes.length;dim++){numerator=0,denominator=0;for(var _n2=0;_n2<nodes.length;_n2++)numerator+=weight[_n2][_c]*opts.attributes[dim](nodes[_n2]),denominator+=weight[_n2][_c];centroids[_c][dim]=numerator/denominator}},updateMembership=function updateMembership(U,_U,centroids,nodes,opts){for(var i=0;i<U.length;i++)_U[i]=U[i].slice();for(var sum,numerator,denominator,pow=2/(opts.m-1),c=0;c<centroids.length;c++)for(var n=0;n<nodes.length;n++){sum=0;for(var k=0;k<centroids.length;k++)numerator=getDist(opts.distance,nodes[n],centroids[c],opts.attributes,"cmeans"),denominator=getDist(opts.distance,nodes[n],centroids[k],opts.attributes,"cmeans"),sum+=Math.pow(numerator/denominator,pow);U[n][c]=1/sum}},fuzzyCMeans=function fuzzyCMeans(options){var clusters,centroids,U,_U,weight,cy=this.cy(),nodes=this.nodes(),opts=setOptions$2(options);_U=new Array(nodes.length);for(var i=0;i<nodes.length;i++)_U[i]=new Array(opts.k);U=new Array(nodes.length);for(var _i3=0;_i3<nodes.length;_i3++)U[_i3]=new Array(opts.k);for(var _i4=0;_i4<nodes.length;_i4++){for(var total=0,j=0;j<opts.k;j++)U[_i4][j]=Math.random(),total+=U[_i4][j];for(var _j=0;_j<opts.k;_j++)U[_i4][_j]=U[_i4][_j]/total}centroids=new Array(opts.k);for(var _i5=0;_i5<opts.k;_i5++)centroids[_i5]=new Array(opts.attributes.length);weight=new Array(nodes.length);for(var _i6=0;_i6<nodes.length;_i6++)weight[_i6]=new Array(opts.k);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;)isStillMoving=!1,updateCentroids(centroids,nodes,U,weight,opts),updateMembership(U,_U,centroids,nodes,opts),haveMatricesConverged(U,_U,opts.sensitivityThreshold)||(isStillMoving=!0),iterations++;return clusters=function assign(nodes,U,opts,cy){for(var max,index,clusters=new Array(opts.k),c=0;c<clusters.length;c++)clusters[c]=[];for(var n=0;n<U.length;n++){max=-1/0,index=-1;for(var _c2=0;_c2<U[0].length;_c2++)U[n][_c2]>max&&(max=U[n][_c2],index=_c2);clusters[index].push(nodes[n])}for(var _c3=0;_c3<clusters.length;_c3++)clusters[_c3]=cy.collection(clusters[_c3]);return clusters}(nodes,U,opts,cy),{clusters,degreeOfMembership:U}},kClustering={kMeans:function kMeans(options){var centroids,cy=this.cy(),nodes=this.nodes(),node=null,opts=setOptions$2(options),clusters=new Array(opts.k),assignment={};opts.testMode?"number"==typeof opts.testCentroids?(opts.testCentroids,centroids=randomCentroids(nodes,opts.k,opts.attributes)):centroids="object"===_typeof(opts.testCentroids)?opts.testCentroids:randomCentroids(nodes,opts.k,opts.attributes):centroids=randomCentroids(nodes,opts.k,opts.attributes);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;){for(var n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]=classify(node,centroids,opts.distance,opts.attributes,"kMeans");isStillMoving=!1;for(var c=0;c<opts.k;c++){var cluster=buildCluster(c,nodes,assignment);if(0!==cluster.length){for(var ndim=opts.attributes.length,centroid=centroids[c],newCentroid=new Array(ndim),sum=new Array(ndim),d=0;d<ndim;d++){sum[d]=0;for(var i=0;i<cluster.length;i++)node=cluster[i],sum[d]+=opts.attributes[d](node);newCentroid[d]=sum[d]/cluster.length,haveValuesConverged(newCentroid[d],centroid[d],opts.sensitivityThreshold)||(isStillMoving=!0)}centroids[c]=newCentroid,clusters[c]=cy.collection(cluster)}}iterations++}return clusters},kMedoids:function kMedoids(options){var medoids,curCost,cy=this.cy(),nodes=this.nodes(),node=null,opts=setOptions$2(options),clusters=new Array(opts.k),assignment={},minCosts=new Array(opts.k);opts.testMode?"number"==typeof opts.testCentroids||(medoids="object"===_typeof(opts.testCentroids)?opts.testCentroids:randomMedoids(nodes,opts.k)):medoids=randomMedoids(nodes,opts.k);for(var isStillMoving=!0,iterations=0;isStillMoving&&iterations<opts.maxIterations;){for(var n=0;n<nodes.length;n++)assignment[(node=nodes[n]).id()]=classify(node,medoids,opts.distance,opts.attributes,"kMedoids");isStillMoving=!1;for(var m=0;m<medoids.length;m++){var cluster=buildCluster(m,nodes,assignment);if(0!==cluster.length){minCosts[m]=findCost(medoids[m],cluster,opts.attributes);for(var _n=0;_n<cluster.length;_n++)(curCost=findCost(cluster[_n],cluster,opts.attributes))<minCosts[m]&&(minCosts[m]=curCost,medoids[m]=cluster[_n],isStillMoving=!0);clusters[m]=cy.collection(cluster)}}iterations++}return clusters},fuzzyCMeans,fcm:fuzzyCMeans},defaults$a=defaults$g({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),linkageAliases={single:"min",complete:"max"},mergeClosest=function mergeClosest(clusters,index,dists,mins,opts){for(var dist,minKey=0,min=1/0,attrs=opts.attributes,getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,function(i){return attrs[i](n1)},function(i){return attrs[i](n2)},n1,n2)},i=0;i<clusters.length;i++){var key=clusters[i].key,_dist=dists[key][mins[key]];_dist<min&&(minKey=key,min=_dist)}if("threshold"===opts.mode&&min>=opts.threshold||"dendrogram"===opts.mode&&1===clusters.length)return!1;var merged,c1=index[minKey],c2=index[mins[minKey]];merged="dendrogram"===opts.mode?{left:c1,right:c2,key:c1.key}:{value:c1.value.concat(c2.value),key:c1.key},clusters[c1.index]=merged,clusters.splice(c2.index,1),index[c1.key]=merged;for(var _i=0;_i<clusters.length;_i++){var cur=clusters[_i];c1.key===cur.key?dist=1/0:"min"===opts.linkage?(dist=dists[c1.key][cur.key],dists[c1.key][cur.key]>dists[c2.key][cur.key]&&(dist=dists[c2.key][cur.key])):"max"===opts.linkage?(dist=dists[c1.key][cur.key],dists[c1.key][cur.key]<dists[c2.key][cur.key]&&(dist=dists[c2.key][cur.key])):dist="mean"===opts.linkage?(dists[c1.key][cur.key]*c1.size+dists[c2.key][cur.key]*c2.size)/(c1.size+c2.size):"dendrogram"===opts.mode?getDist(cur.value,c1.value):getDist(cur.value[0],c1.value[0]),dists[c1.key][cur.key]=dists[cur.key][c1.key]=dist}for(var _i2=0;_i2<clusters.length;_i2++){var key1=clusters[_i2].key;if(mins[key1]===c1.key||mins[key1]===c2.key){for(var _min=key1,j=0;j<clusters.length;j++){var key2=clusters[j].key;dists[key1][key2]<dists[key1][_min]&&(_min=key2)}mins[key1]=_min}clusters[_i2].index=_i2}return c1.key=c2.key=c1.index=c2.index=null,!0},_getAllChildren=function getAllChildren(root,arr,cy){root&&(root.value?arr.push(root.value):(root.left&&_getAllChildren(root.left,arr),root.right&&_getAllChildren(root.right,arr)))},_buildDendrogram=function buildDendrogram(root,cy){if(!root)return"";if(root.left&&root.right){var leftStr=_buildDendrogram(root.left,cy),rightStr=_buildDendrogram(root.right,cy),node=cy.add({group:"nodes",data:{id:leftStr+","+rightStr}});return cy.add({group:"edges",data:{source:leftStr,target:node.id()}}),cy.add({group:"edges",data:{source:rightStr,target:node.id()}}),node.id()}return root.value?root.value.id():void 0},_buildClustersFromTree=function buildClustersFromTree(root,k,cy){if(!root)return[];var left=[],right=[],leaves=[];return 0===k?(root.left&&_getAllChildren(root.left,left),root.right&&_getAllChildren(root.right,right),leaves=left.concat(right),[cy.collection(leaves)]):1===k?root.value?[cy.collection(root.value)]:(root.left&&_getAllChildren(root.left,left),root.right&&_getAllChildren(root.right,right),[cy.collection(left),cy.collection(right)]):root.value?[cy.collection(root.value)]:(root.left&&(left=_buildClustersFromTree(root.left,k-1,cy)),root.right&&(right=_buildClustersFromTree(root.right,k-1,cy)),left.concat(right))},hierarchicalClustering=function hierarchicalClustering(options){for(var cy=this.cy(),nodes=this.nodes(),opts=function setOptions(options){var opts=defaults$a(options),preferredAlias=linkageAliases[opts.linkage];return null!=preferredAlias&&(opts.linkage=preferredAlias),opts}(options),attrs=opts.attributes,getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,function(i){return attrs[i](n1)},function(i){return attrs[i](n2)},n1,n2)},clusters=[],dists=[],mins=[],index=[],n=0;n<nodes.length;n++){var cluster={value:"dendrogram"===opts.mode?nodes[n]:[nodes[n]],key:n,index:n};clusters[n]=cluster,index[n]=cluster,dists[n]=[],mins[n]=0}for(var i=0;i<clusters.length;i++)for(var j=0;j<=i;j++){var dist=void 0;dist="dendrogram"===opts.mode?i===j?1/0:getDist(clusters[i].value,clusters[j].value):i===j?1/0:getDist(clusters[i].value[0],clusters[j].value[0]),dists[i][j]=dist,dists[j][i]=dist,dist<dists[i][mins[i]]&&(mins[i]=j)}for(var retClusters,merged=mergeClosest(clusters,index,dists,mins,opts);merged;)merged=mergeClosest(clusters,index,dists,mins,opts);return"dendrogram"===opts.mode?(retClusters=_buildClustersFromTree(clusters[0],opts.dendrogramDepth,cy),opts.addDendrogram&&_buildDendrogram(clusters[0],cy)):(retClusters=new Array(clusters.length),clusters.forEach(function(cluster,i){cluster.key=cluster.index=null,retClusters[i]=cy.collection(cluster.value)})),retClusters},hierarchicalClustering$1={hierarchicalClustering,hca:hierarchicalClustering},defaults$9=defaults$g({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),getSimilarity=function getSimilarity(type,n1,n2,attributes){var attr=function attr(n,i){return attributes[i](n)};return-clusteringDistance(type,attributes.length,function(i){return attr(n1,i)},function(i){return attr(n2,i)},n1,n2)},getPreference=function getPreference(S,preference){var p=null;return p="median"===preference?function median(arr){var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,sort=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],includeHoles=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?(end<arr.length&&arr.splice(end,arr.length-end),begin>0&&arr.splice(0,begin)):arr=arr.slice(begin,end);for(var off=0,i=arr.length-1;i>=0;i--){var v=arr[i];includeHoles?isFinite(v)||(arr[i]=-1/0,off++):arr.splice(i,1)}sort&&arr.sort(function(a,b){return a-b});var len=arr.length,mid=Math.floor(len/2);return len%2!=0?arr[mid+1+off]:(arr[mid-1+off]+arr[mid+off])/2}(S):"mean"===preference?function mean(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,total=0,n=0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(total+=val,n++)}return total/n}(S):"min"===preference?function min(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,min=1/0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(min=Math.min(val,min))}return min}(S):"max"===preference?function max(arr){for(var begin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,end=arguments.length>2&&void 0!==arguments[2]?arguments[2]:arr.length,max=-1/0,i=begin;i<end;i++){var val=arr[i];isFinite(val)&&(max=Math.max(val,max))}return max}(S):preference,p},assignClusters=function assignClusters(n,S,exemplars){for(var clusters=[],i=0;i<n;i++){for(var index=-1,max=-1/0,ei=0;ei<exemplars.length;ei++){var e=exemplars[ei];S[i*n+e]>max&&(index=e,max=S[i*n+e])}index>0&&clusters.push(index)}for(var _ei=0;_ei<exemplars.length;_ei++)clusters[exemplars[_ei]]=exemplars[_ei];return clusters},affinityPropagation=function affinityPropagation(options){for(var n,n2,S,p,R,A,cy=this.cy(),nodes=this.nodes(),opts=function setOptions(options){var dmp=options.damping,pref=options.preference;.5<=dmp&&dmp<1||error("Damping must range on [0.5, 1).  Got: ".concat(dmp));var validPrefs=["median","mean","min","max"];return validPrefs.some(function(v){return v===pref})||number$1(pref)||error("Preference must be one of [".concat(validPrefs.map(function(p){return"'".concat(p,"'")}).join(", "),"] or a number.  Got: ").concat(pref)),defaults$9(options)}(options),id2position={},i=0;i<nodes.length;i++)id2position[nodes[i].id()]=i;n2=(n=nodes.length)*n,S=new Array(n2);for(var _i=0;_i<n2;_i++)S[_i]=-1/0;for(var _i2=0;_i2<n;_i2++)for(var j=0;j<n;j++)_i2!==j&&(S[_i2*n+j]=getSimilarity(opts.distance,nodes[_i2],nodes[j],opts.attributes));p=getPreference(S,opts.preference);for(var _i3=0;_i3<n;_i3++)S[_i3*n+_i3]=p;R=new Array(n2);for(var _i4=0;_i4<n2;_i4++)R[_i4]=0;A=new Array(n2);for(var _i5=0;_i5<n2;_i5++)A[_i5]=0;for(var old=new Array(n),Rp=new Array(n),se=new Array(n),_i6=0;_i6<n;_i6++)old[_i6]=0,Rp[_i6]=0,se[_i6]=0;for(var iter,e=new Array(n*opts.minIterations),_i7=0;_i7<e.length;_i7++)e[_i7]=0;for(iter=0;iter<opts.maxIterations;iter++){for(var _i8=0;_i8<n;_i8++){for(var max=-1/0,max2=-1/0,maxI=-1,AS=0,_j=0;_j<n;_j++)old[_j]=R[_i8*n+_j],(AS=A[_i8*n+_j]+S[_i8*n+_j])>=max?(max2=max,max=AS,maxI=_j):AS>max2&&(max2=AS);for(var _j2=0;_j2<n;_j2++)R[_i8*n+_j2]=(1-opts.damping)*(S[_i8*n+_j2]-max)+opts.damping*old[_j2];R[_i8*n+maxI]=(1-opts.damping)*(S[_i8*n+maxI]-max2)+opts.damping*old[maxI]}for(var _i9=0;_i9<n;_i9++){for(var sum=0,_j3=0;_j3<n;_j3++)old[_j3]=A[_j3*n+_i9],Rp[_j3]=Math.max(0,R[_j3*n+_i9]),sum+=Rp[_j3];sum-=Rp[_i9],Rp[_i9]=R[_i9*n+_i9],sum+=Rp[_i9];for(var _j4=0;_j4<n;_j4++)A[_j4*n+_i9]=(1-opts.damping)*Math.min(0,sum-Rp[_j4])+opts.damping*old[_j4];A[_i9*n+_i9]=(1-opts.damping)*(sum-Rp[_i9])+opts.damping*old[_i9]}for(var K=0,_i10=0;_i10<n;_i10++){var E=A[_i10*n+_i10]+R[_i10*n+_i10]>0?1:0;e[iter%opts.minIterations*n+_i10]=E,K+=E}if(K>0&&(iter>=opts.minIterations-1||iter==opts.maxIterations-1)){for(var _sum=0,_i11=0;_i11<n;_i11++){se[_i11]=0;for(var _j5=0;_j5<opts.minIterations;_j5++)se[_i11]+=e[_j5*n+_i11];0!==se[_i11]&&se[_i11]!==opts.minIterations||_sum++}if(_sum===n)break}}for(var exemplarsIndices=function findExemplars(n,R,A){for(var indices=[],i=0;i<n;i++)R[i*n+i]+A[i*n+i]>0&&indices.push(i);return indices}(n,R,A),clusterIndices=function assign(n,S,exemplars){for(var clusters=assignClusters(n,S,exemplars),ei=0;ei<exemplars.length;ei++){for(var ii=[],c=0;c<clusters.length;c++)clusters[c]===exemplars[ei]&&ii.push(c);for(var maxI=-1,maxSum=-1/0,i=0;i<ii.length;i++){for(var sum=0,j=0;j<ii.length;j++)sum+=S[ii[j]*n+ii[i]];sum>maxSum&&(maxI=i,maxSum=sum)}exemplars[ei]=ii[maxI]}return assignClusters(n,S,exemplars)}(n,S,exemplarsIndices),clusters={},c=0;c<exemplarsIndices.length;c++)clusters[exemplarsIndices[c]]=[];for(var _i12=0;_i12<nodes.length;_i12++){var clusterIndex=clusterIndices[id2position[nodes[_i12].id()]];null!=clusterIndex&&clusters[clusterIndex].push(nodes[_i12])}for(var retClusters=new Array(exemplarsIndices.length),_c=0;_c<exemplarsIndices.length;_c++)retClusters[_c]=cy.collection(clusters[exemplarsIndices[_c]]);return retClusters},affinityPropagation$1={affinityPropagation,ap:affinityPropagation},hierholzerDefaults=defaults$g({root:void 0,directed:!1}),hopcroftTarjanBiconnected=function hopcroftTarjanBiconnected(){var eles=this,nodes={},id=0,edgeCount=0,components=[],stack=[],visitedEdges={},_biconnectedSearch=function biconnectedSearch(root,currentNode,parent){root===parent&&(edgeCount+=1),nodes[currentNode]={id,low:id++,cutVertex:!1};var sourceId,targetId,otherNodeId,edgeId,edges=eles.getElementById(currentNode).connectedEdges().intersection(eles);0===edges.size()?components.push(eles.spawn(eles.getElementById(currentNode))):edges.forEach(function(edge){sourceId=edge.source().id(),targetId=edge.target().id(),(otherNodeId=sourceId===currentNode?targetId:sourceId)!==parent&&(edgeId=edge.id(),visitedEdges[edgeId]||(visitedEdges[edgeId]=!0,stack.push({x:currentNode,y:otherNodeId,edge})),otherNodeId in nodes?nodes[currentNode].low=Math.min(nodes[currentNode].low,nodes[otherNodeId].id):(_biconnectedSearch(root,otherNodeId,currentNode),nodes[currentNode].low=Math.min(nodes[currentNode].low,nodes[otherNodeId].low),nodes[currentNode].id<=nodes[otherNodeId].low&&(nodes[currentNode].cutVertex=!0,function buildComponent(x,y){for(var i=stack.length-1,cutset=[],component=eles.spawn();stack[i].x!=x||stack[i].y!=y;)cutset.push(stack.pop().edge),i--;cutset.push(stack.pop().edge),cutset.forEach(function(edge){var connectedNodes=edge.connectedNodes().intersection(eles);component.merge(edge),connectedNodes.forEach(function(node){var nodeId=node.id(),connectedEdges=node.connectedEdges().intersection(eles);component.merge(node),nodes[nodeId].cutVertex?component.merge(connectedEdges.filter(function(edge){return edge.isLoop()})):component.merge(connectedEdges)})}),components.push(component)}(currentNode,otherNodeId))))})};eles.forEach(function(ele){if(ele.isNode()){var nodeId=ele.id();nodeId in nodes||(edgeCount=0,_biconnectedSearch(nodeId,nodeId),nodes[nodeId].cutVertex=edgeCount>1)}});var cutVertices=Object.keys(nodes).filter(function(id){return nodes[id].cutVertex}).map(function(id){return eles.getElementById(id)});return{cut:eles.spawn(cutVertices),components}},tarjanStronglyConnected=function tarjanStronglyConnected(){var eles=this,nodes={},index=0,components=[],stack=[],cut=eles.spawn(eles),_stronglyConnectedSearch=function stronglyConnectedSearch(sourceNodeId){if(stack.push(sourceNodeId),nodes[sourceNodeId]={index,low:index++,explored:!1},eles.getElementById(sourceNodeId).connectedEdges().intersection(eles).forEach(function(edge){var targetNodeId=edge.target().id();targetNodeId!==sourceNodeId&&(targetNodeId in nodes||_stronglyConnectedSearch(targetNodeId),nodes[targetNodeId].explored||(nodes[sourceNodeId].low=Math.min(nodes[sourceNodeId].low,nodes[targetNodeId].low)))}),nodes[sourceNodeId].index===nodes[sourceNodeId].low){for(var componentNodes=eles.spawn();;){var nodeId=stack.pop();if(componentNodes.merge(eles.getElementById(nodeId)),nodes[nodeId].low=nodes[sourceNodeId].index,nodes[nodeId].explored=!0,nodeId===sourceNodeId)break}var componentEdges=componentNodes.edgesWith(componentNodes),component=componentNodes.merge(componentEdges);components.push(component),cut=cut.difference(component)}};return eles.forEach(function(ele){if(ele.isNode()){var nodeId=ele.id();nodeId in nodes||_stronglyConnectedSearch(nodeId)}}),{cut,components}},elesfn$j={};[elesfn$v,elesfn$u,elesfn$t,elesfn$s,elesfn$r,elesfn$q,elesfn$p,elesfn$o,elesfn$n,elesfn$m,elesfn$l,markovClustering$1,kClustering,hierarchicalClustering$1,affinityPropagation$1,{hierholzer:function hierholzer(options){if(!plainObject(options)){var args=arguments;options={root:args[0],directed:args[1]}}var oddIn,oddOut,startVertex,_hierholzerDefaults=hierholzerDefaults(options),root=_hierholzerDefaults.root,directed=_hierholzerDefaults.directed,dflag=!1;root&&(startVertex=string(root)?this.filter(root)[0].id():root[0].id());var nodes={},edges={};directed?this.forEach(function(ele){var id=ele.id();if(ele.isNode()){var ind=ele.indegree(!0),outd=ele.outdegree(!0),d1=ind-outd,d2=outd-ind;1==d1?oddIn?dflag=!0:oddIn=id:1==d2?oddOut?dflag=!0:oddOut=id:(d2>1||d1>1)&&(dflag=!0),nodes[id]=[],ele.outgoers().forEach(function(e){e.isEdge()&&nodes[id].push(e.id())})}else edges[id]=[void 0,ele.target().id()]}):this.forEach(function(ele){var id=ele.id();ele.isNode()?(ele.degree(!0)%2&&(oddIn?oddOut?dflag=!0:oddOut=id:oddIn=id),nodes[id]=[],ele.connectedEdges().forEach(function(e){return nodes[id].push(e.id())})):edges[id]=[ele.source().id(),ele.target().id()]});var result={found:!1,trail:void 0};if(dflag)return result;if(oddOut&&oddIn)if(directed){if(startVertex&&oddOut!=startVertex)return result;startVertex=oddOut}else{if(startVertex&&oddOut!=startVertex&&oddIn!=startVertex)return result;startVertex||(startVertex=oddOut)}else startVertex||(startVertex=this[0].id());var walk=function walk(v){for(var adj,adjTail,adjHead,currentNode=v,subtour=[v];nodes[currentNode].length;)adj=nodes[currentNode].shift(),adjTail=edges[adj][0],currentNode!=(adjHead=edges[adj][1])?(nodes[adjHead]=nodes[adjHead].filter(function(e){return e!=adj}),currentNode=adjHead):directed||currentNode==adjTail||(nodes[adjTail]=nodes[adjTail].filter(function(e){return e!=adj}),currentNode=adjTail),subtour.unshift(adj),subtour.unshift(currentNode);return subtour},trail=[],subtour=[];for(subtour=walk(startVertex);1!=subtour.length;)0==nodes[subtour[0]].length?(trail.unshift(this.getElementById(subtour.shift())),trail.unshift(this.getElementById(subtour.shift()))):subtour=walk(subtour.shift()).concat(subtour);for(var d in trail.unshift(this.getElementById(subtour.shift())),nodes)if(nodes[d].length)return result;return result.found=!0,result.trail=this.spawn(trail,!0),result}},{hopcroftTarjanBiconnected,htbc:hopcroftTarjanBiconnected,htb:hopcroftTarjanBiconnected,hopcroftTarjanBiconnectedComponents:hopcroftTarjanBiconnected},{tarjanStronglyConnected,tsc:tarjanStronglyConnected,tscc:tarjanStronglyConnected,tarjanStronglyConnectedComponents:tarjanStronglyConnected}].forEach(function(props){extend(elesfn$j,props)});var _api=function api(executor){if(!(this instanceof _api))return new _api(executor);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this))};_api.prototype={fulfill:function fulfill(value){return deliver(this,1,"fulfillValue",value)},reject:function reject(value){return deliver(this,2,"rejectReason",value)},then:function then(onFulfilled,onRejected){var next=new _api;return this.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),this.onRejected.push(resolver(onRejected,next,"reject")),execute(this),next.proxy}};var deliver=function deliver(curr,state,name,value){return 0===curr.state&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function execute(curr){1===curr.state?execute_handlers(curr,"onFulfilled",curr.fulfillValue):2===curr.state&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function execute_handlers(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function func(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function resolver(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){return void next.reject(e)}_resolve(next,result)}}},_resolve=function resolve(promise,x){if(promise!==x&&promise.proxy!==x){var then;if("object"===_typeof(x)&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):_resolve(promise,y))},function(r){resolved||(resolved=!0,promise.reject(r))})}catch(e){resolved||promise.reject(e)}}}else promise.reject(new TypeError("cannot resolve promise with itself"))};_api.all=function(ps){return new _api(function(resolveAll,rejectAll){for(var vals=new Array(ps.length),doneCount=0,fulfill=function fulfill(i,val){vals[i]=val,++doneCount===ps.length&&resolveAll(vals)},i=0;i<ps.length;i++)(function(i){var p=ps[i];null!=p&&null!=p.then?p.then(function(val){fulfill(i,val)},function(err){rejectAll(err)}):fulfill(i,p)})(i)})},_api.resolve=function(val){return new _api(function(resolve,reject){resolve(val)})},_api.reject=function(val){return new _api(function(resolve,reject){reject(val)})};var Promise$1="undefined"!=typeof Promise?Promise:_api,Animation=function Animation(target,opts,opts2){var isCore=core(target),isEle=!isCore,_p=this._private=extend({duration:1e3},opts,opts2);if(_p.target=target,_p.style=_p.style||_p.css,_p.started=!1,_p.playing=!1,_p.hooked=!1,_p.applying=!1,_p.progress=0,_p.completes=[],_p.frames=[],_p.complete&&fn$6(_p.complete)&&_p.completes.push(_p.complete),isEle){var pos=target.position();_p.startPosition=_p.startPosition||{x:pos.x,y:pos.y},_p.startStyle=_p.startStyle||target.cy().style().getAnimationStartStyle(target,_p.style)}if(isCore){var pan=target.pan();_p.startPan={x:pan.x,y:pan.y},_p.startZoom=target.zoom()}this.length=1,this[0]=this},anifn=Animation.prototype;extend(anifn,{instanceString:function instanceString(){return"animation"},hook:function hook(){var _p=this._private;if(!_p.hooked){var tAni=_p.target._private.animation;(_p.queue?tAni.queue:tAni.current).push(this),elementOrCollection(_p.target)&&_p.target.cy().addToAnimationPool(_p.target),_p.hooked=!0}return this},play:function play(){var _p=this._private;return 1===_p.progress&&(_p.progress=0),_p.playing=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},playing:function playing(){return this._private.playing},apply:function apply(){var _p=this._private;return _p.applying=!0,_p.started=!1,_p.stopped=!1,this.hook(),this},applying:function applying(){return this._private.applying},pause:function pause(){var _p=this._private;return _p.playing=!1,_p.started=!1,this},stop:function stop(){var _p=this._private;return _p.playing=!1,_p.started=!1,_p.stopped=!0,this},rewind:function rewind(){return this.progress(0)},fastforward:function fastforward(){return this.progress(1)},time:function time(t){var _p=this._private;return void 0===t?_p.progress*_p.duration:this.progress(t/_p.duration)},progress:function progress(p){var _p=this._private,wasPlaying=_p.playing;return void 0===p?_p.progress:(wasPlaying&&this.pause(),_p.progress=p,_p.started=!1,wasPlaying&&this.play(),this)},completed:function completed(){return 1===this._private.progress},reverse:function reverse(){var _p=this._private,wasPlaying=_p.playing;wasPlaying&&this.pause(),_p.progress=1-_p.progress,_p.started=!1;var swap=function swap(a,b){var _pa=_p[a];null!=_pa&&(_p[a]=_p[b],_p[b]=_pa)};if(swap("zoom","startZoom"),swap("pan","startPan"),swap("position","startPosition"),_p.style)for(var i=0;i<_p.style.length;i++){var prop=_p.style[i],name=prop.name,startStyleProp=_p.startStyle[name];_p.startStyle[name]=prop,_p.style[i]=startStyleProp}return wasPlaying&&this.play(),this},promise:function promise(type){var arr,_p=this._private;if("frame"===type)arr=_p.frames;else arr=_p.completes;return new Promise$1(function(resolve,reject){arr.push(function(){resolve()})})}}),anifn.complete=anifn.completed,anifn.run=anifn.play,anifn.running=anifn.playing;var isArray_1,hasRequiredIsArray,_isKey,hasRequired_isKey,isFunction_1,hasRequiredIsFunction,_coreJsData,hasRequired_coreJsData,_isMasked,hasRequired_isMasked,_toSource,hasRequired_toSource,_baseIsNative,hasRequired_baseIsNative,_getValue,hasRequired_getValue,_getNative,hasRequired_getNative,_nativeCreate,hasRequired_nativeCreate,_hashClear,hasRequired_hashClear,_hashDelete,hasRequired_hashDelete,_hashGet,hasRequired_hashGet,_hashHas,hasRequired_hashHas,_hashSet,hasRequired_hashSet,_Hash,hasRequired_Hash,_listCacheClear,hasRequired_listCacheClear,eq_1,hasRequiredEq,_assocIndexOf,hasRequired_assocIndexOf,_listCacheDelete,hasRequired_listCacheDelete,_listCacheGet,hasRequired_listCacheGet,_listCacheHas,hasRequired_listCacheHas,_listCacheSet,hasRequired_listCacheSet,_ListCache,hasRequired_ListCache,_Map,hasRequired_Map,_mapCacheClear,hasRequired_mapCacheClear,_isKeyable,hasRequired_isKeyable,_getMapData,hasRequired_getMapData,_mapCacheDelete,hasRequired_mapCacheDelete,_mapCacheGet,hasRequired_mapCacheGet,_mapCacheHas,hasRequired_mapCacheHas,_mapCacheSet,hasRequired_mapCacheSet,_MapCache,hasRequired_MapCache,memoize_1,hasRequiredMemoize,_memoizeCapped,hasRequired_memoizeCapped,_stringToPath,hasRequired_stringToPath,_arrayMap,hasRequired_arrayMap,_baseToString,hasRequired_baseToString,toString_1,hasRequiredToString,_castPath,hasRequired_castPath,_toKey,hasRequired_toKey,_baseGet,hasRequired_baseGet,get_1,hasRequiredGet,define$3={animated:function animated(){return function animatedImpl(){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return!1;var ele=all[0];return ele?ele._private.animation.current.length>0:void 0}},clearQueue:function clearQueue(){return function clearQueueImpl(){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;for(var i=0;i<all.length;i++){all[i]._private.animation.queue=[]}return this}},delay:function delay(){return function delayImpl(time,complete){return(this._private.cy||this).styleEnabled()?this.animate({delay:time,duration:time,complete}):this}},delayAnimation:function delayAnimation(){return function delayAnimationImpl(time,complete){return(this._private.cy||this).styleEnabled()?this.animation({delay:time,duration:time,complete}):this}},animation:function animation(){return function animationImpl(properties,params){var selfIsArrayLike=void 0!==this.length,all=selfIsArrayLike?this:[this],cy=this._private.cy||this,isCore=!selfIsArrayLike,isEles=!isCore;if(!cy.styleEnabled())return this;var style=cy.style();if(properties=extend({},properties,params),0===Object.keys(properties).length)return new Animation(all[0],properties);switch(void 0===properties.duration&&(properties.duration=400),properties.duration){case"slow":properties.duration=600;break;case"fast":properties.duration=200}if(isEles&&(properties.style=style.getPropsList(properties.style||properties.css),properties.css=void 0),isEles&&null!=properties.renderedPosition){var rpos=properties.renderedPosition,pan=cy.pan(),zoom=cy.zoom();properties.position=renderedToModelPosition(rpos,zoom,pan)}if(isCore&&null!=properties.panBy){var panBy=properties.panBy,cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(isCore&&null!=center){var centerPan=cy.getCenterPan(center.eles,properties.zoom);null!=centerPan&&(properties.pan=centerPan)}if(isCore&&null!=properties.fit){var fit=properties.fit,fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);null!=fitVp&&(properties.pan=fitVp.pan,properties.zoom=fitVp.zoom)}if(isCore&&plainObject(properties.zoom)){var vp=cy.getZoomedViewport(properties.zoom);null!=vp?(vp.zoomed&&(properties.zoom=vp.zoom),vp.panned&&(properties.pan=vp.pan)):properties.zoom=null}return new Animation(all[0],properties)}},animate:function animate(){return function animateImpl(properties,params){var all=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;params&&(properties=extend({},properties,params));for(var i=0;i<all.length;i++){var ele=all[i],queue=ele.animated()&&(void 0===properties.queue||properties.queue);ele.animation(properties,queue?{queue:!0}:void 0).play()}return this}},stop:function stop(){return function stopImpl(clearQueue,jumpToEnd){var all=void 0!==this.length?this:[this],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){for(var _p=all[i]._private,anis=_p.animation.current,j=0;j<anis.length;j++){var ani_p=anis[j]._private;jumpToEnd&&(ani_p.duration=0)}clearQueue&&(_p.animation.queue=[]),jumpToEnd||(_p.animation.current=[])}return cy.notify("draw"),this}}};function requireIsArray(){if(hasRequiredIsArray)return isArray_1;hasRequiredIsArray=1;var isArray=Array.isArray;return isArray_1=isArray}function require_isMasked(){if(hasRequired_isMasked)return _isMasked;hasRequired_isMasked=1;var uid,coreJsData=function require_coreJsData(){if(hasRequired_coreJsData)return _coreJsData;hasRequired_coreJsData=1;var coreJsData=require_root()["__core-js_shared__"];return _coreJsData=coreJsData}(),maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"";return _isMasked=function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}}function require_baseIsNative(){if(hasRequired_baseIsNative)return _baseIsNative;hasRequired_baseIsNative=1;var isFunction=function requireIsFunction(){if(hasRequiredIsFunction)return isFunction_1;hasRequiredIsFunction=1;var baseGetTag=require_baseGetTag(),isObject=requireIsObject();return isFunction_1=function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return"[object Function]"==tag||"[object GeneratorFunction]"==tag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag}}(),isMasked=require_isMasked(),isObject=requireIsObject(),toSource=function require_toSource(){if(hasRequired_toSource)return _toSource;hasRequired_toSource=1;var funcToString=Function.prototype.toString;return _toSource=function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}}(),reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return _baseIsNative=function baseIsNative(value){return!(!isObject(value)||isMasked(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}}function require_getNative(){if(hasRequired_getNative)return _getNative;hasRequired_getNative=1;var baseIsNative=require_baseIsNative(),getValue=function require_getValue(){return hasRequired_getValue||(hasRequired_getValue=1,_getValue=function getValue(object,key){return null==object?void 0:object[key]}),_getValue}();return _getNative=function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:void 0},_getNative}function require_nativeCreate(){if(hasRequired_nativeCreate)return _nativeCreate;hasRequired_nativeCreate=1;var nativeCreate=require_getNative()(Object,"create");return _nativeCreate=nativeCreate}function require_Hash(){if(hasRequired_Hash)return _Hash;hasRequired_Hash=1;var hashClear=function require_hashClear(){if(hasRequired_hashClear)return _hashClear;hasRequired_hashClear=1;var nativeCreate=require_nativeCreate();return _hashClear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}}(),hashDelete=function require_hashDelete(){return hasRequired_hashDelete?_hashDelete:(hasRequired_hashDelete=1,_hashDelete=function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result})}(),hashGet=function require_hashGet(){if(hasRequired_hashGet)return _hashGet;hasRequired_hashGet=1;var nativeCreate=require_nativeCreate(),hasOwnProperty=Object.prototype.hasOwnProperty;return _hashGet=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},_hashGet}(),hashHas=function require_hashHas(){if(hasRequired_hashHas)return _hashHas;hasRequired_hashHas=1;var nativeCreate=require_nativeCreate(),hasOwnProperty=Object.prototype.hasOwnProperty;return _hashHas=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},_hashHas}(),hashSet=function require_hashSet(){if(hasRequired_hashSet)return _hashSet;hasRequired_hashSet=1;var nativeCreate=require_nativeCreate();return _hashSet=function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},_hashSet}();function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}return Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,_Hash=Hash}function requireEq(){if(hasRequiredEq)return eq_1;return hasRequiredEq=1,eq_1=function eq(value,other){return value===other||value!=value&&other!=other}}function require_assocIndexOf(){if(hasRequired_assocIndexOf)return _assocIndexOf;hasRequired_assocIndexOf=1;var eq=requireEq();return _assocIndexOf=function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1},_assocIndexOf}function require_ListCache(){if(hasRequired_ListCache)return _ListCache;hasRequired_ListCache=1;var listCacheClear=function require_listCacheClear(){return hasRequired_listCacheClear?_listCacheClear:(hasRequired_listCacheClear=1,_listCacheClear=function listCacheClear(){this.__data__=[],this.size=0})}(),listCacheDelete=function require_listCacheDelete(){if(hasRequired_listCacheDelete)return _listCacheDelete;hasRequired_listCacheDelete=1;var assocIndexOf=require_assocIndexOf(),splice=Array.prototype.splice;return _listCacheDelete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0||(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,0))},_listCacheDelete}(),listCacheGet=function require_listCacheGet(){if(hasRequired_listCacheGet)return _listCacheGet;hasRequired_listCacheGet=1;var assocIndexOf=require_assocIndexOf();return _listCacheGet=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},_listCacheGet}(),listCacheHas=function require_listCacheHas(){if(hasRequired_listCacheHas)return _listCacheHas;hasRequired_listCacheHas=1;var assocIndexOf=require_assocIndexOf();return _listCacheHas=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}}(),listCacheSet=function require_listCacheSet(){if(hasRequired_listCacheSet)return _listCacheSet;hasRequired_listCacheSet=1;var assocIndexOf=require_assocIndexOf();return _listCacheSet=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this},_listCacheSet}();function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}return ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,_ListCache=ListCache}function require_mapCacheClear(){if(hasRequired_mapCacheClear)return _mapCacheClear;hasRequired_mapCacheClear=1;var Hash=require_Hash(),ListCache=require_ListCache(),Map=function require_Map(){if(hasRequired_Map)return _Map;hasRequired_Map=1;var Map=require_getNative()(require_root(),"Map");return _Map=Map}();return _mapCacheClear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}}function require_getMapData(){if(hasRequired_getMapData)return _getMapData;hasRequired_getMapData=1;var isKeyable=function require_isKeyable(){return hasRequired_isKeyable?_isKeyable:(hasRequired_isKeyable=1,_isKeyable=function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value})}();return _getMapData=function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map},_getMapData}function require_MapCache(){if(hasRequired_MapCache)return _MapCache;hasRequired_MapCache=1;var mapCacheClear=require_mapCacheClear(),mapCacheDelete=function require_mapCacheDelete(){if(hasRequired_mapCacheDelete)return _mapCacheDelete;hasRequired_mapCacheDelete=1;var getMapData=require_getMapData();return _mapCacheDelete=function mapCacheDelete(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result}}(),mapCacheGet=function require_mapCacheGet(){if(hasRequired_mapCacheGet)return _mapCacheGet;hasRequired_mapCacheGet=1;var getMapData=require_getMapData();return _mapCacheGet=function mapCacheGet(key){return getMapData(this,key).get(key)}}(),mapCacheHas=function require_mapCacheHas(){if(hasRequired_mapCacheHas)return _mapCacheHas;hasRequired_mapCacheHas=1;var getMapData=require_getMapData();return _mapCacheHas=function mapCacheHas(key){return getMapData(this,key).has(key)}}(),mapCacheSet=function require_mapCacheSet(){if(hasRequired_mapCacheSet)return _mapCacheSet;hasRequired_mapCacheSet=1;var getMapData=require_getMapData();return _mapCacheSet=function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this},_mapCacheSet}();function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}return MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,_MapCache=MapCache}function require_memoizeCapped(){if(hasRequired_memoizeCapped)return _memoizeCapped;hasRequired_memoizeCapped=1;var memoize=function requireMemoize(){if(hasRequiredMemoize)return memoize_1;hasRequiredMemoize=1;var MapCache=require_MapCache();function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}return memoize.Cache=MapCache,memoize_1=memoize}();return _memoizeCapped=function memoizeCapped(func){var result=memoize(func,function(key){return 500===cache.size&&cache.clear(),key}),cache=result.cache;return result},_memoizeCapped}function require_stringToPath(){if(hasRequired_stringToPath)return _stringToPath;hasRequired_stringToPath=1;var memoizeCapped=require_memoizeCapped(),rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}),result});return _stringToPath=stringToPath}function require_arrayMap(){if(hasRequired_arrayMap)return _arrayMap;return hasRequired_arrayMap=1,_arrayMap=function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result},_arrayMap}function requireToString(){if(hasRequiredToString)return toString_1;hasRequiredToString=1;var baseToString=function require_baseToString(){if(hasRequired_baseToString)return _baseToString;hasRequired_baseToString=1;var Symbol=require_Symbol(),arrayMap=require_arrayMap(),isArray=requireIsArray(),isSymbol=requireIsSymbol(),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;return _baseToString=function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result},_baseToString}();return toString_1=function toString(value){return null==value?"":baseToString(value)}}function require_castPath(){if(hasRequired_castPath)return _castPath;hasRequired_castPath=1;var isArray=requireIsArray(),isKey=function require_isKey(){if(hasRequired_isKey)return _isKey;hasRequired_isKey=1;var isArray=requireIsArray(),isSymbol=requireIsSymbol(),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;return _isKey=function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object)},_isKey}(),stringToPath=require_stringToPath(),toString=requireToString();return _castPath=function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))},_castPath}function require_toKey(){if(hasRequired_toKey)return _toKey;hasRequired_toKey=1;var isSymbol=requireIsSymbol();return _toKey=function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}}var _defineProperty,hasRequired_defineProperty,_baseAssignValue,hasRequired_baseAssignValue,_assignValue,hasRequired_assignValue,_isIndex,hasRequired_isIndex,_baseSet,hasRequired_baseSet,set_1,hasRequiredSet,getExports=function requireGet(){if(hasRequiredGet)return get_1;hasRequiredGet=1;var baseGet=function require_baseGet(){if(hasRequired_baseGet)return _baseGet;hasRequired_baseGet=1;var castPath=require_castPath(),toKey=require_toKey();return _baseGet=function baseGet(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0},_baseGet}();return get_1=function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result},get_1}(),get=getDefaultExportFromCjs(getExports);function require_baseAssignValue(){if(hasRequired_baseAssignValue)return _baseAssignValue;hasRequired_baseAssignValue=1;var defineProperty=function require_defineProperty(){if(hasRequired_defineProperty)return _defineProperty;hasRequired_defineProperty=1;var getNative=require_getNative(),defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}();return _defineProperty=defineProperty}();return _baseAssignValue=function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value,writable:!0}):object[key]=value},_baseAssignValue}function require_baseSet(){if(hasRequired_baseSet)return _baseSet;hasRequired_baseSet=1;var assignValue=function require_assignValue(){if(hasRequired_assignValue)return _assignValue;hasRequired_assignValue=1;var baseAssignValue=require_baseAssignValue(),eq=requireEq(),hasOwnProperty=Object.prototype.hasOwnProperty;return _assignValue=function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)},_assignValue}(),castPath=require_castPath(),isIndex=function require_isIndex(){if(hasRequired_isIndex)return _isIndex;hasRequired_isIndex=1;var reIsUint=/^(?:0|[1-9]\d*)$/;return _isIndex=function isIndex(value,length){var type=typeof value;return!!(length=null==length?9007199254740991:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length}}(),isObject=requireIsObject(),toKey=require_toKey();return _baseSet=function baseSet(object,path,value,customizer){if(!isObject(object))return object;for(var index=-1,length=(path=castPath(path,object)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if("__proto__"===key||"constructor"===key||"prototype"===key)return object;if(index!=lastIndex){var objValue=nested[key];void 0===(newValue=customizer?customizer(objValue,key,nested):void 0)&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object},_baseSet}var _copyArray,hasRequired_copyArray,toPath_1,hasRequiredToPath,setExports=function requireSet(){if(hasRequiredSet)return set_1;hasRequiredSet=1;var baseSet=require_baseSet();return set_1=function set(object,path,value){return null==object?object:baseSet(object,path,value)},set_1}(),set=getDefaultExportFromCjs(setExports);var toPathExports=function requireToPath(){if(hasRequiredToPath)return toPath_1;hasRequiredToPath=1;var arrayMap=require_arrayMap(),copyArray=function require_copyArray(){return hasRequired_copyArray||(hasRequired_copyArray=1,_copyArray=function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}),_copyArray}(),isArray=requireIsArray(),isSymbol=requireIsSymbol(),stringToPath=require_stringToPath(),toKey=require_toKey(),toString=requireToString();return toPath_1=function toPath(value){return isArray(value)?arrayMap(value,toKey):isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}}(),toPath=getDefaultExportFromCjs(toPathExports),define$2={data:function data(params){return params=extend({},{field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function beforeGet(self){},beforeSet:function beforeSet(self,obj){},onSet:function onSet(self){},canSet:function canSet(self){return!0}},params),function dataImpl(name,value){var p=params,selfIsArrayLike=void 0!==this.length,all=selfIsArrayLike?this:[this],single=selfIsArrayLike?this[0]:this;if(string(name)){var ret,path=-1!==name.indexOf(".")&&toPath(name);if(p.allowGetting&&void 0===value)return single&&(p.beforeGet(single),ret=path&&void 0===single._private[p.field][name]?get(single._private[p.field],path):single._private[p.field][name]),ret;if(p.allowSetting&&void 0!==value&&!p.immutableKeys[name]){var change=_defineProperty$1({},name,value);p.beforeSet(this,change);for(var i=0,l=all.length;i<l;i++){var ele=all[i];p.canSet(ele)&&(path&&void 0===single._private[p.field][name]?set(ele._private[p.field],path,value):ele._private[p.field][name]=value)}p.updateStyle&&this.updateStyle(),p.onSet(this),p.settingTriggersEvent&&this[p.triggerFnName](p.settingEvent)}}else if(p.allowSetting&&plainObject(name)){var k,v,obj=name,keys=Object.keys(obj);p.beforeSet(this,obj);for(var _i=0;_i<keys.length;_i++){if(v=obj[k=keys[_i]],!p.immutableKeys[k])for(var j=0;j<all.length;j++){var _ele=all[j];p.canSet(_ele)&&(_ele._private[p.field][k]=v)}}p.updateStyle&&this.updateStyle(),p.onSet(this),p.settingTriggersEvent&&this[p.triggerFnName](p.settingEvent)}else if(p.allowBinding&&fn$6(name)){var fn=name;this.on(p.bindingEvent,fn)}else if(p.allowGetting&&void 0===name){var _ret;return single&&(p.beforeGet(single),_ret=single._private[p.field]),_ret}return this}},removeData:function removeData(params){return params=extend({},{field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}},params),function removeDataImpl(names){var p=params,all=void 0!==this.length?this:[this];if(string(names)){for(var keys=names.split(/\s+/),l=keys.length,i=0;i<l;i++){var key=keys[i];if(!emptyString(key))if(!p.immutableKeys[key])for(var i_a=0,l_a=all.length;i_a<l_a;i_a++)all[i_a]._private[p.field][key]=void 0}p.triggerEvent&&this[p.triggerFnName](p.event)}else if(void 0===names){for(var _i_a=0,_l_a=all.length;_i_a<_l_a;_i_a++)for(var _privateFields=all[_i_a]._private[p.field],_keys=Object.keys(_privateFields),_i2=0;_i2<_keys.length;_i2++){var _key=_keys[_i2];!p.immutableKeys[_key]&&(_privateFields[_key]=void 0)}p.triggerEvent&&this[p.triggerFnName](p.event)}return this}}},define$1={eventAliasesOn:function eventAliasesOn(proto){var p=proto;p.addListener=p.listen=p.bind=p.on,p.unlisten=p.unbind=p.off=p.removeListener,p.trigger=p.emit,p.pon=p.promiseOn=function(events,selector){var self=this,args=Array.prototype.slice.call(arguments,0);return new Promise$1(function(resolve,reject){var onArgs=args.concat([function callback(e){self.off.apply(self,offArgs),resolve(e)}]),offArgs=onArgs.concat([]);self.on.apply(self,onArgs)})}}},define={};[define$3,define$2,define$1].forEach(function(m){extend(define,m)});var elesfn$i={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop()},elesfn$h={classes:function classes(_classes){if(void 0===_classes){var ret=[];return this[0]._private.classes.forEach(function(cls){return ret.push(cls)}),ret}array(_classes)||(_classes=(_classes||"").match(/\S+/g)||[]);for(var changed=[],classesSet=new Set$1(_classes),j=0;j<this.length;j++){for(var ele=this[j],_p=ele._private,eleClasses=_p.classes,changedEle=!1,i=0;i<_classes.length;i++){var cls=_classes[i];if(!eleClasses.has(cls)){changedEle=!0;break}}changedEle||(changedEle=eleClasses.size!==_classes.length),changedEle&&(_p.classes=classesSet,changed.push(ele))}return changed.length>0&&this.spawn(changed).updateStyle().emit("class"),this},addClass:function addClass(classes){return this.toggleClass(classes,!0)},hasClass:function hasClass(className){var ele=this[0];return null!=ele&&ele._private.classes.has(className)},toggleClass:function toggleClass(classes,toggle){array(classes)||(classes=classes.match(/\S+/g)||[]);for(var toggleUndefd=void 0===toggle,changed=[],i=0,il=this.length;i<il;i++)for(var ele=this[i],eleClasses=ele._private.classes,changedEle=!1,j=0;j<classes.length;j++){var cls=classes[j],hasClass=eleClasses.has(cls),changedNow=!1;toggle||toggleUndefd&&!hasClass?(eleClasses.add(cls),changedNow=!0):(!toggle||toggleUndefd&&hasClass)&&(eleClasses.delete(cls),changedNow=!0),!changedEle&&changedNow&&(changed.push(ele),changedEle=!0)}return changed.length>0&&this.spawn(changed).updateStyle().emit("class"),this},removeClass:function removeClass(classes){return this.toggleClass(classes,!1)},flashClass:function flashClass(classes,duration){var self=this;if(null==duration)duration=250;else if(0===duration)return self;return self.addClass(classes),setTimeout(function(){self.removeClass(classes)},duration),self}};elesfn$h.className=elesfn$h.classNames=elesfn$h.classes;var tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",number,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};tokens.variable="(?:[\\w-.]|(?:\\\\"+tokens.metaChar+"))+",tokens.className="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+",tokens.value=tokens.string+"|"+tokens.number,tokens.id=tokens.variable,function(){var ops,op,i;for(ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++)op=ops[i],tokens.comparatorOp+="|@"+op;for(ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++)(op=ops[i]).indexOf("!")>=0||"="!==op&&(tokens.comparatorOp+="|\\!"+op)}();var Type_GROUP=0,Type_COLLECTION=1,Type_FILTER=2,Type_DATA_COMPARE=3,Type_DATA_EXIST=4,Type_DATA_BOOL=5,Type_META_COMPARE=6,Type_STATE=7,Type_ID=8,Type_CLASS=9,Type_UNDIRECTED_EDGE=10,Type_DIRECTED_EDGE=11,Type_NODE_SOURCE=12,Type_NODE_TARGET=13,Type_NODE_NEIGHBOR=14,Type_CHILD=15,Type_DESCENDANT=16,Type_PARENT=17,Type_ANCESTOR=18,Type_COMPOUND_SPLIT=19,Type_TRUE=20,stateSelectors=[{selector:":selected",matches:function matches(ele){return ele.selected()}},{selector:":unselected",matches:function matches(ele){return!ele.selected()}},{selector:":selectable",matches:function matches(ele){return ele.selectable()}},{selector:":unselectable",matches:function matches(ele){return!ele.selectable()}},{selector:":locked",matches:function matches(ele){return ele.locked()}},{selector:":unlocked",matches:function matches(ele){return!ele.locked()}},{selector:":visible",matches:function matches(ele){return ele.visible()}},{selector:":hidden",matches:function matches(ele){return!ele.visible()}},{selector:":transparent",matches:function matches(ele){return ele.transparent()}},{selector:":grabbed",matches:function matches(ele){return ele.grabbed()}},{selector:":free",matches:function matches(ele){return!ele.grabbed()}},{selector:":removed",matches:function matches(ele){return ele.removed()}},{selector:":inside",matches:function matches(ele){return!ele.removed()}},{selector:":grabbable",matches:function matches(ele){return ele.grabbable()}},{selector:":ungrabbable",matches:function matches(ele){return!ele.grabbable()}},{selector:":animated",matches:function matches(ele){return ele.animated()}},{selector:":unanimated",matches:function matches(ele){return!ele.animated()}},{selector:":parent",matches:function matches(ele){return ele.isParent()}},{selector:":childless",matches:function matches(ele){return ele.isChildless()}},{selector:":child",matches:function matches(ele){return ele.isChild()}},{selector:":orphan",matches:function matches(ele){return ele.isOrphan()}},{selector:":nonorphan",matches:function matches(ele){return ele.isChild()}},{selector:":compound",matches:function matches(ele){return ele.isNode()?ele.isParent():ele.source().isParent()||ele.target().isParent()}},{selector:":loop",matches:function matches(ele){return ele.isLoop()}},{selector:":simple",matches:function matches(ele){return ele.isSimple()}},{selector:":active",matches:function matches(ele){return ele.active()}},{selector:":inactive",matches:function matches(ele){return!ele.active()}},{selector:":backgrounding",matches:function matches(ele){return ele.backgrounding()}},{selector:":nonbackgrounding",matches:function matches(ele){return!ele.backgrounding()}}].sort(function(a,b){return function descending(a,b){return-1*ascending(a,b)}(a.selector,b.selector)}),lookup=function(){for(var s,selToFn={},i=0;i<stateSelectors.length;i++)selToFn[(s=stateSelectors[i]).selector]=s.matches;return selToFn}(),stateSelectorRegex="("+stateSelectors.map(function(s){return s.selector}).join("|")+")",cleanMetaChars=function cleanMetaChars(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),function(match,$1){return $1})},replaceLastQuery=function replaceLastQuery(selector,examiningQuery,replacementQuery){selector[selector.length-1]=replacementQuery},exprs=[{name:"group",query:!0,regex:"("+tokens.group+")",populate:function populate(selector,query,_ref){var group=_slicedToArray(_ref,1)[0];query.checks.push({type:Type_GROUP,value:"*"===group?group:group+"s"})}},{name:"state",query:!0,regex:stateSelectorRegex,populate:function populate(selector,query,_ref3){var state=_slicedToArray(_ref3,1)[0];query.checks.push({type:Type_STATE,value:state})}},{name:"id",query:!0,regex:"\\#("+tokens.id+")",populate:function populate(selector,query,_ref5){var id=_slicedToArray(_ref5,1)[0];query.checks.push({type:Type_ID,value:cleanMetaChars(id)})}},{name:"className",query:!0,regex:"\\.("+tokens.className+")",populate:function populate(selector,query,_ref7){var className=_slicedToArray(_ref7,1)[0];query.checks.push({type:Type_CLASS,value:cleanMetaChars(className)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref9){var variable=_slicedToArray(_ref9,1)[0];query.checks.push({type:Type_DATA_EXIST,field:cleanMetaChars(variable)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function populate(selector,query,_ref11){var _ref12=_slicedToArray(_ref11,3),variable=_ref12[0],comparatorOp=_ref12[1],value=_ref12[2];value=null!=new RegExp("^"+tokens.string+"$").exec(value)?value.substring(1,value.length-1):parseFloat(value),query.checks.push({type:Type_DATA_COMPARE,field:cleanMetaChars(variable),operator:comparatorOp,value})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref13){var _ref14=_slicedToArray(_ref13,2),boolOp=_ref14[0],variable=_ref14[1];query.checks.push({type:Type_DATA_BOOL,field:cleanMetaChars(variable),operator:boolOp})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function populate(selector,query,_ref15){var _ref16=_slicedToArray(_ref15,3),meta=_ref16[0],comparatorOp=_ref16[1],number=_ref16[2];query.checks.push({type:Type_META_COMPARE,field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},{name:"nextQuery",separator:!0,regex:tokens.separator,populate:function populate(selector,query){var currentSubject=selector.currentSubject,edgeCount=selector.edgeCount,compoundCount=selector.compoundCount,lastQ=selector[selector.length-1];return null!=currentSubject&&(lastQ.subject=currentSubject,selector.currentSubject=null),lastQ.edgeCount=edgeCount,lastQ.compoundCount=compoundCount,selector.edgeCount=0,selector.compoundCount=0,selector[selector.length++]={checks:[]}}},{name:"directedEdge",separator:!0,regex:tokens.directedEdge,populate:function populate(selector,query){if(null==selector.currentSubject){var edgeQuery={checks:[]},source=query,target={checks:[]};return edgeQuery.checks.push({type:Type_DIRECTED_EDGE,source,target}),replaceLastQuery(selector,0,edgeQuery),selector.edgeCount++,target}var srcTgtQ={checks:[]},_source=query,_target={checks:[]};return srcTgtQ.checks.push({type:Type_NODE_SOURCE,source:_source,target:_target}),replaceLastQuery(selector,0,srcTgtQ),selector.edgeCount++,_target}},{name:"undirectedEdge",separator:!0,regex:tokens.undirectedEdge,populate:function populate(selector,query){if(null==selector.currentSubject){var edgeQuery={checks:[]},source=query,target={checks:[]};return edgeQuery.checks.push({type:Type_UNDIRECTED_EDGE,nodes:[source,target]}),replaceLastQuery(selector,0,edgeQuery),selector.edgeCount++,target}var nhoodQ={checks:[]},node=query,neighbor={checks:[]};return nhoodQ.checks.push({type:Type_NODE_NEIGHBOR,node,neighbor}),replaceLastQuery(selector,0,nhoodQ),neighbor}},{name:"child",separator:!0,regex:tokens.child,populate:function populate(selector,query){if(null==selector.currentSubject){var parentChildQuery={checks:[]},child={checks:[]},parent=selector[selector.length-1];return parentChildQuery.checks.push({type:Type_CHILD,parent,child}),replaceLastQuery(selector,0,parentChildQuery),selector.compoundCount++,child}if(selector.currentSubject===query){var compound={checks:[]},left=selector[selector.length-1],right={checks:[]},subject={checks:[]},_child={checks:[]},_parent={checks:[]};return compound.checks.push({type:Type_COMPOUND_SPLIT,left,right,subject}),subject.checks=query.checks,query.checks=[{type:Type_TRUE}],_parent.checks.push({type:Type_TRUE}),right.checks.push({type:Type_PARENT,parent:_parent,child:_child}),replaceLastQuery(selector,0,compound),selector.currentSubject=subject,selector.compoundCount++,_child}var _parent2={checks:[]},_child2={checks:[]},pcQChecks=[{type:Type_PARENT,parent:_parent2,child:_child2}];return _parent2.checks=query.checks,query.checks=pcQChecks,selector.compoundCount++,_child2}},{name:"descendant",separator:!0,regex:tokens.descendant,populate:function populate(selector,query){if(null==selector.currentSubject){var ancChQuery={checks:[]},descendant={checks:[]},ancestor=selector[selector.length-1];return ancChQuery.checks.push({type:Type_DESCENDANT,ancestor,descendant}),replaceLastQuery(selector,0,ancChQuery),selector.compoundCount++,descendant}if(selector.currentSubject===query){var compound={checks:[]},left=selector[selector.length-1],right={checks:[]},subject={checks:[]},_descendant={checks:[]},_ancestor={checks:[]};return compound.checks.push({type:Type_COMPOUND_SPLIT,left,right,subject}),subject.checks=query.checks,query.checks=[{type:Type_TRUE}],_ancestor.checks.push({type:Type_TRUE}),right.checks.push({type:Type_ANCESTOR,ancestor:_ancestor,descendant:_descendant}),replaceLastQuery(selector,0,compound),selector.currentSubject=subject,selector.compoundCount++,_descendant}var _ancestor2={checks:[]},_descendant2={checks:[]},adQChecks=[{type:Type_ANCESTOR,ancestor:_ancestor2,descendant:_descendant2}];return _ancestor2.checks=query.checks,query.checks=adQChecks,selector.compoundCount++,_descendant2}},{name:"subject",modifier:!0,regex:tokens.subject,populate:function populate(selector,query){if(null!=selector.currentSubject&&selector.currentSubject!==query)return warn("Redefinition of subject in selector `"+selector.toString()+"`"),!1;selector.currentSubject=query;var topChk=selector[selector.length-1].checks[0],topType=null==topChk?null:topChk.type;topType===Type_DIRECTED_EDGE?topChk.type=Type_NODE_TARGET:topType===Type_UNDIRECTED_EDGE&&(topChk.type=Type_NODE_NEIGHBOR,topChk.node=topChk.nodes[1],topChk.neighbor=topChk.nodes[0],topChk.nodes=null)}}];exprs.forEach(function(e){return e.regexObj=new RegExp("^"+e.regex)});var consumeExpr=function consumeExpr(remaining){for(var expr,match,name,j=0;j<exprs.length;j++){var e=exprs[j],n=e.name,m=remaining.match(e.regexObj);if(null!=m){match=m,expr=e,name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}return{expr,match,name,remaining}},parse$1={parse:function parse(selector){var remaining=this.inputText=selector,currentQuery=this[0]={checks:[]};for(this.length=1,remaining=function consumeWhitespace(remaining){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}return remaining}(remaining);;){var exprInfo=consumeExpr(remaining);if(null==exprInfo.expr)return warn("The selector `"+selector+"`is invalid"),!1;var args=exprInfo.match.slice(1),ret=exprInfo.expr.populate(this,currentQuery,args);if(!1===ret)return!1;if(null!=ret&&(currentQuery=ret),(remaining=exprInfo.remaining).match(/^\s*$/))break}var lastQ=this[this.length-1];null!=this.currentSubject&&(lastQ.subject=this.currentSubject),lastQ.edgeCount=this.edgeCount,lastQ.compoundCount=this.compoundCount;for(var i=0;i<this.length;i++){var q=this[i];if(q.compoundCount>0&&q.edgeCount>0)return warn("The selector `"+selector+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(q.edgeCount>1)return warn("The selector `"+selector+"` is invalid because it uses multiple edge selectors"),!1;1===q.edgeCount&&warn("The selector `"+selector+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},toString:function toString(){if(null!=this.toStringCache)return this.toStringCache;for(var clean=function clean(obj){return null==obj?"":obj},cleanVal=function cleanVal(val){return string(val)?'"'+val+'"':clean(val)},space=function space(val){return" "+val+" "},checkToString=function checkToString(check,subject){var type=check.type,value=check.value;switch(type){case Type_GROUP:var group=clean(value);return group.substring(0,group.length-1);case Type_DATA_COMPARE:var field=check.field,operator=check.operator;return"["+field+space(clean(operator))+cleanVal(value)+"]";case Type_DATA_BOOL:var _operator=check.operator,_field=check.field;return"["+clean(_operator)+_field+"]";case Type_DATA_EXIST:return"["+check.field+"]";case Type_META_COMPARE:var _operator2=check.operator;return"[["+check.field+space(clean(_operator2))+cleanVal(value)+"]]";case Type_STATE:return value;case Type_ID:return"#"+value;case Type_CLASS:return"."+value;case Type_PARENT:case Type_CHILD:return queryToString(check.parent,subject)+space(">")+queryToString(check.child,subject);case Type_ANCESTOR:case Type_DESCENDANT:return queryToString(check.ancestor,subject)+" "+queryToString(check.descendant,subject);case Type_COMPOUND_SPLIT:var lhs=queryToString(check.left,subject),sub=queryToString(check.subject,subject),rhs=queryToString(check.right,subject);return lhs+(lhs.length>0?" ":"")+sub+rhs;case Type_TRUE:return""}},queryToString=function queryToString(query,subject){return query.checks.reduce(function(str,chk,i){return str+(subject===query&&0===i?"$":"")+checkToString(chk,subject)},"")},str="",i=0;i<this.length;i++){var query=this[i];str+=queryToString(query,query.subject),this.length>1&&i<this.length-1&&(str+=", ")}return this.toStringCache=str,str}},valCmp=function valCmp(fieldVal,operator,value){var matches,fieldStr,valStr,isFieldStr=string(fieldVal),isFieldNum=number$1(fieldVal),isValStr=string(value),caseInsensitive=!1,notExpr=!1,isIneqCmp=!1;switch(operator.indexOf("!")>=0&&(operator=operator.replace("!",""),notExpr=!0),operator.indexOf("@")>=0&&(operator=operator.replace("@",""),caseInsensitive=!0),(isFieldStr||isValStr||caseInsensitive)&&(fieldStr=isFieldStr||isFieldNum?""+fieldVal:"",valStr=""+value),caseInsensitive&&(fieldVal=fieldStr=fieldStr.toLowerCase(),value=valStr=valStr.toLowerCase()),operator){case"*=":matches=fieldStr.indexOf(valStr)>=0;break;case"$=":matches=fieldStr.indexOf(valStr,fieldStr.length-valStr.length)>=0;break;case"^=":matches=0===fieldStr.indexOf(valStr);break;case"=":matches=fieldVal===value;break;case">":isIneqCmp=!0,matches=fieldVal>value;break;case">=":isIneqCmp=!0,matches=fieldVal>=value;break;case"<":isIneqCmp=!0,matches=fieldVal<value;break;case"<=":isIneqCmp=!0,matches=fieldVal<=value;break;default:matches=!1}return!notExpr||null==fieldVal&&isIneqCmp||(matches=!matches),matches},data$1=function data(ele,field){return ele.data(field)},match=[],matches$1=function matches(query,ele){return query.checks.every(function(chk){return match[chk.type](chk,ele)})};match[Type_GROUP]=function(check,ele){var group=check.value;return"*"===group||group===ele.group()},match[Type_STATE]=function(check,ele){return function stateSelectorMatches(sel,ele){return lookup[sel](ele)}(check.value,ele)},match[Type_ID]=function(check,ele){var id=check.value;return ele.id()===id},match[Type_CLASS]=function(check,ele){var cls=check.value;return ele.hasClass(cls)},match[Type_META_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(function meta(ele,field){return ele[field]()}(ele,field),operator,value)},match[Type_DATA_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(data$1(ele,field),operator,value)},match[Type_DATA_BOOL]=function(check,ele){var field=check.field,operator=check.operator;return function boolCmp(fieldVal,operator){switch(operator){case"?":return!!fieldVal;case"!":return!fieldVal;case"^":return void 0===fieldVal}}(data$1(ele,field),operator)},match[Type_DATA_EXIST]=function(check,ele){var field=check.field;return check.operator,function existCmp(fieldVal){return void 0!==fieldVal}(data$1(ele,field))},match[Type_UNDIRECTED_EDGE]=function(check,ele){var qA=check.nodes[0],qB=check.nodes[1],src=ele.source(),tgt=ele.target();return matches$1(qA,src)&&matches$1(qB,tgt)||matches$1(qB,src)&&matches$1(qA,tgt)},match[Type_NODE_NEIGHBOR]=function(check,ele){return matches$1(check.node,ele)&&ele.neighborhood().some(function(n){return n.isNode()&&matches$1(check.neighbor,n)})},match[Type_DIRECTED_EDGE]=function(check,ele){return matches$1(check.source,ele.source())&&matches$1(check.target,ele.target())},match[Type_NODE_SOURCE]=function(check,ele){return matches$1(check.source,ele)&&ele.outgoers().some(function(n){return n.isNode()&&matches$1(check.target,n)})},match[Type_NODE_TARGET]=function(check,ele){return matches$1(check.target,ele)&&ele.incomers().some(function(n){return n.isNode()&&matches$1(check.source,n)})},match[Type_CHILD]=function(check,ele){return matches$1(check.child,ele)&&matches$1(check.parent,ele.parent())},match[Type_PARENT]=function(check,ele){return matches$1(check.parent,ele)&&ele.children().some(function(c){return matches$1(check.child,c)})},match[Type_DESCENDANT]=function(check,ele){return matches$1(check.descendant,ele)&&ele.ancestors().some(function(a){return matches$1(check.ancestor,a)})},match[Type_ANCESTOR]=function(check,ele){return matches$1(check.ancestor,ele)&&ele.descendants().some(function(d){return matches$1(check.descendant,d)})},match[Type_COMPOUND_SPLIT]=function(check,ele){return matches$1(check.subject,ele)&&matches$1(check.left,ele)&&matches$1(check.right,ele)},match[Type_TRUE]=function(){return!0},match[Type_COLLECTION]=function(check,ele){return check.value.has(ele)},match[Type_FILTER]=function(check,ele){return(0,check.value)(ele)};var matching={matches:function matches(ele){for(var j=0;j<this.length;j++){var query=this[j];if(matches$1(query,ele))return!0}return!1},filter:function filter(collection){var self=this;if(1===self.length&&1===self[0].checks.length&&self[0].checks[0].type===Type_ID)return collection.getElementById(self[0].checks[0].value).collection();var selectorFunction=function selectorFunction(element){for(var j=0;j<self.length;j++){var query=self[j];if(matches$1(query,element))return!0}return!1};return null==self.text()&&(selectorFunction=function selectorFunction(){return!0}),collection.filter(selectorFunction)}},Selector=function Selector(selector){this.inputText=selector,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,null==selector||string(selector)&&selector.match(/^\s*$/)||(elementOrCollection(selector)?this.addQuery({checks:[{type:Type_COLLECTION,value:selector.collection()}]}):fn$6(selector)?this.addQuery({checks:[{type:Type_FILTER,value:selector}]}):string(selector)?this.parse(selector)||(this.invalid=!0):error("A selector must be created from a string; found "))},selfn=Selector.prototype;[parse$1,matching].forEach(function(p){return extend(selfn,p)}),selfn.text=function(){return this.inputText},selfn.size=function(){return this.length},selfn.eq=function(i){return this[i]},selfn.sameText=function(otherSel){return!this.invalid&&!otherSel.invalid&&this.text()===otherSel.text()},selfn.addQuery=function(q){this[this.length++]=q},selfn.selector=selfn.toString;var elesfn$g={allAre:function allAre(selector){var selObj=new Selector(selector);return this.every(function(ele){return selObj.matches(ele)})},is:function is(selector){var selObj=new Selector(selector);return this.some(function(ele){return selObj.matches(ele)})},some:function some(fn,thisArg){for(var i=0;i<this.length;i++){if(thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this))return!0}return!1},every:function every(fn,thisArg){for(var i=0;i<this.length;i++){if(!(thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this)))return!1}return!0},same:function same(collection){if(this===collection)return!0;collection=this.cy().collection(collection);var thisLength=this.length;return thisLength===collection.length&&(1===thisLength?this[0]===collection[0]:this.every(function(ele){return collection.hasElementWithId(ele.id())}))},anySame:function anySame(collection){return collection=this.cy().collection(collection),this.some(function(ele){return collection.hasElementWithId(ele.id())})},allAreNeighbors:function allAreNeighbors(collection){collection=this.cy().collection(collection);var nhood=this.neighborhood();return collection.every(function(ele){return nhood.hasElementWithId(ele.id())})},contains:function contains(collection){collection=this.cy().collection(collection);var self=this;return collection.every(function(ele){return self.hasElementWithId(ele.id())})}};elesfn$g.allAreNeighbours=elesfn$g.allAreNeighbors,elesfn$g.has=elesfn$g.contains,elesfn$g.equal=elesfn$g.equals=elesfn$g.same;var fn$5,elesfn$e,cache=function cache(fn,name){return function traversalCache(arg1,arg2,arg3,arg4){var key,selectorOrEles=arg1;if(null==selectorOrEles?key="":elementOrCollection(selectorOrEles)&&1===selectorOrEles.length&&(key=selectorOrEles.id()),1===this.length&&key){var _p=this[0]._private,tch=_p.traversalCache=_p.traversalCache||{},ch=tch[name]=tch[name]||[],hash=hashString(key),cacheHit=ch[hash];return cacheHit||(ch[hash]=fn.call(this,arg1,arg2,arg3,arg4))}return fn.call(this,arg1,arg2,arg3,arg4)}},elesfn$f={parent:function parent(selector){var parents=[];if(1===this.length){var parent=this[0]._private.parent;if(parent)return parent}for(var i=0;i<this.length;i++){var _parent=this[i]._private.parent;_parent&&parents.push(_parent)}return this.spawn(parents,!0).filter(selector)},parents:function parents(selector){for(var parents=[],eles=this.parent();eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent()}return this.spawn(parents,!0).filter(selector)},commonAncestors:function commonAncestors(selector){for(var ancestors,i=0;i<this.length;i++){var parents=this[i].parents();ancestors=(ancestors=ancestors||parents).intersect(parents)}return ancestors.filter(selector)},orphans:function orphans(selector){return this.stdFilter(function(ele){return ele.isOrphan()}).filter(selector)},nonorphans:function nonorphans(selector){return this.stdFilter(function(ele){return ele.isChild()}).filter(selector)},children:cache(function(selector){for(var children=[],i=0;i<this.length;i++)for(var eleChildren=this[i]._private.children,j=0;j<eleChildren.length;j++)children.push(eleChildren[j]);return this.spawn(children,!0).filter(selector)},"children"),siblings:function siblings(selector){return this.parent().children().not(this).filter(selector)},isParent:function isParent(){var ele=this[0];if(ele)return ele.isNode()&&0!==ele._private.children.length},isChildless:function isChildless(){var ele=this[0];if(ele)return ele.isNode()&&0===ele._private.children.length},isChild:function isChild(){var ele=this[0];if(ele)return ele.isNode()&&null!=ele._private.parent},isOrphan:function isOrphan(){var ele=this[0];if(ele)return ele.isNode()&&null==ele._private.parent},descendants:function descendants(selector){var elements=[];return function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele),ele.children().nonempty()&&add(ele.children())}}(this.children()),this.spawn(elements,!0).filter(selector)}};function forEachCompound(eles,fn,includeSelf,recursiveStep){for(var q=[],did=new Set$1,hasCompounds=eles.cy().hasCompoundNodes(),i=0;i<eles.length;i++){var ele=eles[i];includeSelf?q.push(ele):hasCompounds&&recursiveStep(q,did,ele)}for(;q.length>0;){var _ele=q.shift();fn(_ele),did.add(_ele.id()),hasCompounds&&recursiveStep(q,did,_ele)}return eles}function addChildren(q,did,ele){if(ele.isParent())for(var children=ele._private.children,i=0;i<children.length;i++){var child=children[i];did.has(child.id())||q.push(child)}}function addParent(q,did,ele){if(ele.isChild()){var parent=ele._private.parent;did.has(parent.id())||q.push(parent)}}function addParentAndChildren(q,did,ele){addParent(q,did,ele),addChildren(q,did,ele)}elesfn$f.forEachDown=function(fn){return forEachCompound(this,fn,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],addChildren)},elesfn$f.forEachUp=function(fn){return forEachCompound(this,fn,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],addParent)},elesfn$f.forEachUpAndDown=function(fn){return forEachCompound(this,fn,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],addParentAndChildren)},elesfn$f.ancestors=elesfn$f.parents,(fn$5=elesfn$e={data:define.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:define.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:define.removeData({field:"rscratch",triggerEvent:!1}),id:function id(){var ele=this[0];if(ele)return ele._private.data.id}}).attr=fn$5.data,fn$5.removeAttr=fn$5.removeData;var fn$4,elesfn$c,data=elesfn$e,elesfn$d={};function defineDegreeFunction(callback){return function(includeLoops){if(void 0===includeLoops&&(includeLoops=!0),0!==this.length&&this.isNode()&&!this.removed()){for(var degree=0,node=this[0],connectedEdges=node._private.edges,i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];!includeLoops&&edge.isLoop()||(degree+=callback(node,edge))}return degree}}}function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){for(var ret,nodes=this.nodes(),i=0;i<nodes.length;i++){var degree=nodes[i][degreeFn](includeLoops);void 0===degree||void 0!==ret&&!callback(degree,ret)||(ret=degree)}return ret}}extend(elesfn$d,{degree:defineDegreeFunction(function(node,edge){return edge.source().same(edge.target())?2:1}),indegree:defineDegreeFunction(function(node,edge){return edge.target().same(node)?1:0}),outdegree:defineDegreeFunction(function(node,edge){return edge.source().same(node)?1:0})}),extend(elesfn$d,{minDegree:defineDegreeBoundsFunction("degree",function(degree,min){return degree<min}),maxDegree:defineDegreeBoundsFunction("degree",function(degree,max){return degree>max}),minIndegree:defineDegreeBoundsFunction("indegree",function(degree,min){return degree<min}),maxIndegree:defineDegreeBoundsFunction("indegree",function(degree,max){return degree>max}),minOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,min){return degree<min}),maxOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,max){return degree>max})}),extend(elesfn$d,{totalDegree:function totalDegree(includeLoops){for(var total=0,nodes=this.nodes(),i=0;i<nodes.length;i++)total+=nodes[i].degree(includeLoops);return total}});var beforePositionSet=function beforePositionSet(eles,newPos,silent){for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.locked()){var oldPos=ele._private.position,delta={x:null!=newPos.x?newPos.x-oldPos.x:0,y:null!=newPos.y?newPos.y-oldPos.y:0};!ele.isParent()||0===delta.x&&0===delta.y||ele.children().shift(delta,silent),ele.dirtyBoundingBoxCache()}}},positionDef={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function beforeGet(ele){ele.updateCompoundBounds()},beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,!1)},onSet:function onSet(eles){eles.dirtyCompoundBoundsCache()},canSet:function canSet(ele){return!ele.locked()}};fn$4=elesfn$c={position:define.data(positionDef),silentPosition:define.data(extend({},positionDef,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,!0)},onSet:function onSet(eles){eles.dirtyCompoundBoundsCache()}})),positions:function positions(pos,silent){if(plainObject(pos))silent?this.silentPosition(pos):this.position(pos);else if(fn$6(pos)){var _fn=pos,cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var _pos,ele=this[i];(_pos=_fn(ele,i))&&(silent?ele.silentPosition(_pos):ele.position(_pos))}cy.endBatch()}return this},silentPositions:function silentPositions(pos){return this.positions(pos,!0)},shift:function shift(dim,val,silent){var delta;if(plainObject(dim)?(delta={x:number$1(dim.x)?dim.x:0,y:number$1(dim.y)?dim.y:0},silent=val):string(dim)&&number$1(val)&&((delta={x:0,y:0})[dim]=val),null!=delta){var cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var ele=this[i];if(!(cy.hasCompoundNodes()&&ele.isChild()&&ele.ancestors().anySame(this))){var pos=ele.position(),newPos={x:pos.x+delta.x,y:pos.y+delta.y};silent?ele.silentPosition(newPos):ele.position(newPos)}}cy.endBatch()}return this},silentShift:function silentShift(dim,val){return plainObject(dim)?this.shift(dim,!0):string(dim)&&number$1(val)&&this.shift(dim,val,!0),this},renderedPosition:function renderedPosition(dim,val){var ele=this[0],cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),rpos=plainObject(dim)?dim:void 0,setting=void 0!==rpos||void 0!==val&&string(dim);if(ele&&ele.isNode()){if(!setting){var pos=ele.position();return rpos=modelToRenderedPosition$1(pos,zoom,pan),void 0===dim?rpos:rpos[dim]}for(var i=0;i<this.length;i++){var _ele=this[i];void 0!==val?_ele.position(dim,(val-pan[dim])/zoom):void 0!==rpos&&_ele.position(renderedToModelPosition(rpos,zoom,pan))}}else if(!setting)return;return this},relativePosition:function relativePosition(dim,val){var ele=this[0],cy=this.cy(),ppos=plainObject(dim)?dim:void 0,setting=void 0!==ppos||void 0!==val&&string(dim),hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(!setting){var pos=ele.position(),_parent=hasCompoundNodes?ele.parent():null,_hasParent=_parent&&_parent.length>0,_relativeToParent=_hasParent;_hasParent&&(_parent=_parent[0]);var _origin=_relativeToParent?_parent.position():{x:0,y:0};return ppos={x:pos.x-_origin.x,y:pos.y-_origin.y},void 0===dim?ppos:ppos[dim]}for(var i=0;i<this.length;i++){var _ele2=this[i],parent=hasCompoundNodes?_ele2.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent.position():{x:0,y:0};void 0!==val?_ele2.position(dim,val+origin[dim]):void 0!==ppos&&_ele2.position({x:ppos.x+origin.x,y:ppos.y+origin.y})}}else if(!setting)return;return this}},fn$4.modelPosition=fn$4.point=fn$4.position,fn$4.modelPositions=fn$4.points=fn$4.positions,fn$4.renderedPoint=fn$4.renderedPosition,fn$4.relativePoint=fn$4.relativePosition;var fn$3,elesfn$b,position=elesfn$c;fn$3=elesfn$b={},elesfn$b.renderedBoundingBox=function(options){var bb=this.boundingBox(options),cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),x1=bb.x1*zoom+pan.x,x2=bb.x2*zoom+pan.x,y1=bb.y1*zoom+pan.y,y2=bb.y2*zoom+pan.y;return{x1,x2,y1,y2,w:x2-x1,h:y2-y1}},elesfn$b.dirtyCompoundBoundsCache=function(){var silent=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cy=this.cy();return cy.styleEnabled()&&cy.hasCompoundNodes()?(this.forEachUp(function(ele){if(ele.isParent()){var _p=ele._private;_p.compoundBoundsClean=!1,_p.bbCache=null,silent||ele.emitAndNotify("bounds")}}),this):this},elesfn$b.updateCompoundBounds=function(){var force=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes())return this;if(!force&&cy.batching())return this;function update(parent){if(parent.isParent()){var _p=parent._private,children=parent.children(),includeLabels="include"===parent.pstyle("compound-sizing-wrt-labels").value,min={width:{val:parent.pstyle("min-width").pfValue,left:parent.pstyle("min-width-bias-left"),right:parent.pstyle("min-width-bias-right")},height:{val:parent.pstyle("min-height").pfValue,top:parent.pstyle("min-height-bias-top"),bottom:parent.pstyle("min-height-bias-bottom")}},bb=children.boundingBox({includeLabels,includeOverlays:!1,useCache:!1}),pos=_p.position;0!==bb.w&&0!==bb.h||((bb={w:parent.pstyle("width").pfValue,h:parent.pstyle("height").pfValue}).x1=pos.x-bb.w/2,bb.x2=pos.x+bb.w/2,bb.y1=pos.y-bb.h/2,bb.y2=pos.y+bb.h/2);var leftVal=min.width.left.value;"px"===min.width.left.units&&min.width.val>0&&(leftVal=100*leftVal/min.width.val);var rightVal=min.width.right.value;"px"===min.width.right.units&&min.width.val>0&&(rightVal=100*rightVal/min.width.val);var topVal=min.height.top.value;"px"===min.height.top.units&&min.height.val>0&&(topVal=100*topVal/min.height.val);var bottomVal=min.height.bottom.value;"px"===min.height.bottom.units&&min.height.val>0&&(bottomVal=100*bottomVal/min.height.val);var widthBiasDiffs=computeBiasValues(min.width.val-bb.w,leftVal,rightVal),diffLeft=widthBiasDiffs.biasDiff,diffRight=widthBiasDiffs.biasComplementDiff,heightBiasDiffs=computeBiasValues(min.height.val-bb.h,topVal,bottomVal),diffTop=heightBiasDiffs.biasDiff,diffBottom=heightBiasDiffs.biasComplementDiff;_p.autoPadding=function computePaddingValues(width,height,paddingObject,relativeTo){if("%"!==paddingObject.units)return"px"===paddingObject.units?paddingObject.pfValue:0;switch(relativeTo){case"width":return width>0?paddingObject.pfValue*width:0;case"height":return height>0?paddingObject.pfValue*height:0;case"average":return width>0&&height>0?paddingObject.pfValue*(width+height)/2:0;case"min":return width>0&&height>0?width>height?paddingObject.pfValue*height:paddingObject.pfValue*width:0;case"max":return width>0&&height>0?width>height?paddingObject.pfValue*width:paddingObject.pfValue*height:0;default:return 0}}(bb.w,bb.h,parent.pstyle("padding"),parent.pstyle("padding-relative-to").value),_p.autoWidth=Math.max(bb.w,min.width.val),pos.x=(-diffLeft+bb.x1+bb.x2+diffRight)/2,_p.autoHeight=Math.max(bb.h,min.height.val),pos.y=(-diffTop+bb.y1+bb.y2+diffBottom)/2}function computeBiasValues(propDiff,propBias,propBiasComplement){var biasDiff=0,biasComplementDiff=0,biasTotal=propBias+propBiasComplement;return propDiff>0&&biasTotal>0&&(biasDiff=propBias/biasTotal*propDiff,biasComplementDiff=propBiasComplement/biasTotal*propDiff),{biasDiff,biasComplementDiff}}}for(var i=0;i<this.length;i++){var ele=this[i],_p=ele._private;_p.compoundBoundsClean&&!force||(update(ele),cy.batching()||(_p.compoundBoundsClean=!0))}return this};var noninf=function noninf(x){return x===1/0||x===-1/0?0:x},updateBounds=function updateBounds(b,x1,y1,x2,y2){x2-x1!==0&&y2-y1!==0&&null!=x1&&null!=y1&&null!=x2&&null!=y2&&(b.x1=x1<b.x1?x1:b.x1,b.x2=x2>b.x2?x2:b.x2,b.y1=y1<b.y1?y1:b.y1,b.y2=y2>b.y2?y2:b.y2,b.w=b.x2-b.x1,b.h=b.y2-b.y1)},updateBoundsFromBox=function updateBoundsFromBox(b,b2){return null==b2?b:updateBounds(b,b2.x1,b2.y1,b2.x2,b2.y2)},prefixedProperty=function prefixedProperty(obj,field,prefix){return getPrefixedProperty(obj,field,prefix)},updateBoundsFromArrow=function updateBoundsFromArrow(bounds,ele,prefix){if(!ele.cy().headless()){var x,y,_p=ele._private,rstyle=_p.rstyle,halfArW=rstyle.arrowWidth/2;if("none"!==ele.pstyle(prefix+"-arrow-shape").value){"source"===prefix?(x=rstyle.srcX,y=rstyle.srcY):"target"===prefix?(x=rstyle.tgtX,y=rstyle.tgtY):(x=rstyle.midX,y=rstyle.midY);var bbs=_p.arrowBounds=_p.arrowBounds||{},bb=bbs[prefix]=bbs[prefix]||{};bb.x1=x-halfArW,bb.y1=y-halfArW,bb.x2=x+halfArW,bb.y2=y+halfArW,bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1,expandBoundingBox(bb,1),updateBounds(bounds,bb.x1,bb.y1,bb.x2,bb.y2)}}},updateBoundsFromLabel=function updateBoundsFromLabel(bounds,ele,prefix){if(!ele.cy().headless()){var prefixDash;prefixDash=prefix?prefix+"-":"";var _p=ele._private,rstyle=_p.rstyle;if(ele.pstyle(prefixDash+"label").strValue){var lx1,lx2,ly1,ly2,halign=ele.pstyle("text-halign"),valign=ele.pstyle("text-valign"),labelWidth=prefixedProperty(rstyle,"labelWidth",prefix),labelHeight=prefixedProperty(rstyle,"labelHeight",prefix),labelX=prefixedProperty(rstyle,"labelX",prefix),labelY=prefixedProperty(rstyle,"labelY",prefix),marginX=ele.pstyle(prefixDash+"text-margin-x").pfValue,marginY=ele.pstyle(prefixDash+"text-margin-y").pfValue,isEdge=ele.isEdge(),rotation=ele.pstyle(prefixDash+"text-rotation"),outlineWidth=ele.pstyle("text-outline-width").pfValue,halfBorderWidth=ele.pstyle("text-border-width").pfValue/2,padding=ele.pstyle("text-background-padding").pfValue,lh=labelHeight,lw=labelWidth,lw_2=lw/2,lh_2=lh/2;if(isEdge)lx1=labelX-lw_2,lx2=labelX+lw_2,ly1=labelY-lh_2,ly2=labelY+lh_2;else{switch(halign.value){case"left":lx1=labelX-lw,lx2=labelX;break;case"center":lx1=labelX-lw_2,lx2=labelX+lw_2;break;case"right":lx1=labelX,lx2=labelX+lw}switch(valign.value){case"top":ly1=labelY-lh,ly2=labelY;break;case"center":ly1=labelY-lh_2,ly2=labelY+lh_2;break;case"bottom":ly1=labelY,ly2=labelY+lh}}var leftPad=marginX-Math.max(outlineWidth,halfBorderWidth)-padding-2,rightPad=marginX+Math.max(outlineWidth,halfBorderWidth)+padding+2,topPad=marginY-Math.max(outlineWidth,halfBorderWidth)-padding-2,botPad=marginY+Math.max(outlineWidth,halfBorderWidth)+padding+2;lx1+=leftPad,lx2+=rightPad,ly1+=topPad,ly2+=botPad;var bbPrefix=prefix||"main",bbs=_p.labelBounds,bb=bbs[bbPrefix]=bbs[bbPrefix]||{};bb.x1=lx1,bb.y1=ly1,bb.x2=lx2,bb.y2=ly2,bb.w=lx2-lx1,bb.h=ly2-ly1,bb.leftPad=leftPad,bb.rightPad=rightPad,bb.topPad=topPad,bb.botPad=botPad;var isAutorotate=isEdge&&"autorotate"===rotation.strValue,isPfValue=null!=rotation.pfValue&&0!==rotation.pfValue;if(isAutorotate||isPfValue){var theta=isAutorotate?prefixedProperty(_p.rstyle,"labelAngle",prefix):rotation.pfValue,cos=Math.cos(theta),sin=Math.sin(theta),xo=(lx1+lx2)/2,yo=(ly1+ly2)/2;if(!isEdge){switch(halign.value){case"left":xo=lx2;break;case"right":xo=lx1}switch(valign.value){case"top":yo=ly2;break;case"bottom":yo=ly1}}var rotate=function rotate(x,y){return{x:(x-=xo)*cos-(y-=yo)*sin+xo,y:x*sin+y*cos+yo}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2);lx1=Math.min(px1y1.x,px1y2.x,px2y1.x,px2y2.x),lx2=Math.max(px1y1.x,px1y2.x,px2y1.x,px2y2.x),ly1=Math.min(px1y1.y,px1y2.y,px2y1.y,px2y2.y),ly2=Math.max(px1y1.y,px1y2.y,px2y1.y,px2y2.y)}var bbPrefixRot=bbPrefix+"Rot",bbRot=bbs[bbPrefixRot]=bbs[bbPrefixRot]||{};bbRot.x1=lx1,bbRot.y1=ly1,bbRot.x2=lx2,bbRot.y2=ly2,bbRot.w=lx2-lx1,bbRot.h=ly2-ly1,updateBounds(bounds,lx1,ly1,lx2,ly2),updateBounds(_p.labelBounds.all,lx1,ly1,lx2,ly2)}return bounds}},updateBoundsFromOutline=function updateBoundsFromOutline(bounds,ele){if(!ele.cy().headless()){var outlineOpacity=ele.pstyle("outline-opacity").value,expansion=ele.pstyle("outline-width").value+ele.pstyle("outline-offset").value;updateBoundsFromMiter(bounds,ele,outlineOpacity,expansion,"outside",expansion/2)}},updateBoundsFromMiter=function updateBoundsFromMiter(bounds,ele,opacity,expansionSize,expansionPosition,useFallbackValue){if(!(0===opacity||expansionSize<=0||"inside"===expansionPosition)){var cy=ele.cy(),shape=ele.pstyle("shape").value,rshape=cy.renderer().nodeShapes[shape],_ele$position=ele.position(),x=_ele$position.x,y=_ele$position.y,w=ele.width(),h=ele.height();if(rshape.hasMiterBounds){"center"===expansionPosition&&(expansionSize/=2);var mbb=rshape.miterBounds(x,y,w,h,expansionSize);updateBoundsFromBox(bounds,mbb)}else null!=useFallbackValue&&useFallbackValue>0&&expandBoundingBoxSides(bounds,[useFallbackValue,useFallbackValue,useFallbackValue,useFallbackValue])}},boundingBoxImpl=function boundingBoxImpl(ele,options){var ex1,ex2,ey1,ey2,x,y,cy=ele._private.cy,styleEnabled=cy.styleEnabled(),headless=cy.headless(),bounds=makeBoundingBox(),_p=ele._private,isNode=ele.isNode(),isEdge=ele.isEdge(),rstyle=_p.rstyle,manualExpansion=isNode&&styleEnabled?ele.pstyle("bounds-expansion").pfValue:[0],isDisplayed=function isDisplayed(ele){return"none"!==ele.pstyle("display").value},displayed=!styleEnabled||isDisplayed(ele)&&(!isEdge||isDisplayed(ele.source())&&isDisplayed(ele.target()));if(displayed){var overlayPadding=0;styleEnabled&&options.includeOverlays&&0!==ele.pstyle("overlay-opacity").value&&(overlayPadding=ele.pstyle("overlay-padding").value);var underlayPadding=0;styleEnabled&&options.includeUnderlays&&0!==ele.pstyle("underlay-opacity").value&&(underlayPadding=ele.pstyle("underlay-padding").value);var padding=Math.max(overlayPadding,underlayPadding),wHalf=0;if(styleEnabled&&(wHalf=ele.pstyle("width").pfValue/2),isNode&&options.includeNodes){var pos=ele.position();x=pos.x,y=pos.y;var halfW=ele.outerWidth()/2,halfH=ele.outerHeight()/2;updateBounds(bounds,ex1=x-halfW,ey1=y-halfH,ex2=x+halfW,ey2=y+halfH),styleEnabled&&updateBoundsFromOutline(bounds,ele),styleEnabled&&options.includeOutlines&&!headless&&updateBoundsFromOutline(bounds,ele),styleEnabled&&function updateBoundsFromMiterBorder(bounds,ele){if(!ele.cy().headless()){var borderOpacity=ele.pstyle("border-opacity").value,borderWidth=ele.pstyle("border-width").pfValue,borderPosition=ele.pstyle("border-position").value;updateBoundsFromMiter(bounds,ele,borderOpacity,borderWidth,borderPosition)}}(bounds,ele)}else if(isEdge&&options.includeEdges)if(styleEnabled&&!headless){var curveStyle=ele.pstyle("curve-style").strValue;if(ex1=Math.min(rstyle.srcX,rstyle.midX,rstyle.tgtX),ex2=Math.max(rstyle.srcX,rstyle.midX,rstyle.tgtX),ey1=Math.min(rstyle.srcY,rstyle.midY,rstyle.tgtY),ey2=Math.max(rstyle.srcY,rstyle.midY,rstyle.tgtY),updateBounds(bounds,ex1-=wHalf,ey1-=wHalf,ex2+=wHalf,ey2+=wHalf),"haystack"===curveStyle){var hpts=rstyle.haystackPts;if(hpts&&2===hpts.length){if(ex1=hpts[0].x,ey1=hpts[0].y,ex1>(ex2=hpts[1].x)){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>(ey2=hpts[1].y)){var _temp=ey1;ey1=ey2,ey2=_temp}updateBounds(bounds,ex1-wHalf,ey1-wHalf,ex2+wHalf,ey2+wHalf)}}else if("bezier"===curveStyle||"unbundled-bezier"===curveStyle||endsWith(curveStyle,"segments")||endsWith(curveStyle,"taxi")){var pts;switch(curveStyle){case"bezier":case"unbundled-bezier":pts=rstyle.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":pts=rstyle.linePts}if(null!=pts)for(var j=0;j<pts.length;j++){var pt=pts[j];ex1=pt.x-wHalf,ex2=pt.x+wHalf,ey1=pt.y-wHalf,ey2=pt.y+wHalf,updateBounds(bounds,ex1,ey1,ex2,ey2)}}}else{var n1pos=ele.source().position(),n2pos=ele.target().position();if((ex1=n1pos.x)>(ex2=n2pos.x)){var _temp2=ex1;ex1=ex2,ex2=_temp2}if((ey1=n1pos.y)>(ey2=n2pos.y)){var _temp3=ey1;ey1=ey2,ey2=_temp3}updateBounds(bounds,ex1-=wHalf,ey1-=wHalf,ex2+=wHalf,ey2+=wHalf)}if(styleEnabled&&options.includeEdges&&isEdge&&(updateBoundsFromArrow(bounds,ele,"mid-source"),updateBoundsFromArrow(bounds,ele,"mid-target"),updateBoundsFromArrow(bounds,ele,"source"),updateBoundsFromArrow(bounds,ele,"target")),styleEnabled)if("yes"===ele.pstyle("ghost").value){var gx=ele.pstyle("ghost-offset-x").pfValue,gy=ele.pstyle("ghost-offset-y").pfValue;updateBounds(bounds,bounds.x1+gx,bounds.y1+gy,bounds.x2+gx,bounds.y2+gy)}var bbBody=_p.bodyBounds=_p.bodyBounds||{};assignBoundingBox(bbBody,bounds),expandBoundingBoxSides(bbBody,manualExpansion),expandBoundingBox(bbBody,1),styleEnabled&&(ex1=bounds.x1,ex2=bounds.x2,ey1=bounds.y1,ey2=bounds.y2,updateBounds(bounds,ex1-padding,ey1-padding,ex2+padding,ey2+padding));var bbOverlay=_p.overlayBounds=_p.overlayBounds||{};assignBoundingBox(bbOverlay,bounds),expandBoundingBoxSides(bbOverlay,manualExpansion),expandBoundingBox(bbOverlay,1);var bbLabels=_p.labelBounds=_p.labelBounds||{};null!=bbLabels.all?function clearBoundingBox(bb){bb.x1=1/0,bb.y1=1/0,bb.x2=-1/0,bb.y2=-1/0,bb.w=0,bb.h=0}(bbLabels.all):bbLabels.all=makeBoundingBox(),styleEnabled&&options.includeLabels&&(options.includeMainLabels&&updateBoundsFromLabel(bounds,ele,null),isEdge&&(options.includeSourceLabels&&updateBoundsFromLabel(bounds,ele,"source"),options.includeTargetLabels&&updateBoundsFromLabel(bounds,ele,"target")))}return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds.w>0&&bounds.h>0&&displayed&&(expandBoundingBoxSides(bounds,manualExpansion),expandBoundingBox(bounds,1)),bounds},getKey=function getKey(opts){var i=0,tf=function tf(val){return(val?1:0)<<i++},key=0;return key+=tf(opts.incudeNodes),key+=tf(opts.includeEdges),key+=tf(opts.includeLabels),key+=tf(opts.includeMainLabels),key+=tf(opts.includeSourceLabels),key+=tf(opts.includeTargetLabels),key+=tf(opts.includeOverlays),key+=tf(opts.includeOutlines)},getBoundingBoxPosKey=function getBoundingBoxPosKey(ele){var r=function r(x){return Math.round(x)};if(ele.isEdge()){var p1=ele.source().position(),p2=ele.target().position();return hashIntsArray([r(p1.x),r(p1.y),r(p2.x),r(p2.y)])}var p=ele.position();return hashIntsArray([r(p.x),r(p.y)])},cachedBoundingBoxImpl=function cachedBoundingBoxImpl(ele,opts){var bb,_p=ele._private,isEdge=ele.isEdge(),usingDefOpts=(null==opts?defBbOptsKey:getKey(opts))===defBbOptsKey;if(null==_p.bbCache?(bb=boundingBoxImpl(ele,defBbOpts),_p.bbCache=bb,_p.bbCachePosKey=getBoundingBoxPosKey(ele)):bb=_p.bbCache,!usingDefOpts){var isNode=ele.isNode();bb=makeBoundingBox(),(opts.includeNodes&&isNode||opts.includeEdges&&!isNode)&&(opts.includeOverlays?updateBoundsFromBox(bb,_p.overlayBounds):updateBoundsFromBox(bb,_p.bodyBounds)),opts.includeLabels&&(opts.includeMainLabels&&(!isEdge||opts.includeSourceLabels&&opts.includeTargetLabels)?updateBoundsFromBox(bb,_p.labelBounds.all):(opts.includeMainLabels&&updateBoundsFromBox(bb,_p.labelBounds.mainRot),opts.includeSourceLabels&&updateBoundsFromBox(bb,_p.labelBounds.sourceRot),opts.includeTargetLabels&&updateBoundsFromBox(bb,_p.labelBounds.targetRot))),bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}return bb},defBbOpts={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},defBbOptsKey=getKey(defBbOpts),filledBbOpts=defaults$g(defBbOpts);elesfn$b.boundingBox=function(options){var bounds,useCache=void 0===options||void 0===options.useCache||!0===options.useCache,isDirty=memoize(function(ele){var _p=ele._private;return null==_p.bbCache||_p.styleDirty||_p.bbCachePosKey!==getBoundingBoxPosKey(ele)},function(ele){return ele.id()});if(useCache&&1===this.length&&!isDirty(this[0]))options=void 0===options?defBbOpts:filledBbOpts(options),bounds=cachedBoundingBoxImpl(this[0],options);else{bounds=makeBoundingBox();var opts=filledBbOpts(options=options||defBbOpts),styleEnabled=this.cy().styleEnabled();this.edges().forEach(isDirty),this.nodes().forEach(isDirty),styleEnabled&&this.recalculateRenderedStyle(useCache),this.updateCompoundBounds(!useCache);for(var i=0;i<this.length;i++){var ele=this[i];isDirty(ele)&&ele.dirtyBoundingBoxCache(),updateBoundsFromBox(bounds,cachedBoundingBoxImpl(ele,opts))}}return bounds.x1=noninf(bounds.x1),bounds.y1=noninf(bounds.y1),bounds.x2=noninf(bounds.x2),bounds.y2=noninf(bounds.y2),bounds.w=noninf(bounds.x2-bounds.x1),bounds.h=noninf(bounds.y2-bounds.y1),bounds},elesfn$b.dirtyBoundingBoxCache=function(){for(var i=0;i<this.length;i++){var _p=this[i]._private;_p.bbCache=null,_p.bbCachePosKey=null,_p.bodyBounds=null,_p.overlayBounds=null,_p.labelBounds.all=null,_p.labelBounds.source=null,_p.labelBounds.target=null,_p.labelBounds.main=null,_p.labelBounds.sourceRot=null,_p.labelBounds.targetRot=null,_p.labelBounds.mainRot=null,_p.arrowBounds.source=null,_p.arrowBounds.target=null,_p.arrowBounds["mid-source"]=null,_p.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this},elesfn$b.boundingBoxAt=function(fn){var nodes=this.nodes(),cy=this.cy(),hasCompoundNodes=cy.hasCompoundNodes(),parents=cy.collection();if(hasCompoundNodes&&(parents=nodes.filter(function(node){return node.isParent()}),nodes=nodes.not(parents)),plainObject(fn)){var obj=fn;fn=function fn(){return obj}}cy.startBatch(),nodes.forEach(function storeOldPos(node,i){return node._private.bbAtOldPos=fn(node,i)}).silentPositions(fn),hasCompoundNodes&&(parents.dirtyCompoundBoundsCache(),parents.dirtyBoundingBoxCache(),parents.updateCompoundBounds(!0));var bb=function copyBoundingBox(bb){return{x1:bb.x1,x2:bb.x2,w:bb.w,y1:bb.y1,y2:bb.y2,h:bb.h}}(this.boundingBox({useCache:!1}));return nodes.silentPositions(function getOldPos(node){return node._private.bbAtOldPos}),hasCompoundNodes&&(parents.dirtyCompoundBoundsCache(),parents.dirtyBoundingBoxCache(),parents.updateCompoundBounds(!0)),cy.endBatch(),bb},fn$3.boundingbox=fn$3.bb=fn$3.boundingBox,fn$3.renderedBoundingbox=fn$3.renderedBoundingBox;var fn$2,elesfn$a,bounds=elesfn$b;fn$2=elesfn$a={};var defineDimFns=function defineDimFns(opts){opts.uppercaseName=capitalize(opts.name),opts.autoName="auto"+opts.uppercaseName,opts.labelName="label"+opts.uppercaseName,opts.outerName="outer"+opts.uppercaseName,opts.uppercaseOuterName=capitalize(opts.outerName),fn$2[opts.name]=function dimImpl(){var ele=this[0],_p=ele._private,styleEnabled=_p.cy._private.styleEnabled;if(ele){if(styleEnabled){if(ele.isParent())return ele.updateCompoundBounds(),_p[opts.autoName]||0;var d=ele.pstyle(opts.name);return"label"===d.strValue?(ele.recalculateRenderedStyle(),_p.rstyle[opts.labelName]||0):d.pfValue}return 1}},fn$2["outer"+opts.uppercaseName]=function outerDimImpl(){var ele=this[0],styleEnabled=ele._private.cy._private.styleEnabled;if(ele){if(styleEnabled){var dim=ele[opts.name](),borderPos=ele.pstyle("border-position").value;return dim+("center"===borderPos?ele.pstyle("border-width").pfValue:"outside"===borderPos?2*ele.pstyle("border-width").pfValue:0)+2*ele.padding()}return 1}},fn$2["rendered"+opts.uppercaseName]=function renderedDimImpl(){var ele=this[0];if(ele)return ele[opts.name]()*this.cy().zoom()},fn$2["rendered"+opts.uppercaseOuterName]=function renderedOuterDimImpl(){var ele=this[0];if(ele)return ele[opts.outerName]()*this.cy().zoom()}};defineDimFns({name:"width"}),defineDimFns({name:"height"}),elesfn$a.padding=function(){var ele=this[0],_p=ele._private;return ele.isParent()?(ele.updateCompoundBounds(),void 0!==_p.autoPadding?_p.autoPadding:ele.pstyle("padding").pfValue):ele.pstyle("padding").pfValue},elesfn$a.paddedHeight=function(){var ele=this[0];return ele.height()+2*ele.padding()},elesfn$a.paddedWidth=function(){var ele=this[0];return ele.width()+2*ele.padding()};var widthHeight=elesfn$a,pts={controlPoints:{get:function controlPoints(ele){return ele.renderer().getControlPoints(ele)},mult:!0},segmentPoints:{get:function segmentPoints(ele){return ele.renderer().getSegmentPoints(ele)},mult:!0},sourceEndpoint:{get:function sourceEndpoint(ele){return ele.renderer().getSourceEndpoint(ele)}},targetEndpoint:{get:function targetEndpoint(ele){return ele.renderer().getTargetEndpoint(ele)}},midpoint:{get:function midpoint(ele){return ele.renderer().getEdgeMidpoint(ele)}}},edgePoints=Object.keys(pts).reduce(function(obj,name){var spec=pts[name],rName=function renderedName(name){return"rendered"+name[0].toUpperCase()+name.substr(1)}(name);return obj[name]=function(){return function ifEdge(ele,getValue){if(ele.isEdge()&&ele.takesUpSpace())return getValue(ele)}(this,spec.get)},spec.mult?obj[rName]=function(){return function ifEdgeRenderedPositions(ele,getPoints){if(ele.isEdge()&&ele.takesUpSpace()){var cy=ele.cy(),pan=cy.pan(),zoom=cy.zoom();return getPoints(ele).map(function(p){return modelToRenderedPosition$1(p,zoom,pan)})}}(this,spec.get)}:obj[rName]=function(){return function ifEdgeRenderedPosition(ele,getPoint){if(ele.isEdge()&&ele.takesUpSpace()){var cy=ele.cy();return modelToRenderedPosition$1(getPoint(ele),cy.zoom(),cy.pan())}}(this,spec.get)},obj},{}),dimensions=extend({},position,bounds,widthHeight,edgePoints),Event=function Event(src,props){this.recycle(src,props)};function returnFalse(){return!1}function returnTrue(){return!0}Event.prototype={instanceString:function instanceString(){return"event"},recycle:function recycle(src,props){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=returnFalse,null!=src&&src.preventDefault?(this.type=src.type,this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse):null!=src&&src.type?props=src:this.type=src,null!=props&&(this.originalEvent=props.originalEvent,this.type=null!=props.type?props.type:this.type,this.cy=props.cy,this.target=props.target,this.position=props.position,this.renderedPosition=props.renderedPosition,this.namespace=props.namespace,this.layout=props.layout),null!=this.cy&&null!=this.position&&null==this.renderedPosition){var pos=this.position,zoom=this.cy.zoom(),pan=this.cy.pan();this.renderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}this.timeStamp=src&&src.timeStamp||Date.now()},preventDefault:function preventDefault(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function stopPropagation(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function stopImmediatePropagation(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var eventRegex=/^([^.]+)(\.(?:[^.]+))?$/,defaults$8={qualifierCompare:function qualifierCompare(q1,q2){return q1===q2},eventMatches:function eventMatches(){return!0},addEventFields:function addEventFields(){},callbackContext:function callbackContext(context){return context},beforeEmit:function beforeEmit(){},afterEmit:function afterEmit(){},bubble:function bubble(){return!1},parent:function parent(){return null},context:null},defaultsKeys=Object.keys(defaults$8),emptyOpts={};function Emitter(){for(var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:emptyOpts,context=arguments.length>1?arguments[1]:void 0,i=0;i<defaultsKeys.length;i++){var key=defaultsKeys[i];this[key]=opts[key]||defaults$8[key]}this.context=context||this.context,this.listeners=[],this.emitting=0}var p=Emitter.prototype,forEachEvent=function forEachEvent(self,handler,events,qualifier,callback,conf,confOverrides){fn$6(qualifier)&&(callback=qualifier,qualifier=null),confOverrides&&(conf=null==conf?confOverrides:extend({},conf,confOverrides));for(var eventList=array(events)?events:events.split(/\s+/),i=0;i<eventList.length;i++){var evt=eventList[i];if(!emptyString(evt)){var match=evt.match(eventRegex);if(match)if(!1===handler(self,evt,match[1],match[2]?match[2]:null,qualifier,callback,conf))break}}},makeEventObj=function makeEventObj(self,obj){return self.addEventFields(self.context,obj),new Event(obj.type,obj)},forEachEventObj=function forEachEventObj(self,handler,events){if(function event(obj){return"event"===instanceStr(obj)}(events))handler(self,events);else if(plainObject(events))handler(self,makeEventObj(self,events));else for(var eventList=array(events)?events:events.split(/\s+/),i=0;i<eventList.length;i++){var evt=eventList[i];if(!emptyString(evt)){var match=evt.match(eventRegex);if(match){var type=match[1],namespace=match[2]?match[2]:null;handler(self,makeEventObj(self,{type,namespace,target:self.context}))}}}};p.on=p.addListener=function(events,qualifier,callback,conf,confOverrides){return forEachEvent(this,function(self,event,type,namespace,qualifier,callback,conf){fn$6(callback)&&self.listeners.push({event,callback,type,namespace,qualifier,conf})},events,qualifier,callback,conf,confOverrides),this},p.one=function(events,qualifier,callback,conf){return this.on(events,qualifier,callback,conf,{one:!0})},p.removeListener=p.off=function(events,qualifier,callback,conf){var _this=this;0!==this.emitting&&(this.listeners=function copyArray(arr){return arr.slice()}(this.listeners));for(var listeners=this.listeners,_loop=function _loop(i){var listener=listeners[i];forEachEvent(_this,function(self,event,type,namespace,qualifier,callback){if((listener.type===type||"*"===events)&&(!namespace&&".*"!==listener.namespace||listener.namespace===namespace)&&(!qualifier||self.qualifierCompare(listener.qualifier,qualifier))&&(!callback||listener.callback===callback))return listeners.splice(i,1),!1},events,qualifier,callback,conf)},i=listeners.length-1;i>=0;i--)_loop(i);return this},p.removeAllListeners=function(){return this.removeListener("*")},p.emit=p.trigger=function(events,extraParams,manualCallback){var listeners=this.listeners,numListenersBeforeEmit=listeners.length;return this.emitting++,array(extraParams)||(extraParams=[extraParams]),forEachEventObj(this,function(self,eventObj){null!=manualCallback&&(listeners=[{event:eventObj.event,type:eventObj.type,namespace:eventObj.namespace,callback:manualCallback}],numListenersBeforeEmit=listeners.length);for(var _loop2=function _loop2(){var listener=listeners[i];if(listener.type===eventObj.type&&(!listener.namespace||listener.namespace===eventObj.namespace||".*"===listener.namespace)&&self.eventMatches(self.context,listener,eventObj)){var args=[eventObj];null!=extraParams&&function push(arr,otherArr){for(var i=0;i<otherArr.length;i++){var el=otherArr[i];arr.push(el)}}(args,extraParams),self.beforeEmit(self.context,listener,eventObj),listener.conf&&listener.conf.one&&(self.listeners=self.listeners.filter(function(l){return l!==listener}));var context=self.callbackContext(self.context,listener,eventObj),ret=listener.callback.apply(context,args);self.afterEmit(self.context,listener,eventObj),!1===ret&&(eventObj.stopPropagation(),eventObj.preventDefault())}},i=0;i<numListenersBeforeEmit;i++)_loop2();self.bubble(self.context)&&!eventObj.isPropagationStopped()&&self.parent(self.context).emit(eventObj,extraParams)},events),this.emitting--,this};var emitterOptions$1={qualifierCompare:function qualifierCompare(selector1,selector2){return null==selector1||null==selector2?null==selector1&&null==selector2:selector1.sameText(selector2)},eventMatches:function eventMatches(ele,listener,eventObj){var selector=listener.qualifier;return null==selector||ele!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)},addEventFields:function addEventFields(ele,evt){evt.cy=ele.cy(),evt.target=ele},callbackContext:function callbackContext(ele,listener,eventObj){return null!=listener.qualifier?eventObj.target:ele},beforeEmit:function beforeEmit(context,listener){listener.conf&&listener.conf.once&&listener.conf.onceCollection.removeListener(listener.event,listener.qualifier,listener.callback)},bubble:function bubble(){return!0},parent:function parent(ele){return ele.isChild()?ele.parent():ele.cy()}},argSelector$1=function argSelector(arg){return string(arg)?new Selector(arg):arg},elesfn$9={createEmitter:function createEmitter(){for(var i=0;i<this.length;i++){var ele=this[i],_p=ele._private;_p.emitter||(_p.emitter=new Emitter(emitterOptions$1,ele))}return this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){for(var argSel=argSelector$1(selector),i=0;i<this.length;i++){this[i].emitter().on(events,argSel,callback)}return this},removeListener:function removeListener(events,selector,callback){for(var argSel=argSelector$1(selector),i=0;i<this.length;i++){this[i].emitter().removeListener(events,argSel,callback)}return this},removeAllListeners:function removeAllListeners(){for(var i=0;i<this.length;i++){this[i].emitter().removeAllListeners()}return this},one:function one(events,selector,callback){for(var argSel=argSelector$1(selector),i=0;i<this.length;i++){this[i].emitter().one(events,argSel,callback)}return this},once:function once(events,selector,callback){for(var argSel=argSelector$1(selector),i=0;i<this.length;i++){this[i].emitter().on(events,argSel,callback,{once:!0,onceCollection:this})}},emit:function emit(events,extraParams){for(var i=0;i<this.length;i++){this[i].emitter().emit(events,extraParams)}return this},emitAndNotify:function emitAndNotify(event,extraParams){if(0!==this.length)return this.cy().notify(event,this),this.emit(event,extraParams),this}};define.eventAliasesOn(elesfn$9);var elesfn$8={nodes:function nodes(selector){return this.filter(function(ele){return ele.isNode()}).filter(selector)},edges:function edges(selector){return this.filter(function(ele){return ele.isEdge()}).filter(selector)},byGroup:function byGroup(){for(var nodes=this.spawn(),edges=this.spawn(),i=0;i<this.length;i++){var ele=this[i];ele.isNode()?nodes.push(ele):edges.push(ele)}return{nodes,edges}},filter:function filter(_filter,thisArg){if(void 0===_filter)return this;if(string(_filter)||elementOrCollection(_filter))return new Selector(_filter).filter(this);if(fn$6(_filter)){for(var filterEles=this.spawn(),i=0;i<this.length;i++){var ele=this[i];(thisArg?_filter.apply(thisArg,[ele,i,this]):_filter(ele,i,this))&&filterEles.push(ele)}return filterEles}return this.spawn()},not:function not(toRemove){if(toRemove){string(toRemove)&&(toRemove=this.filter(toRemove));for(var elements=this.spawn(),i=0;i<this.length;i++){var element=this[i];toRemove.has(element)||elements.push(element)}return elements}return this},absoluteComplement:function absoluteComplement(){return this.cy().mutableElements().not(this)},intersect:function intersect(other){if(string(other)){var selector=other;return this.filter(selector)}for(var elements=this.spawn(),col2=other,col1Smaller=this.length<other.length,colS=col1Smaller?this:col2,colL=col1Smaller?col2:this,i=0;i<colS.length;i++){var ele=colS[i];colL.has(ele)&&elements.push(ele)}return elements},xor:function xor(other){var cy=this._private.cy;string(other)&&(other=cy.$(other));var elements=this.spawn(),col2=other,add=function add(col,other){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id;other.hasElementWithId(id)||elements.push(ele)}};return add(this,col2),add(col2,this),elements},diff:function diff(other){var cy=this._private.cy;string(other)&&(other=cy.$(other));var left=this.spawn(),right=this.spawn(),both=this.spawn(),col2=other,add=function add(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id;other.hasElementWithId(id)?both.merge(ele):retEles.push(ele)}};return add(this,col2,left),add(col2,this,right),{left,right,both}},add:function add(toAdd){var cy=this._private.cy;if(!toAdd)return this;if(string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var elements=this.spawnSelf(),i=0;i<toAdd.length;i++){var ele=toAdd[i],add=!this.has(ele);add&&elements.push(ele)}return elements},merge:function merge(toAdd){var _p=this._private,cy=_p.cy;if(!toAdd)return this;if(toAdd&&string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var map=_p.map,i=0;i<toAdd.length;i++){var toAddEle=toAdd[i],id=toAddEle._private.data.id;if(!map.has(id)){var index=this.length++;this[index]=toAddEle,map.set(id,{ele:toAddEle,index})}}return this},unmergeAt:function unmergeAt(i){var id=this[i].id(),map=this._private.map;this[i]=void 0,map.delete(id);var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1,lastEle=this[lastEleI],lastEleId=lastEle._private.data.id;this[lastEleI]=void 0,this[i]=lastEle,map.set(lastEleId,{ele:lastEle,index:i})}return this.length--,this},unmergeOne:function unmergeOne(ele){ele=ele[0];var _p=this._private,id=ele._private.data.id,entry=_p.map.get(id);if(!entry)return this;var i=entry.index;return this.unmergeAt(i),this},unmerge:function unmerge(toRemove){var cy=this._private.cy;if(!toRemove)return this;if(toRemove&&string(toRemove)){var selector=toRemove;toRemove=cy.mutableElements().filter(selector)}for(var i=0;i<toRemove.length;i++)this.unmergeOne(toRemove[i]);return this},unmergeBy:function unmergeBy(toRmFn){for(var i=this.length-1;i>=0;i--){toRmFn(this[i])&&this.unmergeAt(i)}return this},map:function map(mapFn,thisArg){for(var arr=[],i=0;i<this.length;i++){var ele=this[i],ret=thisArg?mapFn.apply(thisArg,[ele,i,this]):mapFn(ele,i,this);arr.push(ret)}return arr},reduce:function reduce(fn,initialValue){for(var val=initialValue,i=0;i<this.length;i++)val=fn(val,this[i],i,this);return val},max:function max(valFn,thisArg){for(var maxEle,max=-1/0,i=0;i<this.length;i++){var ele=this[i],val=thisArg?valFn.apply(thisArg,[ele,i,this]):valFn(ele,i,this);val>max&&(max=val,maxEle=ele)}return{value:max,ele:maxEle}},min:function min(valFn,thisArg){for(var minEle,min=1/0,i=0;i<this.length;i++){var ele=this[i],val=thisArg?valFn.apply(thisArg,[ele,i,this]):valFn(ele,i,this);val<min&&(min=val,minEle=ele)}return{value:min,ele:minEle}}},fn$1=elesfn$8;fn$1.u=fn$1["|"]=fn$1["+"]=fn$1.union=fn$1.or=fn$1.add,fn$1["\\"]=fn$1["!"]=fn$1["-"]=fn$1.difference=fn$1.relativeComplement=fn$1.subtract=fn$1.not,fn$1.n=fn$1["&"]=fn$1["."]=fn$1.and=fn$1.intersection=fn$1.intersect,fn$1["^"]=fn$1["(+)"]=fn$1["(-)"]=fn$1.symmetricDifference=fn$1.symdiff=fn$1.xor,fn$1.fnFilter=fn$1.filterFn=fn$1.stdFilter=fn$1.filter,fn$1.complement=fn$1.abscomp=fn$1.absoluteComplement;var zIndexSort=function zIndexSort(a,b){var hasCompoundNodes=a.cy().hasCompoundNodes();function getDepth(ele){var style=ele.pstyle("z-compound-depth");return"auto"===style.value?hasCompoundNodes?ele.zDepth():0:"bottom"===style.value?-1:"top"===style.value?MAX_INT$1:0}var depthDiff=getDepth(a)-getDepth(b);if(0!==depthDiff)return depthDiff;function getEleDepth(ele){return"auto"===ele.pstyle("z-index-compare").value&&ele.isNode()?1:0}var eleDiff=getEleDepth(a)-getEleDepth(b);if(0!==eleDiff)return eleDiff;var zDiff=a.pstyle("z-index").value-b.pstyle("z-index").value;return 0!==zDiff?zDiff:a.poolIndex()-b.poolIndex()},elesfn$6={forEach:function forEach(fn,thisArg){if(fn$6(fn))for(var N=this.length,i=0;i<N;i++){var ele=this[i];if(!1===(thisArg?fn.apply(thisArg,[ele,i,this]):fn(ele,i,this)))break}return this},toArray:function toArray(){for(var array=[],i=0;i<this.length;i++)array.push(this[i]);return array},slice:function slice(start,end){var array=[],thisSize=this.length;null==end&&(end=thisSize),null==start&&(start=0),start<0&&(start=thisSize+start),end<0&&(end=thisSize+end);for(var i=start;i>=0&&i<end&&i<thisSize;i++)array.push(this[i]);return this.spawn(array)},size:function size(){return this.length},eq:function eq(i){return this[i]||this.spawn()},first:function first(){return this[0]||this.spawn()},last:function last(){return this[this.length-1]||this.spawn()},empty:function empty(){return 0===this.length},nonempty:function nonempty(){return!this.empty()},sort:function sort(sortFn){if(!fn$6(sortFn))return this;var sorted=this.toArray().sort(sortFn);return this.spawn(sorted)},sortByZIndex:function sortByZIndex(){return this.sort(zIndexSort)},zDepth:function zDepth(){var ele=this[0];if(ele){var _p=ele._private;if("nodes"===_p.group){var depth=_p.data.parent?ele.parents().size():0;return ele.isParent()?depth:MAX_INT$1-1}var src=_p.source,tgt=_p.target,srcDepth=src.zDepth(),tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}};elesfn$6.each=elesfn$6.forEach;!function defineSymbolIterator(){"undefined"!=("undefined"==typeof Symbol?"undefined":_typeof(Symbol))&&"undefined"!=_typeof(Symbol.iterator)&&(elesfn$6[Symbol.iterator]=function(){var _this=this,entry={value:void 0,done:!1},i=0,length=this.length;return _defineProperty$1({next:function next(){return i<length?entry.value=_this[i++]:(entry.value=void 0,entry.done=!0),entry}},Symbol.iterator,function(){return this})})}();var getLayoutDimensionOptions=defaults$g({nodeDimensionsIncludeLabels:!1}),elesfn$5={layoutDimensions:function layoutDimensions(options){var dims;if(options=getLayoutDimensionOptions(options),this.takesUpSpace())if(options.nodeDimensionsIncludeLabels){var bbDim=this.boundingBox();dims={w:bbDim.w,h:bbDim.h}}else dims={w:this.outerWidth(),h:this.outerHeight()};else dims={w:0,h:0};return 0!==dims.w&&0!==dims.h||(dims.w=dims.h=1),dims},layoutPositions:function layoutPositions(layout,options,fn){var nodes=this.nodes().filter(function(n){return!n.isParent()}),cy=this.cy(),layoutEles=options.eles,getMemoizeKey=function getMemoizeKey(node){return node.id()},fnMem=memoize(fn,getMemoizeKey);layout.emit({type:"layoutstart",layout}),layout.animations=[];var useSpacingFactor=options.spacingFactor&&1!==options.spacingFactor,bb=function spacingBb(){if(!useSpacingFactor)return null;for(var bb=makeBoundingBox(),i=0;i<nodes.length;i++){var node=nodes[i],pos=fnMem(node,i);expandBoundingBoxByPoint(bb,pos.x,pos.y)}return bb}(),getFinalPos=memoize(function(node,i){var newPos=fnMem(node,i);useSpacingFactor&&(newPos=function calculateSpacing(spacing,nodesBb,pos){var center_x=nodesBb.x1+nodesBb.w/2,center_y=nodesBb.y1+nodesBb.h/2;return{x:center_x+(pos.x-center_x)*spacing,y:center_y+(pos.y-center_y)*spacing}}(Math.abs(options.spacingFactor),bb,newPos));return null!=options.transform&&(newPos=options.transform(node,newPos)),newPos},getMemoizeKey);if(options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i],newPos=getFinalPos(node,i);if(null==options.animateFilter||options.animateFilter(node,i)){var ani=node.animation({position:newPos,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(ani)}else node.position(newPos)}if(options.fit){var fitAni=cy.animation({fit:{boundingBox:layoutEles.boundingBoxAt(getFinalPos),padding:options.padding},duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(fitAni)}else if(void 0!==options.zoom&&void 0!==options.pan){var zoomPanAni=cy.animation({zoom:options.zoom,pan:options.pan,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(zoomPanAni)}layout.animations.forEach(function(ani){return ani.play()}),layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout}),Promise$1.all(layout.animations.map(function(ani){return ani.promise()})).then(function(){layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout})})}else nodes.positions(getFinalPos),options.fit&&cy.fit(options.eles,options.padding),null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout}),layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout});return this},layout:function layout(options){return this.cy().makeLayout(extend({},options,{eles:this}))}};function styleCache(key,fn,ele){var val,_p=ele._private,cache=_p.styleCache=_p.styleCache||[];return null!=(val=cache[key])?val:val=cache[key]=fn(ele)}function cacheStyleFunction(key,fn){return key=hashString(key),function cachedStyleFunction(ele){return styleCache(key,fn,ele)}}function cachePrototypeStyleFunction(key,fn){key=hashString(key);var selfFn=function selfFn(ele){return fn.call(ele)};return function cachedPrototypeStyleFunction(){var ele=this[0];if(ele)return styleCache(key,selfFn,ele)}}elesfn$5.createLayout=elesfn$5.makeLayout=elesfn$5.layout;var elesfn$4={recalculateRenderedStyle:function recalculateRenderedStyle(useCache){var cy=this.cy(),renderer=cy.renderer(),styleEnabled=cy.styleEnabled();return renderer&&styleEnabled&&renderer.recalculateRenderedStyle(this,useCache),this},dirtyStyleCache:function dirtyStyleCache(){var eles,cy=this.cy(),dirty=function dirty(ele){return ele._private.styleCache=null};cy.hasCompoundNodes()?((eles=this.spawnSelf().merge(this.descendants()).merge(this.parents())).merge(eles.connectedEdges()),eles.forEach(dirty)):this.forEach(function(ele){dirty(ele),ele.connectedEdges().forEach(dirty)});return this},updateStyle:function updateStyle(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled())return this;if(cy.batching())return cy._private.batchStyleEles.merge(this),this;var updatedEles=this;notifyRenderer=!(!notifyRenderer&&void 0!==notifyRenderer),cy.hasCompoundNodes()&&(updatedEles=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var changedEles=updatedEles;return notifyRenderer?changedEles.emitAndNotify("style"):changedEles.emit("style"),updatedEles.forEach(function(ele){return ele._private.styleDirty=!0}),this},cleanStyle:function cleanStyle(){var cy=this.cy();if(cy.styleEnabled())for(var i=0;i<this.length;i++){var ele=this[i];ele._private.styleDirty&&(ele._private.styleDirty=!1,cy.style().apply(ele))}},parsedStyle:function parsedStyle(property){var includeNonDefault=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],ele=this[0],cy=ele.cy();if(cy.styleEnabled()&&ele){ele._private.styleDirty&&(ele._private.styleDirty=!1,cy.style().apply(ele));var overriddenStyle=ele._private.style[property];return null!=overriddenStyle?overriddenStyle:includeNonDefault?cy.style().getDefaultProperty(property):null}},numericStyle:function numericStyle(property){var ele=this[0];if(ele.cy().styleEnabled()&&ele){var pstyle=ele.pstyle(property);return void 0!==pstyle.pfValue?pstyle.pfValue:pstyle.value}},numericStyleUnits:function numericStyleUnits(property){var ele=this[0];if(ele.cy().styleEnabled())return ele?ele.pstyle(property).units:void 0},renderedStyle:function renderedStyle(property){var cy=this.cy();if(!cy.styleEnabled())return this;var ele=this[0];return ele?cy.style().getRenderedStyle(ele,property):void 0},style:function style(name,value){var cy=this.cy();if(!cy.styleEnabled())return this;var style=cy.style();if(plainObject(name)){var props=name;style.applyBypass(this,props,false),this.emitAndNotify("style")}else if(string(name)){if(void 0===value){var ele=this[0];return ele?style.getStylePropertyValue(ele,name):void 0}style.applyBypass(this,name,value,false),this.emitAndNotify("style")}else if(void 0===name){var _ele=this[0];return _ele?style.getRawStyle(_ele):void 0}return this},removeStyle:function removeStyle(names){var cy=this.cy();if(!cy.styleEnabled())return this;var style=cy.style();if(void 0===names)for(var i=0;i<this.length;i++){var ele=this[i];style.removeAllBypasses(ele,false)}else{names=names.split(/\s+/);for(var _i=0;_i<this.length;_i++){var _ele2=this[_i];style.removeBypasses(_ele2,names,false)}}return this.emitAndNotify("style"),this},show:function show(){return this.css("display","element"),this},hide:function hide(){return this.css("display","none"),this},effectiveOpacity:function effectiveOpacity(){var cy=this.cy();if(!cy.styleEnabled())return 1;var hasCompoundNodes=cy.hasCompoundNodes(),ele=this[0];if(ele){var _p=ele._private,parentOpacity=ele.pstyle("opacity").value;if(!hasCompoundNodes)return parentOpacity;var parents=_p.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){parentOpacity*=parents[i].pstyle("opacity").value}return parentOpacity}},transparent:function transparent(){if(!this.cy().styleEnabled())return!1;var ele=this[0],hasCompoundNodes=ele.cy().hasCompoundNodes();return ele?hasCompoundNodes?0===ele.effectiveOpacity():0===ele.pstyle("opacity").value:void 0},backgrounding:function backgrounding(){return!!this.cy().styleEnabled()&&!!this[0]._private.backgrounding}};function checkCompound(ele,parentOk){var parents=ele._private.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){if(!parentOk(parents[i]))return!1}return!0}function defineDerivedStateFunction(specs){var ok=specs.ok,edgeOkViaNode=specs.edgeOkViaNode||specs.ok,parentOk=specs.parentOk||specs.ok;return function(){var cy=this.cy();if(!cy.styleEnabled())return!0;var ele=this[0],hasCompoundNodes=cy.hasCompoundNodes();if(ele){var _p=ele._private;if(!ok(ele))return!1;if(ele.isNode())return!hasCompoundNodes||checkCompound(ele,parentOk);var src=_p.source,tgt=_p.target;return edgeOkViaNode(src)&&(!hasCompoundNodes||checkCompound(src,edgeOkViaNode))&&(src===tgt||edgeOkViaNode(tgt)&&(!hasCompoundNodes||checkCompound(tgt,edgeOkViaNode)))}}}var eleTakesUpSpace=cacheStyleFunction("eleTakesUpSpace",function(ele){return"element"===ele.pstyle("display").value&&0!==ele.width()&&(!ele.isNode()||0!==ele.height())});elesfn$4.takesUpSpace=cachePrototypeStyleFunction("takesUpSpace",defineDerivedStateFunction({ok:eleTakesUpSpace}));var eleInteractive=cacheStyleFunction("eleInteractive",function(ele){return"yes"===ele.pstyle("events").value&&"visible"===ele.pstyle("visibility").value&&eleTakesUpSpace(ele)}),parentInteractive=cacheStyleFunction("parentInteractive",function(parent){return"visible"===parent.pstyle("visibility").value&&eleTakesUpSpace(parent)});elesfn$4.interactive=cachePrototypeStyleFunction("interactive",defineDerivedStateFunction({ok:eleInteractive,parentOk:parentInteractive,edgeOkViaNode:eleTakesUpSpace})),elesfn$4.noninteractive=function(){var ele=this[0];if(ele)return!ele.interactive()};var eleVisible=cacheStyleFunction("eleVisible",function(ele){return"visible"===ele.pstyle("visibility").value&&0!==ele.pstyle("opacity").pfValue&&eleTakesUpSpace(ele)}),edgeVisibleViaNode=eleTakesUpSpace;elesfn$4.visible=cachePrototypeStyleFunction("visible",defineDerivedStateFunction({ok:eleVisible,edgeOkViaNode:edgeVisibleViaNode})),elesfn$4.hidden=function(){var ele=this[0];if(ele)return!ele.visible()},elesfn$4.isBundledBezier=cachePrototypeStyleFunction("isBundledBezier",function(){return!!this.cy().styleEnabled()&&(!this.removed()&&"bezier"===this.pstyle("curve-style").value&&this.takesUpSpace())}),elesfn$4.bypass=elesfn$4.css=elesfn$4.style,elesfn$4.renderedCss=elesfn$4.renderedStyle,elesfn$4.removeBypass=elesfn$4.removeCss=elesfn$4.removeStyle,elesfn$4.pstyle=elesfn$4.parsedStyle;var elesfn$3={};function defineSwitchFunction(params){return function(){var args=arguments,changedEles=[];if(2===args.length){var data=args[0],handler=args[1];this.on(params.event,data,handler)}else if(1===args.length&&fn$6(args[0])){var _handler=args[0];this.on(params.event,_handler)}else if(0===args.length||1===args.length&&array(args[0])){for(var addlEvents=1===args.length?args[0]:null,i=0;i<this.length;i++){var ele=this[i],able=!params.ableField||ele._private[params.ableField],changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(void 0!==overrideAble&&(able=overrideAble,!overrideAble))return this}able&&(ele._private[params.field]=params.value,changed&&changedEles.push(ele))}var changedColl=this.spawn(changedEles);changedColl.updateStyle(),changedColl.emit(params.event),addlEvents&&changedColl.emit(addlEvents)}return this}}function defineSwitchSet(params){elesfn$3[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(void 0!==val)return val}return ele._private[params.field]}},elesfn$3[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!0}),elesfn$3[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!1})}defineSwitchSet({field:"locked",overrideField:function overrideField(ele){return!!ele.cy().autolock()||void 0},on:"lock",off:"unlock"}),defineSwitchSet({field:"grabbable",overrideField:function overrideField(ele){return!ele.cy().autoungrabify()&&!ele.pannable()&&void 0},on:"grabify",off:"ungrabify"}),defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function overrideAble(ele){return!ele.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),defineSwitchSet({field:"selectable",overrideField:function overrideField(ele){return!ele.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),elesfn$3.deselect=elesfn$3.unselect,elesfn$3.grabbed=function(){var ele=this[0];if(ele)return ele._private.grabbed},defineSwitchSet({field:"active",on:"activate",off:"unactivate"}),defineSwitchSet({field:"pannable",on:"panify",off:"unpanify"}),elesfn$3.inactive=function(){var ele=this[0];if(ele)return!ele._private.active};var elesfn$2={},defineDagExtremity=function defineDagExtremity(params){return function dagExtremityImpl(selector){for(var ret=[],i=0;i<this.length;i++){var ele=this[i];if(ele.isNode()){for(var disqualified=!1,edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();if(params.noIncomingEdges&&tgt===ele&&src!==ele||params.noOutgoingEdges&&src===ele&&tgt!==ele){disqualified=!0;break}}disqualified||ret.push(ele)}}return this.spawn(ret,!0).filter(selector)}},defineDagOneHop=function defineDagOneHop(params){return function(selector){for(var oEles=[],i=0;i<this.length;i++){var ele=this[i];if(ele.isNode())for(var edges=ele.connectedEdges(),j=0;j<edges.length;j++){var edge=edges[j],src=edge.source(),tgt=edge.target();params.outgoing&&src===ele?(oEles.push(edge),oEles.push(tgt)):params.incoming&&tgt===ele&&(oEles.push(edge),oEles.push(src))}}return this.spawn(oEles,!0).filter(selector)}},defineDagAllHops=function defineDagAllHops(params){return function(selector){for(var eles=this,sEles=[],sElesIds={};;){var next=params.outgoing?eles.outgoers():eles.incomers();if(0===next.length)break;for(var newNext=!1,i=0;i<next.length;i++){var n=next[i],nid=n.id();sElesIds[nid]||(sElesIds[nid]=!0,sEles.push(n),newNext=!0)}if(!newNext)break;eles=next}return this.spawn(sEles,!0).filter(selector)}};function defineSourceFunction(params){return function sourceImpl(selector){for(var sources=[],i=0;i<this.length;i++){var src=this[i]._private[params.attr];src&&sources.push(src)}return this.spawn(sources,!0).filter(selector)}}function defineEdgesWithFunction(params){return function edgesWithImpl(otherNodes){var elements=[],cy=this._private.cy,p=params||{};string(otherNodes)&&(otherNodes=cy.$(otherNodes));for(var h=0;h<otherNodes.length;h++)for(var edges=otherNodes[h]._private.edges,i=0;i<edges.length;i++){var edge=edges[i],edgeData=edge._private.data,thisToOther=this.hasElementWithId(edgeData.source)&&otherNodes.hasElementWithId(edgeData.target),otherToThis=otherNodes.hasElementWithId(edgeData.source)&&this.hasElementWithId(edgeData.target);if(thisToOther||otherToThis){if(p.thisIsSrc||p.thisIsTgt){if(p.thisIsSrc&&!thisToOther)continue;if(p.thisIsTgt&&!otherToThis)continue}elements.push(edge)}}return this.spawn(elements,!0)}}function defineParallelEdgesFunction(params){return params=extend({},{codirected:!1},params),function parallelEdgesImpl(selector){for(var elements=[],edges=this.edges(),p=params,i=0;i<edges.length;i++)for(var edge1_p=edges[i]._private,src1=edge1_p.source,srcid1=src1._private.data.id,tgtid1=edge1_p.data.target,srcEdges1=src1._private.edges,j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j],edge2data=edge2._private.data,tgtid2=edge2data.target,srcid2=edge2data.source,codirected=tgtid2===tgtid1&&srcid2===srcid1,oppdirected=srcid1===tgtid2&&tgtid1===srcid2;(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected))&&elements.push(edge2)}return this.spawn(elements,!0).filter(selector)}}elesfn$2.clearTraversalCache=function(){for(var i=0;i<this.length;i++)this[i]._private.traversalCache=null},extend(elesfn$2,{roots:defineDagExtremity({noIncomingEdges:!0}),leaves:defineDagExtremity({noOutgoingEdges:!0}),outgoers:cache(defineDagOneHop({outgoing:!0}),"outgoers"),successors:defineDagAllHops({outgoing:!0}),incomers:cache(defineDagOneHop({incoming:!0}),"incomers"),predecessors:defineDagAllHops({})}),extend(elesfn$2,{neighborhood:cache(function(selector){for(var elements=[],nodes=this.nodes(),i=0;i<nodes.length;i++)for(var node=nodes[i],connectedEdges=node.connectedEdges(),j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j],src=edge.source(),tgt=edge.target(),otherNode=node===src?tgt:src;otherNode.length>0&&elements.push(otherNode[0]),elements.push(edge[0])}return this.spawn(elements,!0).filter(selector)},"neighborhood"),closedNeighborhood:function closedNeighborhood(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function openNeighborhood(selector){return this.neighborhood(selector)}}),elesfn$2.neighbourhood=elesfn$2.neighborhood,elesfn$2.closedNeighbourhood=elesfn$2.closedNeighborhood,elesfn$2.openNeighbourhood=elesfn$2.openNeighborhood,extend(elesfn$2,{source:cache(function sourceImpl(selector){var src,ele=this[0];return ele&&(src=ele._private.source||ele.cy().collection()),src&&selector?src.filter(selector):src},"source"),target:cache(function targetImpl(selector){var tgt,ele=this[0];return ele&&(tgt=ele._private.target||ele.cy().collection()),tgt&&selector?tgt.filter(selector):tgt},"target"),sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})}),extend(elesfn$2,{edgesWith:cache(defineEdgesWithFunction(),"edgesWith"),edgesTo:cache(defineEdgesWithFunction({thisIsSrc:!0}),"edgesTo")}),extend(elesfn$2,{connectedEdges:cache(function(selector){for(var retEles=[],i=0;i<this.length;i++){var node=this[i];if(node.isNode())for(var edges=node._private.edges,j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return this.spawn(retEles,!0).filter(selector)},"connectedEdges"),connectedNodes:cache(function(selector){for(var retEles=[],i=0;i<this.length;i++){var edge=this[i];edge.isEdge()&&(retEles.push(edge.source()[0]),retEles.push(edge.target()[0]))}return this.spawn(retEles,!0).filter(selector)},"connectedNodes"),parallelEdges:cache(defineParallelEdgesFunction(),"parallelEdges"),codirectedEdges:cache(defineParallelEdgesFunction({codirected:!0}),"codirectedEdges")}),extend(elesfn$2,{components:function components(root){var self=this,cy=self.cy(),visited=cy.collection(),unvisited=null==root?self.nodes():root.nodes(),components=[];null!=root&&unvisited.empty()&&(unvisited=root.sources());var visitInComponent=function visitInComponent(node,component){visited.merge(node),unvisited.unmerge(node),component.merge(node)};if(unvisited.empty())return self.spawn();var _loop=function _loop(){var cmpt=cy.collection();components.push(cmpt);var root=unvisited[0];visitInComponent(root,cmpt),self.bfs({directed:!1,roots:root,visit:function visit(v){return visitInComponent(v,cmpt)}}),cmpt.forEach(function(node){node.connectedEdges().forEach(function(e){self.has(e)&&cmpt.has(e.source())&&cmpt.has(e.target())&&cmpt.merge(e)})})};do{_loop()}while(unvisited.length>0);return components},component:function component(){var ele=this[0];return ele.cy().mutableElements().components(ele)[0]}}),elesfn$2.componentsOf=elesfn$2.components;var Collection=function Collection(cy,elements){var unique=arguments.length>2&&void 0!==arguments[2]&&arguments[2],removed=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(void 0!==cy){var map=new Map$1,createdElements=!1;if(elements){if(elements.length>0&&plainObject(elements[0])&&!element(elements[0])){createdElements=!0;for(var eles=[],elesIds=new Set$1,i=0,l=elements.length;i<l;i++){var json=elements[i];null==json.data&&(json.data={});var _data=json.data;if(null==_data.id)_data.id=uuid();else if(cy.hasElementWithId(_data.id)||elesIds.has(_data.id))continue;var ele=new Element(cy,json,!1);eles.push(ele),elesIds.add(_data.id)}elements=eles}}else elements=[];this.length=0;for(var _i=0,_l=elements.length;_i<_l;_i++){var element$1=elements[_i][0];if(null!=element$1){var id=element$1._private.data.id;unique&&map.has(id)||(unique&&map.set(id,{index:this.length,ele:element$1}),this[this.length]=element$1,this.length++)}}this._private={eles:this,cy,get map(){return null==this.lazyMap&&this.rebuildMap(),this.lazyMap},set map(m){this.lazyMap=m},rebuildMap:function rebuildMap(){for(var m=this.lazyMap=new Map$1,eles=this.eles,_i2=0;_i2<eles.length;_i2++){var _ele=eles[_i2];m.set(_ele.id(),{index:_i2,ele:_ele})}}},unique&&(this._private.map=map),createdElements&&!removed&&this.restore()}else error("A collection must have a reference to the core")},elesfn$1=Element.prototype=Collection.prototype=Object.create(Array.prototype);elesfn$1.instanceString=function(){return"collection"},elesfn$1.spawn=function(eles,unique){return new Collection(this.cy(),eles,unique)},elesfn$1.spawnSelf=function(){return this.spawn(this)},elesfn$1.cy=function(){return this._private.cy},elesfn$1.renderer=function(){return this._private.cy.renderer()},elesfn$1.element=function(){return this[0]},elesfn$1.collection=function(){return collection(this)?this:new Collection(this._private.cy,[this])},elesfn$1.unique=function(){return new Collection(this._private.cy,this,!0)},elesfn$1.hasElementWithId=function(id){return id=""+id,this._private.map.has(id)},elesfn$1.getElementById=function(id){id=""+id;var cy=this._private.cy,entry=this._private.map.get(id);return entry?entry.ele:new Collection(cy)},elesfn$1.$id=elesfn$1.getElementById,elesfn$1.poolIndex=function(){var eles=this._private.cy._private.elements,id=this[0]._private.data.id;return eles._private.map.get(id).index},elesfn$1.indexOf=function(ele){var id=ele[0]._private.data.id;return this._private.map.get(id).index},elesfn$1.indexOfId=function(id){return id=""+id,this._private.map.get(id).index},elesfn$1.json=function(obj){var ele=this.element(),cy=this.cy();if(null==ele&&obj)return this;if(null!=ele){var p=ele._private;if(plainObject(obj)){if(cy.startBatch(),obj.data){ele.data(obj.data);var _data2=p.data;if(ele.isEdge()){var move=!1,spec={},src=obj.data.source,tgt=obj.data.target;null!=src&&src!=_data2.source&&(spec.source=""+src,move=!0),null!=tgt&&tgt!=_data2.target&&(spec.target=""+tgt,move=!0),move&&(ele=ele.move(spec))}else{var newParentValSpecd="parent"in obj.data,parent=obj.data.parent;!newParentValSpecd||null==parent&&null==_data2.parent||parent==_data2.parent||(void 0===parent&&(parent=null),null!=parent&&(parent=""+parent),ele=ele.move({parent}))}}obj.position&&ele.position(obj.position);var checkSwitch=function checkSwitch(k,trueFnName,falseFnName){var obj_k=obj[k];null!=obj_k&&obj_k!==p[k]&&(obj_k?ele[trueFnName]():ele[falseFnName]())};return checkSwitch("removed","remove","restore"),checkSwitch("selected","select","unselect"),checkSwitch("selectable","selectify","unselectify"),checkSwitch("locked","lock","unlock"),checkSwitch("grabbable","grabify","ungrabify"),checkSwitch("pannable","panify","unpanify"),null!=obj.classes&&ele.classes(obj.classes),cy.endBatch(),this}if(void 0===obj){var json={data:copy(p.data),position:copy(p.position),group:p.group,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbable:p.grabbable,pannable:p.pannable,classes:(null,"")},i=0;return p.classes.forEach(function(cls){return json.classes+=0===i++?cls:" "+cls}),json}}},elesfn$1.jsons=function(){for(var jsons=[],i=0;i<this.length;i++){var json=this[i].json();jsons.push(json)}return jsons},elesfn$1.clone=function(){for(var cy=this.cy(),elesArr=[],i=0;i<this.length;i++){var json=this[i].json(),clone=new Element(cy,json,!1);elesArr.push(clone)}return new Collection(cy,elesArr)},elesfn$1.copy=elesfn$1.clone,elesfn$1.restore=function(){for(var elements,i,notifyRenderer=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],addToPool=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],cy=this.cy(),cy_p=cy._private,nodes=[],edges=[],_i3=0,l=this.length;_i3<l;_i3++){var ele=this[_i3];addToPool&&!ele.removed()||(ele.isNode()?nodes.push(ele):edges.push(ele))}elements=nodes.concat(edges);var removeFromElements=function removeFromElements(){elements.splice(i,1),i--};for(i=0;i<elements.length;i++){var _ele2=elements[i],_private=_ele2._private,_data3=_private.data;if(_ele2.clearTraversalCache(),addToPool||_private.removed)if(void 0===_data3.id)_data3.id=uuid();else if(number$1(_data3.id))_data3.id=""+_data3.id;else{if(emptyString(_data3.id)||!string(_data3.id)){error("Can not create element with invalid string ID `"+_data3.id+"`"),removeFromElements();continue}if(cy.hasElementWithId(_data3.id)){error("Can not create second element with ID `"+_data3.id+"`"),removeFromElements();continue}}else;var id=_data3.id;if(_ele2.isNode()){var pos=_private.position;null==pos.x&&(pos.x=0),null==pos.y&&(pos.y=0)}if(_ele2.isEdge()){for(var edge=_ele2,fields=["source","target"],fieldsLength=fields.length,badSourceOrTarget=!1,j=0;j<fieldsLength;j++){var field=fields[j],val=_data3[field];number$1(val)&&(val=_data3[field]=""+_data3[field]),null==val||""===val?(error("Can not create edge `"+id+"` with unspecified "+field),badSourceOrTarget=!0):cy.hasElementWithId(val)||(error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`"),badSourceOrTarget=!0)}if(badSourceOrTarget){removeFromElements();continue}var src=cy.getElementById(_data3.source),tgt=cy.getElementById(_data3.target);src.same(tgt)?src._private.edges.push(edge):(src._private.edges.push(edge),tgt._private.edges.push(edge)),edge._private.source=src,edge._private.target=tgt}_private.map=new Map$1,_private.map.set(id,{ele:_ele2,index:0}),_private.removed=!1,addToPool&&cy.addToPool(_ele2)}for(var _i4=0;_i4<nodes.length;_i4++){var node=nodes[_i4],_data4=node._private.data;number$1(_data4.parent)&&(_data4.parent=""+_data4.parent);var parentId=_data4.parent;if(null!=parentId||node._private.parent){var parent=node._private.parent?cy.collection().merge(node._private.parent):cy.getElementById(parentId);if(parent.empty())_data4.parent=void 0;else if(parent[0].removed())warn("Node added with missing parent, reference to parent removed"),_data4.parent=void 0,node._private.parent=null;else{for(var selfAsParent=!1,ancestor=parent;!ancestor.empty();){if(node.same(ancestor)){selfAsParent=!0,_data4.parent=void 0;break}ancestor=ancestor.parent()}selfAsParent||(parent[0]._private.children.push(node),node._private.parent=parent[0],cy_p.hasCompoundNodes=!0)}}}if(elements.length>0){for(var restored=elements.length===this.length?this:new Collection(cy,elements),_i5=0;_i5<restored.length;_i5++){var _ele3=restored[_i5];_ele3.isNode()||(_ele3.parallelEdges().clearTraversalCache(),_ele3.source().clearTraversalCache(),_ele3.target().clearTraversalCache())}(cy_p.hasCompoundNodes?cy.collection().merge(restored).merge(restored.connectedNodes()).merge(restored.parent()):restored).dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(notifyRenderer),notifyRenderer?restored.emitAndNotify("add"):addToPool&&restored.emit("add")}return this},elesfn$1.removed=function(){var ele=this[0];return ele&&ele._private.removed},elesfn$1.inside=function(){var ele=this[0];return ele&&!ele._private.removed},elesfn$1.remove=function(){var notifyRenderer=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],removeFromPool=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],elesToRemove=[],elesToRemoveIds={},cy=this._private.cy;function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];removeFromPool&&ele.removed()||alreadyAdded||(elesToRemoveIds[ele.id()]=!0,ele.isNode()?(elesToRemove.push(ele),function addConnectedEdges(node){for(var edges=node._private.edges,i=0;i<edges.length;i++)add(edges[i])}(ele),function addChildren(node){for(var children=node._private.children,i=0;i<children.length;i++)add(children[i])}(ele)):elesToRemove.unshift(ele))}for(var i=0,l=this.length;i<l;i++){add(this[i])}function removeEdgeRef(node,edge){var connectedEdges=node._private.edges;removeFromArray(connectedEdges,edge),node.clearTraversalCache()}function removeParallelRef(pllEdge){pllEdge.clearTraversalCache()}var alteredParents=[];function removeChildRef(parent,ele){ele=ele[0];var children=(parent=parent[0])._private.children,pid=parent.id();removeFromArray(children,ele),ele._private.parent=null,alteredParents.ids[pid]||(alteredParents.ids[pid]=!0,alteredParents.push(parent))}alteredParents.ids={},this.dirtyCompoundBoundsCache(),removeFromPool&&cy.removeFromPool(elesToRemove);for(var _i6=0;_i6<elesToRemove.length;_i6++){var _ele4=elesToRemove[_i6];if(_ele4.isEdge()){var src=_ele4.source()[0],tgt=_ele4.target()[0];removeEdgeRef(src,_ele4),removeEdgeRef(tgt,_ele4);for(var pllEdges=_ele4.parallelEdges(),j=0;j<pllEdges.length;j++){var pllEdge=pllEdges[j];removeParallelRef(pllEdge),pllEdge.isBundledBezier()&&pllEdge.dirtyBoundingBoxCache()}}else{var parent=_ele4.parent();0!==parent.length&&removeChildRef(parent,_ele4)}removeFromPool&&(_ele4._private.removed=!0)}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=!1;for(var _i7=0;_i7<elesStillInside.length;_i7++){if(elesStillInside[_i7].isParent()){cy._private.hasCompoundNodes=!0;break}}var removedElements=new Collection(this.cy(),elesToRemove);removedElements.size()>0&&(notifyRenderer?removedElements.emitAndNotify("remove"):removeFromPool&&removedElements.emit("remove"));for(var _i8=0;_i8<alteredParents.length;_i8++){var _ele6=alteredParents[_i8];removeFromPool&&_ele6.removed()||_ele6.updateStyle()}return removedElements},elesfn$1.move=function(struct){var cy=this._private.cy,eles=this,toString=function toString(id){return null==id?id:""+id};if(void 0!==struct.source||void 0!==struct.target){var srcId=toString(struct.source),tgtId=toString(struct.target),srcExists=null!=srcId&&cy.hasElementWithId(srcId),tgtExists=null!=tgtId&&cy.hasElementWithId(tgtId);(srcExists||tgtExists)&&(cy.batch(function(){eles.remove(false,false),eles.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i],_data5=ele._private.data;ele.isEdge()&&(srcExists&&(_data5.source=srcId),tgtExists&&(_data5.target=tgtId))}eles.restore(false,false)}),eles.emitAndNotify("move"))}else if(void 0!==struct.parent){var parentId=toString(struct.parent);if(null===parentId||cy.hasElementWithId(parentId)){var pidToAssign=null===parentId?void 0:parentId;cy.batch(function(){var updated=eles.remove(false,false);updated.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i],_data6=ele._private.data;ele.isNode()&&(_data6.parent=pidToAssign)}updated.restore(false,false)}),eles.emitAndNotify("move")}}return this},[elesfn$j,elesfn$i,elesfn$h,elesfn$g,elesfn$f,data,elesfn$d,dimensions,elesfn$9,elesfn$8,{isNode:function isNode(){return"nodes"===this.group()},isEdge:function isEdge(){return"edges"===this.group()},isLoop:function isLoop(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function isSimple(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function group(){var ele=this[0];if(ele)return ele._private.group}},elesfn$6,elesfn$5,elesfn$4,elesfn$3,elesfn$2].forEach(function(props){extend(elesfn$1,props)});var corefn$9={add:function add(opts){var elements,cy=this;if(elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy)elements=eles.restore();else{for(var jsons=[],i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new Collection(cy,jsons)}}else if(array(opts)){elements=new Collection(cy,opts)}else if(plainObject(opts)&&(array(opts.nodes)||array(opts.edges))){for(var elesByGroup=opts,_jsons2=[],grs=["nodes","edges"],_i=0,il=grs.length;_i<il;_i++){var group=grs[_i],elesArray=elesByGroup[group];if(array(elesArray))for(var j=0,jl=elesArray.length;j<jl;j++){var json=extend({group},elesArray[j]);_jsons2.push(json)}}elements=new Collection(cy,_jsons2)}else{elements=new Element(cy,opts).collection()}return elements},remove:function remove(collection){if(elementOrCollection(collection));else if(string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()}};function generateCubicBezier(mX1,mY1,mX2,mY2){var float32ArraySupported="undefined"!=typeof Float32Array;if(4!==arguments.length)return!1;for(var i=0;i<4;++i)if("number"!=typeof arguments[i]||isNaN(arguments[i])||!isFinite(arguments[i]))return!1;mX1=Math.min(mX1,1),mX2=Math.min(mX2,1),mX1=Math.max(mX1,0),mX2=Math.max(mX2,0);var mSampleValues=float32ArraySupported?new Float32Array(11):new Array(11);function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function getTForX(aX){for(var intervalStart=0,currentSample=1;10!==currentSample&&mSampleValues[currentSample]<=aX;++currentSample)intervalStart+=.1;--currentSample;var guessForT=intervalStart+.1*((aX-mSampleValues[currentSample])/(mSampleValues[currentSample+1]-mSampleValues[currentSample])),initialSlope=getSlope(guessForT,mX1,mX2);return initialSlope>=.001?function newtonRaphsonIterate(aX,aGuessT){for(var _i=0;_i<4;++_i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(0===currentSlope)return aGuessT;aGuessT-=(calcBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}(aX,guessForT):0===initialSlope?guessForT:function binarySubdivide(aX,aA,aB){var currentX,currentT,i=0;do{(currentX=calcBezier(currentT=aA+(aB-aA)/2,mX1,mX2)-aX)>0?aB=currentT:aA=currentT}while(Math.abs(currentX)>1e-7&&++i<10);return currentT}(aX,intervalStart,intervalStart+.1)}var _precomputed=!1;function precompute(){_precomputed=!0,mX1===mY1&&mX2===mY2||function calcSampleValues(){for(var _i2=0;_i2<11;++_i2)mSampleValues[_i2]=calcBezier(.1*_i2,mX1,mX2)}()}var f=function f(aX){return _precomputed||precompute(),mX1===mY1&&mX2===mY2?aX:0===aX?0:1===aX?1:calcBezier(getTForX(aX),mY1,mY2)};f.getControlPoints=function(){return[{x:mX1,y:mY1},{x:mX2,y:mY2}]};var str="generateBezier("+[mX1,mY1,mX2,mY2]+")";return f.toString=function(){return str},f}var generateSpringRK4=function(){function springAccelerationForState(state){return-state.tension*state.x-state.friction*state.v}function springEvaluateStateWithDerivative(initialState,dt,derivative){var state={x:initialState.x+derivative.dx*dt,v:initialState.v+derivative.dv*dt,tension:initialState.tension,friction:initialState.friction};return{dx:state.v,dv:springAccelerationForState(state)}}function springIntegrateState(state,dt){var a={dx:state.v,dv:springAccelerationForState(state)},b=springEvaluateStateWithDerivative(state,.5*dt,a),c=springEvaluateStateWithDerivative(state,.5*dt,b),d=springEvaluateStateWithDerivative(state,dt,c),dxdt=1/6*(a.dx+2*(b.dx+c.dx)+d.dx),dvdt=1/6*(a.dv+2*(b.dv+c.dv)+d.dv);return state.x=state.x+dxdt*dt,state.v=state.v+dvdt*dt,state}return function springRK4Factory(tension,friction,duration){var have_duration,dt,last_state,initState={x:-1,v:0,tension:null,friction:null},path=[0],time_lapsed=0;for(tension=parseFloat(tension)||500,friction=parseFloat(friction)||20,duration=duration||null,initState.tension=tension,initState.friction=friction,dt=(have_duration=null!==duration)?(time_lapsed=springRK4Factory(tension,friction))/duration*.016:.016;last_state=springIntegrateState(last_state||initState,dt),path.push(1+last_state.x),time_lapsed+=16,Math.abs(last_state.x)>1e-4&&Math.abs(last_state.v)>1e-4;);return have_duration?function(percentComplete){return path[percentComplete*(path.length-1)|0]}:time_lapsed}}(),cubicBezier=function cubicBezier(t1,p1,t2,p2){var bezier=generateCubicBezier(t1,p1,t2,p2);return function(start,end,percent){return start+(end-start)*bezier(percent)}},easings={linear:function linear(start,end,percent){return start+(end-start)*percent},ease:cubicBezier(.25,.1,.25,1),"ease-in":cubicBezier(.42,0,1,1),"ease-out":cubicBezier(0,0,.58,1),"ease-in-out":cubicBezier(.42,0,.58,1),"ease-in-sine":cubicBezier(.47,0,.745,.715),"ease-out-sine":cubicBezier(.39,.575,.565,1),"ease-in-out-sine":cubicBezier(.445,.05,.55,.95),"ease-in-quad":cubicBezier(.55,.085,.68,.53),"ease-out-quad":cubicBezier(.25,.46,.45,.94),"ease-in-out-quad":cubicBezier(.455,.03,.515,.955),"ease-in-cubic":cubicBezier(.55,.055,.675,.19),"ease-out-cubic":cubicBezier(.215,.61,.355,1),"ease-in-out-cubic":cubicBezier(.645,.045,.355,1),"ease-in-quart":cubicBezier(.895,.03,.685,.22),"ease-out-quart":cubicBezier(.165,.84,.44,1),"ease-in-out-quart":cubicBezier(.77,0,.175,1),"ease-in-quint":cubicBezier(.755,.05,.855,.06),"ease-out-quint":cubicBezier(.23,1,.32,1),"ease-in-out-quint":cubicBezier(.86,0,.07,1),"ease-in-expo":cubicBezier(.95,.05,.795,.035),"ease-out-expo":cubicBezier(.19,1,.22,1),"ease-in-out-expo":cubicBezier(1,0,0,1),"ease-in-circ":cubicBezier(.6,.04,.98,.335),"ease-out-circ":cubicBezier(.075,.82,.165,1),"ease-in-out-circ":cubicBezier(.785,.135,.15,.86),spring:function spring(tension,friction,duration){if(0===duration)return easings.linear;var spring=generateSpringRK4(tension,friction,duration);return function(start,end,percent){return start+(end-start)*spring(percent)}},"cubic-bezier":cubicBezier};function getEasedValue(type,start,end,percent,easingFn){if(1===percent)return end;if(start===end)return end;var val=easingFn(start,end,percent);return null==type||((type.roundValue||type.color)&&(val=Math.round(val)),void 0!==type.min&&(val=Math.max(val,type.min)),void 0!==type.max&&(val=Math.min(val,type.max))),val}function getValue(prop,spec){return null!=prop.pfValue||null!=prop.value?null==prop.pfValue||null!=spec&&"%"===spec.type.units?prop.value:prop.pfValue:prop}function ease(startProp,endProp,percent,easingFn,propSpec){var type=null!=propSpec?propSpec.type:null;percent<0?percent=0:percent>1&&(percent=1);var start=getValue(startProp,propSpec),end=getValue(endProp,propSpec);if(number$1(start)&&number$1(end))return getEasedValue(type,start,end,percent,easingFn);if(array(start)&&array(end)){for(var easedArr=[],i=0;i<end.length;i++){var si=start[i],ei=end[i];if(null!=si&&null!=ei){var val=getEasedValue(type,si,ei,percent,easingFn);easedArr.push(val)}else easedArr.push(ei)}return easedArr}}function step$1(self,ani,now,isCore){var isEles=!isCore,_p=self._private,ani_p=ani._private,pEasing=ani_p.easing,startTime=ani_p.startTime,style=(isCore?self:self.cy()).style();if(!ani_p.easingImpl)if(null==pEasing)ani_p.easingImpl=easings.linear;else{var easingVals,name,args;if(string(pEasing))easingVals=style.parse("transition-timing-function",pEasing).value;else easingVals=pEasing;string(easingVals)?(name=easingVals,args=[]):(name=easingVals[1],args=easingVals.slice(2).map(function(n){return+n})),args.length>0?("spring"===name&&args.push(ani_p.duration),ani_p.easingImpl=easings[name].apply(null,args)):ani_p.easingImpl=easings[name]}var percent,easing=ani_p.easingImpl;if(percent=0===ani_p.duration?1:(now-startTime)/ani_p.duration,ani_p.applying&&(percent=ani_p.progress),percent<0?percent=0:percent>1&&(percent=1),null==ani_p.delay){var startPos=ani_p.startPosition,endPos=ani_p.position;if(endPos&&isEles&&!self.locked()){var newPos={};valid(startPos.x,endPos.x)&&(newPos.x=ease(startPos.x,endPos.x,percent,easing)),valid(startPos.y,endPos.y)&&(newPos.y=ease(startPos.y,endPos.y,percent,easing)),self.position(newPos)}var startPan=ani_p.startPan,endPan=ani_p.pan,pan=_p.pan,animatingPan=null!=endPan&&isCore;animatingPan&&(valid(startPan.x,endPan.x)&&(pan.x=ease(startPan.x,endPan.x,percent,easing)),valid(startPan.y,endPan.y)&&(pan.y=ease(startPan.y,endPan.y,percent,easing)),self.emit("pan"));var startZoom=ani_p.startZoom,endZoom=ani_p.zoom,animatingZoom=null!=endZoom&&isCore;animatingZoom&&(valid(startZoom,endZoom)&&(_p.zoom=bound(_p.minZoom,ease(startZoom,endZoom,percent,easing),_p.maxZoom)),self.emit("zoom")),(animatingPan||animatingZoom)&&self.emit("viewport");var props=ani_p.style;if(props&&props.length>0&&isEles){for(var i=0;i<props.length;i++){var prop=props[i],_name=prop.name,end=prop,start=ani_p.startStyle[_name],easedVal=ease(start,end,percent,easing,style.properties[start.name]);style.overrideBypass(self,_name,easedVal)}self.emit("style")}}return ani_p.progress=percent,percent}function valid(start,end){return null!=start&&null!=end&&(!(!number$1(start)||!number$1(end))||!(!start||!end))}function startAnimation(self,ani,now,isCore){var ani_p=ani._private;ani_p.started=!0,ani_p.startTime=now-ani_p.progress*ani_p.duration}function stepAll(now,cy){var eles=cy._private.aniEles,doneEles=[];function stepOne(ele,isCore){var _p=ele._private,current=_p.animation.current,queue=_p.animation.queue,ranAnis=!1;if(0===current.length){var next=queue.shift();next&&current.push(next)}for(var callbacks=function callbacks(_callbacks){for(var j=_callbacks.length-1;j>=0;j--){(0,_callbacks[j])()}_callbacks.splice(0,_callbacks.length)},i=current.length-1;i>=0;i--){var ani=current[i],ani_p=ani._private;ani_p.stopped?(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.frames)):(ani_p.playing||ani_p.applying)&&(ani_p.playing&&ani_p.applying&&(ani_p.applying=!1),ani_p.started||startAnimation(0,ani,now),step$1(ele,ani,now,isCore),ani_p.applying&&(ani_p.applying=!1),callbacks(ani_p.frames),null!=ani_p.step&&ani_p.step(now),ani.completed()&&(current.splice(i,1),ani_p.hooked=!1,ani_p.playing=!1,ani_p.started=!1,callbacks(ani_p.completes)),ranAnis=!0)}return isCore||0!==current.length||0!==queue.length||doneEles.push(ele),ranAnis}for(var ranEleAni=!1,e=0;e<eles.length;e++){var handledThisEle=stepOne(eles[e]);ranEleAni=ranEleAni||handledThisEle}var ranCoreAni=stepOne(cy,!0);(ranEleAni||ranCoreAni)&&(eles.length>0?cy.notify("draw",eles):cy.notify("draw")),eles.unmerge(doneEles),cy.emit("step")}var corefn$8={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop(),addToAnimationPool:function addToAnimationPool(eles){this.styleEnabled()&&this._private.aniEles.merge(eles)},stopAnimationLoop:function stopAnimationLoop(){this._private.animationsRunning=!1},startAnimationLoop:function startAnimationLoop(){var cy=this;if(cy._private.animationsRunning=!0,cy.styleEnabled()){var renderer=cy.renderer();renderer&&renderer.beforeRender?renderer.beforeRender(function rendererAnimationStep(willDraw,now){stepAll(now,cy)},renderer.beforeRenderPriorities.animations):function headlessStep(){cy._private.animationsRunning&&requestAnimationFrame(function animationStep(now){stepAll(now,cy),headlessStep()})}()}}},emitterOptions={qualifierCompare:function qualifierCompare(selector1,selector2){return null==selector1||null==selector2?null==selector1&&null==selector2:selector1.sameText(selector2)},eventMatches:function eventMatches(cy,listener,eventObj){var selector=listener.qualifier;return null==selector||cy!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)},addEventFields:function addEventFields(cy,evt){evt.cy=cy,evt.target=cy},callbackContext:function callbackContext(cy,listener,eventObj){return null!=listener.qualifier?eventObj.target:cy}},argSelector=function argSelector(arg){return string(arg)?new Selector(arg):arg},elesfn={createEmitter:function createEmitter(){var _p=this._private;return _p.emitter||(_p.emitter=new Emitter(emitterOptions,this)),this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){return this.emitter().on(events,argSelector(selector),callback),this},removeListener:function removeListener(events,selector,callback){return this.emitter().removeListener(events,argSelector(selector),callback),this},removeAllListeners:function removeAllListeners(){return this.emitter().removeAllListeners(),this},one:function one(events,selector,callback){return this.emitter().one(events,argSelector(selector),callback),this},once:function once(events,selector,callback){return this.emitter().one(events,argSelector(selector),callback),this},emit:function emit(events,extraParams){return this.emitter().emit(events,extraParams),this},emitAndNotify:function emitAndNotify(event,eles){return this.emit(event),this.notify(event,eles),this}};define.eventAliasesOn(elesfn);var corefn$7={png:function png(options){return options=options||{},this._private.renderer.png(options)},jpg:function jpg(options){var renderer=this._private.renderer;return(options=options||{}).bg=options.bg||"#fff",renderer.jpg(options)}};corefn$7.jpeg=corefn$7.jpg;var corefn$6={layout:function layout(options){if(null!=options)if(null!=options.name){var name=options.name,Layout=this.extension("layout",name);if(null!=Layout){var eles;eles=string(options.eles)?this.$(options.eles):null!=options.eles?options.eles:this.$();var layout=new Layout(extend({},options,{cy:this,eles}));return layout}error("No such layout `"+name+"` found.  Did you forget to import it and `cytoscape.use()` it?")}else error("A `name` must be specified to make a layout");else error("Layout options must be specified to make a layout")}};corefn$6.createLayout=corefn$6.makeLayout=corefn$6.layout;var corefn$5={notify:function notify(eventName,eventEles){var _p=this._private;if(this.batching()){_p.batchNotifications=_p.batchNotifications||{};var eles=_p.batchNotifications[eventName]=_p.batchNotifications[eventName]||this.collection();null!=eventEles&&eles.merge(eventEles)}else if(_p.notificationsEnabled){var renderer=this.renderer();!this.destroyed()&&renderer&&renderer.notify(eventName,eventEles)}},notifications:function notifications(bool){var p=this._private;return void 0===bool?p.notificationsEnabled:(p.notificationsEnabled=!!bool,this)},noNotifications:function noNotifications(callback){this.notifications(!1),callback(),this.notifications(!0)},batching:function batching(){return this._private.batchCount>0},startBatch:function startBatch(){var _p=this._private;return null==_p.batchCount&&(_p.batchCount=0),0===_p.batchCount&&(_p.batchStyleEles=this.collection(),_p.batchNotifications={}),_p.batchCount++,this},endBatch:function endBatch(){var _p=this._private;if(0===_p.batchCount)return this;if(_p.batchCount--,0===_p.batchCount){_p.batchStyleEles.updateStyle();var renderer=this.renderer();Object.keys(_p.batchNotifications).forEach(function(eventName){var eles=_p.batchNotifications[eventName];eles.empty()?renderer.notify(eventName):renderer.notify(eventName,eles)})}return this},batch:function batch(callback){return this.startBatch(),callback(),this.endBatch(),this},batchData:function batchData(map){var cy=this;return this.batch(function(){for(var ids=Object.keys(map),i=0;i<ids.length;i++){var id=ids[i],data=map[id];cy.getElementById(id).data(data)}})}},rendererDefaults=defaults$g({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),corefn$4={renderTo:function renderTo(context,zoom,pan,pxRatio){return this._private.renderer.renderTo(context,zoom,pan,pxRatio),this},renderer:function renderer(){return this._private.renderer},forceRender:function forceRender(){return this.notify("draw"),this},resize:function resize(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function initRenderer(options){var RendererProto=this.extension("renderer",options.name);if(null!=RendererProto){void 0!==options.wheelSensitivity&&warn("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var rOpts=rendererDefaults(options);rOpts.cy=this,this._private.renderer=new RendererProto(rOpts),this.notify("init")}else error("Can not initialise: No such renderer `".concat(options.name,"` found. Did you forget to import it and `cytoscape.use()` it?"))},destroyRenderer:function destroyRenderer(){this.notify("destroy");var domEle=this.container();if(domEle)for(domEle._cyreg=null;domEle.childNodes.length>0;)domEle.removeChild(domEle.childNodes[0]);this._private.renderer=null,this.mutableElements().forEach(function(ele){var _p=ele._private;_p.rscratch={},_p.rstyle={},_p.animation.current=[],_p.animation.queue=[]})},onRender:function onRender(fn){return this.on("render",fn)},offRender:function offRender(fn){return this.off("render",fn)}};corefn$4.invalidateDimensions=corefn$4.resize;var corefn$3={collection:function collection(eles,opts){return string(eles)?this.$(eles):elementOrCollection(eles)?eles.collection():array(eles)?(opts||(opts={}),new Collection(this,eles,opts.unique,opts.removed)):new Collection(this)},nodes:function nodes(selector){var nodes=this.$(function(ele){return ele.isNode()});return selector?nodes.filter(selector):nodes},edges:function edges(selector){var edges=this.$(function(ele){return ele.isEdge()});return selector?edges.filter(selector):edges},$:function $(selector){var eles=this._private.elements;return selector?eles.filter(selector):eles.spawnSelf()},mutableElements:function mutableElements(){return this._private.elements}};corefn$3.elements=corefn$3.filter=corefn$3.$;var styfn$8={};styfn$8.apply=function(eles){for(var updatedEles=this._private.cy.collection(),ie=0;ie<eles.length;ie++){var ele=eles[ie],cxtMeta=this.getContextMeta(ele);if(!cxtMeta.empty){var cxtStyle=this.getContextStyle(cxtMeta),app=this.applyContextStyle(cxtMeta,cxtStyle,ele);ele._private.appliedInitStyle?this.updateTransitions(ele,app.diffProps):ele._private.appliedInitStyle=!0,this.updateStyleHints(ele)&&updatedEles.push(ele)}}return updatedEles},styfn$8.getPropertiesDiff=function(oldCxtKey,newCxtKey){var cache=this._private.propDiffs=this._private.propDiffs||{},dualCxtKey=oldCxtKey+"-"+newCxtKey,cachedVal=cache[dualCxtKey];if(cachedVal)return cachedVal;for(var diffProps=[],addedProp={},i=0;i<this.length;i++){var cxt=this[i],oldHasCxt="t"===oldCxtKey[i],newHasCxt="t"===newCxtKey[i],cxtHasDiffed=oldHasCxt!==newHasCxt,cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||newHasCxt&&cxtHasMappedProps){var props=void 0;cxtHasDiffed&&cxtHasMappedProps||cxtHasDiffed?props=cxt.properties:cxtHasMappedProps&&(props=cxt.mappedProperties);for(var j=0;j<props.length;j++){for(var prop=props[j],name=prop.name,laterCxtOverrides=!1,k=i+1;k<this.length;k++){var laterCxt=this[k];if("t"===newCxtKey[k]&&(laterCxtOverrides=null!=laterCxt.properties[prop.name]))break}addedProp[name]||laterCxtOverrides||(addedProp[name]=!0,diffProps.push(name))}}}return cache[dualCxtKey]=diffProps,diffProps},styfn$8.getContextMeta=function(ele){for(var diffProps,cxtKey="",prevKey=ele._private.styleCxtKey||"",i=0;i<this.length;i++){var context=this[i];cxtKey+=context.selector&&context.selector.matches(ele)?"t":"f"}return diffProps=this.getPropertiesDiff(prevKey,cxtKey),ele._private.styleCxtKey=cxtKey,{key:cxtKey,diffPropNames:diffProps,empty:0===diffProps.length}},styfn$8.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key,cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey])return cxtStyles[cxtKey];for(var style={_private:{key:cxtKey}},i=0;i<this.length;i++){var cxt=this[i];if("t"===cxtKey[i])for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j];style[prop.name]=prop}}return cxtStyles[cxtKey]=style,style},styfn$8.applyContextStyle=function(cxtMeta,cxtStyle,ele){for(var diffProps=cxtMeta.diffPropNames,retDiffProps={},types=this.types,i=0;i<diffProps.length;i++){var diffPropName=diffProps[i],cxtProp=cxtStyle[diffPropName],eleProp=ele.pstyle(diffPropName);if(!cxtProp){if(!eleProp)continue;cxtProp=eleProp.bypass?{name:diffPropName,deleteBypassed:!0}:{name:diffPropName,delete:!0}}if(eleProp!==cxtProp){if(cxtProp.mapped===types.fn&&null!=eleProp&&null!=eleProp.mapping&&eleProp.mapping.value===cxtProp.value){var mapping=eleProp.mapping;if((mapping.fnValue=cxtProp.value(ele))===mapping.prevFnValue)continue}var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};this.applyParsedProperty(ele,cxtProp),retDiffProp.next=ele.pstyle(diffPropName),retDiffProp.next&&retDiffProp.next.bypass&&(retDiffProp.next=retDiffProp.next.bypassed)}}return{diffProps:retDiffProps}},styfn$8.updateStyleHints=function(ele){var _p=ele._private,self=this,propNames=self.propertyGroupNames,propGrKeys=self.propertyGroupKeys,propHash=function propHash(ele,propNames,seedKey){return self.getPropertiesHash(ele,propNames,seedKey)},oldStyleKey=_p.styleKey;if(ele.removed())return!1;var isNode="nodes"===_p.group,overriddenStyles=ele._private.style;propNames=Object.keys(overriddenStyles);for(var i=0;i<propGrKeys.length;i++){var grKey=propGrKeys[i];_p.styleKeys[grKey]=[9261,5381]}for(var updateGrKey1=function updateGrKey1(val,grKey){return _p.styleKeys[grKey][0]=hashInt(val,_p.styleKeys[grKey][0])},updateGrKey2=function updateGrKey2(val,grKey){return _p.styleKeys[grKey][1]=hashIntAlt(val,_p.styleKeys[grKey][1])},updateGrKey=function updateGrKey(val,grKey){updateGrKey1(val,grKey),updateGrKey2(val,grKey)},updateGrKeyWStr=function updateGrKeyWStr(strVal,grKey){for(var j=0;j<strVal.length;j++){var ch=strVal.charCodeAt(j);updateGrKey1(ch,grKey),updateGrKey2(ch,grKey)}},cleanNum=function cleanNum(val){return-128<val&&val<128&&Math.floor(val)!==val?2e9-(1024*val|0):val},_i=0;_i<propNames.length;_i++){var name=propNames[_i],parsedProp=overriddenStyles[name];if(null!=parsedProp){var propInfo=this.properties[name],type=propInfo.type,_grKey=propInfo.groupKey,normalizedNumberVal=void 0;null!=propInfo.hashOverride?normalizedNumberVal=propInfo.hashOverride(ele,parsedProp):null!=parsedProp.pfValue&&(normalizedNumberVal=parsedProp.pfValue);var numberVal=null==propInfo.enums?parsedProp.value:null,haveNormNum=null!=normalizedNumberVal,haveNum=haveNormNum||null!=numberVal,units=parsedProp.units;if(type.number&&haveNum&&!type.multiple)updateGrKey(cleanNum(haveNormNum?normalizedNumberVal:numberVal),_grKey),haveNormNum||null==units||updateGrKeyWStr(units,_grKey);else updateGrKeyWStr(parsedProp.strValue,_grKey)}}for(var hash=[9261,5381],_i2=0;_i2<propGrKeys.length;_i2++){var _grKey2=propGrKeys[_i2],grHash=_p.styleKeys[_grKey2];hash[0]=hashInt(grHash[0],hash[0]),hash[1]=hashIntAlt(grHash[1],hash[1])}_p.styleKey=function combineHashes(hash1,hash2){return 2097152*hash1+hash2}(hash[0],hash[1]);var sk=_p.styleKeys;_p.labelDimsKey=combineHashesArray(sk.labelDimensions);var labelKeys=propHash(ele,["label"],sk.labelDimensions);if(_p.labelKey=combineHashesArray(labelKeys),_p.labelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,labelKeys)),!isNode){var sourceLabelKeys=propHash(ele,["source-label"],sk.labelDimensions);_p.sourceLabelKey=combineHashesArray(sourceLabelKeys),_p.sourceLabelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,sourceLabelKeys));var targetLabelKeys=propHash(ele,["target-label"],sk.labelDimensions);_p.targetLabelKey=combineHashesArray(targetLabelKeys),_p.targetLabelStyleKey=combineHashesArray(hashArrays(sk.commonLabel,targetLabelKeys))}if(isNode){var _p$styleKeys=_p.styleKeys,nodeBody=_p$styleKeys.nodeBody,nodeBorder=_p$styleKeys.nodeBorder,nodeOutline=_p$styleKeys.nodeOutline,backgroundImage=_p$styleKeys.backgroundImage,compound=_p$styleKeys.compound,pie=_p$styleKeys.pie,stripe=_p$styleKeys.stripe,nodeKeys=[nodeBody,nodeBorder,nodeOutline,backgroundImage,compound,pie,stripe].filter(function(k){return null!=k}).reduce(hashArrays,[9261,5381]);_p.nodeKey=combineHashesArray(nodeKeys),_p.hasPie=null!=pie&&9261!==pie[0]&&5381!==pie[1],_p.hasStripe=null!=stripe&&9261!==stripe[0]&&5381!==stripe[1]}return oldStyleKey!==_p.styleKey},styfn$8.clearStyleHints=function(ele){var _p=ele._private;_p.styleCxtKey="",_p.styleKeys={},_p.styleKey=null,_p.labelKey=null,_p.labelStyleKey=null,_p.sourceLabelKey=null,_p.sourceLabelStyleKey=null,_p.targetLabelKey=null,_p.targetLabelStyleKey=null,_p.nodeKey=null,_p.hasPie=null,_p.hasStripe=null},styfn$8.applyParsedProperty=function(ele,parsedProp){var flatProp,self=this,prop=parsedProp,style=ele._private.style,types=self.types,type=self.properties[prop.name].type,propIsBypass=prop.bypass,origProp=style[prop.name],origPropIsBypass=origProp&&origProp.bypass,_p=ele._private,getVal=function getVal(p){return null==p?null:null!=p.pfValue?p.pfValue:p.value},checkTriggers=function checkTriggers(){var fromVal=getVal(origProp),toVal=getVal(prop);self.checkTriggers(ele,prop.name,fromVal,toVal)};if("curve-style"===parsedProp.name&&ele.isEdge()&&("bezier"!==parsedProp.value&&ele.isLoop()||"haystack"===parsedProp.value&&(ele.source().isParent()||ele.target().isParent()))&&(prop=parsedProp=this.parse(parsedProp.name,"bezier",propIsBypass)),prop.delete)return style[prop.name]=void 0,checkTriggers(),!0;if(prop.deleteBypassed)return origProp?!!origProp.bypass&&(origProp.bypassed=void 0,checkTriggers(),!0):(checkTriggers(),!0);if(prop.deleteBypass)return origProp?!!origProp.bypass&&(style[prop.name]=origProp.bypassed,checkTriggers(),!0):(checkTriggers(),!0);var printMappingErr=function printMappingErr(){warn("Do not assign mappings to elements without corresponding data (i.e. ele `"+ele.id()+"` has no mapping for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:for(var percent,fields=prop.field.split("."),fieldVal=_p.data,i=0;i<fields.length&&fieldVal;i++){fieldVal=fieldVal[fields[i]]}if(null==fieldVal)return printMappingErr(),!1;if(!number$1(fieldVal))return warn("Do not use continuous mappers without specifying numeric data (i.e. `"+prop.field+": "+fieldVal+"` for `"+ele.id()+"` is non-numeric)"),!1;var fieldWidth=prop.fieldMax-prop.fieldMin;if((percent=0===fieldWidth?0:(fieldVal-prop.fieldMin)/fieldWidth)<0?percent=0:percent>1&&(percent=1),type.color){var r1=prop.valueMin[0],r2=prop.valueMax[0],g1=prop.valueMin[1],g2=prop.valueMax[1],b1=prop.valueMin[2],b2=prop.valueMax[2],a1=null==prop.valueMin[3]?1:prop.valueMin[3],a2=null==prop.valueMax[3]?1:prop.valueMax[3],clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else{if(!type.number)return!1;var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,"mapping")}if(!flatProp)return printMappingErr(),!1;flatProp.mapping=prop,prop=flatProp;break;case types.data:for(var _fields=prop.field.split("."),_fieldVal=_p.data,_i3=0;_i3<_fields.length&&_fieldVal;_i3++){_fieldVal=_fieldVal[_fields[_i3]]}if(null!=_fieldVal&&(flatProp=this.parse(prop.name,_fieldVal,prop.bypass,"mapping")),!flatProp)return printMappingErr(),!1;flatProp.mapping=prop,prop=flatProp;break;case types.fn:var fn=prop.value,fnRetVal=null!=prop.fnValue?prop.fnValue:fn(ele);if(prop.prevFnValue=fnRetVal,null==fnRetVal)return warn("Custom function mappers may not return null (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is null)"),!1;if(!(flatProp=this.parse(prop.name,fnRetVal,prop.bypass,"mapping")))return warn("Custom function mappers may not return invalid values for the property type (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is invalid)"),!1;flatProp.mapping=copy(prop),prop=flatProp;break;case void 0:break;default:return!1}return propIsBypass?(prop.bypassed=origPropIsBypass?origProp.bypassed:origProp,style[prop.name]=prop):origPropIsBypass?origProp.bypassed=prop:style[prop.name]=prop,checkTriggers(),!0},styfn$8.cleanElements=function(eles,keepBypasses){for(var i=0;i<eles.length;i++){var ele=eles[i];if(this.clearStyleHints(ele),ele.dirtyCompoundBoundsCache(),ele.dirtyBoundingBoxCache(),keepBypasses)for(var style=ele._private.style,propNames=Object.keys(style),j=0;j<propNames.length;j++){var propName=propNames[j],eleProp=style[propName];null!=eleProp&&(eleProp.bypass?eleProp.bypassed=null:style[propName]=null)}else ele._private.style={}}},styfn$8.update=function(){this._private.cy.mutableElements().updateStyle()},styfn$8.updateTransitions=function(ele,diffProps){var self=this,_p=ele._private,props=ele.pstyle("transition-property").value,duration=ele.pstyle("transition-duration").pfValue,delay=ele.pstyle("transition-delay").pfValue;if(props.length>0&&duration>0){for(var style={},anyPrev=!1,i=0;i<props.length;i++){var prop=props[i],styProp=ele.pstyle(prop),diffProp=diffProps[prop];if(diffProp){var fromProp=diffProp.prev,toProp=null!=diffProp.next?diffProp.next:styProp,diff=!1,initVal=void 0;fromProp&&(number$1(fromProp.pfValue)&&number$1(toProp.pfValue)?(diff=toProp.pfValue-fromProp.pfValue,initVal=fromProp.pfValue+1e-6*diff):number$1(fromProp.value)&&number$1(toProp.value)?(diff=toProp.value-fromProp.value,initVal=fromProp.value+1e-6*diff):array(fromProp.value)&&array(toProp.value)&&(diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2],initVal=fromProp.strValue),diff&&(style[prop]=toProp.strValue,this.applyBypass(ele,prop,initVal),anyPrev=!0))}}if(!anyPrev)return;_p.transitioning=!0,new Promise$1(function(resolve){delay>0?ele.delayAnimation(delay).play().promise().then(resolve):resolve()}).then(function(){return ele.animation({style,duration,easing:ele.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){self.removeBypasses(ele,props),ele.emitAndNotify("style"),_p.transitioning=!1})}else _p.transitioning&&(this.removeBypasses(ele,props),ele.emitAndNotify("style"),_p.transitioning=!1)},styfn$8.checkTrigger=function(ele,name,fromValue,toValue,getTrigger,onTrigger){var prop=this.properties[name],triggerCheck=getTrigger(prop);ele.removed()||null!=triggerCheck&&triggerCheck(fromValue,toValue,ele)&&onTrigger(prop)},styfn$8.checkZOrderTrigger=function(ele,name,fromValue,toValue){var _this=this;this.checkTrigger(ele,name,fromValue,toValue,function(prop){return prop.triggersZOrder},function(){_this._private.cy.notify("zorder",ele)})},styfn$8.checkBoundsTrigger=function(ele,name,fromValue,toValue){this.checkTrigger(ele,name,fromValue,toValue,function(prop){return prop.triggersBounds},function(prop){ele.dirtyCompoundBoundsCache(),ele.dirtyBoundingBoxCache()})},styfn$8.checkConnectedEdgesBoundsTrigger=function(ele,name,fromValue,toValue){this.checkTrigger(ele,name,fromValue,toValue,function(prop){return prop.triggersBoundsOfConnectedEdges},function(prop){ele.connectedEdges().forEach(function(edge){edge.dirtyBoundingBoxCache()})})},styfn$8.checkParallelEdgesBoundsTrigger=function(ele,name,fromValue,toValue){this.checkTrigger(ele,name,fromValue,toValue,function(prop){return prop.triggersBoundsOfParallelEdges},function(prop){ele.parallelEdges().forEach(function(pllEdge){pllEdge.dirtyBoundingBoxCache()})})},styfn$8.checkTriggers=function(ele,name,fromValue,toValue){ele.dirtyStyleCache(),this.checkZOrderTrigger(ele,name,fromValue,toValue),this.checkBoundsTrigger(ele,name,fromValue,toValue),this.checkConnectedEdgesBoundsTrigger(ele,name,fromValue,toValue),this.checkParallelEdgesBoundsTrigger(ele,name,fromValue,toValue)};var styfn$7={applyBypass:function(eles,name,value,updateTransitions){var props=[];if("*"===name||"**"===name){if(void 0!==value)for(var i=0;i<this.properties.length;i++){var _name=this.properties[i].name,parsedProp=this.parse(_name,value,!0);parsedProp&&props.push(parsedProp)}}else if(string(name)){var _parsedProp=this.parse(name,value,!0);_parsedProp&&props.push(_parsedProp)}else{if(!plainObject(name))return!1;var specifiedProps=name;updateTransitions=value;for(var names=Object.keys(specifiedProps),_i=0;_i<names.length;_i++){var _name2=names[_i],_value=specifiedProps[_name2];if(void 0===_value&&(_value=specifiedProps[dash2camel(_name2)]),void 0!==_value){var _parsedProp2=this.parse(_name2,_value,!0);_parsedProp2&&props.push(_parsedProp2)}}}if(0===props.length)return!1;for(var ret=!1,_i2=0;_i2<eles.length;_i2++){for(var ele=eles[_i2],diffProps={},diffProp=void 0,j=0;j<props.length;j++){var _prop=props[j];if(updateTransitions){var prevProp=ele.pstyle(_prop.name);diffProp=diffProps[_prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,copy(_prop))||ret,updateTransitions&&(diffProp.next=ele.pstyle(_prop.name))}ret&&this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,true)}return ret},overrideBypass:function(eles,name,value){name=camel2dash(name);for(var i=0;i<eles.length;i++){var ele=eles[i],prop=ele._private.style[name],type=this.properties[name].type,isColor=type.color,isMulti=type.mutiple,oldValue=prop?null!=prop.pfValue?prop.pfValue:prop.value:null;prop&&prop.bypass?(prop.value=value,null!=prop.pfValue&&(prop.pfValue=value),prop.strValue=isColor?"rgb("+value.join(",")+")":isMulti?value.join(" "):""+value,this.updateStyleHints(ele)):this.applyBypass(ele,name,value),this.checkTriggers(ele,name,oldValue,value)}},removeAllBypasses:function(eles,updateTransitions){return this.removeBypasses(eles,this.propertyNames,updateTransitions)},removeBypasses:function(eles,props,updateTransitions){for(var j=0;j<eles.length;j++){for(var ele=eles[j],diffProps={},i=0;i<props.length;i++){var name=props[i],prop=this.properties[name],prevProp=ele.pstyle(prop.name);if(prevProp&&prevProp.bypass){var parsedProp=this.parse(name,"",!0),diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp),diffProp.next=ele.pstyle(prop.name)}}this.updateStyleHints(ele),updateTransitions&&this.updateTransitions(ele,diffProps,true)}}},styfn$6={getEmSizeInPixels:function(){var px=this.containerCss("font-size");return null!=px?parseFloat(px):1},containerCss:function(propName){var cy=this._private.cy,domElement=cy.container(),containerWindow=cy.window();if(containerWindow&&domElement&&containerWindow.getComputedStyle)return containerWindow.getComputedStyle(domElement).getPropertyValue(propName)}},styfn$5={getRenderedStyle:function(ele,prop){return prop?this.getStylePropertyValue(ele,prop,!0):this.getRawStyle(ele,!0)},getRawStyle:function(ele,isRenderedVal){if(ele=ele[0]){for(var rstyle={},i=0;i<this.properties.length;i++){var prop=this.properties[i],val=this.getStylePropertyValue(ele,prop.name,isRenderedVal);null!=val&&(rstyle[prop.name]=val,rstyle[dash2camel(prop.name)]=val)}return rstyle}},getIndexedStyle:function(ele,property,subproperty,index){var pstyle=ele.pstyle(property)[subproperty][index];return null!=pstyle?pstyle:ele.cy().style().getDefaultProperty(property)[subproperty][0]},getStylePropertyValue:function(ele,propName,isRenderedVal){if(ele=ele[0]){var prop=this.properties[propName];prop.alias&&(prop=prop.pointsTo);var type=prop.type,styleProp=ele.pstyle(prop.name);if(styleProp){var value=styleProp.value,units=styleProp.units,strValue=styleProp.strValue;if(isRenderedVal&&type.number&&null!=value&&number$1(value)){var zoom=ele.cy().zoom(),getRenderedValue=function getRenderedValue(val){return val*zoom},getValueStringWithUnits=function getValueStringWithUnits(val,units){return getRenderedValue(val)+units},isArrayValue=array(value);return(isArrayValue?units.every(function(u){return null!=u}):null!=units)?isArrayValue?value.map(function(v,i){return getValueStringWithUnits(v,units[i])}).join(" "):getValueStringWithUnits(value,units):isArrayValue?value.map(function(v){return string(v)?v:""+getRenderedValue(v)}).join(" "):""+getRenderedValue(value)}if(null!=strValue)return strValue}return null}},getAnimationStartStyle:function(ele,aniProps){for(var rstyle={},i=0;i<aniProps.length;i++){var name=aniProps[i].name,styleProp=ele.pstyle(name);void 0!==styleProp&&(styleProp=plainObject(styleProp)?this.parse(name,styleProp.strValue):this.parse(name,styleProp)),styleProp&&(rstyle[name]=styleProp)}return rstyle},getPropsList:function(propsObj){var rstyle=[],style=propsObj,props=this.properties;if(style)for(var names=Object.keys(style),i=0;i<names.length;i++){var name=names[i],val=style[name],prop=props[name]||props[camel2dash(name)],styleProp=this.parse(prop.name,val);styleProp&&rstyle.push(styleProp)}return rstyle},getNonDefaultPropertiesHash:function(ele,propNames,seed){var name,val,strVal,chVal,i,j,hash=seed.slice();for(i=0;i<propNames.length;i++)if(name=propNames[i],null!=(val=ele.pstyle(name,!1)))if(null!=val.pfValue)hash[0]=hashInt(chVal,hash[0]),hash[1]=hashIntAlt(chVal,hash[1]);else for(strVal=val.strValue,j=0;j<strVal.length;j++)chVal=strVal.charCodeAt(j),hash[0]=hashInt(chVal,hash[0]),hash[1]=hashIntAlt(chVal,hash[1]);return hash}};styfn$5.getPropertiesHash=styfn$5.getNonDefaultPropertiesHash;var styfn$4={appendFromJson:function(json){for(var i=0;i<json.length;i++){var context=json[i],selector=context.selector,props=context.style||context.css,names=Object.keys(props);this.selector(selector);for(var j=0;j<names.length;j++){var name=names[j],value=props[name];this.css(name,value)}}return this},fromJson:function(json){return this.resetToDefault(),this.appendFromJson(json),this},json:function(){for(var json=[],i=this.defaultLength;i<this.length;i++){for(var cxt=this[i],selector=cxt.selector,props=cxt.properties,css={},j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:selector?selector.toString():"core",style:css})}return json}},styfn$3={appendFromString:function(string){var selAndBlockStr,blockRem,propAndValStr,remaining=""+string;function removeSelAndBlockFromRemaining(){remaining=remaining.length>selAndBlockStr.length?remaining.substr(selAndBlockStr.length):""}function removePropAndValFromRem(){blockRem=blockRem.length>propAndValStr.length?blockRem.substr(propAndValStr.length):""}for(remaining=remaining.replace(/[/][*](\s|.)+?[*][/]/g,"");;){if(remaining.match(/^\s*$/))break;var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){warn("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if("core"!==selectorStr)if(new Selector(selectorStr).invalid){warn("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr),removeSelAndBlockFromRemaining();continue}var blockStr=selAndBlock[2],invalidBlock=!1;blockRem=blockStr;for(var props=[];;){if(blockRem.match(/^\s*$/))break;var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!propAndVal){warn("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr),invalidBlock=!0;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1],valStr=propAndVal[2];if(this.properties[propStr])this.parse(propStr,valStr)?(props.push({name:propStr,val:valStr}),removePropAndValFromRem()):(warn("Skipping property: Invalid property definition in: "+propAndValStr),removePropAndValFromRem());else warn("Skipping property: Invalid property name in: "+propAndValStr),removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}this.selector(selectorStr);for(var i=0;i<props.length;i++){var _prop=props[i];this.css(_prop.name,_prop.val)}removeSelAndBlockFromRemaining()}return this},fromString:function(string){return this.resetToDefault(),this.appendFromString(string),this}},styfn$2={};!function(){var number$1=number,rgba=rgbaNoBackRefs,hsla=hslaNoBackRefs,data=function data(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},mapData=function mapData(prefix){var mapArg=number$1+"|\\w+|"+rgba+"|"+hsla+"|\\#[0-9a-fA-F]{3}|\\#[0-9a-fA-F]{6}";return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number$1+")\\s*\\,\\s*("+number$1+")\\s*,\\s*("+mapArg+")\\s*\\,\\s*("+mapArg+")\\)$"},urlRegexes=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];styfn$2.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:data("data")},layoutData:{mapping:!0,regex:data("layoutData")},scratch:{mapping:!0,regex:data("scratch")},mapData:{mapping:!0,regex:mapData("mapData")},mapLayoutData:{mapping:!0,regex:mapData("mapLayoutData")},mapScratch:{mapping:!0,regex:mapData("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:urlRegexes,singleRegexMatchValue:!0},urls:{regexes:urlRegexes,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function validate(valArr,unitsArr){switch(valArr.length){case 2:return"deg"!==unitsArr[0]&&"rad"!==unitsArr[0]&&"deg"!==unitsArr[1]&&"rad"!==unitsArr[1];case 1:return string(valArr[0])||"deg"===unitsArr[0]||"rad"===unitsArr[0];default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+number$1+")\\s*,\\s*("+number$1+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+number$1+")\\s*,\\s*("+number$1+")\\s*,\\s*("+number$1+")\\s*,\\s*("+number$1+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function validate(valArr){var length=valArr.length;return 1===length||2===length||4===length}}};var diff={zeroNonZero:function zeroNonZero(val1,val2){return(null==val1||null==val2)&&val1!==val2||(0==val1&&0!=val2||0!=val1&&0==val2)},any:function any(val1,val2){return val1!=val2},emptyNonEmpty:function emptyNonEmpty(str1,str2){var empty1=emptyString(str1),empty2=emptyString(str2);return empty1&&!empty2||!empty1&&empty2}},t=styfn$2.types,mainLabel=[{name:"label",type:t.text,triggersBounds:diff.any,triggersZOrder:diff.emptyNonEmpty},{name:"text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any}],sourceLabel=[{name:"source-label",type:t.text,triggersBounds:diff.any},{name:"source-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"source-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-offset",type:t.size,triggersBounds:diff.any}],targetLabel=[{name:"target-label",type:t.text,triggersBounds:diff.any},{name:"target-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"target-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-offset",type:t.size,triggersBounds:diff.any}],labelDimensions=[{name:"font-family",type:t.fontFamily,triggersBounds:diff.any},{name:"font-style",type:t.fontStyle,triggersBounds:diff.any},{name:"font-weight",type:t.fontWeight,triggersBounds:diff.any},{name:"font-size",type:t.size,triggersBounds:diff.any},{name:"text-transform",type:t.textTransform,triggersBounds:diff.any},{name:"text-wrap",type:t.textWrap,triggersBounds:diff.any},{name:"text-overflow-wrap",type:t.textOverflowWrap,triggersBounds:diff.any},{name:"text-max-width",type:t.size,triggersBounds:diff.any},{name:"text-outline-width",type:t.size,triggersBounds:diff.any},{name:"line-height",type:t.positiveNumber,triggersBounds:diff.any}],commonLabel=[{name:"text-valign",type:t.valign,triggersBounds:diff.any},{name:"text-halign",type:t.halign,triggersBounds:diff.any},{name:"color",type:t.color},{name:"text-outline-color",type:t.color},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-background-padding",type:t.size,triggersBounds:diff.any},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size,triggersBounds:diff.any},{name:"text-border-style",type:t.borderStyle,triggersBounds:diff.any},{name:"text-background-shape",type:t.textBackgroundShape,triggersBounds:diff.any},{name:"text-justification",type:t.justification},{name:"box-select-labels",type:t.bool,triggersBounds:diff.any}],behavior=[{name:"events",type:t.bool,triggersZOrder:diff.any},{name:"text-events",type:t.bool,triggersZOrder:diff.any},{name:"box-selection",type:t.boxSelection,triggersZOrder:diff.any}],visibility=[{name:"display",type:t.display,triggersZOrder:diff.any,triggersBounds:diff.any,triggersBoundsOfConnectedEdges:diff.any,triggersBoundsOfParallelEdges:function triggersBoundsOfParallelEdges(fromValue,toValue,ele){return fromValue!==toValue&&"bezier"===ele.pstyle("curve-style").value}},{name:"visibility",type:t.visibility,triggersZOrder:diff.any},{name:"opacity",type:t.zeroOneNumber,triggersZOrder:diff.zeroNonZero},{name:"text-opacity",type:t.zeroOneNumber},{name:"min-zoomed-font-size",type:t.size},{name:"z-compound-depth",type:t.zCompoundDepth,triggersZOrder:diff.any},{name:"z-index-compare",type:t.zIndexCompare,triggersZOrder:diff.any},{name:"z-index",type:t.number,triggersZOrder:diff.any}],overlay=[{name:"overlay-padding",type:t.size,triggersBounds:diff.any},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber,triggersBounds:diff.zeroNonZero},{name:"overlay-shape",type:t.overlayShape,triggersBounds:diff.any},{name:"overlay-corner-radius",type:t.cornerRadius}],underlay=[{name:"underlay-padding",type:t.size,triggersBounds:diff.any},{name:"underlay-color",type:t.color},{name:"underlay-opacity",type:t.zeroOneNumber,triggersBounds:diff.zeroNonZero},{name:"underlay-shape",type:t.overlayShape,triggersBounds:diff.any},{name:"underlay-corner-radius",type:t.cornerRadius}],transition=[{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"transition-timing-function",type:t.easing}],nodeSizeHashOverride=function nodeSizeHashOverride(ele,parsedProp){return"label"===parsedProp.value?-ele.poolIndex():parsedProp.pfValue},nodeBody=[{name:"height",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"width",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"shape",type:t.nodeShape,triggersBounds:diff.any},{name:"shape-polygon-points",type:t.polygonPointList,triggersBounds:diff.any},{name:"corner-radius",type:t.cornerRadius},{name:"background-color",type:t.color},{name:"background-fill",type:t.fill},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"background-gradient-stop-colors",type:t.colors},{name:"background-gradient-stop-positions",type:t.percentages},{name:"background-gradient-direction",type:t.gradientDirection},{name:"padding",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"padding-relative-to",type:t.paddingRelativeTo,triggersBounds:diff.any},{name:"bounds-expansion",type:t.boundsExpansion,triggersBounds:diff.any}],nodeBorder=[{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size,triggersBounds:diff.any},{name:"border-style",type:t.borderStyle},{name:"border-cap",type:t.lineCap},{name:"border-join",type:t.lineJoin},{name:"border-dash-pattern",type:t.numbers},{name:"border-dash-offset",type:t.number},{name:"border-position",type:t.linePosition}],nodeOutline=[{name:"outline-color",type:t.color},{name:"outline-opacity",type:t.zeroOneNumber},{name:"outline-width",type:t.size,triggersBounds:diff.any},{name:"outline-style",type:t.borderStyle},{name:"outline-offset",type:t.size,triggersBounds:diff.any}],backgroundImage=[{name:"background-image",type:t.urls},{name:"background-image-crossorigin",type:t.bgCrossOrigin},{name:"background-image-opacity",type:t.zeroOneNumbers},{name:"background-image-containment",type:t.bgContainment},{name:"background-image-smoothing",type:t.bools},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-width-relative-to",type:t.bgRelativeTo},{name:"background-height-relative-to",type:t.bgRelativeTo},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"background-offset-x",type:t.bgPos},{name:"background-offset-y",type:t.bgPos}],compound=[{name:"position",type:t.position,triggersBounds:diff.any},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels,triggersBounds:diff.any},{name:"min-width",type:t.size,triggersBounds:diff.any},{name:"min-width-bias-left",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-width-bias-right",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height",type:t.size,triggersBounds:diff.any},{name:"min-height-bias-top",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height-bias-bottom",type:t.sizeMaybePercent,triggersBounds:diff.any}],edgeLine=[{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"line-fill",type:t.fill},{name:"line-cap",type:t.lineCap},{name:"line-opacity",type:t.zeroOneNumber},{name:"line-dash-pattern",type:t.numbers},{name:"line-dash-offset",type:t.number},{name:"line-outline-width",type:t.size},{name:"line-outline-color",type:t.color},{name:"line-gradient-stop-colors",type:t.colors},{name:"line-gradient-stop-positions",type:t.percentages},{name:"curve-style",type:t.curveStyle,triggersBounds:diff.any,triggersBoundsOfParallelEdges:function triggersBoundsOfParallelEdges(fromValue,toValue){return fromValue!==toValue&&("bezier"===fromValue||"bezier"===toValue)}},{name:"haystack-radius",type:t.zeroOneNumber,triggersBounds:diff.any},{name:"source-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"target-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"control-point-step-size",type:t.size,triggersBounds:diff.any},{name:"control-point-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"control-point-weights",type:t.numbers,triggersBounds:diff.any},{name:"segment-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"segment-weights",type:t.numbers,triggersBounds:diff.any},{name:"segment-radii",type:t.numbers,triggersBounds:diff.any},{name:"radius-type",type:t.radiusType,triggersBounds:diff.any},{name:"taxi-turn",type:t.bidirectionalSizeMaybePercent,triggersBounds:diff.any},{name:"taxi-turn-min-distance",type:t.size,triggersBounds:diff.any},{name:"taxi-direction",type:t.axisDirection,triggersBounds:diff.any},{name:"taxi-radius",type:t.number,triggersBounds:diff.any},{name:"edge-distances",type:t.edgeDistances,triggersBounds:diff.any},{name:"arrow-scale",type:t.positiveNumber,triggersBounds:diff.any},{name:"loop-direction",type:t.angle,triggersBounds:diff.any},{name:"loop-sweep",type:t.angle,triggersBounds:diff.any},{name:"source-distance-from-node",type:t.size,triggersBounds:diff.any},{name:"target-distance-from-node",type:t.size,triggersBounds:diff.any}],ghost=[{name:"ghost",type:t.bool,triggersBounds:diff.any},{name:"ghost-offset-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-offset-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-opacity",type:t.zeroOneNumber}],core=[{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}],pie=[];styfn$2.pieBackgroundN=16,pie.push({name:"pie-size",type:t.sizeMaybePercent}),pie.push({name:"pie-hole",type:t.sizeMaybePercent}),pie.push({name:"pie-start-angle",type:t.angle});for(var i=1;i<=styfn$2.pieBackgroundN;i++)pie.push({name:"pie-"+i+"-background-color",type:t.color}),pie.push({name:"pie-"+i+"-background-size",type:t.percent}),pie.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber});var stripe=[];styfn$2.stripeBackgroundN=16,stripe.push({name:"stripe-size",type:t.sizeMaybePercent}),stripe.push({name:"stripe-direction",type:t.axisDirectionPrimary});for(var _i=1;_i<=styfn$2.stripeBackgroundN;_i++)stripe.push({name:"stripe-"+_i+"-background-color",type:t.color}),stripe.push({name:"stripe-"+_i+"-background-size",type:t.percent}),stripe.push({name:"stripe-"+_i+"-background-opacity",type:t.zeroOneNumber});var edgeArrow=[],arrowPrefixes=styfn$2.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:t.arrowShape,triggersBounds:diff.any},{name:"arrow-color",type:t.color},{name:"arrow-fill",type:t.arrowFill},{name:"arrow-width",type:t.arrowWidth}].forEach(function(prop){arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name,type=prop.type,triggersBounds=prop.triggersBounds;edgeArrow.push({name,type,triggersBounds})})},{});var props=styfn$2.properties=[].concat(behavior,transition,visibility,overlay,underlay,ghost,commonLabel,labelDimensions,mainLabel,sourceLabel,targetLabel,nodeBody,nodeBorder,nodeOutline,backgroundImage,pie,stripe,compound,edgeLine,edgeArrow,core),propGroups=styfn$2.propertyGroups={behavior,transition,visibility,overlay,underlay,ghost,commonLabel,labelDimensions,mainLabel,sourceLabel,targetLabel,nodeBody,nodeBorder,nodeOutline,backgroundImage,pie,stripe,compound,edgeLine,edgeArrow,core},propGroupNames=styfn$2.propertyGroupNames={};(styfn$2.propertyGroupKeys=Object.keys(propGroups)).forEach(function(key){propGroupNames[key]=propGroups[key].map(function(prop){return prop.name}),propGroups[key].forEach(function(prop){return prop.groupKey=key})});var aliases=styfn$2.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];styfn$2.propertyNames=props.map(function(p){return p.name});for(var _i2=0;_i2<props.length;_i2++){var prop=props[_i2];props[prop.name]=prop}for(var _i3=0;_i3<aliases.length;_i3++){var alias=aliases[_i3],pointsToProp=props[alias.pointsTo],aliasProp={name:alias.name,alias:!0,pointsTo:pointsToProp};props.push(aliasProp),props[alias.name]=aliasProp}}(),styfn$2.getDefaultProperty=function(name){return this.getDefaultProperties()[name]},styfn$2.getDefaultProperties=function(){var _p=this._private;if(null!=_p.defaultProperties)return _p.defaultProperties;for(var rawProps=extend({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(css,prop){for(var i=1;i<=styfn$2.pieBackgroundN;i++){var name=prop.name.replace("{{i}}",i),val=prop.value;css[name]=val}return css},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(css,prop){for(var i=1;i<=styfn$2.stripeBackgroundN;i++){var name=prop.name.replace("{{i}}",i),val=prop.value;css[name]=val}return css},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(css,prop){return styfn$2.arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name,val=prop.value;css[name]=val}),css},{})),parsedProps={},i=0;i<this.properties.length;i++){var prop=this.properties[i];if(!prop.pointsTo){var name=prop.name,val=rawProps[name],parsedProp=this.parse(name,val);parsedProps[name]=parsedProp}}return _p.defaultProperties=parsedProps,_p.defaultProperties},styfn$2.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var styfn$1={parse:function(name,value,propIsBypass,propIsFlat){if(fn$6(value))return this.parseImplWarn(name,value,propIsBypass,propIsFlat);var ret,argHash=hashStrings(name,""+value,propIsBypass?"t":"f","mapping"===propIsFlat||!0===propIsFlat||!1===propIsFlat||null==propIsFlat?"dontcare":propIsFlat),propCache=this.propCache=this.propCache||[];return(ret=propCache[argHash])||(ret=propCache[argHash]=this.parseImplWarn(name,value,propIsBypass,propIsFlat)),(propIsBypass||"mapping"===propIsFlat)&&(ret=copy(ret))&&(ret.value=copy(ret.value)),ret},parseImplWarn:function(name,value,propIsBypass,propIsFlat){var prop=this.parseImpl(name,value,propIsBypass,propIsFlat);return prop||null==value||warn("The style property `".concat(name,": ").concat(value,"` is invalid")),!prop||"width"!==prop.name&&"height"!==prop.name||"label"!==value||warn("The style value of `label` is deprecated for `"+prop.name+"`"),prop}};styfn$1.parseImpl=function(name,value,propIsBypass,propIsFlat){name=camel2dash(name);var property=this.properties[name],passedValue=value,types=this.types;if(!property)return null;if(void 0===value)return null;property.alias&&(property=property.pointsTo,name=property.name);var valueIsString=string(value);valueIsString&&(value=value.trim());var data,mapData,type=property.type;if(!type)return null;if(propIsBypass&&(""===value||null===value))return{name,value,bypass:!0,deleteBypass:!0};if(fn$6(value))return{name,value,strValue:"fn",mapped:types.fn,bypass:propIsBypass};if(!valueIsString||propIsFlat||value.length<7||"a"!==value[1]);else{if(value.length>=7&&"d"===value[0]&&(data=new RegExp(types.data.regex).exec(value))){if(propIsBypass)return!1;var mapped=types.data;return{name,value:data,strValue:""+value,mapped,field:data[1],bypass:propIsBypass}}if(value.length>=10&&"m"===value[0]&&(mapData=new RegExp(types.mapData.regex).exec(value))){if(propIsBypass)return!1;if(type.multiple)return!1;var _mapped=types.mapData;if(!type.color&&!type.number)return!1;var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped)return!1;var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped)return!1;if(valueMin.pfValue===valueMax.pfValue||valueMin.strValue===valueMax.strValue)return warn("`"+name+": "+value+"` is not a valid mapper because the output range is zero; converting to `"+name+": "+valueMin.strValue+"`"),this.parse(name,valueMin.strValue);if(type.color){var c1=valueMin.value,c2=valueMax.value;if(!(c1[0]!==c2[0]||c1[1]!==c2[1]||c1[2]!==c2[2]||c1[3]!==c2[3]&&(null!=c1[3]&&1!==c1[3]||null!=c2[3]&&1!==c2[3])))return!1}return{name,value:mapData,strValue:""+value,mapped:_mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass}}}if(type.multiple&&"multiple"!==propIsFlat){var vals;if(vals=valueIsString?value.split(/\s+/):array(value)?value:[value],type.evenMultiple&&vals.length%2!=0)return null;for(var valArr=[],unitsArr=[],pfValArr=[],strVal="",hasEnum=!1,i=0;i<vals.length;i++){var p=this.parse(name,vals[i],propIsBypass,"multiple");hasEnum=hasEnum||string(p.value),valArr.push(p.value),pfValArr.push(null!=p.pfValue?p.pfValue:p.value),unitsArr.push(p.units),strVal+=(i>0?" ":"")+p.strValue}return type.validate&&!type.validate(valArr,unitsArr)?null:type.singleEnum&&hasEnum?1===valArr.length&&string(valArr[0])?{name,value:valArr[0],strValue:valArr[0],bypass:propIsBypass}:null:{name,value:valArr,pfValue:pfValArr,strValue:strVal,bypass:propIsBypass,units:unitsArr}}var checkEnums=function checkEnums(){for(var _i=0;_i<type.enums.length;_i++){if(type.enums[_i]===value)return{name,value,strValue:""+value,bypass:propIsBypass}}return null};if(type.number){var units,implicitUnits="px";if(type.units&&(units=type.units),type.implicitUnits&&(implicitUnits=type.implicitUnits),!type.unitless)if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");units&&(unitsRegex=units);var match=value.match("^("+number+")("+unitsRegex+")?$");match&&(value=match[1],units=match[2]||implicitUnits)}else units&&!type.implicitUnits||(units=implicitUnits);if(value=parseFloat(value),isNaN(value)&&void 0===type.enums)return null;if(isNaN(value)&&void 0!==type.enums)return value=passedValue,checkEnums();if(type.integer&&!function integer(obj){return number$1(obj)&&Math.floor(obj)===obj}(value))return null;if(void 0!==type.min&&(value<type.min||type.strictMin&&value===type.min)||void 0!==type.max&&(value>type.max||type.strictMax&&value===type.max))return null;var ret={name,value,strValue:""+value+(units||""),units,bypass:propIsBypass};return type.unitless||"px"!==units&&"em"!==units?ret.pfValue=value:ret.pfValue="px"!==units&&units?this.getEmSizeInPixels()*value:value,"ms"!==units&&"s"!==units||(ret.pfValue="ms"===units?value:1e3*value),"deg"!==units&&"rad"!==units||(ret.pfValue="rad"===units?value:function deg2rad(deg){return Math.PI*deg/180}(value)),"%"===units&&(ret.pfValue=value/100),ret}if(type.propList){var props=[],propsStr=""+value;if("none"===propsStr);else{for(var propsSplit=propsStr.split(/\s*,\s*|\s+/),_i2=0;_i2<propsSplit.length;_i2++){var propName=propsSplit[_i2].trim();this.properties[propName]?props.push(propName):warn("`"+propName+"` is not a valid property name")}if(0===props.length)return null}return{name,value:props,strValue:0===props.length?"none":props.join(" "),bypass:propIsBypass}}if(type.color){var tuple=color2tuple(value);return tuple?{name,value:tuple,pfValue:tuple,strValue:"rgb("+tuple[0]+","+tuple[1]+","+tuple[2]+")",bypass:propIsBypass}:null}if(type.regex||type.regexes){if(type.enums){var enumProp=checkEnums();if(enumProp)return enumProp}for(var regexes=type.regexes?type.regexes:[type.regex],_i3=0;_i3<regexes.length;_i3++){var m=new RegExp(regexes[_i3]).exec(value);if(m)return{name,value:type.singleRegexMatchValue?m[1]:m,strValue:""+value,bypass:propIsBypass}}return null}return type.string?{name,value:""+value,strValue:""+value,bypass:propIsBypass}:type.enums?checkEnums():null};var _Style=function Style(cy){if(!(this instanceof _Style))return new _Style(cy);core(cy)?(this._private={cy,coreStyle:{}},this.length=0,this.resetToDefault()):error("A style must have a core reference")},styfn=_Style.prototype;styfn.instanceString=function(){return"style"},styfn.clear=function(){for(var _p=this._private,eles=_p.cy.elements(),i=0;i<this.length;i++)this[i]=void 0;return this.length=0,_p.contextStyles={},_p.propDiffs={},this.cleanElements(eles,!0),eles.forEach(function(ele){var ele_p=ele[0]._private;ele_p.styleDirty=!0,ele_p.appliedInitStyle=!1}),this},styfn.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},styfn.core=function(propName){return this._private.coreStyle[propName]||this.getDefaultProperty(propName)},styfn.selector=function(selectorStr){var selector="core"===selectorStr?null:new Selector(selectorStr),i=this.length++;return this[i]={selector,properties:[],mappedProperties:[],index:i},this},styfn.css=function(){var args=arguments;if(1===args.length)for(var map=args[0],i=0;i<this.properties.length;i++){var prop=this.properties[i],mapVal=map[prop.name];void 0===mapVal&&(mapVal=map[dash2camel(prop.name)]),void 0!==mapVal&&this.cssRule(prop.name,mapVal)}else 2===args.length&&this.cssRule(args[0],args[1]);return this},styfn.style=styfn.css,styfn.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property),this[i].properties[property.name]=property,property.name.match(/pie-(\d+)-background-size/)&&property.value&&(this._private.hasPie=!0),property.name.match(/stripe-(\d+)-background-size/)&&property.value&&(this._private.hasStripe=!0),property.mapped&&this[i].mappedProperties.push(property),!this[i].selector&&(this._private.coreStyle[property.name]=property)}return this},styfn.append=function(style){return stylesheet(style)?style.appendToStyle(this):array(style)?this.appendFromJson(style):string(style)&&this.appendFromString(style),this},_Style.fromJson=function(cy,json){var style=new _Style(cy);return style.fromJson(json),style},_Style.fromString=function(cy,string){return new _Style(cy).fromString(string)},[styfn$8,styfn$7,styfn$6,styfn$5,styfn$4,styfn$3,styfn$2,styfn$1].forEach(function(props){extend(styfn,props)}),_Style.types=styfn.types,_Style.properties=styfn.properties,_Style.propertyGroups=styfn.propertyGroups,_Style.propertyGroupNames=styfn.propertyGroupNames,_Style.propertyGroupKeys=styfn.propertyGroupKeys;var corefn$2={style:function style(newStyle){newStyle&&this.setStyle(newStyle).update();return this._private.style},setStyle:function setStyle(style){var _p=this._private;return stylesheet(style)?_p.style=style.generateStyle(this):array(style)?_p.style=_Style.fromJson(this,style):string(style)?_p.style=_Style.fromString(this,style):_p.style=_Style(this),_p.style},updateStyle:function updateStyle(){this.mutableElements().updateStyle()}},corefn$1={autolock:function autolock(bool){return void 0===bool?this._private.autolock:(this._private.autolock=!!bool,this)},autoungrabify:function autoungrabify(bool){return void 0===bool?this._private.autoungrabify:(this._private.autoungrabify=!!bool,this)},autounselectify:function autounselectify(bool){return void 0===bool?this._private.autounselectify:(this._private.autounselectify=!!bool,this)},selectionType:function selectionType(selType){var _p=this._private;return null==_p.selectionType&&(_p.selectionType="single"),void 0===selType?_p.selectionType:("additive"!==selType&&"single"!==selType||(_p.selectionType=selType),this)},panningEnabled:function panningEnabled(bool){return void 0===bool?this._private.panningEnabled:(this._private.panningEnabled=!!bool,this)},userPanningEnabled:function userPanningEnabled(bool){return void 0===bool?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!bool,this)},zoomingEnabled:function zoomingEnabled(bool){return void 0===bool?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!bool,this)},userZoomingEnabled:function userZoomingEnabled(bool){return void 0===bool?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!bool,this)},boxSelectionEnabled:function boxSelectionEnabled(bool){return void 0===bool?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!bool,this)},pan:function pan(){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;switch(args.length){case 0:return pan;case 1:if(string(args[0]))return pan[dim=args[0]];if(plainObject(args[0])){if(!this._private.panningEnabled)return this;x=(dims=args[0]).x,y=dims.y,number$1(x)&&(pan.x=x),number$1(y)&&(pan.y=y),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;val=args[1],"x"!==(dim=args[0])&&"y"!==dim||!number$1(val)||(pan[dim]=val),this.emit("pan viewport")}return this.notify("viewport"),this},panBy:function panBy(arg0,arg1){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;if(!this._private.panningEnabled)return this;switch(args.length){case 1:plainObject(arg0)&&(x=(dims=args[0]).x,y=dims.y,number$1(x)&&(pan.x+=x),number$1(y)&&(pan.y+=y),this.emit("pan viewport"));break;case 2:val=arg1,"x"!==(dim=arg0)&&"y"!==dim||!number$1(val)||(pan[dim]+=val),this.emit("pan viewport")}return this.notify("viewport"),this},gc:function gc(){this.notify("gc")},fit:function fit(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom,_p.pan=viewportState.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function getFitViewport(elements,padding){if(number$1(elements)&&void 0===padding&&(padding=elements,elements=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){var bb;if(string(elements)){var sel=elements;elements=this.$(sel)}else if(function boundingBox(obj){return plainObject(obj)&&number$1(obj.x1)&&number$1(obj.x2)&&number$1(obj.y1)&&number$1(obj.y2)}(elements)){var bbe=elements;(bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2}).w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}else elementOrCollection(elements)||(elements=this.mutableElements());if(!elementOrCollection(elements)||!elements.empty()){bb=bb||elements.boundingBox();var zoom,w=this.width(),h=this.height();if(padding=number$1(padding)?padding:0,!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0)return{zoom:zoom=(zoom=(zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h))>this._private.maxZoom?this._private.maxZoom:zoom)<this._private.minZoom?this._private.minZoom:zoom,pan:{x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2}}}}},zoomRange:function zoomRange(min,max){var _p=this._private;if(null==max){var opts=min;min=opts.min,max=opts.max}return number$1(min)&&number$1(max)&&min<=max?(_p.minZoom=min,_p.maxZoom=max):number$1(min)&&void 0===max&&min<=_p.maxZoom?_p.minZoom=min:number$1(max)&&void 0===min&&max>=_p.minZoom&&(_p.maxZoom=max),this},minZoom:function minZoom(zoom){return void 0===zoom?this._private.minZoom:this.zoomRange({min:zoom})},maxZoom:function maxZoom(zoom){return void 0===zoom?this._private.maxZoom:this.zoomRange({max:zoom})},getZoomedViewport:function getZoomedViewport(params){var pos,zoom,_p=this._private,currentPan=_p.pan,currentZoom=_p.zoom,bail=!1;if(_p.zoomingEnabled||(bail=!0),number$1(params)?zoom=params:plainObject(params)&&(zoom=params.level,null!=params.position?pos=modelToRenderedPosition$1(params.position,currentZoom,currentPan):null!=params.renderedPosition&&(pos=params.renderedPosition),null==pos||_p.panningEnabled||(bail=!0)),zoom=(zoom=zoom>_p.maxZoom?_p.maxZoom:zoom)<_p.minZoom?_p.minZoom:zoom,bail||!number$1(zoom)||zoom===currentZoom||null!=pos&&(!number$1(pos.x)||!number$1(pos.y)))return null;if(null!=pos){var pan1=currentPan,zoom1=currentZoom,zoom2=zoom;return{zoomed:!0,panned:!0,zoom:zoom2,pan:{x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y}}}return{zoomed:!0,panned:!1,zoom,pan:currentPan}},zoom:function zoom(params){if(void 0===params)return this._private.zoom;var vp=this.getZoomedViewport(params),_p=this._private;return null!=vp&&vp.zoomed?(_p.zoom=vp.zoom,vp.panned&&(_p.pan.x=vp.pan.x,_p.pan.y=vp.pan.y),this.emit("zoom"+(vp.panned?" pan":"")+" viewport"),this.notify("viewport"),this):this},viewport:function viewport(opts){var _p=this._private,zoomDefd=!0,panDefd=!0,events=[],zoomFailed=!1,panFailed=!1;if(!opts)return this;if(number$1(opts.zoom)||(zoomDefd=!1),plainObject(opts.pan)||(panDefd=!1),!zoomDefd&&!panDefd)return this;if(zoomDefd){var z=opts.zoom;z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled?zoomFailed=!0:(_p.zoom=z,events.push("zoom"))}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;number$1(p.x)&&(_p.pan.x=p.x,panFailed=!1),number$1(p.y)&&(_p.pan.y=p.y,panFailed=!1),panFailed||events.push("pan")}return events.length>0&&(events.push("viewport"),this.emit(events.join(" ")),this.notify("viewport")),this},center:function center(elements){var pan=this.getCenterPan(elements);return pan&&(this._private.pan=pan,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function getCenterPan(elements,zoom){if(this._private.panningEnabled){if(string(elements)){var selector=elements;elements=this.mutableElements().filter(selector)}else elementOrCollection(elements)||(elements=this.mutableElements());if(0!==elements.length){var bb=elements.boundingBox(),w=this.width(),h=this.height();return{x:(w-(zoom=void 0===zoom?this._private.zoom:zoom)*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2}}}},reset:function reset(){return this._private.panningEnabled&&this._private.zoomingEnabled?(this.viewport({pan:{x:0,y:0},zoom:1}),this):this},invalidateSize:function invalidateSize(){this._private.sizeCache=null},size:function size(){var style,val,_p=this._private,container=_p.container,cy=this;return _p.sizeCache=_p.sizeCache||(container?(style=cy.window().getComputedStyle(container),val=function val(name){return parseFloat(style.getPropertyValue(name))},{width:container.clientWidth-val("padding-left")-val("padding-right"),height:container.clientHeight-val("padding-top")-val("padding-bottom")}):{width:1,height:1})},width:function width(){return this.size().width},height:function height(){return this.size().height},extent:function extent(){var pan=this._private.pan,zoom=this._private.zoom,rb=this.renderedExtent(),b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};return b.w=b.x2-b.x1,b.h=b.y2-b.y1,b},renderedExtent:function renderedExtent(){var width=this.width(),height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}},multiClickDebounceTime:function multiClickDebounceTime(_int){return _int?(this._private.multiClickDebounceTime=_int,this):this._private.multiClickDebounceTime}};corefn$1.centre=corefn$1.center,corefn$1.autolockNodes=corefn$1.autolock,corefn$1.autoungrabifyNodes=corefn$1.autoungrabify;var fn={data:define.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};fn.attr=fn.data,fn.removeAttr=fn.removeData;var Core=function Core(opts){var cy=this,container=(opts=extend({},opts)).container;container&&!htmlElement(container)&&htmlElement(container[0])&&(container=container[0]);var reg=container?container._cyreg:null;(reg=reg||{})&&reg.cy&&(reg.cy.destroy(),reg={});var readies=reg.readies=reg.readies||[];container&&(container._cyreg=reg),reg.cy=cy;var head=void 0!==_window&&void 0!==container&&!opts.headless,options=opts;options.layout=extend({name:head?"grid":"null"},options.layout),options.renderer=extend({name:head?"canvas":"null"},options.renderer);var defVal=function defVal(def,val,altVal){return void 0!==val?val:void 0!==altVal?altVal:def},_p=this._private={container,ready:!1,options,elements:new Collection(this),listeners:[],aniEles:new Collection(this),data:options.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(!0,options.zoomingEnabled),userZoomingEnabled:defVal(!0,options.userZoomingEnabled),panningEnabled:defVal(!0,options.panningEnabled),userPanningEnabled:defVal(!0,options.userPanningEnabled),boxSelectionEnabled:defVal(!0,options.boxSelectionEnabled),autolock:defVal(!1,options.autolock,options.autolockNodes),autoungrabify:defVal(!1,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(!1,options.autounselectify),styleEnabled:void 0===options.styleEnabled?head:options.styleEnabled,zoom:number$1(options.zoom)?options.zoom:1,pan:{x:plainObject(options.pan)&&number$1(options.pan.x)?options.pan.x:0,y:plainObject(options.pan)&&number$1(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:defVal(250,options.multiClickDebounceTime)};this.createEmitter(),this.selectionType(options.selectionType),this.zoomRange({min:options.minZoom,max:options.maxZoom});_p.styleEnabled&&cy.setStyle([]);var rendererOptions=extend({},options,options.renderer);cy.initRenderer(rendererOptions);!function loadExtData(extData,next){if(extData.some(promise))return Promise$1.all(extData).then(next);next(extData)}([options.style,options.elements],function(thens){var initStyle=thens[0],initEles=thens[1];_p.styleEnabled&&cy.style().append(initStyle),function setElesAndLayout(elements,onload,ondone){cy.notifications(!1);var oldEles=cy.mutableElements();oldEles.length>0&&oldEles.remove(),null!=elements&&(plainObject(elements)||array(elements))&&cy.add(elements),cy.one("layoutready",function(e){cy.notifications(!0),cy.emit(e),cy.one("load",onload),cy.emitAndNotify("load")}).one("layoutstop",function(){cy.one("done",ondone),cy.emit("done")});var layoutOpts=extend({},cy._private.options.layout);layoutOpts.eles=cy.elements(),cy.layout(layoutOpts).run()}(initEles,function(){cy.startAnimationLoop(),_p.ready=!0,fn$6(options.ready)&&cy.on("ready",options.ready);for(var i=0;i<readies.length;i++){var fn=readies[i];cy.on("ready",fn)}reg&&(reg.readies=[]),cy.emit("ready")},options.done)})},corefn=Core.prototype;extend(corefn,{instanceString:function instanceString(){return"core"},isReady:function isReady(){return this._private.ready},destroyed:function destroyed(){return this._private.destroyed},ready:function ready(fn){return this.isReady()?this.emitter().emit("ready",[],fn):this.on("ready",fn),this},destroy:function destroy(){var cy=this;if(!cy.destroyed())return cy.stopAnimationLoop(),cy.destroyRenderer(),this.emit("destroy"),cy._private.destroyed=!0,cy},hasElementWithId:function hasElementWithId(id){return this._private.elements.hasElementWithId(id)},getElementById:function getElementById(id){return this._private.elements.getElementById(id)},hasCompoundNodes:function hasCompoundNodes(){return this._private.hasCompoundNodes},headless:function headless(){return this._private.renderer.isHeadless()},styleEnabled:function styleEnabled(){return this._private.styleEnabled},addToPool:function addToPool(eles){return this._private.elements.merge(eles),this},removeFromPool:function removeFromPool(eles){return this._private.elements.unmerge(eles),this},container:function container(){return this._private.container||null},window:function window(){if(null==this._private.container)return _window;var ownerDocument=this._private.container.ownerDocument;return void 0===ownerDocument||null==ownerDocument?_window:ownerDocument.defaultView||_window},mount:function mount(container){if(null!=container){var cy=this,_p=cy._private,options=_p.options;return!htmlElement(container)&&htmlElement(container[0])&&(container=container[0]),cy.stopAnimationLoop(),cy.destroyRenderer(),_p.container=container,_p.styleEnabled=!0,cy.invalidateSize(),cy.initRenderer(extend({},options,options.renderer,{name:"null"===options.renderer.name?"canvas":options.renderer.name})),cy.startAnimationLoop(),cy.style(options.style),cy.emit("mount"),cy}},unmount:function unmount(){var cy=this;return cy.stopAnimationLoop(),cy.destroyRenderer(),cy.initRenderer({name:"null"}),cy.emit("unmount"),cy},options:function options(){return copy(this._private.options)},json:function json(obj){var cy=this,_p=cy._private,eles=cy.mutableElements();if(plainObject(obj)){if(cy.startBatch(),obj.elements){var idInJson={},updateEles=function updateEles(jsons,gr){for(var toAdd=[],toMod=[],i=0;i<jsons.length;i++){var json=jsons[i];if(json.data.id){var id=""+json.data.id,ele=cy.getElementById(id);idInJson[id]=!0,0!==ele.length?toMod.push({ele,json}):gr?(json.group=gr,toAdd.push(json)):toAdd.push(json)}else warn("cy.json() cannot handle elements without an ID attribute")}cy.add(toAdd);for(var _i=0;_i<toMod.length;_i++){var _toMod$_i=toMod[_i],_ele=_toMod$_i.ele,_json=_toMod$_i.json;_ele.json(_json)}};if(array(obj.elements))updateEles(obj.elements);else for(var grs=["nodes","edges"],i=0;i<grs.length;i++){var gr=grs[i],elements=obj.elements[gr];array(elements)&&updateEles(elements,gr)}var parentsToRemove=cy.collection();eles.filter(function(ele){return!idInJson[ele.id()]}).forEach(function(ele){ele.isParent()?parentsToRemove.merge(ele):ele.remove()}),parentsToRemove.forEach(function(ele){return ele.children().move({parent:null})}),parentsToRemove.forEach(function(ele){return function getFreshRef(ele){return cy.getElementById(ele.id())}(ele).remove()})}obj.style&&cy.style(obj.style),null!=obj.zoom&&obj.zoom!==_p.zoom&&cy.zoom(obj.zoom),obj.pan&&(obj.pan.x===_p.pan.x&&obj.pan.y===_p.pan.y||cy.pan(obj.pan)),obj.data&&cy.data(obj.data);for(var fields=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],_i2=0;_i2<fields.length;_i2++){var f=fields[_i2];null!=obj[f]&&cy[f](obj[f])}return cy.endBatch(),this}var json={};!!obj?json.elements=this.elements().map(function(ele){return ele.json()}):(json.elements={},eles.forEach(function(ele){var group=ele.group();json.elements[group]||(json.elements[group]=[]),json.elements[group].push(ele.json())})),this._private.styleEnabled&&(json.style=cy.style().json()),json.data=copy(cy.data());var options=_p.options;return json.zoomingEnabled=_p.zoomingEnabled,json.userZoomingEnabled=_p.userZoomingEnabled,json.zoom=_p.zoom,json.minZoom=_p.minZoom,json.maxZoom=_p.maxZoom,json.panningEnabled=_p.panningEnabled,json.userPanningEnabled=_p.userPanningEnabled,json.pan=copy(_p.pan),json.boxSelectionEnabled=_p.boxSelectionEnabled,json.renderer=copy(options.renderer),json.hideEdgesOnViewport=options.hideEdgesOnViewport,json.textureOnViewport=options.textureOnViewport,json.wheelSensitivity=options.wheelSensitivity,json.motionBlur=options.motionBlur,json.multiClickDebounceTime=options.multiClickDebounceTime,json}}),corefn.$id=corefn.getElementById,[corefn$9,corefn$8,elesfn,corefn$7,corefn$6,corefn$5,corefn$4,corefn$3,corefn$2,corefn$1,fn].forEach(function(props){extend(corefn,props)});var defaults$7={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}},deprecatedOptionDefaults={maximal:!1,acyclic:!1},getInfo=function getInfo(ele){return ele.scratch("breadthfirst")},setInfo=function setInfo(ele,obj){return ele.scratch("breadthfirst",obj)};function BreadthFirstLayout(options){this.options=extend({},defaults$7,deprecatedOptionDefaults,options)}BreadthFirstLayout.prototype.run=function(){var roots,options=this.options,cy=options.cy,eles=options.eles,nodes=eles.nodes().filter(function(n){return n.isChildless()}),graph=eles,directed=options.directed,maximal=options.acyclic||options.maximal||options.maximalAdjustments>0,hasBoundingBox=!!options.boundingBox,bb=makeBoundingBox(hasBoundingBox?options.boundingBox:structuredClone(cy.extent()));if(elementOrCollection(options.roots))roots=options.roots;else if(array(options.roots)){for(var rootsArray=[],i=0;i<options.roots.length;i++){var id=options.roots[i],ele=cy.getElementById(id);rootsArray.push(ele)}roots=cy.collection(rootsArray)}else if(string(options.roots))roots=cy.$(options.roots);else if(directed)roots=nodes.roots();else{var components=eles.components();roots=cy.collection();for(var _loop=function _loop(){var comp=components[_i],maxDegree=comp.maxDegree(!1),compRoots=comp.filter(function(ele){return ele.degree(!1)===maxDegree});roots=roots.add(compRoots)},_i=0;_i<components.length;_i++)_loop()}var depths=[],foundByBfs={},addToDepth=function addToDepth(ele,d){null==depths[d]&&(depths[d]=[]);var i=depths[d].length;depths[d].push(ele),setInfo(ele,{index:i,depth:d})};graph.bfs({roots,directed:options.directed,visit:function visit(node,edge,pNode,i,depth){var ele=node[0],id=ele.id();ele.isChildless()&&addToDepth(ele,depth),foundByBfs[id]=!0}});for(var orphanNodes=[],_i2=0;_i2<nodes.length;_i2++){var _ele=nodes[_i2];foundByBfs[_ele.id()]||orphanNodes.push(_ele)}var assignDepthsAt=function assignDepthsAt(i){for(var eles=depths[i],j=0;j<eles.length;j++){var _ele2=eles[j];null!=_ele2?setInfo(_ele2,{depth:i,index:j}):(eles.splice(j,1),j--)}},adjustMaximally=function adjustMaximally(ele,shifted){for(var eInfo=getInfo(ele),incomers=ele.incomers().filter(function(el){return el.isNode()&&eles.has(el)}),maxDepth=-1,id=ele.id(),k=0;k<incomers.length;k++){var incmr=incomers[k],iInfo=getInfo(incmr);maxDepth=Math.max(maxDepth,iInfo.depth)}if(eInfo.depth<=maxDepth){if(!options.acyclic&&shifted[id])return null;var newDepth=maxDepth+1;return function changeDepth(ele,newDepth){var _getInfo=getInfo(ele),depth=_getInfo.depth,index=_getInfo.index;depths[depth][index]=null,ele.isChildless()&&addToDepth(ele,newDepth)}(ele,newDepth),shifted[id]=newDepth,!0}return!1};if(directed&&maximal){var Q=[],shifted={},enqueue=function enqueue(n){return Q.push(n)},dequeue=function dequeue(){return Q.shift()};for(nodes.forEach(function(n){return Q.push(n)});Q.length>0;){var _ele3=dequeue(),didShift=adjustMaximally(_ele3,shifted);if(didShift)_ele3.outgoers().filter(function(el){return el.isNode()&&eles.has(el)}).forEach(enqueue);else if(null===didShift){warn("Detected double maximal shift for node `"+_ele3.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var minDistance=0;if(options.avoidOverlap)for(var _i3=0;_i3<nodes.length;_i3++){var nbb=nodes[_i3].layoutDimensions(options),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}var cachedWeightedPercent={},getWeightedPercent=function getWeightedPercent(ele){if(cachedWeightedPercent[ele.id()])return cachedWeightedPercent[ele.id()];for(var eleDepth=getInfo(ele).depth,neighbors=ele.neighborhood(),percent=0,samples=0,_i4=0;_i4<neighbors.length;_i4++){var neighbor=neighbors[_i4];if(!neighbor.isEdge()&&!neighbor.isParent()&&nodes.has(neighbor)){var bf=getInfo(neighbor);if(null!=bf){var index=bf.index,depth=bf.depth;if(null!=index&&null!=depth){var nDepth=depths[depth].length;depth<eleDepth&&(percent+=index/nDepth,samples++)}}}}return percent/=samples=Math.max(1,samples),0===samples&&(percent=0),cachedWeightedPercent[ele.id()]=percent,percent},sortFn=function sortFn(a,b){var diff=getWeightedPercent(a)-getWeightedPercent(b);return 0===diff?ascending(a.id(),b.id()):diff};void 0!==options.depthSort&&(sortFn=options.depthSort);for(var depthsLen=depths.length,_i5=0;_i5<depthsLen;_i5++)depths[_i5].sort(sortFn),assignDepthsAt(_i5);for(var orphanDepth=[],_i6=0;_i6<orphanNodes.length;_i6++)orphanDepth.push(orphanNodes[_i6]);orphanDepth.length&&(depths.unshift(orphanDepth),depthsLen=depths.length,function assignDepths(){for(var _i7=0;_i7<depthsLen;_i7++)assignDepthsAt(_i7)}());for(var biggestDepthSize=0,_i8=0;_i8<depthsLen;_i8++)biggestDepthSize=Math.max(depths[_i8].length,biggestDepthSize);var center_x=bb.x1+bb.w/2,center_y=bb.y1+bb.h/2,aveNodeSize=nodes.reduce(function(acc,node){return box=node.boundingBox({includeLabels:options.nodeDimensionsIncludeLabels}),{w:-1===acc.w?box.w:(acc.w+box.w)/2,h:-1===acc.h?box.h:(acc.h+box.h)/2};var box},{w:-1,h:-1}),distanceY=Math.max(1===depthsLen?0:hasBoundingBox?(bb.h-2*options.padding-aveNodeSize.h)/(depthsLen-1):(bb.h-2*options.padding-aveNodeSize.h)/(depthsLen+1),minDistance),maxDepthSize=depths.reduce(function(max,eles){return Math.max(max,eles.length)},0),rotateDegrees={downward:0,leftward:90,upward:180,rightward:-90};-1===Object.keys(rotateDegrees).indexOf(options.direction)&&error("Invalid direction '".concat(options.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(rotateDegrees).join(", ")));return eles.nodes().layoutPositions(this,options,function getPosition(ele){return rotatePosAndSkewByBox(function getPositionTopBottom(ele){var _getInfo2=getInfo(ele),depth=_getInfo2.depth,index=_getInfo2.index;if(options.circle){var radiusStepSize=Math.min(bb.w/2/depthsLen,bb.h/2/depthsLen),radius=(radiusStepSize=Math.max(radiusStepSize,minDistance))*depth+radiusStepSize-(depthsLen>0&&depths[0].length<=3?radiusStepSize/2:0),theta=2*Math.PI/depths[depth].length*index;return 0===depth&&1===depths[0].length&&(radius=1),{x:center_x+radius*Math.cos(theta),y:center_y+radius*Math.sin(theta)}}var depthSize=depths[depth].length,distanceX=Math.max(1===depthSize?0:hasBoundingBox?(bb.w-2*options.padding-aveNodeSize.w)/((options.grid?maxDepthSize:depthSize)-1):(bb.w-2*options.padding-aveNodeSize.w)/((options.grid?maxDepthSize:depthSize)+1),minDistance);return{x:center_x+(index+1-(depthSize+1)/2)*distanceX,y:center_y+(depth+1-(depthsLen+1)/2)*distanceY}}(ele),bb,rotateDegrees[options.direction])}),this};var defaults$6={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function CircleLayout(options){this.options=extend({},defaults$6,options)}CircleLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));for(var r,bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center_x=bb.x1+bb.w/2,center_y=bb.y1+bb.h/2,dTheta=(void 0===options.sweep?2*Math.PI-2*Math.PI/nodes.length:options.sweep)/Math.max(1,nodes.length-1),minDistance=0,i=0;i<nodes.length;i++){var nbb=nodes[i].layoutDimensions(options),w=nbb.w,h=nbb.h;minDistance=Math.max(minDistance,w,h)}if(r=number$1(options.radius)?options.radius:nodes.length<=1?0:Math.min(bb.h,bb.w)/2-minDistance,nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}return eles.nodes().layoutPositions(this,options,function getPos(ele,i){var theta=options.startAngle+i*dTheta*(clockwise?1:-1),rx=r*Math.cos(theta),ry=r*Math.sin(theta);return{x:center_x+rx,y:center_y+ry}}),this};var DEBUG,defaults$5={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function concentric(node){return node.degree()},levelWidth:function levelWidth(nodes){return nodes.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function ConcentricLayout(options){this.options=extend({},defaults$5,options)}ConcentricLayout.prototype.run=function(){for(var params=this.options,options=params,clockwise=void 0!==options.counterclockwise?!options.counterclockwise:options.clockwise,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center_x=bb.x1+bb.w/2,center_y=bb.y1+bb.h/2,nodeValues=[],maxNodeSize=0,i=0;i<nodes.length;i++){var value,node=nodes[i];value=options.concentric(node),nodeValues.push({value,node}),node._private.scratch.concentric=value}nodes.updateStyle();for(var _i=0;_i<nodes.length;_i++){var nbb=nodes[_i].layoutDimensions(options);maxNodeSize=Math.max(maxNodeSize,nbb.w,nbb.h)}nodeValues.sort(function(a,b){return b.value-a.value});for(var levelWidth=options.levelWidth(nodes),levels=[[]],currentLevel=levels[0],_i2=0;_i2<nodeValues.length;_i2++){var val=nodeValues[_i2];if(currentLevel.length>0)Math.abs(currentLevel[0].value-val.value)>=levelWidth&&(currentLevel=[],levels.push(currentLevel));currentLevel.push(val)}var minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1,rStep=(Math.min(bb.w,bb.h)/2-minDist)/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}for(var r=0,_i3=0;_i3<levels.length;_i3++){var level=levels[_i3],sweep=void 0===options.sweep?2*Math.PI-2*Math.PI/level.length:options.sweep,dTheta=level.dTheta=sweep/Math.max(1,level.length-1);if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}level.r=r,r+=minDist}if(options.equidistant){for(var rDeltaMax=0,_r=0,_i4=0;_i4<levels.length;_i4++){var rDelta=levels[_i4].r-_r;rDeltaMax=Math.max(rDeltaMax,rDelta)}_r=0;for(var _i5=0;_i5<levels.length;_i5++){var _level2=levels[_i5];0===_i5&&(_r=_level2.r),_level2.r=_r,_r+=rDeltaMax}}for(var pos={},_i6=0;_i6<levels.length;_i6++)for(var _level3=levels[_i6],_dTheta=_level3.dTheta,_r2=_level3.r,j=0;j<_level3.length;j++){var _val=_level3[j],theta=options.startAngle+(clockwise?1:-1)*_dTheta*j,p={x:center_x+_r2*Math.cos(theta),y:center_y+_r2*Math.sin(theta)};pos[_val.node.id()]=p}return eles.nodes().layoutPositions(this,options,function(ele){var id=ele.id();return pos[id]}),this};var defaults$4={ready:function ready(){},stop:function stop(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function animateFilter(node,i){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function nodeRepulsion(node){return 2048},nodeOverlap:4,idealEdgeLength:function idealEdgeLength(edge){return 32},edgeElasticity:function edgeElasticity(edge){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function CoseLayout(options){this.options=extend({},defaults$4,options),this.options.layout=this;var nodes=this.options.eles.nodes(),notEdges=this.options.eles.edges().filter(function(e){var sourceId=e.source().data("id"),targetId=e.target().data("id"),hasSource=nodes.some(function(n){return n.data("id")===sourceId}),hasTarget=nodes.some(function(n){return n.data("id")===targetId});return!hasSource||!hasTarget});this.options.eles=this.options.eles.not(notEdges)}CoseLayout.prototype.run=function(){var options=this.options,cy=options.cy,layout=this;layout.stopped=!1,!0!==options.animate&&!1!==options.animate||layout.emit({type:"layoutstart",layout}),DEBUG=!0===options.debug;var layoutInfo=createLayoutInfo(cy,layout,options);DEBUG&&undefined(layoutInfo),options.randomize&&randomizePositions(layoutInfo);var startTime=performanceNow(),refresh=function refresh(){refreshPositions(layoutInfo,cy,options),!0===options.fit&&cy.fit(options.padding)},mainLoop=function mainLoop(i){return!(layout.stopped||i>=options.numIter)&&(step(layoutInfo,options),layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor,!(layoutInfo.temperature<options.minTemp))},done=function done(){if(!0===options.animate||!1===options.animate)refresh(),layout.one("layoutstop",options.stop),layout.emit({type:"layoutstop",layout});else{var nodes=options.eles.nodes(),getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.layoutPositions(layout,options,getScaledPos)}},i=0,loopRet=!0;if(!0===options.animate){var _frame=function frame(){for(var f=0;loopRet&&f<options.refresh;)loopRet=mainLoop(i),i++,f++;loopRet?(performanceNow()-startTime>=options.animationThreshold&&refresh(),requestAnimationFrame(_frame)):(separateComponents(layoutInfo,options),done())};_frame()}else{for(;loopRet;)loopRet=mainLoop(i),i++;separateComponents(layoutInfo,options),done()}return this},CoseLayout.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this},CoseLayout.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var createLayoutInfo=function createLayoutInfo(cy,layout,options){for(var edges=options.eles.edges(),nodes=options.eles.nodes(),bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),layoutInfo={isCompound:cy.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:bb.w,clientHeight:bb.h,boundingBox:bb},components=options.eles.components(),id2cmptId={},i=0;i<components.length;i++)for(var component=components[i],j=0;j<component.length;j++){id2cmptId[component[j].id()]=i}for(i=0;i<layoutInfo.nodeSize;i++){var nbb=(n=nodes[i]).layoutDimensions(options);(tempNode={}).isLocked=n.locked(),tempNode.id=n.data("id"),tempNode.parentId=n.data("parent"),tempNode.cmptId=id2cmptId[n.id()],tempNode.children=[],tempNode.positionX=n.position("x"),tempNode.positionY=n.position("y"),tempNode.offsetX=0,tempNode.offsetY=0,tempNode.height=nbb.w,tempNode.width=nbb.h,tempNode.maxX=tempNode.positionX+tempNode.width/2,tempNode.minX=tempNode.positionX-tempNode.width/2,tempNode.maxY=tempNode.positionY+tempNode.height/2,tempNode.minY=tempNode.positionY-tempNode.height/2,tempNode.padLeft=parseFloat(n.style("padding")),tempNode.padRight=parseFloat(n.style("padding")),tempNode.padTop=parseFloat(n.style("padding")),tempNode.padBottom=parseFloat(n.style("padding")),tempNode.nodeRepulsion=fn$6(options.nodeRepulsion)?options.nodeRepulsion(n):options.nodeRepulsion,layoutInfo.layoutNodes.push(tempNode),layoutInfo.idToIndex[tempNode.id]=i}var queue=[],start=0,end=-1,tempGraph=[];for(i=0;i<layoutInfo.nodeSize;i++){var n,p_id=(n=layoutInfo.layoutNodes[i]).parentId;null!=p_id?layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id):(queue[++end]=n.id,tempGraph.push(n.id))}for(layoutInfo.graphSet.push(tempGraph);start<=end;){var node_id=queue[start++],node_ix=layoutInfo.idToIndex[node_id],children=layoutInfo.layoutNodes[node_ix].children;if(children.length>0){layoutInfo.graphSet.push(children);for(i=0;i<children.length;i++)queue[++end]=children[i]}}for(i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];for(j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}}for(i=0;i<layoutInfo.edgeSize;i++){var e=edges[i],tempEdge={};tempEdge.id=e.data("id"),tempEdge.sourceId=e.data("source"),tempEdge.targetId=e.data("target");var idealLength=fn$6(options.idealEdgeLength)?options.idealEdgeLength(e):options.idealEdgeLength,elasticity=fn$6(options.edgeElasticity)?options.edgeElasticity(e):options.edgeElasticity,sourceIx=layoutInfo.idToIndex[tempEdge.sourceId],targetIx=layoutInfo.idToIndex[tempEdge.targetId];if(layoutInfo.indexToGraph[sourceIx]!=layoutInfo.indexToGraph[targetIx]){for(var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo),lcaGraph=layoutInfo.graphSet[lca],depth=0,tempNode=layoutInfo.layoutNodes[sourceIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;for(tempNode=layoutInfo.layoutNodes[targetIx];-1===lcaGraph.indexOf(tempNode.id);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength,tempEdge.elasticity=elasticity,layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo},findLCA=function findLCA(node1,node2,layoutInfo){var res=_findLCA_aux(node1,node2,0,layoutInfo);return 2>res.count?0:res.graph},_findLCA_aux=function findLCA_aux(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<graph.indexOf(node1)&&-1<graph.indexOf(node2))return{count:2,graph:graphIx};for(var c=0,i=0;i<graph.length;i++){var nodeId=graph[i],nodeIx=layoutInfo.idToIndex[nodeId],children=layoutInfo.layoutNodes[nodeIx].children;if(0!==children.length){var childGraphIx=layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]],result=_findLCA_aux(node1,node2,childGraphIx,layoutInfo);if(0!==result.count){if(1!==result.count)return result;if(2===++c)break}}}return{count:c,graph:graphIx}},randomizePositions=function randomizePositions(layoutInfo,cy){for(var width=layoutInfo.clientWidth,height=layoutInfo.clientHeight,i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0!==n.children.length||n.isLocked||(n.positionX=Math.random()*width,n.positionY=Math.random()*height)}},getScaleInBoundsFn=function getScaleInBoundsFn(layoutInfo,options,nodes){var bb=layoutInfo.boundingBox,coseBB={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return options.boundingBox&&(nodes.forEach(function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX),coseBB.x2=Math.max(coseBB.x2,lnode.positionX),coseBB.y1=Math.min(coseBB.y1,lnode.positionY),coseBB.y2=Math.max(coseBB.y2,lnode.positionY)}),coseBB.w=coseBB.x2-coseBB.x1,coseBB.h=coseBB.y2-coseBB.y1),function(ele,i){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=0===coseBB.w?.5:(lnode.positionX-coseBB.x1)/coseBB.w,pctY=0===coseBB.h?.5:(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}return{x:lnode.positionX,y:lnode.positionY}}},refreshPositions=function refreshPositions(layoutInfo,cy,options){var layout=options.layout,nodes=options.eles.nodes(),getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.positions(getScaledPos),!0!==layoutInfo.ready&&(layoutInfo.ready=!0,layout.one("layoutready",options.ready),layout.emit({type:"layoutready",layout:this}))},step=function step(layoutInfo,options,_step){calculateNodeForces(layoutInfo,options),calculateEdgeForces(layoutInfo),calculateGravityForces(layoutInfo,options),propagateForces(layoutInfo),updatePositions(layoutInfo)},calculateNodeForces=function calculateNodeForces(layoutInfo,options){for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],numNodes=graph.length,j=0;j<numNodes;j++)for(var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]],k=j+1;k<numNodes;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,options)}},randomDistance=function randomDistance(max){return 2*max*Math.random()-1},nodeRepulsion=function nodeRepulsion(node1,node2,layoutInfo,options){if(node1.cmptId===node2.cmptId||layoutInfo.isCompound){var directionX=node2.positionX-node1.positionX,directionY=node2.positionY-node1.positionY;0===directionX&&0===directionY&&(directionX=randomDistance(1),directionY=randomDistance(1));var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0)var forceX=(force=options.nodeOverlap*overlap)*directionX/(distance=Math.sqrt(directionX*directionX+directionY*directionY)),forceY=force*directionY/distance;else{var force,point1=findClippingPoint(node1,directionX,directionY),point2=findClippingPoint(node2,-1*directionX,-1*directionY),distanceX=point2.x-point1.x,distanceY=point2.y-point1.y,distanceSqr=distanceX*distanceX+distanceY*distanceY,distance=Math.sqrt(distanceSqr);forceX=(force=(node1.nodeRepulsion+node2.nodeRepulsion)/distanceSqr)*distanceX/distance,forceY=force*distanceY/distance}node1.isLocked||(node1.offsetX-=forceX,node1.offsetY-=forceY),node2.isLocked||(node2.offsetX+=forceX,node2.offsetY+=forceY)}},nodesOverlap=function nodesOverlap(node1,node2,dX,dY){if(dX>0)var overlapX=node1.maxX-node2.minX;else overlapX=node2.maxX-node1.minX;if(dY>0)var overlapY=node1.maxY-node2.minY;else overlapY=node2.maxY-node1.minY;return overlapX>=0&&overlapY>=0?Math.sqrt(overlapX*overlapX+overlapY*overlapY):0},findClippingPoint=function findClippingPoint(node,dX,dY){var X=node.positionX,Y=node.positionY,H=node.height||1,W=node.width||1,dirSlope=dY/dX,nodeSlope=H/W,res={};return 0===dX&&0<dY||0===dX&&0>dY?(res.x=X,res.y=Y+H/2,res):0<dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X+W/2,res.y=Y+W*dY/2/dX,res):0>dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope?(res.x=X-W/2,res.y=Y-W*dY/2/dX,res):0<dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X+H*dX/2/dY,res.y=Y+H/2,res):0>dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)?(res.x=X-H*dX/2/dY,res.y=Y-H/2,res):res},calculateEdgeForces=function calculateEdgeForces(layoutInfo,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i],sourceIx=layoutInfo.idToIndex[edge.sourceId],source=layoutInfo.layoutNodes[sourceIx],targetIx=layoutInfo.idToIndex[edge.targetId],target=layoutInfo.layoutNodes[targetIx],directionX=target.positionX-source.positionX,directionY=target.positionY-source.positionY;if(0!==directionX||0!==directionY){var point1=findClippingPoint(source,directionX,directionY),point2=findClippingPoint(target,-1*directionX,-1*directionY),lx=point2.x-point1.x,ly=point2.y-point1.y,l=Math.sqrt(lx*lx+ly*ly),force=Math.pow(edge.idealLength-l,2)/edge.elasticity;if(0!==l)var forceX=force*lx/l,forceY=force*ly/l;else forceX=0,forceY=0;source.isLocked||(source.offsetX+=forceX,source.offsetY+=forceY),target.isLocked||(target.offsetX-=forceX,target.offsetY-=forceY)}}},calculateGravityForces=function calculateGravityForces(layoutInfo,options){if(0!==options.gravity)for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i],numNodes=graph.length;if(0===i)var centerX=layoutInfo.clientHeight/2,centerY=layoutInfo.clientWidth/2;else{var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]],parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]];centerX=parent.positionX,centerY=parent.positionY}for(var j=0;j<numNodes;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];if(!node.isLocked){var dx=centerX-node.positionX,dy=centerY-node.positionY,d=Math.sqrt(dx*dx+dy*dy);if(d>1){var fx=options.gravity*dx/d,fy=options.gravity*dy/d;node.offsetX+=fx,node.offsetY+=fy}}}}},propagateForces=function propagateForces(layoutInfo,options){var queue=[],start=0,end=-1;for(queue.push.apply(queue,layoutInfo.graphSet[0]),end+=layoutInfo.graphSet[0].length;start<=end;){var nodeId=queue[start++],nodeIndex=layoutInfo.idToIndex[nodeId],node=layoutInfo.layoutNodes[nodeIndex],children=node.children;if(0<children.length&&!node.isLocked){for(var offX=node.offsetX,offY=node.offsetY,i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX,childNode.offsetY+=offY,queue[++end]=children[i]}node.offsetX=0,node.offsetY=0}}},updatePositions=function updatePositions(layoutInfo,options){for(var i=0;i<layoutInfo.nodeSize;i++){0<(n=layoutInfo.layoutNodes[i]).children.length&&(n.maxX=void 0,n.minX=void 0,n.maxY=void 0,n.minY=void 0)}for(i=0;i<layoutInfo.nodeSize;i++){if(!(0<(n=layoutInfo.layoutNodes[i]).children.length||n.isLocked)){var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x,n.positionY+=tempForce.y,n.offsetX=0,n.offsetY=0,n.minX=n.positionX-n.width,n.maxX=n.positionX+n.width,n.minY=n.positionY-n.height,n.maxY=n.positionY+n.height,_updateAncestryBoundaries(n,layoutInfo)}}for(i=0;i<layoutInfo.nodeSize;i++){var n;0<(n=layoutInfo.layoutNodes[i]).children.length&&!n.isLocked&&(n.positionX=(n.maxX+n.minX)/2,n.positionY=(n.maxY+n.minY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY)}},limitForce=function limitForce(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max)var res={x:max*forceX/force,y:max*forceY/force};else res={x:forceX,y:forceY};return res},_updateAncestryBoundaries=function updateAncestryBoundaries(node,layoutInfo){var parentId=node.parentId;if(null!=parentId){var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]],flag=!1;return(null==p.maxX||node.maxX+p.padRight>p.maxX)&&(p.maxX=node.maxX+p.padRight,flag=!0),(null==p.minX||node.minX-p.padLeft<p.minX)&&(p.minX=node.minX-p.padLeft,flag=!0),(null==p.maxY||node.maxY+p.padBottom>p.maxY)&&(p.maxY=node.maxY+p.padBottom,flag=!0),(null==p.minY||node.minY-p.padTop<p.minY)&&(p.minY=node.minY-p.padTop,flag=!0),flag?_updateAncestryBoundaries(p,layoutInfo):void 0}},separateComponents=function separateComponents(layoutInfo,options){for(var nodes=layoutInfo.layoutNodes,components=[],i=0;i<nodes.length;i++){var node=nodes[i],cid=node.cmptId;(components[cid]=components[cid]||[]).push(node)}var totalA=0;for(i=0;i<components.length;i++){if(c=components[i]){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var j=0;j<c.length;j++){var n=c[j];c.x1=Math.min(c.x1,n.positionX-n.width/2),c.x2=Math.max(c.x2,n.positionX+n.width/2),c.y1=Math.min(c.y1,n.positionY-n.height/2),c.y2=Math.max(c.y2,n.positionY+n.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,totalA+=c.w*c.h}}components.sort(function(c1,c2){return c2.w*c2.h-c1.w*c1.h});var x=0,y=0,usedW=0,rowH=0,maxRowW=Math.sqrt(totalA)*layoutInfo.clientWidth/layoutInfo.clientHeight;for(i=0;i<components.length;i++){var c;if(c=components[i]){for(j=0;j<c.length;j++){(n=c[j]).isLocked||(n.positionX+=x-c.x1,n.positionY+=y-c.y1)}x+=c.w+options.componentSpacing,usedW+=c.w+options.componentSpacing,rowH=Math.max(rowH,c.h),usedW>maxRowW&&(y+=rowH+options.componentSpacing,x=0,usedW=0,rowH=0)}}},defaults$3={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function position(node){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function GridLayout(options){this.options=extend({},defaults$3,options)}GridLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(0===bb.h||0===bb.w)eles.nodes().layoutPositions(this,options,function(ele){return{x:bb.x1,y:bb.y1}});else{var cells=nodes.size(),splits=Math.sqrt(cells*bb.h/bb.w),rows=Math.round(splits),cols=Math.round(bb.w/bb.h*splits),small=function small(val){if(null==val)return Math.min(rows,cols);Math.min(rows,cols)==rows?rows=val:cols=val},large=function large(val){if(null==val)return Math.max(rows,cols);Math.max(rows,cols)==rows?rows=val:cols=val},oRows=options.rows,oCols=null!=options.cols?options.cols:options.columns;if(null!=oRows&&null!=oCols)rows=oRows,cols=oCols;else if(null!=oRows&&null==oCols)rows=oRows,cols=Math.ceil(cells/rows);else if(null==oRows&&null!=oCols)cols=oCols,rows=Math.ceil(cells/cols);else if(cols*rows>cells){var sm=small(),lg=large();(sm-1)*lg>=cells?small(sm-1):(lg-1)*sm>=cells&&large(lg-1)}else for(;cols*rows<cells;){var _sm=small(),_lg=large();(_lg+1)*_sm>=cells?large(_lg+1):small(_sm+1)}var cellWidth=bb.w/cols,cellHeight=bb.h/rows;if(options.condense&&(cellWidth=0,cellHeight=0),options.avoidOverlap)for(var i=0;i<nodes.length;i++){var node=nodes[i],pos=node._private.position;null!=pos.x&&null!=pos.y||(pos.x=0,pos.y=0);var nbb=node.layoutDimensions(options),p=options.avoidOverlapPadding,w=nbb.w+p,h=nbb.h+p;cellWidth=Math.max(cellWidth,w),cellHeight=Math.max(cellHeight,h)}for(var cellUsed={},used=function used(row,col){return!!cellUsed["c-"+row+"-"+col]},use=function use(row,col){cellUsed["c-"+row+"-"+col]=!0},row=0,col=0,moveToNextCell=function moveToNextCell(){++col>=cols&&(col=0,row++)},id2manPos={},_i=0;_i<nodes.length;_i++){var _node=nodes[_i],rcPos=options.position(_node);if(rcPos&&(void 0!==rcPos.row||void 0!==rcPos.col)){var _pos={row:rcPos.row,col:rcPos.col};if(void 0===_pos.col)for(_pos.col=0;used(_pos.row,_pos.col);)_pos.col++;else if(void 0===_pos.row)for(_pos.row=0;used(_pos.row,_pos.col);)_pos.row++;id2manPos[_node.id()]=_pos,use(_pos.row,_pos.col)}}nodes.layoutPositions(this,options,function getPos(element,i){var x,y;if(element.locked()||element.isParent())return!1;var rcPos=id2manPos[element.id()];if(rcPos)x=rcPos.col*cellWidth+cellWidth/2+bb.x1,y=rcPos.row*cellHeight+cellHeight/2+bb.y1;else{for(;used(row,col);)moveToNextCell();x=col*cellWidth+cellWidth/2+bb.x1,y=row*cellHeight+cellHeight/2+bb.y1,use(row,col),moveToNextCell()}return{x,y}})}return this};var defaults$2={ready:function ready(){},stop:function stop(){}};function NullLayout(options){this.options=extend({},defaults$2,options)}NullLayout.prototype.run=function(){var options=this.options,eles=options.eles;return options.cy,this.emit("layoutstart"),eles.nodes().positions(function(){return{x:0,y:0}}),this.one("layoutready",options.ready),this.emit("layoutready"),this.one("layoutstop",options.stop),this.emit("layoutstop"),this},NullLayout.prototype.stop=function(){return this};var defaults$1={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function PresetLayout(options){this.options=extend({},defaults$1,options)}PresetLayout.prototype.run=function(){var options=this.options,nodes=options.eles.nodes(),posIsFn=fn$6(options.positions);return nodes.layoutPositions(this,options,function(node,i){var position=function getPosition(node){if(null==options.positions)return function copyPosition(p){return{x:p.x,y:p.y}}(node.position());if(posIsFn)return options.positions(node);var pos=options.positions[node._private.data.id];return null==pos?null:pos}(node);return!node.locked()&&null!=position&&position}),this};var defaults={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function animateFilter(node,i){return!0},ready:void 0,stop:void 0,transform:function transform(node,position){return position}};function RandomLayout(options){this.options=extend({},defaults,options)}RandomLayout.prototype.run=function(){var options=this.options,cy=options.cy,eles=options.eles,bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});return eles.nodes().layoutPositions(this,options,function getPos(node,i){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}}),this};var layout=[{name:"breadthfirst",impl:BreadthFirstLayout},{name:"circle",impl:CircleLayout},{name:"concentric",impl:ConcentricLayout},{name:"cose",impl:CoseLayout},{name:"grid",impl:GridLayout},{name:"null",impl:NullLayout},{name:"preset",impl:PresetLayout},{name:"random",impl:RandomLayout}];function NullRenderer(options){this.options=options,this.notifications=0}var noop=function noop(){},throwImgErr=function throwImgErr(){throw new Error("A headless instance can not render images")};NullRenderer.prototype={recalculateRenderedStyle:noop,notify:function notify(){this.notifications++},init:noop,isHeadless:function isHeadless(){return!0},png:throwImgErr,jpg:throwImgErr};var BRp$f={arrowShapeWidth:.3,registerArrowShapes:function(){var arrowShapes=this.arrowShapes={},renderer=this,bbCollide=function bbCollide(x,y,size,angle,translation,edgeWidth,padding){var x1=translation.x-size/2-padding,x2=translation.x+size/2+padding,y1=translation.y-size/2-padding,y2=translation.y+size/2+padding;return x1<=x&&x<=x2&&y1<=y&&y<=y2},transform=function transform(x,y,size,angle,translation){var xRotated=x*Math.cos(angle)-y*Math.sin(angle),yScaled=(x*Math.sin(angle)+y*Math.cos(angle))*size;return{x:xRotated*size+translation.x,y:yScaled+translation.y}},transformPoints=function transformPoints(pts,size,angle,translation){for(var retPts=[],i=0;i<pts.length;i+=2){var x=pts[i],y=pts[i+1];retPts.push(transform(x,y,size,angle,translation))}return retPts},pointsToArr=function pointsToArr(pts){for(var ret=[],i=0;i<pts.length;i++){var p=pts[i];ret.push(p.x,p.y)}return ret},standardGap=function standardGap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").pfValue*2},defineArrowShape=function defineArrowShape(name,defn){string(defn)&&(defn=arrowShapes[defn]),arrowShapes[name]=extend({name,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function collide(x,y,size,angle,translation,padding){var points=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,points)},roughCollide:bbCollide,draw:function draw(context,size,angle,translation){var points=transformPoints(this.points,size,angle,translation);renderer.arrowShapeImpl("polygon")(context,points)},spacing:function spacing(edge){return 0},gap:standardGap},defn)};defineArrowShape("none",{collide:falsify,roughCollide:falsify,draw:noop$1,spacing:zeroify,gap:zeroify}),defineArrowShape("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),defineArrowShape("arrow","triangle"),defineArrowShape("triangle-backcurve",{points:arrowShapes.triangle.points,controlPoint:[0,-.15],roughCollide:bbCollide,draw:function draw(context,size,angle,translation,edgeWidth){var ptsTrans=transformPoints(this.points,size,angle,translation),ctrlPt=this.controlPoint,ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);renderer.arrowShapeImpl(this.name)(context,ptsTrans,ctrlPtTrans)},gap:function gap(edge){return.8*standardGap(edge)}}),defineArrowShape("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),teePts=pointsToArr(transformPoints(this.pointsTee,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts)},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation),teePts=transformPoints(this.pointsTee,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,teePts)}}),defineArrowShape("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var t=translation,circleInside=Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2),triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||circleInside},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.pointsTr,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,translation.x,translation.y,this.radius*size)},spacing:function spacing(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.radius}}),defineArrowShape("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function crossLinePts(size,edgeWidth){var p=this.baseCrossLinePts.slice(),shiftFactor=edgeWidth/size;return p[3]=p[3]-shiftFactor,p[5]=p[5]-shiftFactor,p},collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation)),teePts=pointsToArr(transformPoints(this.crossLinePts(size,edgeWidth),size+2*padding,angle,translation));return pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts)},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation),crossLinePts=transformPoints(this.crossLinePts(size,edgeWidth),size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,crossLinePts)}}),defineArrowShape("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function gap(edge){return.525*standardGap(edge)}}),defineArrowShape("circle",{radius:.15,collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var t=translation;return Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2)},draw:function draw(context,size,angle,translation,edgeWidth){renderer.arrowShapeImpl(this.name)(context,translation.x,translation.y,this.radius*size)},spacing:function spacing(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.radius}}),defineArrowShape("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function spacing(edge){return 1},gap:function gap(edge){return 1}}),defineArrowShape("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),defineArrowShape("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function gap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}}),defineArrowShape("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function gap(edge){return.95*edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}})}},BRp$e={projectIntoViewport:function(clientX,clientY){var cy=this.cy,offsets=this.findContainerClientCoords(),offsetLeft=offsets[0],offsetTop=offsets[1],scale=offsets[4],pan=cy.pan(),zoom=cy.zoom();return[((clientX-offsetLeft)/scale-pan.x)/zoom,((clientY-offsetTop)/scale-pan.y)/zoom]},findContainerClientCoords:function(){if(this.containerBB)return this.containerBB;var container=this.container,rect=container.getBoundingClientRect(),style=this.cy.window().getComputedStyle(container),styleValue=function styleValue(name){return parseFloat(style.getPropertyValue(name))},padding_left=styleValue("padding-left"),padding_right=styleValue("padding-right"),padding_top=styleValue("padding-top"),padding_bottom=styleValue("padding-bottom"),border_left=styleValue("border-left-width"),border_right=styleValue("border-right-width"),border_top=styleValue("border-top-width"),clientWidth=(styleValue("border-bottom-width"),container.clientWidth),clientHeight=container.clientHeight,paddingHor=padding_left+padding_right,paddingVer=padding_top+padding_bottom,borderHor=border_left+border_right,scale=rect.width/(clientWidth+borderHor),unscaledW=clientWidth-paddingHor,unscaledH=clientHeight-paddingVer,left=rect.left+padding_left+border_left,top=rect.top+padding_top+border_top;return this.containerBB=[left,top,unscaledW,unscaledH,scale]},invalidateContainerClientCoordsCache:function(){this.containerBB=null},findNearestElement:function(x,y,interactiveElementsOnly,isTouch){return this.findNearestElements(x,y,interactiveElementsOnly,isTouch)[0]},findNearestElements:function(x,y,interactiveElementsOnly,isTouch){var nearEdge,nearNode,self=this,r=this,eles=r.getCachedZSortedEles(),near=[],zoom=r.cy.zoom(),hasCompounds=r.cy.hasCompoundNodes(),edgeThreshold=(isTouch?24:8)/zoom,nodeThreshold=(isTouch?8:2)/zoom,labelThreshold=(isTouch?8:2)/zoom,minSqDist=1/0;function addEle(ele,sqDist){if(ele.isNode()){if(nearNode)return;nearNode=ele,near.push(ele)}if(ele.isEdge()&&(null==sqDist||sqDist<minSqDist))if(nearEdge){if(nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value&&nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value)for(var i=0;i<near.length;i++)if(near[i].isEdge()){near[i]=ele,nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist;break}}else near.push(ele),nearEdge=ele,minSqDist=null!=sqDist?sqDist:minSqDist}function checkNode(node){var width=node.outerWidth()+2*nodeThreshold,height=node.outerHeight()+2*nodeThreshold,hw=width/2,hh=height/2,pos=node.position(),cornerRadius="auto"===node.pstyle("corner-radius").value?"auto":node.pstyle("corner-radius").pfValue,rs=node._private.rscratch;if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh&&r.nodeShapes[self.getNodeShape(node)].checkPoint(x,y,0,width,height,pos.x,pos.y,cornerRadius,rs))return addEle(node,0),!0}function checkEdge(edge){var sqDist,_p=edge._private,rs=_p.rscratch,styleWidth=edge.pstyle("width").pfValue,scale=edge.pstyle("arrow-scale").value,width=styleWidth/2+edgeThreshold,widthSq=width*width,width2=2*width,src=_p.source,tgt=_p.target;if("segments"===rs.edgeType||"straight"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=rs.allpts,i=0;i+3<pts.length;i+=2)if(inLineVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],width2)&&widthSq>(sqDist=sqdistToFiniteLine(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3])))return addEle(edge,sqDist),!0}else if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType)for(pts=rs.allpts,i=0;i+5<rs.allpts.length;i+=4)if(inBezierVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5],width2)&&widthSq>(sqDist=sqdistToQuadraticBezier(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5])))return addEle(edge,sqDist),!0;src=src||_p.source,tgt=tgt||_p.target;var arSize=self.getArrowWidth(styleWidth,scale),arrows=[{name:"source",x:rs.arrowStartX,y:rs.arrowStartY,angle:rs.srcArrowAngle},{name:"target",x:rs.arrowEndX,y:rs.arrowEndY,angle:rs.tgtArrowAngle},{name:"mid-source",x:rs.midX,y:rs.midY,angle:rs.midsrcArrowAngle},{name:"mid-target",x:rs.midX,y:rs.midY,angle:rs.midtgtArrowAngle}];for(i=0;i<arrows.length;i++){var ar=arrows[i],shape=r.arrowShapes[edge.pstyle(ar.name+"-arrow-shape").value],edgeWidth=edge.pstyle("width").pfValue;if(shape.roughCollide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold)&&shape.collide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold))return addEle(edge),!0}hasCompounds&&near.length>0&&(checkNode(src),checkNode(tgt))}function preprop(obj,name,pre){return getPrefixedProperty(obj,name,pre)}function checkLabel(ele,prefix){var prefixDash,_p=ele._private,th=labelThreshold;prefixDash=prefix?prefix+"-":"",ele.boundingBox();var bb=_p.labelBounds[prefix||"main"],text=ele.pstyle(prefixDash+"label").value;if("yes"===ele.pstyle("text-events").strValue&&text){var lx=preprop(_p.rscratch,"labelX",prefix),ly=preprop(_p.rscratch,"labelY",prefix),theta=preprop(_p.rscratch,"labelAngle",prefix),ox=ele.pstyle(prefixDash+"text-margin-x").pfValue,oy=ele.pstyle(prefixDash+"text-margin-y").pfValue,lx1=bb.x1-th-ox,lx2=bb.x2+th-ox,ly1=bb.y1-th-oy,ly2=bb.y2+th-oy;if(theta){var cos=Math.cos(theta),sin=Math.sin(theta),rotate=function rotate(x,y){return{x:(x-=lx)*cos-(y-=ly)*sin+lx,y:x*sin+y*cos+ly}},px1y1=rotate(lx1,ly1),px1y2=rotate(lx1,ly2),px2y1=rotate(lx2,ly1),px2y2=rotate(lx2,ly2),points=[px1y1.x+ox,px1y1.y+oy,px2y1.x+ox,px2y1.y+oy,px2y2.x+ox,px2y2.y+oy,px1y2.x+ox,px1y2.y+oy];if(pointInsidePolygonPoints(x,y,points))return addEle(ele),!0}else if(inBoundingBox(bb,x,y))return addEle(ele),!0}}interactiveElementsOnly&&(eles=eles.interactive);for(var i=eles.length-1;i>=0;i--){var ele=eles[i];ele.isNode()?checkNode(ele)||checkLabel(ele):checkEdge(ele)||checkLabel(ele)||checkLabel(ele,"source")||checkLabel(ele,"target")}return near},getAllInBox:function(x1,y1,x2,y2){var eles=this.getCachedZSortedEles().interactive,labelThreshold=2/this.cy.zoom(),box=[],x1c=Math.min(x1,x2),x2c=Math.max(x1,x2),y1c=Math.min(y1,y2),y2c=Math.max(y1,y2),boxBb=makeBoundingBox({x1:x1=x1c,y1:y1=y1c,x2:x2=x2c,y2:y2=y2c}),selectionBox=[{x:boxBb.x1,y:boxBb.y1},{x:boxBb.x2,y:boxBb.y1},{x:boxBb.x2,y:boxBb.y2},{x:boxBb.x1,y:boxBb.y2}],boxEdges=[[selectionBox[0],selectionBox[1]],[selectionBox[1],selectionBox[2]],[selectionBox[2],selectionBox[3]],[selectionBox[3],selectionBox[0]]];function preprop(obj,name,pre){return getPrefixedProperty(obj,name,pre)}function getRotatedLabelBox(ele,prefix){var _p=ele._private,th=labelThreshold;ele.boundingBox();var bb=_p.labelBounds.main;if(!bb)return null;var lx=preprop(_p.rscratch,"labelX",prefix),ly=preprop(_p.rscratch,"labelY",prefix),theta=preprop(_p.rscratch,"labelAngle",prefix),ox=ele.pstyle("text-margin-x").pfValue,oy=ele.pstyle("text-margin-y").pfValue,lx1=bb.x1-th-ox,lx2=bb.x2+th-ox,ly1=bb.y1-th-oy,ly2=bb.y2+th-oy;if(theta){var cos=Math.cos(theta),sin=Math.sin(theta),rotate=function rotate(x,y){return{x:(x-=lx)*cos-(y-=ly)*sin+lx,y:x*sin+y*cos+ly}};return[rotate(lx1,ly1),rotate(lx2,ly1),rotate(lx2,ly2),rotate(lx1,ly2)]}return[{x:lx1,y:ly1},{x:lx2,y:ly1},{x:lx2,y:ly2},{x:lx1,y:ly2}]}function doLinesIntersect(p1,p2,q1,q2){function ccw(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}return ccw(p1,q1,q2)!==ccw(p2,q1,q2)&&ccw(p1,p2,q1)!==ccw(p1,p2,q2)}for(var e=0;e<eles.length;e++){var ele=eles[e];if(ele.isNode()){var node=ele,textEvents="yes"===node.pstyle("text-events").strValue,nodeBoxSelectMode=node.pstyle("box-selection").strValue,labelBoxSelectEnabled="yes"===node.pstyle("box-select-labels").strValue;if("none"===nodeBoxSelectMode)continue;var includeLabels=("overlap"===nodeBoxSelectMode||labelBoxSelectEnabled)&&textEvents,nodeBb=node.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels});if("contain"===nodeBoxSelectMode){var selected=!1;if(labelBoxSelectEnabled&&textEvents){var rotatedLabelBox=getRotatedLabelBox(node);rotatedLabelBox&&satPolygonIntersection(rotatedLabelBox,selectionBox)&&(box.push(node),selected=!0)}!selected&&boundingBoxInBoundingBox(boxBb,nodeBb)&&box.push(node)}else if("overlap"===nodeBoxSelectMode&&boundingBoxesIntersect(boxBb,nodeBb)){var nodeBodyBb=node.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1});if(satPolygonIntersection([{x:nodeBodyBb.x1,y:nodeBodyBb.y1},{x:nodeBodyBb.x2,y:nodeBodyBb.y1},{x:nodeBodyBb.x2,y:nodeBodyBb.y2},{x:nodeBodyBb.x1,y:nodeBodyBb.y2}],selectionBox))box.push(node);else{var _rotatedLabelBox=getRotatedLabelBox(node);_rotatedLabelBox&&satPolygonIntersection(_rotatedLabelBox,selectionBox)&&box.push(node)}}}else{var edge=ele,_p=edge._private,rs=_p.rscratch,edgeBoxSelectMode=edge.pstyle("box-selection").strValue;if("none"===edgeBoxSelectMode)continue;if("contain"===edgeBoxSelectMode){if(null!=rs.startX&&null!=rs.startY&&!inBoundingBox(boxBb,rs.startX,rs.startY))continue;if(null!=rs.endX&&null!=rs.endY&&!inBoundingBox(boxBb,rs.endX,rs.endY))continue;if("bezier"===rs.edgeType||"multibezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType||"segments"===rs.edgeType||"haystack"===rs.edgeType){for(var pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts,allInside=!0,i=0;i<pts.length;i++)if(!pointInBoundingBox(boxBb,pts[i])){allInside=!1;break}allInside&&box.push(edge)}else"straight"===rs.edgeType&&box.push(edge)}else if("overlap"===edgeBoxSelectMode){var _selected=!1;if(null!=rs.startX&&null!=rs.startY&&null!=rs.endX&&null!=rs.endY&&(inBoundingBox(boxBb,rs.startX,rs.startY)||inBoundingBox(boxBb,rs.endX,rs.endY)))box.push(edge),_selected=!0;else if(!_selected&&"haystack"===rs.edgeType)for(var haystackPts=_p.rstyle.haystackPts,_i=0;_i<haystackPts.length;_i++)if(pointInBoundingBox(boxBb,haystackPts[_i])){box.push(edge),_selected=!0;break}if(!_selected){var _pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts;if((!_pts||_pts.length<2)&&"straight"===rs.edgeType&&null!=rs.startX&&null!=rs.startY&&null!=rs.endX&&null!=rs.endY&&(_pts=[{x:rs.startX,y:rs.startY},{x:rs.endX,y:rs.endY}]),!_pts||_pts.length<2)continue;for(var _i2=0;_i2<_pts.length-1;_i2++){for(var segStart=_pts[_i2],segEnd=_pts[_i2+1],b=0;b<boxEdges.length;b++){var _boxEdges$b=_slicedToArray(boxEdges[b],2);if(doLinesIntersect(segStart,segEnd,_boxEdges$b[0],_boxEdges$b[1])){box.push(edge),_selected=!0;break}}if(_selected)break}}}}}return box}},BRp$d={calculateArrowAngles:function(edge){var dispX,dispY,startX,startY,endX,endY,rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType,isBezier="bezier"===rs.edgeType,isMultibezier="multibezier"===rs.edgeType,isSegments="segments"===rs.edgeType,isCompound="compound"===rs.edgeType,isSelf="self"===rs.edgeType;if(isHaystack?(startX=rs.haystackPts[0],startY=rs.haystackPts[1],endX=rs.haystackPts[2],endY=rs.haystackPts[3]):(startX=rs.arrowStartX,startY=rs.arrowStartY,endX=rs.arrowEndX,endY=rs.arrowEndY),midX=rs.midX,midY=rs.midY,isSegments)dispX=startX-rs.segpts[0],dispY=startY-rs.segpts[1];else if(isMultibezier||isCompound||isSelf||isBezier){var pts=rs.allpts;dispX=startX-qbezierAt(pts[0],pts[2],pts[4],.1),dispY=startY-qbezierAt(pts[1],pts[3],pts[5],.1)}else dispX=startX-midX,dispY=startY-midY;rs.srcArrowAngle=getAngleFromDisp(dispX,dispY);var midX=rs.midX,midY=rs.midY;if(isHaystack&&(midX=(startX+endX)/2,midY=(startY+endY)/2),dispX=endX-startX,dispY=endY-startY,isSegments)if((pts=rs.allpts).length/2%2==0){var i1=(i2=pts.length/2)-2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}else if(rs.isRound)dispX=rs.midVector[1],dispY=-rs.midVector[0];else{i1=(i2=pts.length/2-1)-2;dispX=pts[i2]-pts[i1],dispY=pts[i2+1]-pts[i1+1]}else if(isMultibezier||isCompound||isSelf){var bp0x,bp0y,bp1x,bp1y,pts=rs.allpts;if(rs.ctrlpts.length/2%2==0){var p1=(ic=(p0=pts.length/2-1)+2)+2;bp0x=qbezierAt(pts[p0],pts[ic],pts[p1],0),bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],0),bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],1e-4),bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],1e-4)}else{var ic,p0;p1=(ic=pts.length/2-1)+2;bp0x=qbezierAt(pts[p0=ic-2],pts[ic],pts[p1],.4999),bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.4999),bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],.5),bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.5)}dispX=bp1x-bp0x,dispY=bp1y-bp0y}if(rs.midtgtArrowAngle=getAngleFromDisp(dispX,dispY),rs.midDispX=dispX,rs.midDispY=dispY,dispX*=-1,dispY*=-1,isSegments)if((pts=rs.allpts).length/2%2==0);else if(!rs.isRound){var i2,i3=(i2=pts.length/2-1)+2;dispX=-(pts[i3]-pts[i2]),dispY=-(pts[i3+1]-pts[i2+1])}if(rs.midsrcArrowAngle=getAngleFromDisp(dispX,dispY),isSegments)dispX=endX-rs.segpts[rs.segpts.length-2],dispY=endY-rs.segpts[rs.segpts.length-1];else if(isMultibezier||isCompound||isSelf||isBezier){var l=(pts=rs.allpts).length;dispX=endX-qbezierAt(pts[l-6],pts[l-4],pts[l-2],.9),dispY=endY-qbezierAt(pts[l-5],pts[l-3],pts[l-1],.9)}else dispX=endX-midX,dispY=endY-midY;rs.tgtArrowAngle=getAngleFromDisp(dispX,dispY)}};BRp$d.getArrowWidth=BRp$d.getArrowHeight=function(edgeWidth,scale){var cache=this.arrowWidthCache=this.arrowWidthCache||{},cachedVal=cache[edgeWidth+", "+scale];return cachedVal||(cachedVal=Math.max(Math.pow(13.37*edgeWidth,.9),29)*scale,cache[edgeWidth+", "+scale]=cachedVal,cachedVal)};var x,y,sinA,sinA90,radDirection,drawDirection,angle,halfAngle,cRadius,lenOut,radius,limit,startX,startY,stopX,stopY,lastPoint,v1={},v2={},asVec=function asVec(p,pp,v){v.x=pp.x-p.x,v.y=pp.y-p.y,v.len=Math.sqrt(v.x*v.x+v.y*v.y),v.nx=v.x/v.len,v.ny=v.y/v.len,v.ang=Math.atan2(v.ny,v.nx)},calcCornerArc=function calcCornerArc(previousPoint,currentPoint,nextPoint,radiusMax,isArcRadius){if(previousPoint!==lastPoint?asVec(currentPoint,previousPoint,v1):function invertVec(originalV,invertedV){invertedV.x=-1*originalV.x,invertedV.y=-1*originalV.y,invertedV.nx=-1*originalV.nx,invertedV.ny=-1*originalV.ny,invertedV.ang=originalV.ang>0?-(Math.PI-originalV.ang):Math.PI+originalV.ang}(v2,v1),asVec(currentPoint,nextPoint,v2),sinA=v1.nx*v2.ny-v1.ny*v2.nx,sinA90=v1.nx*v2.nx-v1.ny*-v2.ny,angle=Math.asin(Math.max(-1,Math.min(1,sinA))),Math.abs(angle)<1e-6)return x=currentPoint.x,y=currentPoint.y,void(cRadius=radius=0);radDirection=1,drawDirection=!1,sinA90<0?angle<0?angle=Math.PI+angle:(angle=Math.PI-angle,radDirection=-1,drawDirection=!0):angle>0&&(radDirection=-1,drawDirection=!0),radius=void 0!==currentPoint.radius?currentPoint.radius:radiusMax,halfAngle=angle/2,limit=Math.min(v1.len/2,v2.len/2),isArcRadius?(lenOut=Math.abs(Math.cos(halfAngle)*radius/Math.sin(halfAngle)))>limit?(lenOut=limit,cRadius=Math.abs(lenOut*Math.sin(halfAngle)/Math.cos(halfAngle))):cRadius=radius:(lenOut=Math.min(limit,radius),cRadius=Math.abs(lenOut*Math.sin(halfAngle)/Math.cos(halfAngle))),stopX=currentPoint.x+v2.nx*lenOut,stopY=currentPoint.y+v2.ny*lenOut,x=stopX-v2.ny*cRadius*radDirection,y=stopY+v2.nx*cRadius*radDirection,startX=currentPoint.x+v1.nx*lenOut,startY=currentPoint.y+v1.ny*lenOut,lastPoint=currentPoint};function drawPreparedRoundCorner(ctx,roundCorner){0===roundCorner.radius?ctx.lineTo(roundCorner.cx,roundCorner.cy):ctx.arc(roundCorner.cx,roundCorner.cy,roundCorner.radius,roundCorner.startAngle,roundCorner.endAngle,roundCorner.counterClockwise)}function getRoundCorner(previousPoint,currentPoint,nextPoint,radiusMax){var isArcRadius=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return 0===radiusMax||0===currentPoint.radius?{cx:currentPoint.x,cy:currentPoint.y,radius:0,startX:currentPoint.x,startY:currentPoint.y,stopX:currentPoint.x,stopY:currentPoint.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(calcCornerArc(previousPoint,currentPoint,nextPoint,radiusMax,isArcRadius),{cx:x,cy:y,radius:cRadius,startX,startY,stopX,stopY,startAngle:v1.ang+Math.PI/2*radDirection,endAngle:v2.ang-Math.PI/2*radDirection,counterClockwise:drawDirection})}var AVOID_IMPOSSIBLE_BEZIER_CONSTANT_L=Math.sqrt(.02),BRp$c={};function getPts(pts){var retPts=[];if(null!=pts){for(var i=0;i<pts.length;i+=2){var x=pts[i],y=pts[i+1];retPts.push({x,y})}return retPts}}BRp$c.findMidptPtsEtc=function(edge,pairInfo){var midptPts,posPts=pairInfo.posPts,intersectionPts=pairInfo.intersectionPts,vectorNormInverse=pairInfo.vectorNormInverse,srcManEndpt=edge.pstyle("source-endpoint"),tgtManEndpt=edge.pstyle("target-endpoint"),haveManualEndPts=null!=srcManEndpt.units&&null!=tgtManEndpt.units;switch(edge.pstyle("edge-distances").value){case"node-position":midptPts=posPts;break;case"intersection":midptPts=intersectionPts;break;case"endpoints":if(haveManualEndPts){var _this$manualEndptToPx2=_slicedToArray(this.manualEndptToPx(edge.source()[0],srcManEndpt),2),x1=_this$manualEndptToPx2[0],y1=_this$manualEndptToPx2[1],_this$manualEndptToPx4=_slicedToArray(this.manualEndptToPx(edge.target()[0],tgtManEndpt),2),x2=_this$manualEndptToPx4[0],y2=_this$manualEndptToPx4[1],endPts={x1,y1,x2,y2};vectorNormInverse=function recalcVectorNormInverse(x1,y1,x2,y2){var dy=y2-y1,dx=x2-x1,l=Math.sqrt(dx*dx+dy*dy);return{x:-dy/l,y:dx/l}}(x1,y1,x2,y2),midptPts=endPts}else warn("Edge ".concat(edge.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),midptPts=intersectionPts}return{midptPts,vectorNormInverse}},BRp$c.findHaystackPoints=function(edges){for(var i=0;i<edges.length;i++){var edge=edges[i],_p=edge._private,rs=_p.rscratch;if(!rs.haystack){var angle=2*Math.random()*Math.PI;rs.source={x:Math.cos(angle),y:Math.sin(angle)},angle=2*Math.random()*Math.PI,rs.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source,tgt=_p.target,srcPos=src.position(),tgtPos=tgt.position(),srcW=src.width(),tgtW=tgt.width(),srcH=src.height(),tgtH=tgt.height(),halfRadius=edge.pstyle("haystack-radius").value/2;rs.haystackPts=rs.allpts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y],rs.midX=(rs.allpts[0]+rs.allpts[2])/2,rs.midY=(rs.allpts[1]+rs.allpts[3])/2,rs.edgeType="haystack",rs.haystack=!0,this.storeEdgeProjections(edge),this.calculateArrowAngles(edge),this.recalculateEdgeLabelProjections(edge),this.calculateLabelAngles(edge)}},BRp$c.findSegmentsPoints=function(edge,pairInfo){var rs=edge._private.rscratch,segmentWs=edge.pstyle("segment-weights"),segmentDs=edge.pstyle("segment-distances"),segmentRs=edge.pstyle("segment-radii"),segmentTs=edge.pstyle("radius-type"),segmentsN=Math.min(segmentWs.pfValue.length,segmentDs.pfValue.length),lastRadius=segmentRs.pfValue[segmentRs.pfValue.length-1],lastRadiusType=segmentTs.pfValue[segmentTs.pfValue.length-1];rs.edgeType="segments",rs.segpts=[],rs.radii=[],rs.isArcRadius=[];for(var s=0;s<segmentsN;s++){var w=segmentWs.pfValue[s],d=segmentDs.pfValue[s],w1=1-w,w2=w,_this$findMidptPtsEtc=this.findMidptPtsEtc(edge,pairInfo),midptPts=_this$findMidptPtsEtc.midptPts,vectorNormInverse=_this$findMidptPtsEtc.vectorNormInverse,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.segpts.push(adjustedMidpt.x+vectorNormInverse.x*d,adjustedMidpt.y+vectorNormInverse.y*d),rs.radii.push(void 0!==segmentRs.pfValue[s]?segmentRs.pfValue[s]:lastRadius),rs.isArcRadius.push("arc-radius"===(void 0!==segmentTs.pfValue[s]?segmentTs.pfValue[s]:lastRadiusType))}},BRp$c.findLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch,dirCounts=pairInfo.dirCounts,srcPos=pairInfo.srcPos,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,loopDir=edge.pstyle("loop-direction").pfValue,loopSwp=edge.pstyle("loop-sweep").pfValue,stepSize=edge.pstyle("control-point-step-size").pfValue;rs.edgeType="self";var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist);var loopAngle=loopDir-Math.PI/2,outAngle=loopAngle-loopSwp/2,inAngle=loopAngle+loopSwp/2,dc=String(loopDir+"_"+loopSwp);j=void 0===dirCounts[dc]?dirCounts[dc]=0:++dirCounts[dc],rs.ctrlpts=[srcPos.x+1.4*Math.cos(outAngle)*loopDist*(j/3+1),srcPos.y+1.4*Math.sin(outAngle)*loopDist*(j/3+1),srcPos.x+1.4*Math.cos(inAngle)*loopDist*(j/3+1),srcPos.y+1.4*Math.sin(inAngle)*loopDist*(j/3+1)]},BRp$c.findCompoundLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch;rs.edgeType="compound";var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,stepSize=edge.pstyle("control-point-step-size").pfValue,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=ctrlptDist);var loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2},loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2},loopPos={x:Math.min(loopaPos.x,loopbPos.x),y:Math.min(loopaPos.y,loopbPos.y)},compoundStretchA=Math.max(.5,Math.log(.01*srcW)),compoundStretchB=Math.max(.5,Math.log(.01*tgtW));rs.ctrlpts=[loopPos.x,loopPos.y-(1+Math.pow(50,1.12)/100)*loopDist*(j/3+1)*compoundStretchA,loopPos.x-(1+Math.pow(50,1.12)/100)*loopDist*(j/3+1)*compoundStretchB,loopPos.y]},BRp$c.findStraightEdgePoints=function(edge){edge._private.rscratch.edgeType="straight"},BRp$c.findBezierPoints=function(edge,pairInfo,i,edgeIsUnbundled,edgeIsSwapped){var rs=edge._private.rscratch,stepSize=edge.pstyle("control-point-step-size").pfValue,ctrlptDists=edge.pstyle("control-point-distances"),ctrlptWs=edge.pstyle("control-point-weights"),bezierN=ctrlptDists&&ctrlptWs?Math.min(ctrlptDists.value.length,ctrlptWs.value.length):1,ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:void 0,ctrlptWeight=ctrlptWs.value[0],multi=edgeIsUnbundled;rs.edgeType=multi?"multibezier":"bezier",rs.ctrlpts=[];for(var b=0;b<bezierN;b++){var normctrlptDist=(.5-pairInfo.eles.length/2+i)*stepSize*(edgeIsSwapped?-1:1),manctrlptDist=void 0,sign=signum(normctrlptDist);multi&&(ctrlptDist=ctrlptDists?ctrlptDists.pfValue[b]:stepSize,ctrlptWeight=ctrlptWs.value[b]);var distanceFromMidpoint=void 0!==(manctrlptDist=edgeIsUnbundled?ctrlptDist:void 0!==ctrlptDist?sign*ctrlptDist:void 0)?manctrlptDist:normctrlptDist,w1=1-ctrlptWeight,w2=ctrlptWeight,_this$findMidptPtsEtc2=this.findMidptPtsEtc(edge,pairInfo),midptPts=_this$findMidptPtsEtc2.midptPts,vectorNormInverse=_this$findMidptPtsEtc2.vectorNormInverse,adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.ctrlpts.push(adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint)}},BRp$c.findTaxiPoints=function(edge,pairInfo){var rs=edge._private.rscratch;rs.edgeType="segments";var posPts=pairInfo.posPts,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,dIncludesNodeBody="node-position"!==edge.pstyle("edge-distances").value,taxiDir=edge.pstyle("taxi-direction").value,rawTaxiDir=taxiDir,taxiTurn=edge.pstyle("taxi-turn"),turnIsPercent="%"===taxiTurn.units,taxiTurnPfVal=taxiTurn.pfValue,turnIsNegative=taxiTurnPfVal<0,minD=edge.pstyle("taxi-turn-min-distance").pfValue,dw=dIncludesNodeBody?(srcW+tgtW)/2:0,dh=dIncludesNodeBody?(srcH+tgtH)/2:0,pdx=posPts.x2-posPts.x1,pdy=posPts.y2-posPts.y1,subDWH=function subDWH(dxy,dwh){return dxy>0?Math.max(dxy-dwh,0):Math.min(dxy+dwh,0)},dx=subDWH(pdx,dw),dy=subDWH(pdy,dh),isExplicitDir=!1;"auto"===rawTaxiDir?taxiDir=Math.abs(dx)>Math.abs(dy)?"horizontal":"vertical":"upward"===rawTaxiDir||"downward"===rawTaxiDir?(taxiDir="vertical",isExplicitDir=!0):"leftward"!==rawTaxiDir&&"rightward"!==rawTaxiDir||(taxiDir="horizontal",isExplicitDir=!0);var d,isVert="vertical"===taxiDir,l=isVert?dy:dx,pl=isVert?pdy:pdx,sgnL=signum(pl),forcedDir=!1;(isExplicitDir&&(turnIsPercent||turnIsNegative)||!("downward"===rawTaxiDir&&pl<0||"upward"===rawTaxiDir&&pl>0||"leftward"===rawTaxiDir&&pl>0||"rightward"===rawTaxiDir&&pl<0)||(l=(sgnL*=-1)*Math.abs(l),forcedDir=!0),turnIsPercent)?d=(taxiTurnPfVal<0?1+taxiTurnPfVal:taxiTurnPfVal)*l:d=(taxiTurnPfVal<0?l:0)+taxiTurnPfVal*sgnL;var getIsTooClose=function getIsTooClose(d){return Math.abs(d)<minD||Math.abs(d)>=Math.abs(l)},isTooCloseSrc=getIsTooClose(d),isTooCloseTgt=getIsTooClose(Math.abs(l)-Math.abs(d));if((isTooCloseSrc||isTooCloseTgt)&&!forcedDir)if(isVert){var lShapeInsideSrc=Math.abs(pl)<=srcH/2,lShapeInsideTgt=Math.abs(pdx)<=tgtW/2;if(lShapeInsideSrc){var x=(posPts.x1+posPts.x2)/2,y1=posPts.y1,y2=posPts.y2;rs.segpts=[x,y1,x,y2]}else if(lShapeInsideTgt){var y=(posPts.y1+posPts.y2)/2,x1=posPts.x1,x2=posPts.x2;rs.segpts=[x1,y,x2,y]}else rs.segpts=[posPts.x1,posPts.y2]}else{var _lShapeInsideSrc=Math.abs(pl)<=srcW/2,_lShapeInsideTgt=Math.abs(pdy)<=tgtH/2;if(_lShapeInsideSrc){var _y=(posPts.y1+posPts.y2)/2,_x=posPts.x1,_x2=posPts.x2;rs.segpts=[_x,_y,_x2,_y]}else if(_lShapeInsideTgt){var _x3=(posPts.x1+posPts.x2)/2,_y2=posPts.y1,_y3=posPts.y2;rs.segpts=[_x3,_y2,_x3,_y3]}else rs.segpts=[posPts.x2,posPts.y1]}else if(isVert){var _y4=posPts.y1+d+(dIncludesNodeBody?srcH/2*sgnL:0),_x4=posPts.x1,_x5=posPts.x2;rs.segpts=[_x4,_y4,_x5,_y4]}else{var _x6=posPts.x1+d+(dIncludesNodeBody?srcW/2*sgnL:0),_y5=posPts.y1,_y6=posPts.y2;rs.segpts=[_x6,_y5,_x6,_y6]}if(rs.isRound){var radius=edge.pstyle("taxi-radius").value,isArcRadius="arc-radius"===edge.pstyle("radius-type").value[0];rs.radii=new Array(rs.segpts.length/2).fill(radius),rs.isArcRadius=new Array(rs.segpts.length/2).fill(isArcRadius)}},BRp$c.tryToCorrectInvalidPoints=function(edge,pairInfo){var rs=edge._private.rscratch;if("bezier"===rs.edgeType){var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,srcShape=pairInfo.srcShape,tgtShape=pairInfo.tgtShape,srcCornerRadius=pairInfo.srcCornerRadius,tgtCornerRadius=pairInfo.tgtCornerRadius,srcRs=pairInfo.srcRs,tgtRs=pairInfo.tgtRs,badStart=!number$1(rs.startX)||!number$1(rs.startY),badAStart=!number$1(rs.arrowStartX)||!number$1(rs.arrowStartY),badEnd=!number$1(rs.endX)||!number$1(rs.endY),badAEnd=!number$1(rs.arrowEndX)||!number$1(rs.arrowEndY),minCpADist=3*(this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth),startACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.startX,y:rs.startY}),closeStartACp=startACpDist<minCpADist,endACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.endX,y:rs.endY}),closeEndACp=endACpDist<minCpADist,overlapping=!1;if(badStart||badAStart||closeStartACp){overlapping=!0;var cpD={x:rs.ctrlpts[0]-srcPos.x,y:rs.ctrlpts[1]-srcPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.ctrlpts[0]+2*cpM.x*radius,y:rs.ctrlpts[1]+2*cpM.y*radius},srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,0,srcCornerRadius,srcRs);closeStartACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-startACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-startACpDist)):(rs.ctrlpts[0]=srcCtrlPtIntn[0]+cpM.x*minCpADist,rs.ctrlpts[1]=srcCtrlPtIntn[1]+cpM.y*minCpADist)}if(badEnd||badAEnd||closeEndACp){overlapping=!0;var _cpD={x:rs.ctrlpts[0]-tgtPos.x,y:rs.ctrlpts[1]-tgtPos.y},_cpL=Math.sqrt(_cpD.x*_cpD.x+_cpD.y*_cpD.y),_cpM={x:_cpD.x/_cpL,y:_cpD.y/_cpL},_radius=Math.max(srcW,srcH),_cpProj={x:rs.ctrlpts[0]+2*_cpM.x*_radius,y:rs.ctrlpts[1]+2*_cpM.y*_radius},tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,_cpProj.x,_cpProj.y,0,tgtCornerRadius,tgtRs);closeEndACp?(rs.ctrlpts[0]=rs.ctrlpts[0]+_cpM.x*(minCpADist-endACpDist),rs.ctrlpts[1]=rs.ctrlpts[1]+_cpM.y*(minCpADist-endACpDist)):(rs.ctrlpts[0]=tgtCtrlPtIntn[0]+_cpM.x*minCpADist,rs.ctrlpts[1]=tgtCtrlPtIntn[1]+_cpM.y*minCpADist)}overlapping&&this.findEndpoints(edge)}},BRp$c.storeAllpts=function(edge){var rs=edge._private.rscratch;if("multibezier"===rs.edgeType||"bezier"===rs.edgeType||"self"===rs.edgeType||"compound"===rs.edgeType){rs.allpts=[],rs.allpts.push(rs.startX,rs.startY);for(var b=0;b+1<rs.ctrlpts.length;b+=2)rs.allpts.push(rs.ctrlpts[b],rs.ctrlpts[b+1]),b+3<rs.ctrlpts.length&&rs.allpts.push((rs.ctrlpts[b]+rs.ctrlpts[b+2])/2,(rs.ctrlpts[b+1]+rs.ctrlpts[b+3])/2);var m;rs.allpts.push(rs.endX,rs.endY),rs.ctrlpts.length/2%2==0?(m=rs.allpts.length/2-1,rs.midX=rs.allpts[m],rs.midY=rs.allpts[m+1]):(m=rs.allpts.length/2-3,rs.midX=qbezierAt(rs.allpts[m],rs.allpts[m+2],rs.allpts[m+4],.5),rs.midY=qbezierAt(rs.allpts[m+1],rs.allpts[m+3],rs.allpts[m+5],.5))}else if("straight"===rs.edgeType)rs.allpts=[rs.startX,rs.startY,rs.endX,rs.endY],rs.midX=(rs.startX+rs.endX+rs.arrowStartX+rs.arrowEndX)/4,rs.midY=(rs.startY+rs.endY+rs.arrowStartY+rs.arrowEndY)/4;else if("segments"===rs.edgeType){if(rs.allpts=[],rs.allpts.push(rs.startX,rs.startY),rs.allpts.push.apply(rs.allpts,rs.segpts),rs.allpts.push(rs.endX,rs.endY),rs.isRound){rs.roundCorners=[];for(var i=2;i+3<rs.allpts.length;i+=2){var radius=rs.radii[i/2-1],isArcRadius=rs.isArcRadius[i/2-1];rs.roundCorners.push(getRoundCorner({x:rs.allpts[i-2],y:rs.allpts[i-1]},{x:rs.allpts[i],y:rs.allpts[i+1],radius},{x:rs.allpts[i+2],y:rs.allpts[i+3]},radius,isArcRadius))}}if(rs.segpts.length%4==0){var i2=rs.segpts.length/2,i1=i2-2;rs.midX=(rs.segpts[i1]+rs.segpts[i2])/2,rs.midY=(rs.segpts[i1+1]+rs.segpts[i2+1])/2}else{var _i=rs.segpts.length/2-1;if(rs.isRound){var point={x:rs.segpts[_i],y:rs.segpts[_i+1]},corner=rs.roundCorners[_i/2];if(0===corner.radius){var nextPoint={x:rs.segpts[_i+2],y:rs.segpts[_i+3]};rs.midX=point.x,rs.midY=point.y,rs.midVector=[point.y-nextPoint.y,nextPoint.x-point.x]}else{var v=[point.x-corner.cx,point.y-corner.cy],factor=corner.radius/Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2));v=v.map(function(c){return c*factor}),rs.midX=corner.cx+v[0],rs.midY=corner.cy+v[1],rs.midVector=v}}else rs.midX=rs.segpts[_i],rs.midY=rs.segpts[_i+1]}}},BRp$c.checkForInvalidEdgeWarning=function(edge){var rs=edge[0]._private.rscratch;rs.nodesOverlap||number$1(rs.startX)&&number$1(rs.startY)&&number$1(rs.endX)&&number$1(rs.endY)?rs.loggedErr=!1:rs.loggedErr||(rs.loggedErr=!0,warn("Edge `"+edge.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))},BRp$c.findEdgeControlPoints=function(edges){var _this=this;if(edges&&0!==edges.length){for(var r=this,hasCompounds=r.cy.hasCompoundNodes(),hashTable=new Map$1,getKey=function getKey(pairId,edgeIsUnbundled){return[].concat(_toConsumableArray(pairId),[edgeIsUnbundled?1:0]).join("-")},pairIds=[],haystackEdges=[],i=0;i<edges.length;i++){var edge=edges[i],_p=edge._private,curveStyle=edge.pstyle("curve-style").value;if(!edge.removed()&&edge.takesUpSpace())if("haystack"!==curveStyle){var edgeIsUnbundled="unbundled-bezier"===curveStyle||endsWith(curveStyle,"segments")||"straight"===curveStyle||"straight-triangle"===curveStyle||endsWith(curveStyle,"taxi"),edgeIsBezier="unbundled-bezier"===curveStyle||"bezier"===curveStyle,src=_p.source,tgt=_p.target,pairId=[src.poolIndex(),tgt.poolIndex()].sort(),key=getKey(pairId,edgeIsUnbundled),tableEntry=hashTable.get(key);null==tableEntry&&(tableEntry={eles:[]},pairIds.push({pairId,edgeIsUnbundled}),hashTable.set(key,tableEntry)),tableEntry.eles.push(edge),edgeIsUnbundled&&(tableEntry.hasUnbundled=!0),edgeIsBezier&&(tableEntry.hasBezier=!0)}else haystackEdges.push(edge)}for(var _loop=function _loop(){var swappedpairInfo,_pairIds$p=pairIds[p],pairId=_pairIds$p.pairId,edgeIsUnbundled=_pairIds$p.edgeIsUnbundled,key=getKey(pairId,edgeIsUnbundled),pairInfo=hashTable.get(key);if(!pairInfo.hasUnbundled){var pllEdges=pairInfo.eles[0].parallelEdges().filter(function(e){return e.isBundledBezier()});clearArray(pairInfo.eles),pllEdges.forEach(function(edge){return pairInfo.eles.push(edge)}),pairInfo.eles.sort(function(edge1,edge2){return edge1.poolIndex()-edge2.poolIndex()})}var firstEdge=pairInfo.eles[0],src=firstEdge.source(),tgt=firstEdge.target();if(src.poolIndex()>tgt.poolIndex()){var temp=src;src=tgt,tgt=temp}var srcPos=pairInfo.srcPos=src.position(),tgtPos=pairInfo.tgtPos=tgt.position(),srcW=pairInfo.srcW=src.outerWidth(),srcH=pairInfo.srcH=src.outerHeight(),tgtW=pairInfo.tgtW=tgt.outerWidth(),tgtH=pairInfo.tgtH=tgt.outerHeight(),srcShape=pairInfo.srcShape=r.nodeShapes[_this.getNodeShape(src)],tgtShape=pairInfo.tgtShape=r.nodeShapes[_this.getNodeShape(tgt)],srcCornerRadius=pairInfo.srcCornerRadius="auto"===src.pstyle("corner-radius").value?"auto":src.pstyle("corner-radius").pfValue,tgtCornerRadius=pairInfo.tgtCornerRadius="auto"===tgt.pstyle("corner-radius").value?"auto":tgt.pstyle("corner-radius").pfValue,tgtRs=pairInfo.tgtRs=tgt._private.rscratch,srcRs=pairInfo.srcRs=src._private.rscratch;pairInfo.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var _i2=0;_i2<pairInfo.eles.length;_i2++){var _edge=pairInfo.eles[_i2],rs=_edge[0]._private.rscratch,_curveStyle=_edge.pstyle("curve-style").value,_edgeIsUnbundled="unbundled-bezier"===_curveStyle||endsWith(_curveStyle,"segments")||endsWith(_curveStyle,"taxi"),edgeIsSwapped=!src.same(_edge.source());if(!pairInfo.calculatedIntersection&&src!==tgt&&(pairInfo.hasBezier||pairInfo.hasUnbundled)){pairInfo.calculatedIntersection=!0;var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,0,srcCornerRadius,srcRs),srcIntn=pairInfo.srcIntn=srcOutside,tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,0,tgtCornerRadius,tgtRs),tgtIntn=pairInfo.tgtIntn=tgtOutside,intersectionPts=pairInfo.intersectionPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]},posPts=pairInfo.posPts={x1:srcPos.x,x2:tgtPos.x,y1:srcPos.y,y2:tgtPos.y},dy=tgtOutside[1]-srcOutside[1],dx=tgtOutside[0]-srcOutside[0],l=Math.sqrt(dx*dx+dy*dy);number$1(l)&&l>=AVOID_IMPOSSIBLE_BEZIER_CONSTANT_L||(l=Math.sqrt(Math.max(dx*dx,.01)+Math.max(dy*dy,.01)));var vector=pairInfo.vector={x:dx,y:dy},vectorNorm=pairInfo.vectorNorm={x:vector.x/l,y:vector.y/l},vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x};pairInfo.nodesOverlap=!number$1(l)||tgtShape.checkPoint(srcOutside[0],srcOutside[1],0,tgtW,tgtH,tgtPos.x,tgtPos.y,tgtCornerRadius,tgtRs)||srcShape.checkPoint(tgtOutside[0],tgtOutside[1],0,srcW,srcH,srcPos.x,srcPos.y,srcCornerRadius,srcRs),pairInfo.vectorNormInverse=vectorNormInverse,swappedpairInfo={nodesOverlap:pairInfo.nodesOverlap,dirCounts:pairInfo.dirCounts,calculatedIntersection:!0,hasBezier:pairInfo.hasBezier,hasUnbundled:pairInfo.hasUnbundled,eles:pairInfo.eles,srcPos:tgtPos,srcRs:tgtRs,tgtPos:srcPos,tgtRs:srcRs,srcW:tgtW,srcH:tgtH,tgtW:srcW,tgtH:srcH,srcIntn:tgtIntn,tgtIntn:srcIntn,srcShape:tgtShape,tgtShape:srcShape,posPts:{x1:posPts.x2,y1:posPts.y2,x2:posPts.x1,y2:posPts.y1},intersectionPts:{x1:intersectionPts.x2,y1:intersectionPts.y2,x2:intersectionPts.x1,y2:intersectionPts.y1},vector:{x:-vector.x,y:-vector.y},vectorNorm:{x:-vectorNorm.x,y:-vectorNorm.y},vectorNormInverse:{x:-vectorNormInverse.x,y:-vectorNormInverse.y}}}var passedPairInfo=edgeIsSwapped?swappedpairInfo:pairInfo;rs.nodesOverlap=passedPairInfo.nodesOverlap,rs.srcIntn=passedPairInfo.srcIntn,rs.tgtIntn=passedPairInfo.tgtIntn,rs.isRound=_curveStyle.startsWith("round"),hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src)||src.same(tgt)&&src.isParent())?_this.findCompoundLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled):src===tgt?_this.findLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled):_curveStyle.endsWith("segments")?_this.findSegmentsPoints(_edge,passedPairInfo):_curveStyle.endsWith("taxi")?_this.findTaxiPoints(_edge,passedPairInfo):"straight"===_curveStyle||!_edgeIsUnbundled&&pairInfo.eles.length%2==1&&_i2===Math.floor(pairInfo.eles.length/2)?_this.findStraightEdgePoints(_edge):_this.findBezierPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled,edgeIsSwapped),_this.findEndpoints(_edge),_this.tryToCorrectInvalidPoints(_edge,passedPairInfo),_this.checkForInvalidEdgeWarning(_edge),_this.storeAllpts(_edge),_this.storeEdgeProjections(_edge),_this.calculateArrowAngles(_edge),_this.recalculateEdgeLabelProjections(_edge),_this.calculateLabelAngles(_edge)}},p=0;p<pairIds.length;p++)_loop();this.findHaystackPoints(haystackEdges)}},BRp$c.getSegmentPoints=function(edge){var rs=edge[0]._private.rscratch;if(this.recalculateRenderedStyle(edge),"segments"===rs.edgeType)return getPts(rs.segpts)},BRp$c.getControlPoints=function(edge){var rs=edge[0]._private.rscratch;this.recalculateRenderedStyle(edge);var type=rs.edgeType;if("bezier"===type||"multibezier"===type||"self"===type||"compound"===type)return getPts(rs.ctrlpts)},BRp$c.getEdgeMidpoint=function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),{x:rs.midX,y:rs.midY}};var BRp$b={manualEndptToPx:function(node,prop){var npos=node.position(),w=node.outerWidth(),h=node.outerHeight(),rs=node._private.rscratch;if(2===prop.value.length){var p=[prop.pfValue[0],prop.pfValue[1]];return"%"===prop.units[0]&&(p[0]=p[0]*w),"%"===prop.units[1]&&(p[1]=p[1]*h),p[0]+=npos.x,p[1]+=npos.y,p}var angle=prop.pfValue[0];angle=-Math.PI/2+angle;var l=2*Math.max(w,h),_p=[npos.x+Math.cos(angle)*l,npos.y+Math.sin(angle)*l];return this.nodeShapes[this.getNodeShape(node)].intersectLine(npos.x,npos.y,w,h,_p[0],_p[1],0,"auto"===node.pstyle("corner-radius").value?"auto":node.pstyle("corner-radius").pfValue,rs)},findEndpoints:function(edge){var _ref,_tgtManEndpt$pfValue,_ref2,_srcManEndpt$pfValue,intersect,p1,p2,p1_i,p2_i,r=this,source=edge.source()[0],target=edge.target()[0],srcPos=source.position(),tgtPos=target.position(),tgtArShape=edge.pstyle("target-arrow-shape").value,srcArShape=edge.pstyle("source-arrow-shape").value,tgtDist=edge.pstyle("target-distance-from-node").pfValue,srcDist=edge.pstyle("source-distance-from-node").pfValue,srcRs=source._private.rscratch,tgtRs=target._private.rscratch,curveStyle=edge.pstyle("curve-style").value,rs=edge._private.rscratch,et=rs.edgeType,taxi=endsWith(curveStyle,"taxi"),self="self"===et||"compound"===et,bezier="bezier"===et||"multibezier"===et||self,multi="bezier"!==et,lines="straight"===et||"segments"===et,segments="segments"===et,hasEndpts=bezier||multi||lines,overrideEndpts=self||taxi,srcManEndpt=edge.pstyle("source-endpoint"),srcManEndptVal=overrideEndpts?"outside-to-node":srcManEndpt.value,srcCornerRadius="auto"===source.pstyle("corner-radius").value?"auto":source.pstyle("corner-radius").pfValue,tgtManEndpt=edge.pstyle("target-endpoint"),tgtManEndptVal=overrideEndpts?"outside-to-node":tgtManEndpt.value,tgtCornerRadius="auto"===target.pstyle("corner-radius").value?"auto":target.pstyle("corner-radius").pfValue;rs.srcManEndpt=srcManEndpt,rs.tgtManEndpt=tgtManEndpt;var tgtManEndptPt=null!==(_ref=2===(null==tgtManEndpt||null===(_tgtManEndpt$pfValue=tgtManEndpt.pfValue)||void 0===_tgtManEndpt$pfValue?void 0:_tgtManEndpt$pfValue.length)?tgtManEndpt.pfValue:null)&&void 0!==_ref?_ref:[0,0],srcManEndptPt=null!==(_ref2=2===(null==srcManEndpt||null===(_srcManEndpt$pfValue=srcManEndpt.pfValue)||void 0===_srcManEndpt$pfValue?void 0:_srcManEndpt$pfValue.length)?srcManEndpt.pfValue:null)&&void 0!==_ref2?_ref2:[0,0];if(bezier){var cpStart=[rs.ctrlpts[0],rs.ctrlpts[1]];p1=multi?[rs.ctrlpts[rs.ctrlpts.length-2],rs.ctrlpts[rs.ctrlpts.length-1]]:cpStart,p2=cpStart}else if(lines){var srcArrowFromPt=segments?rs.segpts.slice(0,2):[tgtPos.x+tgtManEndptPt[0],tgtPos.y+tgtManEndptPt[1]];p1=segments?rs.segpts.slice(rs.segpts.length-2):[srcPos.x+srcManEndptPt[0],srcPos.y+srcManEndptPt[1]],p2=srcArrowFromPt}if("inside-to-node"===tgtManEndptVal)intersect=[tgtPos.x,tgtPos.y];else if(tgtManEndpt.units)intersect=this.manualEndptToPx(target,tgtManEndpt);else if("outside-to-line"===tgtManEndptVal)intersect=rs.tgtIntn;else if("outside-to-node"===tgtManEndptVal||"outside-to-node-or-label"===tgtManEndptVal?p1_i=p1:"outside-to-line"!==tgtManEndptVal&&"outside-to-line-or-label"!==tgtManEndptVal||(p1_i=[srcPos.x,srcPos.y]),intersect=r.nodeShapes[this.getNodeShape(target)].intersectLine(tgtPos.x,tgtPos.y,target.outerWidth(),target.outerHeight(),p1_i[0],p1_i[1],0,tgtCornerRadius,tgtRs),"outside-to-node-or-label"===tgtManEndptVal||"outside-to-line-or-label"===tgtManEndptVal){var trs=target._private.rscratch,lw=trs.labelWidth,lh=trs.labelHeight,lx=trs.labelX,ly=trs.labelY,lw2=lw/2,lh2=lh/2,va=target.pstyle("text-valign").value;"top"===va?ly-=lh2:"bottom"===va&&(ly+=lh2);var ha=target.pstyle("text-halign").value;"left"===ha?lx-=lw2:"right"===ha&&(lx+=lw2);var labelIntersect=polygonIntersectLine(p1_i[0],p1_i[1],[lx-lw2,ly-lh2,lx+lw2,ly-lh2,lx+lw2,ly+lh2,lx-lw2,ly+lh2],tgtPos.x,tgtPos.y);if(labelIntersect.length>0){var refPt=srcPos,intSqdist=sqdist(refPt,array2point(intersect)),labIntSqdist=sqdist(refPt,array2point(labelIntersect)),minSqDist=intSqdist;if(labIntSqdist<intSqdist&&(intersect=labelIntersect,minSqDist=labIntSqdist),labelIntersect.length>2)sqdist(refPt,{x:labelIntersect[2],y:labelIntersect[3]})<minSqDist&&(intersect=[labelIntersect[2],labelIntersect[3]])}}var arrowEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].spacing(edge)+tgtDist),edgeEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].gap(edge)+tgtDist);if(rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1],"inside-to-node"===srcManEndptVal)intersect=[srcPos.x,srcPos.y];else if(srcManEndpt.units)intersect=this.manualEndptToPx(source,srcManEndpt);else if("outside-to-line"===srcManEndptVal)intersect=rs.srcIntn;else if("outside-to-node"===srcManEndptVal||"outside-to-node-or-label"===srcManEndptVal?p2_i=p2:"outside-to-line"!==srcManEndptVal&&"outside-to-line-or-label"!==srcManEndptVal||(p2_i=[tgtPos.x,tgtPos.y]),intersect=r.nodeShapes[this.getNodeShape(source)].intersectLine(srcPos.x,srcPos.y,source.outerWidth(),source.outerHeight(),p2_i[0],p2_i[1],0,srcCornerRadius,srcRs),"outside-to-node-or-label"===srcManEndptVal||"outside-to-line-or-label"===srcManEndptVal){var srs=source._private.rscratch,_lw=srs.labelWidth,_lh=srs.labelHeight,_lx=srs.labelX,_ly=srs.labelY,_lw2=_lw/2,_lh2=_lh/2,_va=source.pstyle("text-valign").value;"top"===_va?_ly-=_lh2:"bottom"===_va&&(_ly+=_lh2);var _ha=source.pstyle("text-halign").value;"left"===_ha?_lx-=_lw2:"right"===_ha&&(_lx+=_lw2);var _labelIntersect=polygonIntersectLine(p2_i[0],p2_i[1],[_lx-_lw2,_ly-_lh2,_lx+_lw2,_ly-_lh2,_lx+_lw2,_ly+_lh2,_lx-_lw2,_ly+_lh2],srcPos.x,srcPos.y);if(_labelIntersect.length>0){var _refPt=tgtPos,_intSqdist=sqdist(_refPt,array2point(intersect)),_labIntSqdist=sqdist(_refPt,array2point(_labelIntersect)),_minSqDist=_intSqdist;if(_labIntSqdist<_intSqdist&&(intersect=[_labelIntersect[0],_labelIntersect[1]],_minSqDist=_labIntSqdist),_labelIntersect.length>2)sqdist(_refPt,{x:_labelIntersect[2],y:_labelIntersect[3]})<_minSqDist&&(intersect=[_labelIntersect[2],_labelIntersect[3]])}}var arrowStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].spacing(edge)+srcDist),edgeStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].gap(edge)+srcDist);rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1],hasEndpts&&(number$1(rs.startX)&&number$1(rs.startY)&&number$1(rs.endX)&&number$1(rs.endY)?rs.badLine=!1:rs.badLine=!0)},getSourceEndpoint:function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),"haystack"===rs.edgeType?{x:rs.haystackPts[0],y:rs.haystackPts[1]}:{x:rs.arrowStartX,y:rs.arrowStartY}},getTargetEndpoint:function(edge){var rs=edge[0]._private.rscratch;return this.recalculateRenderedStyle(edge),"haystack"===rs.edgeType?{x:rs.haystackPts[2],y:rs.haystackPts[3]}:{x:rs.arrowEndX,y:rs.arrowEndY}}},BRp$a={};function pushBezierPts(r,edge,pts){for(var qbezierAt$1=function qbezierAt$1(p1,p2,p3,t){return qbezierAt(p1,p2,p3,t)},bpts=edge._private.rstyle.bezierPts,i=0;i<r.bezierProjPcts.length;i++){var p=r.bezierProjPcts[i];bpts.push({x:qbezierAt$1(pts[0],pts[2],pts[4],p),y:qbezierAt$1(pts[1],pts[3],pts[5],p)})}}BRp$a.storeEdgeProjections=function(edge){var _p=edge._private,rs=_p.rscratch,et=rs.edgeType;if(_p.rstyle.bezierPts=null,_p.rstyle.linePts=null,_p.rstyle.haystackPts=null,"multibezier"===et||"bezier"===et||"self"===et||"compound"===et){_p.rstyle.bezierPts=[];for(var i=0;i+5<rs.allpts.length;i+=4)pushBezierPts(this,edge,rs.allpts.slice(i,i+6))}else if("segments"===et){var lpts=_p.rstyle.linePts=[];for(i=0;i+1<rs.allpts.length;i+=2)lpts.push({x:rs.allpts[i],y:rs.allpts[i+1]})}else if("haystack"===et){var hpts=rs.haystackPts;_p.rstyle.haystackPts=[{x:hpts[0],y:hpts[1]},{x:hpts[2],y:hpts[3]}]}_p.rstyle.arrowWidth=this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth},BRp$a.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)};var BRp$9={recalculateNodeLabelProjection:function(node){var content=node.pstyle("label").strValue;if(!emptyString(content)){var textX,textY,_p=node._private,nodeWidth=node.width(),nodeHeight=node.height(),padding=node.padding(),nodePos=node.position(),textHalign=node.pstyle("text-halign").strValue,textValign=node.pstyle("text-valign").strValue,rs=_p.rscratch,rstyle=_p.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2-padding;break;case"right":textX=nodePos.x+nodeWidth/2+padding;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2-padding;break;case"bottom":textY=nodePos.y+nodeHeight/2+padding;break;default:textY=nodePos.y}rs.labelX=textX,rs.labelY=textY,rstyle.labelX=textX,rstyle.labelY=textY,this.calculateLabelAngles(node),this.applyLabelDimensions(node)}}},lineAngleFromDelta=function lineAngleFromDelta(dx,dy){var angle=Math.atan(dy/dx);return 0===dx&&angle<0&&(angle*=-1),angle},lineAngle=function lineAngle(p0,p1){var dx=p1.x-p0.x,dy=p1.y-p0.y;return lineAngleFromDelta(dx,dy)};BRp$9.recalculateEdgeLabelProjections=function(edge){var p,_p=edge._private,rs=_p.rscratch,r=this,content={mid:edge.pstyle("label").strValue,source:edge.pstyle("source-label").strValue,target:edge.pstyle("target-label").strValue};if(content.mid||content.source||content.target){p={x:rs.midX,y:rs.midY};var setRs=function setRs(propName,prefix,value){setPrefixedProperty(_p.rscratch,propName,prefix,value),setPrefixedProperty(_p.rstyle,propName,prefix,value)};setRs("labelX",null,p.x),setRs("labelY",null,p.y);var midAngle=lineAngleFromDelta(rs.midDispX,rs.midDispY);setRs("labelAutoAngle",null,midAngle);var _createControlPointInfo=function createControlPointInfo(){if(_createControlPointInfo.cache)return _createControlPointInfo.cache;for(var ctrlpts=[],i=0;i+5<rs.allpts.length;i+=4){var p0={x:rs.allpts[i],y:rs.allpts[i+1]},p1={x:rs.allpts[i+2],y:rs.allpts[i+3]},p2={x:rs.allpts[i+4],y:rs.allpts[i+5]};ctrlpts.push({p0,p1,p2,startDist:0,length:0,segments:[]})}var bpts=_p.rstyle.bezierPts,nProjs=r.bezierProjPcts.length;function addSegment(cp,p0,p1,t0,t1){var length=dist(p0,p1),prevSegment=cp.segments[cp.segments.length-1],segment={p0,p1,t0,t1,startDist:prevSegment?prevSegment.startDist+prevSegment.length:0,length};cp.segments.push(segment),cp.length+=length}for(var _i=0;_i<ctrlpts.length;_i++){var cp=ctrlpts[_i],prevCp=ctrlpts[_i-1];prevCp&&(cp.startDist=prevCp.startDist+prevCp.length),addSegment(cp,cp.p0,bpts[_i*nProjs],0,r.bezierProjPcts[0]);for(var j=0;j<nProjs-1;j++)addSegment(cp,bpts[_i*nProjs+j],bpts[_i*nProjs+j+1],r.bezierProjPcts[j],r.bezierProjPcts[j+1]);addSegment(cp,bpts[_i*nProjs+nProjs-1],cp.p2,r.bezierProjPcts[nProjs-1],1)}return _createControlPointInfo.cache=ctrlpts},calculateEndProjection=function calculateEndProjection(prefix){var angle,isSrc="source"===prefix;if(content[prefix]){var offset=edge.pstyle(prefix+"-text-offset").pfValue;switch(rs.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var selected,cps=_createControlPointInfo(),startDist=0,totalDist=0,i=0;i<cps.length;i++){for(var _cp=cps[isSrc?i:cps.length-1-i],j=0;j<_cp.segments.length;j++){var _seg=_cp.segments[isSrc?j:_cp.segments.length-1-j],lastSeg=i===cps.length-1&&j===_cp.segments.length-1;if(startDist=totalDist,(totalDist+=_seg.length)>=offset||lastSeg){selected={cp:_cp,segment:_seg};break}}if(selected)break}var cp=selected.cp,seg=selected.segment,tSegment=(offset-startDist)/seg.length,segDt=seg.t1-seg.t0,t=isSrc?seg.t0+segDt*tSegment:seg.t1-segDt*tSegment;t=bound(0,t,1),p=qbezierPtAt(cp.p0,cp.p1,cp.p2,t),angle=function bezierAngle(p0,p1,p2,t){var t0=bound(0,t-.001,1),t1=bound(0,t+.001,1),lp0=qbezierPtAt(p0,p1,p2,t0),lp1=qbezierPtAt(p0,p1,p2,t1);return lineAngle(lp0,lp1)}(cp.p0,cp.p1,cp.p2,t);break;case"straight":case"segments":case"haystack":for(var di,d0,p0,p1,d=0,l=rs.allpts.length,_i2=0;_i2+3<l&&(isSrc?(p0={x:rs.allpts[_i2],y:rs.allpts[_i2+1]},p1={x:rs.allpts[_i2+2],y:rs.allpts[_i2+3]}):(p0={x:rs.allpts[l-2-_i2],y:rs.allpts[l-1-_i2]},p1={x:rs.allpts[l-4-_i2],y:rs.allpts[l-3-_i2]}),d0=d,!((d+=di=dist(p0,p1))>=offset));_i2+=2);var _t=(offset-d0)/di;_t=bound(0,_t,1),p=function lineAt(p0,p1,t,d){var vec_x=p1.x-p0.x,vec_y=p1.y-p0.y,vecDist=dist(p0,p1),normVec_x=vec_x/vecDist,normVec_y=vec_y/vecDist;return t=null==t?0:t,d=null!=d?d:t*vecDist,{x:p0.x+normVec_x*d,y:p0.y+normVec_y*d}}(p0,p1,_t),angle=lineAngle(p0,p1)}setRs("labelX",prefix,p.x),setRs("labelY",prefix,p.y),setRs("labelAutoAngle",prefix,angle)}};calculateEndProjection("source"),calculateEndProjection("target"),this.applyLabelDimensions(edge)}},BRp$9.applyLabelDimensions=function(ele){this.applyPrefixedLabelDimensions(ele),ele.isEdge()&&(this.applyPrefixedLabelDimensions(ele,"source"),this.applyPrefixedLabelDimensions(ele,"target"))},BRp$9.applyPrefixedLabelDimensions=function(ele,prefix){var _p=ele._private,text=this.getLabelText(ele,prefix),cacheKey=hashString(text,ele._private.labelDimsKey);if(getPrefixedProperty(_p.rscratch,"prefixedLabelDimsKey",prefix)!==cacheKey){setPrefixedProperty(_p.rscratch,"prefixedLabelDimsKey",prefix,cacheKey);var labelDims=this.calculateLabelDimensions(ele,text),lineHeight=ele.pstyle("line-height").pfValue,textWrap=ele.pstyle("text-wrap").strValue,lines=getPrefixedProperty(_p.rscratch,"labelWrapCachedLines",prefix)||[],numLines="wrap"!==textWrap?1:Math.max(lines.length,1),normPerLineHeight=labelDims.height/numLines,labelLineHeight=normPerLineHeight*lineHeight,width=labelDims.width,height=labelDims.height+(numLines-1)*(lineHeight-1)*normPerLineHeight;setPrefixedProperty(_p.rstyle,"labelWidth",prefix,width),setPrefixedProperty(_p.rscratch,"labelWidth",prefix,width),setPrefixedProperty(_p.rstyle,"labelHeight",prefix,height),setPrefixedProperty(_p.rscratch,"labelHeight",prefix,height),setPrefixedProperty(_p.rscratch,"labelLineHeight",prefix,labelLineHeight)}},BRp$9.getLabelText=function(ele,prefix){var _p=ele._private,pfd=prefix?prefix+"-":"",text=ele.pstyle(pfd+"label").strValue,textTransform=ele.pstyle("text-transform").value,rscratch=function rscratch(propName,value){return value?(setPrefixedProperty(_p.rscratch,propName,prefix,value),value):getPrefixedProperty(_p.rscratch,propName,prefix)};if(!text)return"";"none"==textTransform||("uppercase"==textTransform?text=text.toUpperCase():"lowercase"==textTransform&&(text=text.toLowerCase()));var wrapStyle=ele.pstyle("text-wrap").value;if("wrap"===wrapStyle){var labelKey=rscratch("labelKey");if(null!=labelKey&&rscratch("labelWrapKey")===labelKey)return rscratch("labelWrapCachedText");for(var lines=text.split("\n"),maxW=ele.pstyle("text-max-width").pfValue,overflowAny="anywhere"===ele.pstyle("text-overflow-wrap").value,wrappedLines=[],separatorRegex=/[\s\u200b]+|$/g,l=0;l<lines.length;l++){var line=lines[l],lineW=this.calculateLabelDimensions(ele,line).width;if(overflowAny){var processedLine=line.split("").join("");line=processedLine}if(lineW>maxW){var _step,subline="",previousIndex=0,_iterator=_createForOfIteratorHelper(line.matchAll(separatorRegex));try{for(_iterator.s();!(_step=_iterator.n()).done;){var separatorMatch=_step.value,wordSeparator=separatorMatch[0],word=line.substring(previousIndex,separatorMatch.index);previousIndex=separatorMatch.index+wordSeparator.length;var testLine=0===subline.length?word:subline+word+wordSeparator;this.calculateLabelDimensions(ele,testLine).width<=maxW?subline+=word+wordSeparator:(subline&&wrappedLines.push(subline),subline=word+wordSeparator)}}catch(err){_iterator.e(err)}finally{_iterator.f()}subline.match(/^[\s\u200b]+$/)||wrappedLines.push(subline)}else wrappedLines.push(line)}rscratch("labelWrapCachedLines",wrappedLines),text=rscratch("labelWrapCachedText",wrappedLines.join("\n")),rscratch("labelWrapKey",labelKey)}else if("ellipsis"===wrapStyle){var _maxW=ele.pstyle("text-max-width").pfValue,ellipsized="",incLastCh=!1;if(this.calculateLabelDimensions(ele,text).width<_maxW)return text;for(var i=0;i<text.length;i++){if(this.calculateLabelDimensions(ele,ellipsized+text[i]+"").width>_maxW)break;ellipsized+=text[i],i===text.length-1&&(incLastCh=!0)}return incLastCh||(ellipsized+=""),ellipsized}return text},BRp$9.getLabelJustification=function(ele){var justification=ele.pstyle("text-justification").strValue,textHalign=ele.pstyle("text-halign").strValue;if("auto"!==justification)return justification;if(!ele.isNode())return"center";switch(textHalign){case"left":return"right";case"right":return"left";default:return"center"}},BRp$9.calculateLabelDimensions=function(ele,text){var document=this.cy.window().document,fStyle=ele.pstyle("font-style").strValue,size=ele.pstyle("font-size").pfValue,family=ele.pstyle("font-family").strValue,weight=ele.pstyle("font-weight").strValue,canvas=this.labelCalcCanvas,c2d=this.labelCalcCanvasContext;if(!canvas){canvas=this.labelCalcCanvas=document.createElement("canvas"),c2d=this.labelCalcCanvasContext=canvas.getContext("2d");var ds=canvas.style;ds.position="absolute",ds.left="-9999px",ds.top="-9999px",ds.zIndex="-1",ds.visibility="hidden",ds.pointerEvents="none"}c2d.font="".concat(fStyle," ").concat(weight," ").concat(size,"px ").concat(family);for(var width=0,height=0,lines=text.split("\n"),i=0;i<lines.length;i++){var line=lines[i],metrics=c2d.measureText(line),w=Math.ceil(metrics.width),h=size;width=Math.max(w,width),height+=h}return{width:width+=0,height:height+=0}},BRp$9.calculateLabelAngle=function(ele,prefix){var rs=ele._private.rscratch,isEdge=ele.isEdge(),prefixDash=prefix?prefix+"-":"",rot=ele.pstyle(prefixDash+"text-rotation"),rotStr=rot.strValue;return"none"===rotStr?0:isEdge&&"autorotate"===rotStr?rs.labelAutoAngle:"autorotate"===rotStr?0:rot.pfValue},BRp$9.calculateLabelAngles=function(ele){var r=this,isEdge=ele.isEdge(),rs=ele._private.rscratch;rs.labelAngle=r.calculateLabelAngle(ele),isEdge&&(rs.sourceLabelAngle=r.calculateLabelAngle(ele,"source"),rs.targetLabelAngle=r.calculateLabelAngle(ele,"target"))};var BRp$8={},warnedCutRect=!1;BRp$8.getNodeShape=function(node){var shape=node.pstyle("shape").value;if("cutrectangle"===shape&&(node.width()<28||node.height()<28))return warnedCutRect||(warn("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),warnedCutRect=!0),"rectangle";if(node.isParent())return"rectangle"===shape||"roundrectangle"===shape||"round-rectangle"===shape||"cutrectangle"===shape||"cut-rectangle"===shape||"barrel"===shape?shape:"rectangle";if("polygon"===shape){var points=node.pstyle("shape-polygon-points").value;return this.nodeShapes.makePolygon(points).name}return shape};var BRp$7={registerCalculationListeners:function(){var cy=this.cy,elesToUpdate=cy.collection(),r=this,enqueue=function enqueue(eles){var dirtyStyleCaches=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(elesToUpdate.merge(eles),dirtyStyleCaches)for(var i=0;i<eles.length;i++){var rstyle=eles[i]._private.rstyle;rstyle.clean=!1,rstyle.cleanConnected=!1}};r.binder(cy).on("bounds.* dirty.*",function onDirtyBounds(e){var ele=e.target;enqueue(ele)}).on("style.* background.*",function onDirtyStyle(e){var ele=e.target;enqueue(ele,!1)});var updateEleCalcs=function updateEleCalcs(willDraw){if(willDraw){var fns=r.onUpdateEleCalcsFns;elesToUpdate.cleanStyle();for(var i=0;i<elesToUpdate.length;i++){var ele=elesToUpdate[i],rstyle=ele._private.rstyle;ele.isNode()&&!rstyle.cleanConnected&&(enqueue(ele.connectedEdges()),rstyle.cleanConnected=!0)}if(fns)for(var _i=0;_i<fns.length;_i++){(0,fns[_i])(willDraw,elesToUpdate)}r.recalculateRenderedStyle(elesToUpdate),elesToUpdate=cy.collection()}};r.flushRenderedStyleQueue=function(){updateEleCalcs(!0)},r.beforeRender(updateEleCalcs,r.beforeRenderPriorities.eleCalcs)},onUpdateEleCalcs:function(fn){(this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[]).push(fn)},recalculateRenderedStyle:function(eles,useCache){var isCleanConnected=function isCleanConnected(ele){return ele._private.rstyle.cleanConnected};if(0!==eles.length){var edges=[],nodes=[];if(!this.destroyed){void 0===useCache&&(useCache=!0);for(var i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,rstyle=_p.rstyle;!ele.isEdge()||isCleanConnected(ele.source())&&isCleanConnected(ele.target())||(rstyle.clean=!1),ele.isEdge()&&ele.isBundledBezier()&&ele.parallelEdges().some(function(ele){return!ele._private.rstyle.clean&&ele.isBundledBezier()})&&(rstyle.clean=!1),useCache&&rstyle.clean||ele.removed()||"none"!==ele.pstyle("display").value&&("nodes"===_p.group?nodes.push(ele):edges.push(ele),rstyle.clean=!0)}for(var _i2=0;_i2<nodes.length;_i2++){var _ele=nodes[_i2],_rstyle=_ele._private.rstyle,pos=_ele.position();this.recalculateNodeLabelProjection(_ele),_rstyle.nodeX=pos.x,_rstyle.nodeY=pos.y,_rstyle.nodeW=_ele.pstyle("width").pfValue,_rstyle.nodeH=_ele.pstyle("height").pfValue}this.recalculateEdgeProjections(edges);for(var _i3=0;_i3<edges.length;_i3++){var _p3=edges[_i3]._private,_rstyle2=_p3.rstyle,rs=_p3.rscratch;_rstyle2.srcX=rs.arrowStartX,_rstyle2.srcY=rs.arrowStartY,_rstyle2.tgtX=rs.arrowEndX,_rstyle2.tgtY=rs.arrowEndY,_rstyle2.midX=rs.midX,_rstyle2.midY=rs.midY,_rstyle2.labelAngle=rs.labelAngle,_rstyle2.sourceLabelAngle=rs.sourceLabelAngle,_rstyle2.targetLabelAngle=rs.targetLabelAngle}}}}},BRp$6={updateCachedGrabbedEles:function(){var eles=this.cachedZSortedEles;if(eles){eles.drag=[],eles.nondrag=[];for(var grabTargets=[],i=0;i<eles.length;i++){var rs=(ele=eles[i])._private.rscratch;ele.grabbed()&&!ele.isParent()?grabTargets.push(ele):rs.inDragLayer?eles.drag.push(ele):eles.nondrag.push(ele)}for(i=0;i<grabTargets.length;i++){var ele=grabTargets[i];eles.drag.push(ele)}}},invalidateCachedZSortedEles:function(){this.cachedZSortedEles=null},getCachedZSortedEles:function(forceRecalc){if(forceRecalc||!this.cachedZSortedEles){var eles=this.cy.mutableElements().toArray();eles.sort(zIndexSort),eles.interactive=eles.filter(function(ele){return ele.interactive()}),this.cachedZSortedEles=eles,this.updateCachedGrabbedEles()}else eles=this.cachedZSortedEles;return eles}},BRp$5={};[BRp$e,BRp$d,BRp$c,BRp$b,BRp$a,BRp$9,BRp$8,BRp$7,BRp$6].forEach(function(props){extend(BRp$5,props)});var BRp$4={getCachedImage:function(url,crossOrigin,onLoad){var imageCache=this.imageCache=this.imageCache||{},cache=imageCache[url];if(cache)return cache.image.complete||cache.image.addEventListener("load",onLoad),cache.image;var image=(cache=imageCache[url]=imageCache[url]||{}).image=new Image;image.addEventListener("load",onLoad),image.addEventListener("error",function(){image.error=!0});return"data:"===url.substring(0,5).toLowerCase()||(crossOrigin="null"===crossOrigin?null:crossOrigin,image.crossOrigin=crossOrigin),image.src=url,image}},BRp$3={registerBinding:function(target,event,handler,useCapture){var args=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(target)){for(var res=[],i=0;i<target.length;i++){var t=target[i];if(void 0!==t){var b=this.binder(t);res.push(b.on.apply(b,args))}}return res}return(b=this.binder(target)).on.apply(b,args)}};BRp$3.binder=function(tgt){var r=this,containerWindow=r.cy.window(),tgtIsDom=tgt===containerWindow||tgt===containerWindow.document||tgt===containerWindow.document.body||function domElement(obj){return"undefined"!=typeof HTMLElement&&obj instanceof HTMLElement}(tgt);if(null==r.supportsPassiveEvents){var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function get(){return supportsPassive=!0,!0}});containerWindow.addEventListener("test",null,opts)}catch(err){}r.supportsPassiveEvents=supportsPassive}var on=function on(event,handler,useCapture){var args=Array.prototype.slice.call(arguments);return tgtIsDom&&r.supportsPassiveEvents&&(args[2]={capture:null!=useCapture&&useCapture,passive:!1,once:!1}),r.bindings.push({target:tgt,args}),(tgt.addEventListener||tgt.on).apply(tgt,args),this};return{on,addEventListener:on,addListener:on,bind:on}},BRp$3.nodeIsDraggable=function(node){return node&&node.isNode()&&!node.locked()&&node.grabbable()},BRp$3.nodeIsGrabbable=function(node){return this.nodeIsDraggable(node)&&node.interactive()},BRp$3.load=function(){var r=this,containerWindow=r.cy.window(),isSelected=function isSelected(ele){return ele.selected()},triggerEvents=function triggerEvents(target,names,e,position){null==target&&(target=r.cy);for(var i=0;i<names.length;i++){var name=names[i];target.emit({originalEvent:e,type:name,position})}},isMultSelKeyDown=function isMultSelKeyDown(e){return e.shiftKey||e.metaKey||e.ctrlKey},allowPanningPassthrough=function allowPanningPassthrough(down,downs){var allowPassthrough=!0;if(r.cy.hasCompoundNodes()&&down&&down.pannable())for(var i=0;downs&&i<downs.length;i++){if((down=downs[i]).isNode()&&down.isParent()&&!down.pannable()){allowPassthrough=!1;break}}else allowPassthrough=!0;return allowPassthrough},setInDragLayer=function setInDragLayer(ele){ele[0]._private.rscratch.inDragLayer=!0},setGrabTarget=function setGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=!0},addToDragList=function addToDragList(ele,opts){var list=opts.addToList;list.has(ele)||!ele.grabbable()||ele.locked()||(list.merge(ele),function setGrabbed(ele){ele[0]._private.grabbed=!0}(ele))},addNodesToDrag=function addNodesToDrag(nodes,opts){opts=opts||{};var hasCompoundNodes=nodes.cy().hasCompoundNodes();opts.inDragLayer&&(nodes.forEach(setInDragLayer),nodes.neighborhood().stdFilter(function(ele){return!hasCompoundNodes||ele.isEdge()}).forEach(setInDragLayer)),opts.addToList&&nodes.forEach(function(ele){addToDragList(ele,opts)}),function addDescendantsToDrag(node,opts){if(node.cy().hasCompoundNodes()&&(null!=opts.inDragLayer||null!=opts.addToList)){var innerNodes=node.descendants();opts.inDragLayer&&(innerNodes.forEach(setInDragLayer),innerNodes.connectedEdges().forEach(setInDragLayer)),opts.addToList&&addToDragList(innerNodes,opts)}}(nodes,opts),updateAncestorsInDragLayer(nodes,{inDragLayer:opts.inDragLayer}),r.updateCachedGrabbedEles()},addNodeToDrag=addNodesToDrag,freeDraggedElements=function freeDraggedElements(grabbedEles){grabbedEles&&(r.getCachedZSortedEles().forEach(function(ele){!function setFreed(ele){ele[0]._private.grabbed=!1}(ele),function setOutDragLayer(ele){ele[0]._private.rscratch.inDragLayer=!1}(ele),function removeGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=!1}(ele)}),r.updateCachedGrabbedEles())},updateAncestorsInDragLayer=function updateAncestorsInDragLayer(node,opts){if((null!=opts.inDragLayer||null!=opts.addToList)&&node.cy().hasCompoundNodes()){var parent=node.ancestors().orphans();if(!parent.same(node)){var nodes=parent.descendants().spawnSelf().merge(parent).unmerge(node).unmerge(node.descendants()),edges=nodes.connectedEdges();opts.inDragLayer&&(edges.forEach(setInDragLayer),nodes.forEach(setInDragLayer)),opts.addToList&&nodes.forEach(function(ele){addToDragList(ele,opts)})}}},blurActiveDomElement=function blurActiveDomElement(){null!=document.activeElement&&null!=document.activeElement.blur&&document.activeElement.blur()},haveMutationsApi="undefined"!=typeof MutationObserver,haveResizeObserverApi="undefined"!=typeof ResizeObserver;haveMutationsApi?(r.removeObserver=new MutationObserver(function(mutns){for(var i=0;i<mutns.length;i++){var rNodes=mutns[i].removedNodes;if(rNodes)for(var j=0;j<rNodes.length;j++){if(rNodes[j]===r.container){r.destroy();break}}}}),r.container.parentNode&&r.removeObserver.observe(r.container.parentNode,{childList:!0})):r.registerBinding(r.container,"DOMNodeRemoved",function(e){r.destroy()});var onResize=debounce(function(){r.cy.resize()},100);haveMutationsApi&&(r.styleObserver=new MutationObserver(onResize),r.styleObserver.observe(r.container,{attributes:!0})),r.registerBinding(containerWindow,"resize",onResize),haveResizeObserverApi&&(r.resizeObserver=new ResizeObserver(onResize),r.resizeObserver.observe(r.container));var invalidateCoords=function invalidateCoords(){r.invalidateContainerClientCoordsCache()};!function forEachUp(domEle,fn){for(;null!=domEle;)fn(domEle),domEle=domEle.parentNode}(r.container,function(domEle){r.registerBinding(domEle,"transitionend",invalidateCoords),r.registerBinding(domEle,"animationend",invalidateCoords),r.registerBinding(domEle,"scroll",invalidateCoords)}),r.registerBinding(r.container,"contextmenu",function(e){e.preventDefault()});var eventInContainer=function eventInContainer(e){for(var containerPageCoords=r.findContainerClientCoords(),x=containerPageCoords[0],y=containerPageCoords[1],width=containerPageCoords[2],height=containerPageCoords[3],positions=e.touches?e.touches:[e],atLeastOnePosInside=!1,i=0;i<positions.length;i++){var p=positions[i];if(x<=p.clientX&&p.clientX<=x+width&&y<=p.clientY&&p.clientY<=y+height){atLeastOnePosInside=!0;break}}if(!atLeastOnePosInside)return!1;for(var container=r.container,tParent=e.target.parentNode,containerIsTarget=!1;tParent;){if(tParent===container){containerIsTarget=!0;break}tParent=tParent.parentNode}return!!containerIsTarget};r.registerBinding(r.container,"mousedown",function mousedownHandler(e){if(eventInContainer(e)&&(1!==r.hoverData.which||1===e.which)){e.preventDefault(),blurActiveDomElement(),r.hoverData.capture=!0,r.hoverData.which=e.which;var cy=r.cy,gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),select=r.selection,nears=r.findNearestElements(pos[0],pos[1],!0,!1),near=nears[0],draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos,r.hoverData.mdownGPos=gpos;var makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:pos[0],y:pos[1]}}};if(3==e.which){r.hoverData.cxtStarted=!0;var cxtEvt={originalEvent:e,type:"cxttapstart",position:{x:pos[0],y:pos[1]}};near?(near.activate(),near.emit(cxtEvt),r.hoverData.down=near):cy.emit(cxtEvt),r.hoverData.downTime=(new Date).getTime(),r.hoverData.cxtDragged=!1}else if(1==e.which){if(near&&near.activate(),null!=near&&r.nodeIsGrabbable(near)){if(setGrabTarget(near),near.selected()){draggedElements=r.dragData.possibleDragElements=cy.collection();var selectedNodes=cy.$(function(ele){return ele.isNode()&&ele.selected()&&r.nodeIsGrabbable(ele)});addNodesToDrag(selectedNodes,{addToList:draggedElements}),near.emit(makeEvent("grabon")),selectedNodes.forEach(function triggerGrab(ele){ele.emit(makeEvent("grab"))})}else draggedElements=r.dragData.possibleDragElements=cy.collection(),addNodeToDrag(near,{addToList:draggedElements}),near.emit(makeEvent("grabon")).emit(makeEvent("grab"));r.redrawHint("eles",!0),r.redrawHint("drag",!0)}r.hoverData.down=near,r.hoverData.downs=nears,r.hoverData.downTime=(new Date).getTime(),triggerEvents(near,["mousedown","tapstart","vmousedown"],e,{x:pos[0],y:pos[1]}),null==near?(select[4]=1,r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()):near.pannable()&&(select[4]=1),function checkForTaphold(){r.hoverData.tapholdCancelled=!1,clearTimeout(r.hoverData.tapholdTimeout),r.hoverData.tapholdTimeout=setTimeout(function(){if(!r.hoverData.tapholdCancelled){var ele=r.hoverData.down;ele?ele.emit(makeEvent("taphold")):cy.emit(makeEvent("taphold"))}},r.tapholdDuration)}()}select[0]=select[2]=pos[0],select[1]=select[3]=pos[1]}},!1);var clickTimeout,didDoubleClick,prevClickTimeStamp,shadowRoot=function getShadowRoot(element){var rootNode=element.getRootNode();if(rootNode&&11===rootNode.nodeType&&void 0!==rootNode.host)return rootNode}(r.container);r.registerBinding([containerWindow,shadowRoot],"mousemove",function mousemoveHandler(e){if(r.hoverData.capture||eventInContainer(e)){var preventDefault=!1,cy=r.cy,zoom=cy.zoom(),gpos=[e.clientX,e.clientY],pos=r.projectIntoViewport(gpos[0],gpos[1]),mdownPos=r.hoverData.mdownPos,mdownGPos=r.hoverData.mdownGPos,select=r.selection,near=null;r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.selecting||(near=r.findNearestElement(pos[0],pos[1],!0,!1));var isOverThresholdDrag,last=r.hoverData.last,down=r.hoverData.down,disp=[pos[0]-select[2],pos[1]-select[3]],draggedElements=r.dragData.possibleDragElements;if(mdownGPos){var dx=gpos[0]-mdownGPos[0],dx2=dx*dx,dy=gpos[1]-mdownGPos[1],dist2=dx2+dy*dy;r.hoverData.isOverThresholdDrag=isOverThresholdDrag=dist2>=r.desktopTapThreshold2}var multSelKeyDown=isMultSelKeyDown(e);isOverThresholdDrag&&(r.hoverData.tapholdCancelled=!0);preventDefault=!0,triggerEvents(near,["mousemove","vmousemove","tapdrag"],e,{x:pos[0],y:pos[1]});var makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:pos[0],y:pos[1]}}},goIntoBoxMode=function goIntoBoxMode(){r.data.bgActivePosistion=void 0,r.hoverData.selecting||cy.emit(makeEvent("boxstart")),select[4]=1,r.hoverData.selecting=!0,r.redrawHint("select",!0),r.redraw()};if(3===r.hoverData.which){if(isOverThresholdDrag){var cxtEvt=makeEvent("cxtdrag");down?down.emit(cxtEvt):cy.emit(cxtEvt),r.hoverData.cxtDragged=!0,r.hoverData.cxtOver&&near===r.hoverData.cxtOver||(r.hoverData.cxtOver&&r.hoverData.cxtOver.emit(makeEvent("cxtdragout")),r.hoverData.cxtOver=near,near&&near.emit(makeEvent("cxtdragover")))}}else if(r.hoverData.dragging){if(preventDefault=!0,cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom},r.hoverData.justStartedPan=!1}else deltaP={x:disp[0]*zoom,y:disp[1]*zoom};cy.panBy(deltaP),cy.emit(makeEvent("dragpan")),r.hoverData.dragged=!0}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(1!=select[4]||null!=down&&!down.pannable()){if(down&&down.pannable()&&down.active()&&down.unactivate(),down&&down.grabbed()||near==last||(last&&triggerEvents(last,["mouseout","tapdragout"],e,{x:pos[0],y:pos[1]}),near&&triggerEvents(near,["mouseover","tapdragover"],e,{x:pos[0],y:pos[1]}),r.hoverData.last=near),down)if(isOverThresholdDrag){if(cy.boxSelectionEnabled()&&multSelKeyDown)down&&down.grabbed()&&(freeDraggedElements(draggedElements),down.emit(makeEvent("freeon")),draggedElements.emit(makeEvent("free")),r.dragData.didDrag&&(down.emit(makeEvent("dragfreeon")),draggedElements.emit(makeEvent("dragfree")))),goIntoBoxMode();else if(down&&down.grabbed()&&r.nodeIsDraggable(down)){var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&r.redrawHint("eles",!0),r.dragData.didDrag=!0,r.hoverData.draggingEles||addNodesToDrag(draggedElements,{inDragLayer:!0});var totalShift={x:0,y:0};if(number$1(disp[0])&&number$1(disp[1])&&(totalShift.x+=disp[0],totalShift.y+=disp[1],justStartedDrag)){var dragDelta=r.hoverData.dragDelta;dragDelta&&number$1(dragDelta[0])&&number$1(dragDelta[1])&&(totalShift.x+=dragDelta[0],totalShift.y+=dragDelta[1])}r.hoverData.draggingEles=!0,draggedElements.silentShift(totalShift).emit(makeEvent("position")).emit(makeEvent("drag")),r.redrawHint("drag",!0),r.redraw()}}else!function updateDragDelta(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}();preventDefault=!0}else if(isOverThresholdDrag){if(r.hoverData.dragging||!cy.boxSelectionEnabled()||!multSelKeyDown&&cy.panningEnabled()&&cy.userPanningEnabled()){if(!r.hoverData.selecting&&cy.panningEnabled()&&cy.userPanningEnabled()){allowPanningPassthrough(down,r.hoverData.downs)&&(r.hoverData.dragging=!0,r.hoverData.justStartedPan=!0,select[4]=0,r.data.bgActivePosistion=array2point(mdownPos),r.redrawHint("select",!0),r.redraw())}}else goIntoBoxMode();down&&down.pannable()&&down.active()&&down.unactivate()}return select[2]=pos[0],select[3]=pos[1],preventDefault?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1):void 0}},!1),r.registerBinding(containerWindow,"mouseup",function mouseupHandler(e){if((1!==r.hoverData.which||1===e.which||!r.hoverData.capture)&&r.hoverData.capture){r.hoverData.capture=!1;var cy=r.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.selection,near=r.findNearestElement(pos[0],pos[1],!0,!1),draggedElements=r.dragData.possibleDragElements,down=r.hoverData.down,multSelKeyDown=isMultSelKeyDown(e);r.data.bgActivePosistion&&(r.redrawHint("select",!0),r.redraw()),r.hoverData.tapholdCancelled=!0,r.data.bgActivePosistion=void 0,down&&down.unactivate();var makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:pos[0],y:pos[1]}}};if(3===r.hoverData.which){var cxtEvt=makeEvent("cxttapend");if(down?down.emit(cxtEvt):cy.emit(cxtEvt),!r.hoverData.cxtDragged){var cxtTap=makeEvent("cxttap");down?down.emit(cxtTap):cy.emit(cxtTap)}r.hoverData.cxtDragged=!1,r.hoverData.which=null}else if(1===r.hoverData.which){if(triggerEvents(near,["mouseup","tapend","vmouseup"],e,{x:pos[0],y:pos[1]}),r.dragData.didDrag||r.hoverData.dragged||r.hoverData.selecting||r.hoverData.isOverThresholdDrag||(triggerEvents(down,["click","tap","vclick"],e,{x:pos[0],y:pos[1]}),didDoubleClick=!1,e.timeStamp-prevClickTimeStamp<=cy.multiClickDebounceTime()?(clickTimeout&&clearTimeout(clickTimeout),didDoubleClick=!0,prevClickTimeStamp=null,triggerEvents(down,["dblclick","dbltap","vdblclick"],e,{x:pos[0],y:pos[1]})):(clickTimeout=setTimeout(function(){didDoubleClick||triggerEvents(down,["oneclick","onetap","voneclick"],e,{x:pos[0],y:pos[1]})},cy.multiClickDebounceTime()),prevClickTimeStamp=e.timeStamp)),null!=down||r.dragData.didDrag||r.hoverData.selecting||r.hoverData.dragged||isMultSelKeyDown(e)||(cy.$(isSelected).unselect(["tapunselect"]),draggedElements.length>0&&r.redrawHint("eles",!0),r.dragData.possibleDragElements=draggedElements=cy.collection()),near!=down||r.dragData.didDrag||r.hoverData.selecting||null!=near&&near._private.selectable&&(r.hoverData.dragging||("additive"===cy.selectionType()||multSelKeyDown?near.selected()?near.unselect(["tapunselect"]):near.select(["tapselect"]):multSelKeyDown||(cy.$(isSelected).unmerge(near).unselect(["tapunselect"]),near.select(["tapselect"]))),r.redrawHint("eles",!0)),r.hoverData.selecting){var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));r.redrawHint("select",!0),box.length>0&&r.redrawHint("eles",!0),cy.emit(makeEvent("boxend"));var eleWouldBeSelected=function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()};"additive"===cy.selectionType()||multSelKeyDown||cy.$(isSelected).unmerge(box).unselect(),box.emit(makeEvent("box")).stdFilter(eleWouldBeSelected).select().emit(makeEvent("boxselect")),r.redraw()}if(r.hoverData.dragging&&(r.hoverData.dragging=!1,r.redrawHint("select",!0),r.redrawHint("eles",!0),r.redraw()),!select[4]){r.redrawHint("drag",!0),r.redrawHint("eles",!0);var downWasGrabbed=down&&down.grabbed();freeDraggedElements(draggedElements),downWasGrabbed&&(down.emit(makeEvent("freeon")),draggedElements.emit(makeEvent("free")),r.dragData.didDrag&&(down.emit(makeEvent("dragfreeon")),draggedElements.emit(makeEvent("dragfree"))))}}select[4]=0,r.hoverData.down=null,r.hoverData.cxtStarted=!1,r.hoverData.draggingEles=!1,r.hoverData.selecting=!1,r.hoverData.isOverThresholdDrag=!1,r.dragData.didDrag=!1,r.hoverData.dragged=!1,r.hoverData.dragDelta=[],r.hoverData.mdownPos=null,r.hoverData.mdownGPos=null,r.hoverData.which=null}},!1);var inaccurateScrollDevice,f1x1,f1y1,f2x1,f2y1,distance1,distance1Sq,center1,modelCenter1,offsetLeft,offsetTop,containerWidth,containerHeight,twoFingersStartInside,wheelDeltas=[],inaccurateScrollFactor=1e5,wheelHandler=function wheelHandler(e){var clamp=!1,delta=e.deltaY;if(null==delta&&(null!=e.wheelDeltaY?delta=e.wheelDeltaY/4:null!=e.wheelDelta&&(delta=e.wheelDelta/4)),0!==delta){if(null==inaccurateScrollDevice)if(wheelDeltas.length>=4){var wds=wheelDeltas;if(inaccurateScrollDevice=function allAreDivisibleBy(list,factor){for(var i=0;i<list.length;i++)if(list[i]%factor!==0)return!1;return!0}(wds,5),!inaccurateScrollDevice){var firstMag=Math.abs(wds[0]);inaccurateScrollDevice=function allAreSameMagnitude(list){for(var firstMag=Math.abs(list[0]),i=1;i<list.length;i++)if(Math.abs(list[i])!==firstMag)return!1;return!0}(wds)&&firstMag>5}if(inaccurateScrollDevice)for(var i=0;i<wds.length;i++)inaccurateScrollFactor=Math.min(Math.abs(wds[i]),inaccurateScrollFactor)}else wheelDeltas.push(delta),clamp=!0;else inaccurateScrollDevice&&(inaccurateScrollFactor=Math.min(Math.abs(delta),inaccurateScrollFactor));if(!r.scrollingPage){var cy=r.cy,zoom=cy.zoom(),pan=cy.pan(),pos=r.projectIntoViewport(e.clientX,e.clientY),rpos=[pos[0]*zoom+pan.x,pos[1]*zoom+pan.y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||function inBoxSelection(){return 0!==r.selection[4]}())e.preventDefault();else if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){var diff;e.preventDefault(),r.data.wheelZooming=!0,clearTimeout(r.data.wheelTimeout),r.data.wheelTimeout=setTimeout(function(){r.data.wheelZooming=!1,r.redrawHint("eles",!0),r.redraw()},150),clamp&&Math.abs(delta)>5&&(delta=5*signum(delta)),diff=delta/-250,inaccurateScrollDevice&&(diff/=inaccurateScrollFactor,diff*=3),diff*=r.wheelSensitivity,1===e.deltaMode&&(diff*=33);var newZoom=cy.zoom()*Math.pow(10,diff);"gesturechange"===e.type&&(newZoom=r.gestureStartZoom*e.scale),cy.zoom({level:newZoom,renderedPosition:{x:rpos[0],y:rpos[1]}}),cy.emit({type:"gesturechange"===e.type?"pinchzoom":"scrollzoom",originalEvent:e,position:{x:pos[0],y:pos[1]}})}}}};r.registerBinding(r.container,"wheel",wheelHandler,!0),r.registerBinding(containerWindow,"scroll",function scrollHandler(e){r.scrollingPage=!0,clearTimeout(r.scrollingPageTimeout),r.scrollingPageTimeout=setTimeout(function(){r.scrollingPage=!1},250)},!0),r.registerBinding(r.container,"gesturestart",function gestureStartHandler(e){r.gestureStartZoom=r.cy.zoom(),r.hasTouchStarted||e.preventDefault()},!0),r.registerBinding(r.container,"gesturechange",function(e){r.hasTouchStarted||wheelHandler(e)},!0),r.registerBinding(r.container,"mouseout",function mouseOutHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseout",position:{x:pos[0],y:pos[1]}})},!1),r.registerBinding(r.container,"mouseover",function mouseOverHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseover",position:{x:pos[0],y:pos[1]}})},!1);var touchstartHandler,touchmoveHandler,touchcancelHandler,touchendHandler,didDoubleTouch,touchTimeout,prevTouchTimeStamp,distance=function distance(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))},distanceSq=function distanceSq(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)};if(r.registerBinding(r.container,"touchstart",touchstartHandler=function touchstartHandler(e){if(r.hasTouchStarted=!0,eventInContainer(e)){blurActiveDomElement(),r.touchData.capture=!0,r.data.bgActivePosistion=void 0;var cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}var makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:now[0],y:now[1]}}};if(e.touches[1]){r.touchData.singleTouchMoved=!0,freeDraggedElements(r.dragData.touchDragEles);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0],offsetTop=offsets[1],containerWidth=offsets[2],containerHeight=offsets[3],f1x1=e.touches[0].clientX-offsetLeft,f1y1=e.touches[0].clientY-offsetTop,f2x1=e.touches[1].clientX-offsetLeft,f2y1=e.touches[1].clientY-offsetTop,twoFingersStartInside=0<=f1x1&&f1x1<=containerWidth&&0<=f2x1&&f2x1<=containerWidth&&0<=f1y1&&f1y1<=containerHeight&&0<=f2y1&&f2y1<=containerHeight;var pan=cy.pan(),zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1),distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1),modelCenter1=[((center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2])[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];if(distance1Sq<4e4&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],!0,!0),near2=r.findNearestElement(now[2],now[3],!0,!0);return near1&&near1.isNode()?(near1.activate().emit(makeEvent("cxttapstart")),r.touchData.start=near1):near2&&near2.isNode()?(near2.activate().emit(makeEvent("cxttapstart")),r.touchData.start=near2):cy.emit(makeEvent("cxttapstart")),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!0,r.touchData.cxtDragged=!1,r.data.bgActivePosistion=void 0,void r.redraw()}}if(e.touches[2])cy.boxSelectionEnabled()&&e.preventDefault();else if(e.touches[1]);else if(e.touches[0]){var nears=r.findNearestElements(now[0],now[1],!0,!0),near=nears[0];if(null!=near&&(near.activate(),r.touchData.start=near,r.touchData.starts=nears,r.nodeIsGrabbable(near))){var draggedEles=r.dragData.touchDragEles=cy.collection(),selectedNodes=null;r.redrawHint("eles",!0),r.redrawHint("drag",!0),near.selected()?(selectedNodes=cy.$(function(ele){return ele.selected()&&r.nodeIsGrabbable(ele)}),addNodesToDrag(selectedNodes,{addToList:draggedEles})):addNodeToDrag(near,{addToList:draggedEles}),setGrabTarget(near),near.emit(makeEvent("grabon")),selectedNodes?selectedNodes.forEach(function(n){n.emit(makeEvent("grab"))}):near.emit(makeEvent("grab"))}triggerEvents(near,["touchstart","tapstart","vmousedown"],e,{x:now[0],y:now[1]}),null==near&&(r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.redrawHint("select",!0),r.redraw()),r.touchData.singleTouchMoved=!1,r.touchData.singleTouchStartTime=+new Date,clearTimeout(r.touchData.tapholdTimeout),r.touchData.tapholdTimeout=setTimeout(function(){!1!==r.touchData.singleTouchMoved||r.pinching||r.touchData.selecting||triggerEvents(r.touchData.start,["taphold"],e,{x:now[0],y:now[1]})},r.tapholdDuration)}if(e.touches.length>=1){for(var sPos=r.touchData.startPosition=[null,null,null,null,null,null],i=0;i<now.length;i++)sPos[i]=earlier[i]=now[i];var touch0=e.touches[0];r.touchData.startGPosition=[touch0.clientX,touch0.clientY]}}},!1),r.registerBinding(containerWindow,"touchmove",touchmoveHandler=function touchmoveHandler(e){var capture=r.touchData.capture;if(capture||eventInContainer(e)){var select=r.selection,cy=r.cy,now=r.touchData.now,earlier=r.touchData.earlier,zoom=cy.zoom();if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}var isOverThresholdDrag,makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:now[0],y:now[1]}}},startGPos=r.touchData.startGPosition;if(capture&&e.touches[0]&&startGPos){for(var disp=[],j=0;j<now.length;j++)disp[j]=now[j]-earlier[j];var dx=e.touches[0].clientX-startGPos[0],dx2=dx*dx,dy=e.touches[0].clientY-startGPos[1];isOverThresholdDrag=dx2+dy*dy>=r.touchTapThreshold2}if(capture&&r.touchData.cxt){e.preventDefault();var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2);if(distance2Sq/distance1Sq>=2.25||distance2Sq>=22500){r.touchData.cxt=!1,r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var cxtEvt=makeEvent("cxttapend");r.touchData.start?(r.touchData.start.unactivate().emit(cxtEvt),r.touchData.start=null):cy.emit(cxtEvt)}}if(capture&&r.touchData.cxt){cxtEvt=makeEvent("cxtdrag");r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.touchData.start?r.touchData.start.emit(cxtEvt):cy.emit(cxtEvt),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxtDragged=!0;var near=r.findNearestElement(now[0],now[1],!0,!0);r.touchData.cxtOver&&near===r.touchData.cxtOver||(r.touchData.cxtOver&&r.touchData.cxtOver.emit(makeEvent("cxtdragout")),r.touchData.cxtOver=near,near&&near.emit(makeEvent("cxtdragover")))}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled())e.preventDefault(),r.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,r.touchData.selecting||cy.emit(makeEvent("boxstart")),r.touchData.selecting=!0,r.touchData.didSelect=!0,select[4]=1,select&&0!==select.length&&void 0!==select[0]?(select[2]=(now[0]+now[2]+now[4])/3,select[3]=(now[1]+now[3]+now[5])/3):(select[0]=(now[0]+now[2]+now[4])/3,select[1]=(now[1]+now[3]+now[5])/3,select[2]=(now[0]+now[2]+now[4])/3+1,select[3]=(now[1]+now[3]+now[5])/3+1),r.redrawHint("select",!0),r.redraw();else if(capture&&e.touches[1]&&!r.touchData.didSelect&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){if(e.preventDefault(),r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),draggedEles=r.dragData.touchDragEles){r.redrawHint("drag",!0);for(var i=0;i<draggedEles.length;i++){var de_p=draggedEles[i]._private;de_p.grabbed=!1,de_p.rscratch.inDragLayer=!1}}var _start=r.touchData.start,distance2=(f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance(f1x2,f1y2,f2x2,f2y2)),factor=distance2/distance1;if(twoFingersStartInside){var tx=(f1x2-f1x1+(f2x2-f2x1))/2,ty=(f1y2-f1y1+(f2y2-f2y1))/2,zoom1=cy.zoom(),zoom2=zoom1*factor,pan1=cy.pan(),ctrx=modelCenter1[0]*zoom1+pan1.x,ctry=modelCenter1[1]*zoom1+pan1.y,pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(_start&&_start.active()){var draggedEles=r.dragData.touchDragEles;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),_start.unactivate().emit(makeEvent("freeon")),draggedEles.emit(makeEvent("free")),r.dragData.didDrag&&(_start.emit(makeEvent("dragfreeon")),draggedEles.emit(makeEvent("dragfree")))}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:!0}),cy.emit(makeEvent("pinchzoom")),distance1=distance2,f1x1=f1x2,f1y1=f1y2,f2x1=f2x2,f2y1=f2y2,r.pinching=!0}if(e.touches[0]){pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}}else if(e.touches[0]&&!r.touchData.didSelect){var start=r.touchData.start,last=r.touchData.last;if(r.hoverData.draggingEles||r.swipePanning||(near=r.findNearestElement(now[0],now[1],!0,!0)),capture&&null!=start&&e.preventDefault(),capture&&null!=start&&r.nodeIsDraggable(start))if(isOverThresholdDrag){draggedEles=r.dragData.touchDragEles;var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&addNodesToDrag(draggedEles,{inDragLayer:!0}),r.dragData.didDrag=!0;var totalShift={x:0,y:0};if(number$1(disp[0])&&number$1(disp[1]))if(totalShift.x+=disp[0],totalShift.y+=disp[1],justStartedDrag)r.redrawHint("eles",!0),(dragDelta=r.touchData.dragDelta)&&number$1(dragDelta[0])&&number$1(dragDelta[1])&&(totalShift.x+=dragDelta[0],totalShift.y+=dragDelta[1]);r.hoverData.draggingEles=!0,draggedEles.silentShift(totalShift).emit(makeEvent("position")).emit(makeEvent("drag")),r.redrawHint("drag",!0),r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]&&r.redrawHint("eles",!0),r.redraw()}else{var dragDelta;0===(dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[]).length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}if(triggerEvents(start||near,["touchmove","tapdrag","vmousemove"],e,{x:now[0],y:now[1]}),start&&start.grabbed()||near==last||(last&&last.emit(makeEvent("tapdragout")),near&&near.emit(makeEvent("tapdragover"))),r.touchData.last=near,capture)for(i=0;i<now.length;i++)now[i]&&r.touchData.startPosition[i]&&isOverThresholdDrag&&(r.touchData.singleTouchMoved=!0);if(capture&&(null==start||start.pannable())&&cy.panningEnabled()&&cy.userPanningEnabled()){allowPanningPassthrough(start,r.touchData.starts)&&(e.preventDefault(),r.data.bgActivePosistion||(r.data.bgActivePosistion=array2point(r.touchData.startPosition)),r.swipePanning?(cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom}),cy.emit(makeEvent("dragpan"))):isOverThresholdDrag&&(r.swipePanning=!0,cy.panBy({x:dx*zoom,y:dy*zoom}),cy.emit(makeEvent("dragpan")),start&&(start.unactivate(),r.redrawHint("select",!0),r.touchData.start=null)));pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}}for(j=0;j<now.length;j++)earlier[j]=now[j];capture&&e.touches.length>0&&!r.hoverData.draggingEles&&!r.swipePanning&&null!=r.data.bgActivePosistion&&(r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.redraw())}},!1),r.registerBinding(containerWindow,"touchcancel",touchcancelHandler=function touchcancelHandler(e){var start=r.touchData.start;r.touchData.capture=!1,start&&start.unactivate()}),r.registerBinding(containerWindow,"touchend",touchendHandler=function touchendHandler(e){var start=r.touchData.start;if(r.touchData.capture){0===e.touches.length&&(r.touchData.capture=!1),e.preventDefault();var select=r.selection;r.swipePanning=!1,r.hoverData.draggingEles=!1;var cy=r.cy,zoom=cy.zoom(),now=r.touchData.now,earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}var ctxTapend,makeEvent=function makeEvent(type){return{originalEvent:e,type,position:{x:now[0],y:now[1]}}};if(start&&start.unactivate(),r.touchData.cxt){if(ctxTapend=makeEvent("cxttapend"),start?start.emit(ctxTapend):cy.emit(ctxTapend),!r.touchData.cxtDragged){var ctxTap=makeEvent("cxttap");start?start.emit(ctxTap):cy.emit(ctxTap)}return r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!1,r.touchData.start=null,void r.redraw()}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=!1;var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));select[0]=void 0,select[1]=void 0,select[2]=void 0,select[3]=void 0,select[4]=0,r.redrawHint("select",!0),cy.emit(makeEvent("boxend"));box.emit(makeEvent("box")).stdFilter(function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()}).select().emit(makeEvent("boxselect")),box.nonempty()&&r.redrawHint("eles",!0),r.redraw()}if(null!=start&&start.unactivate(),e.touches[2])r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var draggedEles=r.dragData.touchDragEles;if(null!=start){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles),r.redrawHint("drag",!0),r.redrawHint("eles",!0),startWasGrabbed&&(start.emit(makeEvent("freeon")),draggedEles.emit(makeEvent("free")),r.dragData.didDrag&&(start.emit(makeEvent("dragfreeon")),draggedEles.emit(makeEvent("dragfree")))),triggerEvents(start,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]}),start.unactivate(),r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],!0,!0);triggerEvents(near,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]})}var dx=r.touchData.startPosition[0]-now[0],dx2=dx*dx,dy=r.touchData.startPosition[1]-now[1],rdist2=(dx2+dy*dy)*zoom*zoom;r.touchData.singleTouchMoved||(start||cy.$(":selected").unselect(["tapunselect"]),triggerEvents(start,["tap","vclick"],e,{x:now[0],y:now[1]}),didDoubleTouch=!1,e.timeStamp-prevTouchTimeStamp<=cy.multiClickDebounceTime()?(touchTimeout&&clearTimeout(touchTimeout),didDoubleTouch=!0,prevTouchTimeStamp=null,triggerEvents(start,["dbltap","vdblclick"],e,{x:now[0],y:now[1]})):(touchTimeout=setTimeout(function(){didDoubleTouch||triggerEvents(start,["onetap","voneclick"],e,{x:now[0],y:now[1]})},cy.multiClickDebounceTime()),prevTouchTimeStamp=e.timeStamp)),null!=start&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching&&("single"===cy.selectionType()?(cy.$(isSelected).unmerge(start).unselect(["tapunselect"]),start.select(["tapselect"])):start.selected()?start.unselect(["tapunselect"]):start.select(["tapselect"]),r.redrawHint("eles",!0)),r.touchData.singleTouchMoved=!0}for(var j=0;j<now.length;j++)earlier[j]=now[j];r.dragData.didDrag=!1,0===e.touches.length&&(r.touchData.dragDelta=[],r.touchData.startPosition=[null,null,null,null,null,null],r.touchData.startGPosition=null,r.touchData.didSelect=!1),e.touches.length<2&&(1===e.touches.length&&(r.touchData.startGPosition=[e.touches[0].clientX,e.touches[0].clientY]),r.pinching=!1,r.redrawHint("eles",!0),r.redraw())}},!1),"undefined"==typeof TouchEvent){var pointers=[],makeTouch=function makeTouch(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}},addPointer=function addPointer(e){pointers.push(function makePointer(e){return{event:e,touch:makeTouch(e)}}(e))},removePointer=function removePointer(e){for(var i=0;i<pointers.length;i++){if(pointers[i].event.pointerId===e.pointerId)return void pointers.splice(i,1)}},addTouchesToEvent=function addTouchesToEvent(e){e.touches=pointers.map(function(p){return p.touch})},pointerIsMouse=function pointerIsMouse(e){return"mouse"===e.pointerType||4===e.pointerType};r.registerBinding(r.container,"pointerdown",function(e){pointerIsMouse(e)||(e.preventDefault(),addPointer(e),addTouchesToEvent(e),touchstartHandler(e))}),r.registerBinding(r.container,"pointerup",function(e){pointerIsMouse(e)||(removePointer(e),addTouchesToEvent(e),touchendHandler(e))}),r.registerBinding(r.container,"pointercancel",function(e){pointerIsMouse(e)||(removePointer(e),addTouchesToEvent(e),touchcancelHandler())}),r.registerBinding(r.container,"pointermove",function(e){pointerIsMouse(e)||(e.preventDefault(),function updatePointer(e){var p=pointers.filter(function(p){return p.event.pointerId===e.pointerId})[0];p.event=e,p.touch=makeTouch(e)}(e),addTouchesToEvent(e),touchmoveHandler(e))})}};var BRp$2={generatePolygon:function(name,points){return this.nodeShapes[name]={renderer:this,name,points,draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl("polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){return polygonIntersectLine(x,y,this.points,nodeX,nodeY,width/2,height/2,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){return pointInsidePolygon(x,y,this.points,centerX,centerY,width,height,[0,-1],padding)},hasMiterBounds:"rectangle"!==name,miterBounds:function miterBounds(centerX,centerY,width,height,strokeWidth,strokePosition){return miterBox(this.points,centerX,centerY,width,height,strokeWidth)}}}};BRp$2.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){return function intersectLineEllipse(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x,dispY=centerY-y;dispX/=ellipseWradius,dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY),newLength=len-1;if(newLength<0)return[];var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]}(x,y,nodeX,nodeY,width/2+padding,height/2+padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){return checkInEllipse(x,y,width,height,centerX,centerY,padding)}}},BRp$2.generateRoundPolygon=function(name,points){return this.nodeShapes[name]={renderer:this,name,points,getOrCreateCorners:function getOrCreateCorners(centerX,centerY,width,height,cornerRadius,rs,field){if(void 0!==rs[field]&&rs[field+"-cx"]===centerX&&rs[field+"-cy"]===centerY)return rs[field];rs[field]=new Array(points.length/2),rs[field+"-cx"]=centerX,rs[field+"-cy"]=centerY;var halfW=width/2,halfH=height/2;cornerRadius="auto"===cornerRadius?getRoundPolygonRadius(width,height):cornerRadius;for(var p=new Array(points.length/2),_i=0;_i<points.length/2;_i++)p[_i]={x:centerX+halfW*points[2*_i],y:centerY+halfH*points[2*_i+1]};var i,p1,p2,p3,len=p.length;for(p1=p[len-1],i=0;i<len;i++)p2=p[i%len],p3=p[(i+1)%len],rs[field][i]=getRoundCorner(p1,p2,p3,cornerRadius),p1=p2,p2=p3;return rs[field]},draw:function draw(context,centerX,centerY,width,height,cornerRadius,rs){this.renderer.nodeShapeImpl("round-polygon",context,centerX,centerY,width,height,this.points,this.getOrCreateCorners(centerX,centerY,width,height,cornerRadius,rs,"drawCorners"))},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius,rs){return function roundPolygonIntersectLine(x,y,basePoints,centerX,centerY,width,height,padding,corners){var intersection,intersections=[],lines=new Array(2*basePoints.length);corners.forEach(function(corner,i){0===i?(lines[lines.length-2]=corner.startX,lines[lines.length-1]=corner.startY):(lines[4*i-2]=corner.startX,lines[4*i-1]=corner.startY),lines[4*i]=corner.stopX,lines[4*i+1]=corner.stopY,0!==(intersection=intersectLineCircle(x,y,centerX,centerY,corner.cx,corner.cy,corner.radius)).length&&intersections.push(intersection[0],intersection[1])});for(var i=0;i<lines.length/4;i++)0!==(intersection=finiteLinesIntersect(x,y,centerX,centerY,lines[4*i],lines[4*i+1],lines[4*i+2],lines[4*i+3],!1)).length&&intersections.push(intersection[0],intersection[1]);if(intersections.length>2){for(var lowestIntersection=[intersections[0],intersections[1]],lowestSquaredDistance=Math.pow(lowestIntersection[0]-x,2)+Math.pow(lowestIntersection[1]-y,2),_i4=1;_i4<intersections.length/2;_i4++){var squaredDistance=Math.pow(intersections[2*_i4]-x,2)+Math.pow(intersections[2*_i4+1]-y,2);squaredDistance<=lowestSquaredDistance&&(lowestIntersection[0]=intersections[2*_i4],lowestIntersection[1]=intersections[2*_i4+1],lowestSquaredDistance=squaredDistance)}return lowestIntersection}return intersections}(x,y,this.points,nodeX,nodeY,0,0,0,this.getOrCreateCorners(nodeX,nodeY,width,height,cornerRadius,rs,"corners"))},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius,rs){return function pointInsideRoundPolygon(x,y,basePoints,centerX,centerY,width,height,corners){for(var cutPolygonPoints=new Array(2*basePoints.length),i=0;i<corners.length;i++){var corner=corners[i];if(cutPolygonPoints[4*i+0]=corner.startX,cutPolygonPoints[4*i+1]=corner.startY,cutPolygonPoints[4*i+2]=corner.stopX,cutPolygonPoints[4*i+3]=corner.stopY,Math.pow(corner.cx-x,2)+Math.pow(corner.cy-y,2)<=Math.pow(corner.radius,2))return!0}return pointInsidePolygonPoints(x,y,cutPolygonPoints)}(x,y,this.points,0,0,0,0,this.getOrCreateCorners(centerX,centerY,width,height,cornerRadius,rs,"corners"))}}},BRp$2.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height,this.points,cornerRadius)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){return roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding,cornerRadius)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){var halfWidth=width/2,halfHeight=height/2;cornerRadius="auto"===cornerRadius?getRoundRectangleRadius(width,height):cornerRadius;var diam=2*(cornerRadius=Math.min(halfWidth,halfHeight,cornerRadius));return!!pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding)||(!!pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding)||(!!checkInEllipse(x,y,diam,diam,centerX-halfWidth+cornerRadius,centerY-halfHeight+cornerRadius,padding)||(!!checkInEllipse(x,y,diam,diam,centerX+halfWidth-cornerRadius,centerY-halfHeight+cornerRadius,padding)||(!!checkInEllipse(x,y,diam,diam,centerX+halfWidth-cornerRadius,centerY+halfHeight-cornerRadius,padding)||!!checkInEllipse(x,y,diam,diam,centerX-halfWidth+cornerRadius,centerY+halfHeight-cornerRadius,padding)))))}}},BRp$2.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:8,points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height,null,cornerRadius)},generateCutTrianglePts:function generateCutTrianglePts(width,height,centerX,centerY,cornerRadius){var cl="auto"===cornerRadius?this.cornerLength:cornerRadius,hh=height/2,hw=width/2,xBegin=centerX-hw,xEnd=centerX+hw,yBegin=centerY-hh,yEnd=centerY+hh;return{topLeft:[xBegin,yBegin+cl,xBegin+cl,yBegin,xBegin+cl,yBegin+cl],topRight:[xEnd-cl,yBegin,xEnd,yBegin+cl,xEnd-cl,yBegin+cl],bottomRight:[xEnd,yEnd-cl,xEnd-cl,yEnd,xEnd-cl,yEnd-cl],bottomLeft:[xBegin+cl,yEnd,xBegin,yEnd-cl,xBegin+cl,yEnd-cl]}},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){var cPts=this.generateCutTrianglePts(width+2*padding,height+2*padding,nodeX,nodeY,cornerRadius),pts=[].concat.apply([],[cPts.topLeft.splice(0,4),cPts.topRight.splice(0,4),cPts.bottomRight.splice(0,4),cPts.bottomLeft.splice(0,4)]);return polygonIntersectLine(x,y,pts,nodeX,nodeY)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){var cl="auto"===cornerRadius?this.cornerLength:cornerRadius;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*cl,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*cl,height,[0,-1],padding))return!0;var cutTrianglePts=this.generateCutTrianglePts(width,height,centerX,centerY);return pointInsidePolygonPoints(x,y,cutTrianglePts.topLeft)||pointInsidePolygonPoints(x,y,cutTrianglePts.topRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomLeft)}}},BRp$2.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){var bPts=this.generateBarrelBezierPts(width+2*padding,height+2*padding,nodeX,nodeY),approximateBarrelCurvePts=function approximateBarrelCurvePts(pts){var m0=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.15),m1=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.5),m2=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},.85);return[pts[0],pts[1],m0.x,m0.y,m1.x,m1.y,m2.x,m2.y,pts[4],pts[5]]},pts=[].concat(approximateBarrelCurvePts(bPts.topLeft),approximateBarrelCurvePts(bPts.topRight),approximateBarrelCurvePts(bPts.bottomRight),approximateBarrelCurvePts(bPts.bottomLeft));return polygonIntersectLine(x,y,pts,nodeX,nodeY)},generateBarrelBezierPts:function generateBarrelBezierPts(width,height,centerX,centerY){var hh=height/2,hw=width/2,xBegin=centerX-hw,xEnd=centerX+hw,yBegin=centerY-hh,yEnd=centerY+hh,curveConstants=getBarrelCurveConstants(width,height),hOffset=curveConstants.heightOffset,wOffset=curveConstants.widthOffset,ctrlPtXOffset=curveConstants.ctrlPtOffsetPct*width,pts={topLeft:[xBegin,yBegin+hOffset,xBegin+ctrlPtXOffset,yBegin,xBegin+wOffset,yBegin],topRight:[xEnd-wOffset,yBegin,xEnd-ctrlPtXOffset,yBegin,xEnd,yBegin+hOffset],bottomRight:[xEnd,yEnd-hOffset,xEnd-ctrlPtXOffset,yEnd,xEnd-wOffset,yEnd],bottomLeft:[xBegin+wOffset,yEnd,xBegin+ctrlPtXOffset,yEnd,xBegin,yEnd-hOffset]};return pts.topLeft.isTop=!0,pts.topRight.isTop=!0,pts.bottomLeft.isBottom=!0,pts.bottomRight.isBottom=!0,pts},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){var curveConstants=getBarrelCurveConstants(width,height),hOffset=curveConstants.heightOffset,wOffset=curveConstants.widthOffset;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*hOffset,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*wOffset,height,[0,-1],padding))return!0;for(var barrelCurvePts=this.generateBarrelBezierPts(width,height,centerX,centerY),getCurveT=function getCurveT(x,y,curvePts){var x0=curvePts[4],x1=curvePts[2],x2=curvePts[0],y0=curvePts[5],y2=curvePts[1],xMin=Math.min(x0,x2),xMax=Math.max(x0,x2),yMin=Math.min(y0,y2),yMax=Math.max(y0,y2);if(xMin<=x&&x<=xMax&&yMin<=y&&y<=yMax){var coeff=function bezierPtsToQuadCoeff(p0,p1,p2){return[p0-2*p1+p2,2*(p1-p0),p0]}(x0,x1,x2),validRoots=function solveQuadratic(a,b,c,val){var r=b*b-4*a*(c-=val);if(r<0)return[];var sqrtR=Math.sqrt(r),denom=2*a;return[(-b+sqrtR)/denom,(-b-sqrtR)/denom]}(coeff[0],coeff[1],coeff[2],x).filter(function(r){return 0<=r&&r<=1});if(validRoots.length>0)return validRoots[0]}return null},curveRegions=Object.keys(barrelCurvePts),i=0;i<curveRegions.length;i++){var cornerPts=barrelCurvePts[curveRegions[i]],t=getCurveT(x,y,cornerPts);if(null!=t){var y0=cornerPts[5],y1=cornerPts[3],y2=cornerPts[1],bezY=qbezierAt(y0,y1,y2,t);if(cornerPts.isTop&&bezY<=y)return!0;if(cornerPts.isBottom&&y<=bezY)return!0}}return!1}}},BRp$2.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height,cornerRadius){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height,this.points,cornerRadius)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding,cornerRadius){var topStartY=nodeY-(height/2+padding),topIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,nodeX-(width/2+padding),topStartY,nodeX+(width/2+padding),topStartY,!1);return topIntersections.length>0?topIntersections:roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding,cornerRadius)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY,cornerRadius){var diam=2*(cornerRadius="auto"===cornerRadius?getRoundRectangleRadius(width,height):cornerRadius);if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding))return!0;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding))return!0;var outerWidth=width/2+2*padding,outerHeight=height/2+2*padding;return!!pointInsidePolygonPoints(x,y,[centerX-outerWidth,centerY-outerHeight,centerX-outerWidth,centerY,centerX+outerWidth,centerY,centerX+outerWidth,centerY-outerHeight])||(!!checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,padding)||!!checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,padding))}}},BRp$2.registerNodeShapes=function(){var nodeShapes=this.nodeShapes={},renderer=this;this.generateEllipse(),this.generatePolygon("triangle",generateUnitNgonPointsFitToSquare(3,0)),this.generateRoundPolygon("round-triangle",generateUnitNgonPointsFitToSquare(3,0)),this.generatePolygon("rectangle",generateUnitNgonPointsFitToSquare(4,0)),nodeShapes.square=nodeShapes.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();var diamondPoints=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",diamondPoints),this.generateRoundPolygon("round-diamond",diamondPoints),this.generatePolygon("pentagon",generateUnitNgonPointsFitToSquare(5,0)),this.generateRoundPolygon("round-pentagon",generateUnitNgonPointsFitToSquare(5,0)),this.generatePolygon("hexagon",generateUnitNgonPointsFitToSquare(6,0)),this.generateRoundPolygon("round-hexagon",generateUnitNgonPointsFitToSquare(6,0)),this.generatePolygon("heptagon",generateUnitNgonPointsFitToSquare(7,0)),this.generateRoundPolygon("round-heptagon",generateUnitNgonPointsFitToSquare(7,0)),this.generatePolygon("octagon",generateUnitNgonPointsFitToSquare(8,0)),this.generateRoundPolygon("round-octagon",generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20),outerPoints=generateUnitNgonPoints(5,0),innerPoints=generateUnitNgonPoints(5,Math.PI/5),innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++)innerPoints[2*i]*=innerRadius,innerPoints[2*i+1]*=innerRadius;for(i=0;i<5;i++)star5Points[4*i]=outerPoints[2*i],star5Points[4*i+1]=outerPoints[2*i+1],star5Points[4*i+2]=innerPoints[2*i],star5Points[4*i+3]=innerPoints[2*i+1];star5Points=fitPolygonToSquare(star5Points),this.generatePolygon("star",star5Points),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);var tagPoints=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",tagPoints),this.generateRoundPolygon("round-tag",tagPoints),nodeShapes.makePolygon=function(points){var shape,name="polygon-"+points.join("$");return(shape=this[name])?shape:renderer.generatePolygon(name,points)}};var BRp$1={timeToRender:function(){return this.redrawTotalTime/this.redrawCount},redraw:function(options){options=options||staticEmptyObject();var r=this;void 0===r.averageRedrawTime&&(r.averageRedrawTime=0),void 0===r.lastRedrawTime&&(r.lastRedrawTime=0),void 0===r.lastDrawTime&&(r.lastDrawTime=0),r.requestedFrame=!0,r.renderOptions=options},beforeRender:function(fn,priority){if(!this.destroyed){null==priority&&error("Priority is not optional for beforeRender");var cbs=this.beforeRenderCallbacks;cbs.push({fn,priority}),cbs.sort(function(a,b){return b.priority-a.priority})}}},beforeRenderCallbacks=function beforeRenderCallbacks(r,willDraw,startTime){for(var cbs=r.beforeRenderCallbacks,i=0;i<cbs.length;i++)cbs[i].fn(willDraw,startTime)};BRp$1.startRenderLoop=function(){var r=this,cy=r.cy;if(!r.renderLoopStarted){r.renderLoopStarted=!0;var _renderFn=function renderFn(requestTime){if(!r.destroyed){if(cy.batching());else if(r.requestedFrame&&!r.skipFrame){beforeRenderCallbacks(r,!0,requestTime);var startTime=performanceNow();r.render(r.renderOptions);var endTime=r.lastDrawTime=performanceNow();void 0===r.averageRedrawTime&&(r.averageRedrawTime=endTime-startTime),void 0===r.redrawCount&&(r.redrawCount=0),r.redrawCount++,void 0===r.redrawTotalTime&&(r.redrawTotalTime=0);var duration=endTime-startTime;r.redrawTotalTime+=duration,r.lastRedrawTime=duration,r.averageRedrawTime=r.averageRedrawTime/2+duration/2,r.requestedFrame=!1}else beforeRenderCallbacks(r,!1,requestTime);r.skipFrame=!1,requestAnimationFrame(_renderFn)}};requestAnimationFrame(_renderFn)}};var BR=function BaseRenderer(options){this.init(options)},BRp=BR.prototype;BRp.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],BRp.init=function(options){var r=this;r.options=options,r.cy=options.cy;var ctr=r.container=options.cy.container(),containerWindow=r.cy.window();if(containerWindow){var document=containerWindow.document,head=document.head,className="__________cytoscape_container",stylesheetAlreadyExists=null!=document.getElementById("__________cytoscape_stylesheet");if(ctr.className.indexOf(className)<0&&(ctr.className=(ctr.className||"")+" "+className),!stylesheetAlreadyExists){var stylesheet=document.createElement("style");stylesheet.id="__________cytoscape_stylesheet",stylesheet.textContent="."+className+" { position: relative; }",head.insertBefore(stylesheet,head.children[0])}"static"===containerWindow.getComputedStyle(ctr).getPropertyValue("position")&&warn("A Cytoscape container has style position:static and so can not use UI extensions properly")}r.selection=[void 0,void 0,void 0,void 0,0],r.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],r.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},r.dragData={possibleDragElements:[]},r.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},r.redraws=0,r.showFps=options.showFps,r.debug=options.debug,r.webgl=options.webgl,r.hideEdgesOnViewport=options.hideEdgesOnViewport,r.textureOnViewport=options.textureOnViewport,r.wheelSensitivity=options.wheelSensitivity,r.motionBlurEnabled=options.motionBlur,r.forcedPixelRatio=number$1(options.pixelRatio)?options.pixelRatio:null,r.motionBlur=options.motionBlur,r.motionBlurOpacity=options.motionBlurOpacity,r.motionBlurTransparency=1-r.motionBlurOpacity,r.motionBlurPxRatio=1,r.mbPxRBlurry=1,r.minMbLowQualFrames=4,r.fullQualityMb=!1,r.clearedForMotionBlur=[],r.desktopTapThreshold=options.desktopTapThreshold,r.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold,r.touchTapThreshold=options.touchTapThreshold,r.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold,r.tapholdDuration=500,r.bindings=[],r.beforeRenderCallbacks=[],r.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},r.registerNodeShapes(),r.registerArrowShapes(),r.registerCalculationListeners()},BRp.notify=function(eventName,eles){var r=this,cy=r.cy;this.destroyed||("init"!==eventName?"destroy"!==eventName?(("add"===eventName||"remove"===eventName||"move"===eventName&&cy.hasCompoundNodes()||"load"===eventName||"zorder"===eventName||"mount"===eventName)&&r.invalidateCachedZSortedEles(),"viewport"===eventName&&r.redrawHint("select",!0),"gc"===eventName&&r.redrawHint("gc",!0),"load"!==eventName&&"resize"!==eventName&&"mount"!==eventName||(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container)),r.redrawHint("eles",!0),r.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()):r.destroy():r.load())},BRp.destroy=function(){var r=this;r.destroyed=!0,r.cy.stopAnimationLoop();for(var i=0;i<r.bindings.length;i++){var b=r.bindings[i],tgt=b.target;(tgt.off||tgt.removeEventListener).apply(tgt,b.args)}if(r.bindings=[],r.beforeRenderCallbacks=[],r.onUpdateEleCalcsFns=[],r.removeObserver&&r.removeObserver.disconnect(),r.styleObserver&&r.styleObserver.disconnect(),r.resizeObserver&&r.resizeObserver.disconnect(),r.labelCalcDiv)try{document.body.removeChild(r.labelCalcDiv)}catch(e){}},BRp.isHeadless=function(){return!1},[BRp$f,BRp$5,BRp$4,BRp$3,BRp$2,BRp$1].forEach(function(props){extend(BRp,props)});var fullFpsTime=1e3/60,defs_setupDequeueing=function setupDequeueing(opts){return function setupDequeueingImpl(){var self=this,r=this.renderer;if(!self.dequeueingSetup){self.dequeueingSetup=!0;var queueRedraw=debounce(function(){r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},opts.deqRedrawThreshold),priority=opts.priority||noop$1;r.beforeRender(function dequeue(willDraw,frameStartTime){var startTime=performanceNow(),avgRenderTime=r.averageRedrawTime,renderTime=r.lastRedrawTime,deqd=[],extent=r.cy.extent(),pixelRatio=r.getPixelRatio();for(willDraw||r.flushRenderedStyleQueue();;){var now=performanceNow(),duration=now-startTime,frameDuration=now-frameStartTime;if(renderTime<fullFpsTime){var timeAvailable=fullFpsTime-(willDraw?avgRenderTime:0);if(frameDuration>=opts.deqFastCost*timeAvailable)break}else if(willDraw){if(duration>=opts.deqCost*renderTime||duration>=opts.deqAvgCost*avgRenderTime)break}else if(frameDuration>=opts.deqNoDrawCost*fullFpsTime)break;var thisDeqd=opts.deq(self,pixelRatio,extent);if(!(thisDeqd.length>0))break;for(var i=0;i<thisDeqd.length;i++)deqd.push(thisDeqd[i])}deqd.length>0&&(opts.onDeqd(self,deqd),!willDraw&&opts.shouldRedraw(self,deqd,pixelRatio,extent)&&queueRedraw())},priority(self))}}},ElementTextureCacheLookup=function(){return _createClass(function ElementTextureCacheLookup(getKey){var doesEleInvalidateKey=arguments.length>1&&void 0!==arguments[1]?arguments[1]:falsify;_classCallCheck(this,ElementTextureCacheLookup),this.idsByKey=new Map$1,this.keyForId=new Map$1,this.cachesByLvl=new Map$1,this.lvls=[],this.getKey=getKey,this.doesEleInvalidateKey=doesEleInvalidateKey},[{key:"getIdsFor",value:function getIdsFor(key){null==key&&error("Can not get id list for null key");var idsByKey=this.idsByKey,ids=this.idsByKey.get(key);return ids||(ids=new Set$1,idsByKey.set(key,ids)),ids}},{key:"addIdForKey",value:function addIdForKey(key,id){null!=key&&this.getIdsFor(key).add(id)}},{key:"deleteIdForKey",value:function deleteIdForKey(key,id){null!=key&&this.getIdsFor(key).delete(id)}},{key:"getNumberOfIdsForKey",value:function getNumberOfIdsForKey(key){return null==key?0:this.getIdsFor(key).size}},{key:"updateKeyMappingFor",value:function updateKeyMappingFor(ele){var id=ele.id(),prevKey=this.keyForId.get(id),currKey=this.getKey(ele);this.deleteIdForKey(prevKey,id),this.addIdForKey(currKey,id),this.keyForId.set(id,currKey)}},{key:"deleteKeyMappingFor",value:function deleteKeyMappingFor(ele){var id=ele.id(),prevKey=this.keyForId.get(id);this.deleteIdForKey(prevKey,id),this.keyForId.delete(id)}},{key:"keyHasChangedFor",value:function keyHasChangedFor(ele){var id=ele.id();return this.keyForId.get(id)!==this.getKey(ele)}},{key:"isInvalid",value:function isInvalid(ele){return this.keyHasChangedFor(ele)||this.doesEleInvalidateKey(ele)}},{key:"getCachesAt",value:function getCachesAt(lvl){var cachesByLvl=this.cachesByLvl,lvls=this.lvls,caches=cachesByLvl.get(lvl);return caches||(caches=new Map$1,cachesByLvl.set(lvl,caches),lvls.push(lvl)),caches}},{key:"getCache",value:function getCache(key,lvl){return this.getCachesAt(lvl).get(key)}},{key:"get",value:function get(ele,lvl){var key=this.getKey(ele),cache=this.getCache(key,lvl);return null!=cache&&this.updateKeyMappingFor(ele),cache}},{key:"getForCachedKey",value:function getForCachedKey(ele,lvl){var key=this.keyForId.get(ele.id());return this.getCache(key,lvl)}},{key:"hasCache",value:function hasCache(key,lvl){return this.getCachesAt(lvl).has(key)}},{key:"has",value:function has(ele,lvl){var key=this.getKey(ele);return this.hasCache(key,lvl)}},{key:"setCache",value:function setCache(key,lvl,cache){cache.key=key,this.getCachesAt(lvl).set(key,cache)}},{key:"set",value:function set(ele,lvl,cache){var key=this.getKey(ele);this.setCache(key,lvl,cache),this.updateKeyMappingFor(ele)}},{key:"deleteCache",value:function deleteCache(key,lvl){this.getCachesAt(lvl).delete(key)}},{key:"delete",value:function _delete(ele,lvl){var key=this.getKey(ele);this.deleteCache(key,lvl)}},{key:"invalidateKey",value:function invalidateKey(key){var _this=this;this.lvls.forEach(function(lvl){return _this.deleteCache(key,lvl)})}},{key:"invalidate",value:function invalidate(ele){var id=ele.id(),key=this.keyForId.get(id);this.deleteKeyMappingFor(ele);var entireKeyInvalidated=this.doesEleInvalidateKey(ele);return entireKeyInvalidated&&this.invalidateKey(key),entireKeyInvalidated||0===this.getNumberOfIdsForKey(key)}}])}(),getTxrReasons={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},initDefaults=defaults$g({getKey:null,doesEleInvalidateKey:falsify,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:trueify,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),ElementTextureCache=function ElementTextureCache(renderer,initOptions){this.renderer=renderer,this.onDequeues=[];var opts=initDefaults(initOptions);extend(this,opts),this.lookup=new ElementTextureCacheLookup(opts.getKey,opts.doesEleInvalidateKey),this.setupDequeueing()},ETCp=ElementTextureCache.prototype;ETCp.reasons=getTxrReasons,ETCp.getTextureQueue=function(txrH){return this.eleImgCaches=this.eleImgCaches||{},this.eleImgCaches[txrH]=this.eleImgCaches[txrH]||[]},ETCp.getRetiredTextureQueue=function(txrH){var rtxtrQs=this.eleImgCaches.retired=this.eleImgCaches.retired||{};return rtxtrQs[txrH]=rtxtrQs[txrH]||[]},ETCp.getElementQueue=function(){return this.eleCacheQueue=this.eleCacheQueue||new Heap(function(a,b){return b.reqs-a.reqs})},ETCp.getElementKeyToQueue=function(){return this.eleKeyToCacheQueue=this.eleKeyToCacheQueue||{}},ETCp.getElement=function(ele,bb,pxRatio,lvl,reason){var self=this,r=this.renderer,zoom=r.cy.zoom(),lookup=this.lookup;if(!bb||0===bb.w||0===bb.h||isNaN(bb.w)||isNaN(bb.h)||!ele.visible()||ele.removed())return null;if(!self.allowEdgeTxrCaching&&ele.isEdge()||!self.allowParentTxrCaching&&ele.isParent())return null;if(null==lvl&&(lvl=Math.ceil(log2(zoom*pxRatio))),lvl<-4)lvl=-4;else if(zoom>=7.99||lvl>3)return null;var scale=Math.pow(2,lvl),eleScaledH=bb.h*scale,eleScaledW=bb.w*scale,scaledLabelShown=r.eleTextBiggerThanMin(ele,scale);if(!this.isVisible(ele,scaledLabelShown))return null;var txrH,eleCache=lookup.get(ele,lvl);if(eleCache&&eleCache.invalidated&&(eleCache.invalidated=!1,eleCache.texture.invalidatedWidth-=eleCache.width),eleCache)return eleCache;if(txrH=eleScaledH<=25?25:eleScaledH<=50?50:50*Math.ceil(eleScaledH/50),eleScaledH>1024||eleScaledW>1024)return null;var txrQ=self.getTextureQueue(txrH),txr=txrQ[txrQ.length-2],addNewTxr=function addNewTxr(){return self.recycleTexture(txrH,eleScaledW)||self.addTexture(txrH,eleScaledW)};txr||(txr=txrQ[txrQ.length-1]),txr||(txr=addNewTxr()),txr.width-txr.usedWidth<eleScaledW&&(txr=addNewTxr());for(var higherCache,scalableFrom=function scalableFrom(otherCache){return otherCache&&otherCache.scaledLabelShown===scaledLabelShown},deqing=reason&&reason===getTxrReasons.dequeue,highQualityReq=reason&&reason===getTxrReasons.highQuality,downscaleReq=reason&&reason===getTxrReasons.downscale,l=lvl+1;l<=3;l++){var c=lookup.get(ele,l);if(c){higherCache=c;break}}var oneUpCache=higherCache&&higherCache.level===lvl+1?higherCache:null,downscale=function downscale(){txr.context.drawImage(oneUpCache.texture.canvas,oneUpCache.x,0,oneUpCache.width,oneUpCache.height,txr.usedWidth,0,eleScaledW,eleScaledH)};if(txr.context.setTransform(1,0,0,1,0,0),txr.context.clearRect(txr.usedWidth,0,eleScaledW,txrH),scalableFrom(oneUpCache))downscale();else if(scalableFrom(higherCache)){if(!highQualityReq)return self.queueElement(ele,higherCache.level-1),higherCache;for(var _l=higherCache.level;_l>lvl;_l--)oneUpCache=self.getElement(ele,bb,pxRatio,_l,getTxrReasons.downscale);downscale()}else{var lowerCache;if(!deqing&&!highQualityReq&&!downscaleReq)for(var _l2=lvl-1;_l2>=-4;_l2--){var _c=lookup.get(ele,_l2);if(_c){lowerCache=_c;break}}if(scalableFrom(lowerCache))return self.queueElement(ele,lvl),lowerCache;txr.context.translate(txr.usedWidth,0),txr.context.scale(scale,scale),this.drawElement(txr.context,ele,bb,scaledLabelShown,!1),txr.context.scale(1/scale,1/scale),txr.context.translate(-txr.usedWidth,0)}return eleCache={x:txr.usedWidth,texture:txr,level:lvl,scale,width:eleScaledW,height:eleScaledH,scaledLabelShown},txr.usedWidth+=Math.ceil(eleScaledW+8),txr.eleCaches.push(eleCache),lookup.set(ele,lvl,eleCache),self.checkTextureFullness(txr),eleCache},ETCp.invalidateElements=function(eles){for(var i=0;i<eles.length;i++)this.invalidateElement(eles[i])},ETCp.invalidateElement=function(ele){var lookup=this.lookup,caches=[];if(lookup.isInvalid(ele)){for(var lvl=-4;lvl<=3;lvl++){var cache=lookup.getForCachedKey(ele,lvl);cache&&caches.push(cache)}if(lookup.invalidate(ele))for(var i=0;i<caches.length;i++){var _cache=caches[i],txr=_cache.texture;txr.invalidatedWidth+=_cache.width,_cache.invalidated=!0,this.checkTextureUtility(txr)}this.removeFromQueue(ele)}},ETCp.checkTextureUtility=function(txr){txr.invalidatedWidth>=.2*txr.width&&this.retireTexture(txr)},ETCp.checkTextureFullness=function(txr){var txrQ=this.getTextureQueue(txr.height);txr.usedWidth/txr.width>.8&&txr.fullnessChecks>=10?removeFromArray(txrQ,txr):txr.fullnessChecks++},ETCp.retireTexture=function(txr){var txrH=txr.height,txrQ=this.getTextureQueue(txrH),lookup=this.lookup;removeFromArray(txrQ,txr),txr.retired=!0;for(var eleCaches=txr.eleCaches,i=0;i<eleCaches.length;i++){var eleCache=eleCaches[i];lookup.deleteCache(eleCache.key,eleCache.level)}clearArray(eleCaches),this.getRetiredTextureQueue(txrH).push(txr)},ETCp.addTexture=function(txrH,minW){var txr={};return this.getTextureQueue(txrH).push(txr),txr.eleCaches=[],txr.height=txrH,txr.width=Math.max(1024,minW),txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,txr.canvas=this.renderer.makeOffscreenCanvas(txr.width,txr.height),txr.context=txr.canvas.getContext("2d"),txr},ETCp.recycleTexture=function(txrH,minW){for(var txrQ=this.getTextureQueue(txrH),rtxtrQ=this.getRetiredTextureQueue(txrH),i=0;i<rtxtrQ.length;i++){var txr=rtxtrQ[i];if(txr.width>=minW)return txr.retired=!1,txr.usedWidth=0,txr.invalidatedWidth=0,txr.fullnessChecks=0,clearArray(txr.eleCaches),txr.context.setTransform(1,0,0,1,0,0),txr.context.clearRect(0,0,txr.width,txr.height),removeFromArray(rtxtrQ,txr),txrQ.push(txr),txr}},ETCp.queueElement=function(ele,lvl){var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),key=this.getKey(ele),existingReq=k2q[key];if(existingReq)existingReq.level=Math.max(existingReq.level,lvl),existingReq.eles.merge(ele),existingReq.reqs++,q.updateItem(existingReq);else{var req={eles:ele.spawn().merge(ele),level:lvl,reqs:1,key};q.push(req),k2q[key]=req}},ETCp.dequeue=function(pxRatio){for(var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),dequeued=[],lookup=this.lookup,i=0;i<1&&q.size()>0;i++){var req=q.pop(),key=req.key,ele=req.eles[0],cacheExists=lookup.hasCache(ele,req.level);if(k2q[key]=null,!cacheExists){dequeued.push(req);var bb=this.getBoundingBox(ele);this.getElement(ele,bb,pxRatio,req.level,getTxrReasons.dequeue)}}return dequeued},ETCp.removeFromQueue=function(ele){var q=this.getElementQueue(),k2q=this.getElementKeyToQueue(),key=this.getKey(ele),req=k2q[key];null!=req&&(1===req.eles.length?(req.reqs=MAX_INT$1,q.updateItem(req),q.pop(),k2q[key]=null):req.eles.unmerge(ele))},ETCp.onDequeue=function(fn){this.onDequeues.push(fn)},ETCp.offDequeue=function(fn){removeFromArray(this.onDequeues,fn)},ETCp.setupDequeueing=defs_setupDequeueing({deqRedrawThreshold:100,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function deq(self,pxRatio,extent){return self.dequeue(pxRatio,extent)},onDeqd:function onDeqd(self,deqd){for(var i=0;i<self.onDequeues.length;i++){(0,self.onDequeues[i])(deqd)}},shouldRedraw:function shouldRedraw(self,deqd,pxRatio,extent){for(var i=0;i<deqd.length;i++)for(var eles=deqd[i].eles,j=0;j<eles.length;j++){var bb=eles[j].boundingBox();if(boundingBoxesIntersect(bb,extent))return!0}return!1},priority:function priority(self){return self.renderer.beforeRenderPriorities.eleTxrDeq}});var LayeredTextureCache=function LayeredTextureCache(renderer){var self=this,r=self.renderer=renderer,cy=r.cy;self.layersByLevel={},self.firstGet=!0,self.lastInvalidationTime=performanceNow()-500,self.skipping=!1,self.eleTxrDeqs=cy.collection(),self.scheduleElementRefinement=debounce(function(){self.refineElementTextures(self.eleTxrDeqs),self.eleTxrDeqs.unmerge(self.eleTxrDeqs)},50),r.beforeRender(function(willDraw,now){now-self.lastInvalidationTime<=250?self.skipping=!0:self.skipping=!1},r.beforeRenderPriorities.lyrTxrSkip);self.layersQueue=new Heap(function qSort(a,b){return b.reqs-a.reqs}),self.setupDequeueing()},LTCp=LayeredTextureCache.prototype,layerIdPool=0,MAX_INT=Math.pow(2,53)-1;LTCp.makeLayer=function(bb,lvl){var scale=Math.pow(2,lvl),w=Math.ceil(bb.w*scale),h=Math.ceil(bb.h*scale),canvas=this.renderer.makeOffscreenCanvas(w,h),layer={id:layerIdPool=++layerIdPool%MAX_INT,bb,level:lvl,width:w,height:h,canvas,context:canvas.getContext("2d"),eles:[],elesQueue:[],reqs:0},cxt=layer.context,dx=-layer.bb.x1,dy=-layer.bb.y1;return cxt.scale(scale,scale),cxt.translate(dx,dy),layer},LTCp.getLayers=function(eles,pxRatio,lvl){var self=this,zoom=self.renderer.cy.zoom(),firstGet=self.firstGet;if(self.firstGet=!1,null==lvl)if((lvl=Math.ceil(log2(zoom*pxRatio)))<-4)lvl=-4;else if(zoom>=3.99||lvl>2)return null;self.validateLayersElesOrdering(lvl,eles);var bb,tmpLayers,layersByLvl=self.layersByLevel,scale=Math.pow(2,lvl),layers=layersByLvl[lvl]=layersByLvl[lvl]||[];if(self.levelIsComplete(lvl,eles))return layers;!function checkTempLevels(){var canUseAsTmpLvl=function canUseAsTmpLvl(l){if(self.validateLayersElesOrdering(l,eles),self.levelIsComplete(l,eles))return tmpLayers=layersByLvl[l],!0},checkLvls=function checkLvls(dir){if(!tmpLayers)for(var l=lvl+dir;-4<=l&&l<=2&&!canUseAsTmpLvl(l);l+=dir);};checkLvls(1),checkLvls(-1);for(var i=layers.length-1;i>=0;i--){var layer=layers[i];layer.invalid&&removeFromArray(layers,layer)}}();var makeLayer=function makeLayer(opts){var after=(opts=opts||{}).after;!function getBb(){if(!bb){bb=makeBoundingBox();for(var i=0;i<eles.length;i++)updateBoundingBox(bb,eles[i].boundingBox())}}();var w=Math.ceil(bb.w*scale),h=Math.ceil(bb.h*scale);if(w>32767||h>32767)return null;if(w*h>16e6)return null;var layer=self.makeLayer(bb,lvl);if(null!=after){var index=layers.indexOf(after)+1;layers.splice(index,0,layer)}else(void 0===opts.insert||opts.insert)&&layers.unshift(layer);return layer};if(self.skipping&&!firstGet)return null;for(var layer=null,maxElesPerLayer=eles.length/1,allowLazyQueueing=!firstGet,i=0;i<eles.length;i++){var ele=eles[i],rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},existingLayer=caches[lvl];if(existingLayer)layer=existingLayer;else{if((!layer||layer.eles.length>=maxElesPerLayer||!boundingBoxInBoundingBox(layer.bb,ele.boundingBox()))&&!(layer=makeLayer({insert:!0,after:layer})))return null;tmpLayers||allowLazyQueueing?self.queueLayer(layer,ele):self.drawEleInLayer(layer,ele,lvl,pxRatio),layer.eles.push(ele),caches[lvl]=layer}}return tmpLayers||(allowLazyQueueing?null:layers)},LTCp.getEleLevelForLayerLevel=function(lvl,pxRatio){return lvl},LTCp.drawEleInLayer=function(layer,ele,lvl,pxRatio){var r=this.renderer,context=layer.context,bb=ele.boundingBox();0!==bb.w&&0!==bb.h&&ele.visible()&&(lvl=this.getEleLevelForLayerLevel(lvl,pxRatio),r.setImgSmoothing(context,!1),r.drawCachedElement(context,ele,null,null,lvl,true),r.setImgSmoothing(context,!0))},LTCp.levelIsComplete=function(lvl,eles){var layers=this.layersByLevel[lvl];if(!layers||0===layers.length)return!1;for(var numElesInLayers=0,i=0;i<layers.length;i++){var layer=layers[i];if(layer.reqs>0)return!1;if(layer.invalid)return!1;numElesInLayers+=layer.eles.length}return numElesInLayers===eles.length},LTCp.validateLayersElesOrdering=function(lvl,eles){var layers=this.layersByLevel[lvl];if(layers)for(var i=0;i<layers.length;i++){for(var layer=layers[i],offset=-1,j=0;j<eles.length;j++)if(layer.eles[0]===eles[j]){offset=j;break}if(offset<0)this.invalidateLayer(layer);else{var o=offset;for(j=0;j<layer.eles.length;j++)if(layer.eles[j]!==eles[o+j]){this.invalidateLayer(layer);break}}}},LTCp.updateElementsInLayers=function(eles,update){for(var isEles=element(eles[0]),i=0;i<eles.length;i++)for(var req=isEles?null:eles[i],ele=isEles?eles[i]:eles[i].ele,rs=ele._private.rscratch,caches=rs.imgLayerCaches=rs.imgLayerCaches||{},l=-4;l<=2;l++){var layer=caches[l];layer&&(req&&this.getEleLevelForLayerLevel(layer.level)!==req.level||update(layer,ele,req))}},LTCp.haveLayers=function(){for(var haveLayers=!1,l=-4;l<=2;l++){var layers=this.layersByLevel[l];if(layers&&layers.length>0){haveLayers=!0;break}}return haveLayers},LTCp.invalidateElements=function(eles){var self=this;0!==eles.length&&(self.lastInvalidationTime=performanceNow(),0!==eles.length&&self.haveLayers()&&self.updateElementsInLayers(eles,function invalAssocLayers(layer,ele,req){self.invalidateLayer(layer)}))},LTCp.invalidateLayer=function(layer){if(this.lastInvalidationTime=performanceNow(),!layer.invalid){var lvl=layer.level,eles=layer.eles,layers=this.layersByLevel[lvl];removeFromArray(layers,layer),layer.elesQueue=[],layer.invalid=!0,layer.replacement&&(layer.replacement.invalid=!0);for(var i=0;i<eles.length;i++){var caches=eles[i]._private.rscratch.imgLayerCaches;caches&&(caches[lvl]=null)}}},LTCp.refineElementTextures=function(eles){var self=this;self.updateElementsInLayers(eles,function refineEachEle(layer,ele,req){var rLyr=layer.replacement;if(rLyr||((rLyr=layer.replacement=self.makeLayer(layer.bb,layer.level)).replaces=layer,rLyr.eles=layer.eles),!rLyr.reqs)for(var i=0;i<rLyr.eles.length;i++)self.queueLayer(rLyr,rLyr.eles[i])})},LTCp.enqueueElementRefinement=function(ele){this.eleTxrDeqs.merge(ele),this.scheduleElementRefinement()},LTCp.queueLayer=function(layer,ele){var q=this.layersQueue,elesQ=layer.elesQueue,hasId=elesQ.hasId=elesQ.hasId||{};if(!layer.replacement){if(ele){if(hasId[ele.id()])return;elesQ.push(ele),hasId[ele.id()]=!0}layer.reqs?(layer.reqs++,q.updateItem(layer)):(layer.reqs=1,q.push(layer))}},LTCp.dequeue=function(pxRatio){for(var q=this.layersQueue,deqd=[],eleDeqs=0;eleDeqs<1&&0!==q.size();){var layer=q.peek();if(layer.replacement)q.pop();else if(layer.replaces&&layer!==layer.replaces.replacement)q.pop();else if(layer.invalid)q.pop();else{var ele=layer.elesQueue.shift();ele&&(this.drawEleInLayer(layer,ele,layer.level,pxRatio),eleDeqs++),0===deqd.length&&deqd.push(!0),0===layer.elesQueue.length&&(q.pop(),layer.reqs=0,layer.replaces&&this.applyLayerReplacement(layer),this.requestRedraw())}}return deqd},LTCp.applyLayerReplacement=function(layer){var layersInLevel=this.layersByLevel[layer.level],replaced=layer.replaces,index=layersInLevel.indexOf(replaced);if(!(index<0||replaced.invalid)){layersInLevel[index]=layer;for(var i=0;i<layer.eles.length;i++){var _p=layer.eles[i]._private,cache=_p.imgLayerCaches=_p.imgLayerCaches||{};cache&&(cache[layer.level]=layer)}this.requestRedraw()}},LTCp.requestRedraw=debounce(function(){var r=this.renderer;r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},100),LTCp.setupDequeueing=defs_setupDequeueing({deqRedrawThreshold:50,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function deq(self,pxRatio){return self.dequeue(pxRatio)},onDeqd:noop$1,shouldRedraw:trueify,priority:function priority(self){return self.renderer.beforeRenderPriorities.lyrTxrDeq}});var impl,CRp$b={};function polygon(context,points){for(var i=0;i<points.length;i++){var pt=points[i];context.lineTo(pt.x,pt.y)}}function triangleBackcurve(context,points,controlPoint){for(var firstPt,i=0;i<points.length;i++){var pt=points[i];0===i&&(firstPt=pt),context.lineTo(pt.x,pt.y)}context.quadraticCurveTo(controlPoint.x,controlPoint.y,firstPt.x,firstPt.y)}function triangleTee(context,trianglePoints,teePoints){context.beginPath&&context.beginPath();for(var triPts=trianglePoints,i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}var teePts=teePoints,firstTeePt=teePoints[0];context.moveTo(firstTeePt.x,firstTeePt.y);for(i=1;i<teePts.length;i++){pt=teePts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath()}function circleTriangle(context,trianglePoints,rx,ry,r){context.beginPath&&context.beginPath(),context.arc(rx,ry,r,0,2*Math.PI,!1);var triPts=trianglePoints,firstTrPt=triPts[0];context.moveTo(firstTrPt.x,firstTrPt.y);for(var i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}context.closePath&&context.closePath()}function circle$1(context,rx,ry,r){context.arc(rx,ry,r,0,2*Math.PI,!1)}CRp$b.arrowShapeImpl=function(name){return(impl||(impl={polygon,"triangle-backcurve":triangleBackcurve,"triangle-tee":triangleTee,"circle-triangle":circleTriangle,"triangle-cross":triangleTee,circle:circle$1}))[name]};var CRp$a={drawElement:function(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity){ele.isNode()?this.drawNode(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity):this.drawEdge(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity)},drawElementOverlay:function(context,ele){ele.isNode()?this.drawNodeOverlay(context,ele):this.drawEdgeOverlay(context,ele)},drawElementUnderlay:function(context,ele){ele.isNode()?this.drawNodeUnderlay(context,ele):this.drawEdgeUnderlay(context,ele)},drawCachedElementPortion:function(context,ele,eleTxrCache,pxRatio,lvl,reason,getRotation,getOpacity){var r=this,bb=eleTxrCache.getBoundingBox(ele);if(0!==bb.w&&0!==bb.h){var eleCache=eleTxrCache.getElement(ele,bb,pxRatio,lvl,reason);if(null!=eleCache){var opacity=getOpacity(r,ele);if(0===opacity)return;var x,y,sx,sy,smooth,oldGlobalAlpha,theta=getRotation(r,ele),x1=bb.x1,y1=bb.y1,w=bb.w,h=bb.h;if(0!==theta){var rotPt=eleTxrCache.getRotationPoint(ele);sx=rotPt.x,sy=rotPt.y,context.translate(sx,sy),context.rotate(theta),(smooth=r.getImgSmoothing(context))||r.setImgSmoothing(context,!0);var off=eleTxrCache.getRotationOffset(ele);x=off.x,y=off.y}else x=x1,y=y1;1!==opacity&&(oldGlobalAlpha=context.globalAlpha,context.globalAlpha=oldGlobalAlpha*opacity),context.drawImage(eleCache.texture.canvas,eleCache.x,0,eleCache.width,eleCache.height,x,y,w,h),1!==opacity&&(context.globalAlpha=oldGlobalAlpha),0!==theta&&(context.rotate(-theta),context.translate(-sx,-sy),smooth||r.setImgSmoothing(context,!1))}else eleTxrCache.drawElement(context,ele)}}},getZeroRotation=function getZeroRotation(){return 0},getLabelRotation=function getLabelRotation(r,ele){return r.getTextAngle(ele,null)},getSourceLabelRotation=function getSourceLabelRotation(r,ele){return r.getTextAngle(ele,"source")},getTargetLabelRotation=function getTargetLabelRotation(r,ele){return r.getTextAngle(ele,"target")},getOpacity=function getOpacity(r,ele){return ele.effectiveOpacity()},getTextOpacity=function getTextOpacity(e,ele){return ele.pstyle("text-opacity").pfValue*ele.effectiveOpacity()};CRp$a.drawCachedElement=function(context,ele,pxRatio,extent,lvl,requestHighQuality){var r=this,_r$data=r.data,eleTxrCache=_r$data.eleTxrCache,lblTxrCache=_r$data.lblTxrCache,slbTxrCache=_r$data.slbTxrCache,tlbTxrCache=_r$data.tlbTxrCache,bb=ele.boundingBox(),reason=!0===requestHighQuality?eleTxrCache.reasons.highQuality:null;if(0!==bb.w&&0!==bb.h&&ele.visible()&&(!extent||boundingBoxesIntersect(bb,extent))){var isEdge=ele.isEdge(),badLine=ele.element()._private.rscratch.badLine;r.drawElementUnderlay(context,ele),r.drawCachedElementPortion(context,ele,eleTxrCache,pxRatio,lvl,reason,getZeroRotation,getOpacity),isEdge&&badLine||r.drawCachedElementPortion(context,ele,lblTxrCache,pxRatio,lvl,reason,getLabelRotation,getTextOpacity),isEdge&&!badLine&&(r.drawCachedElementPortion(context,ele,slbTxrCache,pxRatio,lvl,reason,getSourceLabelRotation,getTextOpacity),r.drawCachedElementPortion(context,ele,tlbTxrCache,pxRatio,lvl,reason,getTargetLabelRotation,getTextOpacity)),r.drawElementOverlay(context,ele)}},CRp$a.drawElements=function(context,eles){for(var i=0;i<eles.length;i++){var ele=eles[i];this.drawElement(context,ele)}},CRp$a.drawCachedElements=function(context,eles,pxRatio,extent){for(var i=0;i<eles.length;i++){var ele=eles[i];this.drawCachedElement(context,ele,pxRatio,extent)}},CRp$a.drawCachedNodes=function(context,eles,pxRatio,extent){for(var i=0;i<eles.length;i++){var ele=eles[i];ele.isNode()&&this.drawCachedElement(context,ele,pxRatio,extent)}},CRp$a.drawLayeredElements=function(context,eles,pxRatio,extent){var layers=this.data.lyrTxrCache.getLayers(eles,pxRatio);if(layers)for(var i=0;i<layers.length;i++){var layer=layers[i],bb=layer.bb;0!==bb.w&&0!==bb.h&&context.drawImage(layer.canvas,bb.x1,bb.y1,bb.w,bb.h)}else this.drawCachedElements(context,eles,pxRatio,extent)};var CRp$9={drawEdge:function(context,edge,shiftToOriginWithBb){var drawLabel=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],shouldDrawOverlay=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],shouldDrawOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this,rs=edge._private.rscratch;if((!shouldDrawOpacity||edge.visible())&&!rs.badLine&&null!=rs.allpts&&!isNaN(rs.allpts[0])){var bb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));var opacity=shouldDrawOpacity?edge.pstyle("opacity").value:1,lineOpacity=shouldDrawOpacity?edge.pstyle("line-opacity").value:1,curveStyle=edge.pstyle("curve-style").value,lineStyle=edge.pstyle("line-style").value,edgeWidth=edge.pstyle("width").pfValue,lineCap=edge.pstyle("line-cap").value,lineOutlineWidth=edge.pstyle("line-outline-width").value,lineOutlineColor=edge.pstyle("line-outline-color").value,effectiveLineOpacity=opacity*lineOpacity,effectiveArrowOpacity=opacity*lineOpacity,drawLine=function drawLine(){var strokeOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:effectiveLineOpacity;"straight-triangle"===curveStyle?(r.eleStrokeStyle(context,edge,strokeOpacity),r.drawEdgeTrianglePath(edge,context,rs.allpts)):(context.lineWidth=edgeWidth,context.lineCap=lineCap,r.eleStrokeStyle(context,edge,strokeOpacity),r.drawEdgePath(edge,context,rs.allpts,lineStyle),context.lineCap="butt")},drawArrows=function drawArrows(){var arrowOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:effectiveArrowOpacity;r.drawArrowheads(context,edge,arrowOpacity)};if(context.lineJoin="round","yes"===edge.pstyle("ghost").value){var gx=edge.pstyle("ghost-offset-x").pfValue,gy=edge.pstyle("ghost-offset-y").pfValue,ghostOpacity=edge.pstyle("ghost-opacity").value,effectiveGhostOpacity=effectiveLineOpacity*ghostOpacity;context.translate(gx,gy),drawLine(effectiveGhostOpacity),drawArrows(effectiveGhostOpacity),context.translate(-gx,-gy)}else!function drawLineOutline(){var strokeOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:effectiveLineOpacity;context.lineWidth=edgeWidth+lineOutlineWidth,context.lineCap=lineCap,lineOutlineWidth>0?(r.colorStrokeStyle(context,lineOutlineColor[0],lineOutlineColor[1],lineOutlineColor[2],strokeOpacity),"straight-triangle"===curveStyle?r.drawEdgeTrianglePath(edge,context,rs.allpts):(r.drawEdgePath(edge,context,rs.allpts,lineStyle),context.lineCap="butt")):context.lineCap="butt"}();!function drawUnderlay(){shouldDrawOverlay&&r.drawEdgeUnderlay(context,edge)}(),drawLine(),drawArrows(),function drawOverlay(){shouldDrawOverlay&&r.drawEdgeOverlay(context,edge)}(),function drawText(){r.drawElementText(context,edge,null,drawLabel)}(),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}}},drawEdgeOverlayUnderlay=function drawEdgeOverlayUnderlay(overlayOrUnderlay){if(!["overlay","underlay"].includes(overlayOrUnderlay))throw new Error("Invalid state");return function(context,edge){if(edge.visible()){var opacity=edge.pstyle("".concat(overlayOrUnderlay,"-opacity")).value;if(0!==opacity){var r=this,usePaths=r.usePaths(),rs=edge._private.rscratch,width=2*edge.pstyle("".concat(overlayOrUnderlay,"-padding")).pfValue,color=edge.pstyle("".concat(overlayOrUnderlay,"-color")).value;context.lineWidth=width,"self"!==rs.edgeType||usePaths?context.lineCap="round":context.lineCap="butt",r.colorStrokeStyle(context,color[0],color[1],color[2],opacity),r.drawEdgePath(edge,context,rs.allpts,"solid")}}}};CRp$9.drawEdgeOverlay=drawEdgeOverlayUnderlay("overlay"),CRp$9.drawEdgeUnderlay=drawEdgeOverlayUnderlay("underlay"),CRp$9.drawEdgePath=function(edge,context,pts,type){var path,rs=edge._private.rscratch,canvasCxt=context,pathCacheHit=!1,usePaths=this.usePaths(),lineDashPattern=edge.pstyle("line-dash-pattern").pfValue,lineDashOffset=edge.pstyle("line-dash-offset").pfValue;if(usePaths){var pathCacheKey=pts.join("$");rs.pathCacheKey&&rs.pathCacheKey===pathCacheKey?(path=context=rs.pathCache,pathCacheHit=!0):(path=context=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(canvasCxt.setLineDash)switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash(lineDashPattern),canvasCxt.lineDashOffset=lineDashOffset;break;case"solid":canvasCxt.setLineDash([])}if(!pathCacheHit&&!rs.badLine)switch(context.beginPath&&context.beginPath(),context.moveTo(pts[0],pts[1]),rs.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var i=2;i+3<pts.length;i+=4)context.quadraticCurveTo(pts[i],pts[i+1],pts[i+2],pts[i+3]);break;case"straight":case"haystack":for(var _i=2;_i+1<pts.length;_i+=2)context.lineTo(pts[_i],pts[_i+1]);break;case"segments":if(rs.isRound){var _step,_iterator=_createForOfIteratorHelper(rs.roundCorners);try{for(_iterator.s();!(_step=_iterator.n()).done;){drawPreparedRoundCorner(context,_step.value)}}catch(err){_iterator.e(err)}finally{_iterator.f()}context.lineTo(pts[pts.length-2],pts[pts.length-1])}else for(var _i2=2;_i2+1<pts.length;_i2+=2)context.lineTo(pts[_i2],pts[_i2+1])}context=canvasCxt,usePaths?context.stroke(path):context.stroke(),context.setLineDash&&context.setLineDash([])},CRp$9.drawEdgeTrianglePath=function(edge,context,pts){context.fillStyle=context.strokeStyle;for(var edgeWidth=edge.pstyle("width").pfValue,i=0;i+1<pts.length;i+=2){var vector=[pts[i+2]-pts[i],pts[i+3]-pts[i+1]],length=Math.sqrt(vector[0]*vector[0]+vector[1]*vector[1]),normal=[vector[1]/length,-vector[0]/length],triangleHead=[normal[0]*edgeWidth/2,normal[1]*edgeWidth/2];context.beginPath(),context.moveTo(pts[i]-triangleHead[0],pts[i+1]-triangleHead[1]),context.lineTo(pts[i]+triangleHead[0],pts[i+1]+triangleHead[1]),context.lineTo(pts[i+2],pts[i+3]),context.closePath(),context.fill()}},CRp$9.drawArrowheads=function(context,edge,opacity){var rs=edge._private.rscratch,isHaystack="haystack"===rs.edgeType;isHaystack||this.drawArrowhead(context,edge,"source",rs.arrowStartX,rs.arrowStartY,rs.srcArrowAngle,opacity),this.drawArrowhead(context,edge,"mid-target",rs.midX,rs.midY,rs.midtgtArrowAngle,opacity),this.drawArrowhead(context,edge,"mid-source",rs.midX,rs.midY,rs.midsrcArrowAngle,opacity),isHaystack||this.drawArrowhead(context,edge,"target",rs.arrowEndX,rs.arrowEndY,rs.tgtArrowAngle,opacity)},CRp$9.drawArrowhead=function(context,edge,prefix,x,y,angle,opacity){if(!(isNaN(x)||null==x||isNaN(y)||null==y||isNaN(angle)||null==angle)){var arrowShape=edge.pstyle(prefix+"-arrow-shape").value;if("none"!==arrowShape){var arrowClearFill="hollow"===edge.pstyle(prefix+"-arrow-fill").value?"both":"filled",arrowFill=edge.pstyle(prefix+"-arrow-fill").value,edgeWidth=edge.pstyle("width").pfValue,pArrowWidth=edge.pstyle(prefix+"-arrow-width"),arrowWidth="match-line"===pArrowWidth.value?edgeWidth:pArrowWidth.pfValue;"%"===pArrowWidth.units&&(arrowWidth*=edgeWidth);var edgeOpacity=edge.pstyle("opacity").value;void 0===opacity&&(opacity=edgeOpacity);var gco=context.globalCompositeOperation;1===opacity&&"hollow"!==arrowFill||(context.globalCompositeOperation="destination-out",this.colorFillStyle(context,255,255,255,1),this.colorStrokeStyle(context,255,255,255,1),this.drawArrowShape(edge,context,arrowClearFill,edgeWidth,arrowShape,arrowWidth,x,y,angle),context.globalCompositeOperation=gco);var color=edge.pstyle(prefix+"-arrow-color").value;this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.colorStrokeStyle(context,color[0],color[1],color[2],opacity),this.drawArrowShape(edge,context,arrowFill,edgeWidth,arrowShape,arrowWidth,x,y,angle)}}},CRp$9.drawArrowShape=function(edge,context,fill,edgeWidth,shape,shapeWidth,x,y,angle){var path,r=this,usePaths=this.usePaths()&&"triangle-cross"!==shape,pathCacheHit=!1,canvasContext=context,translation={x,y},scale=edge.pstyle("arrow-scale").value,size=this.getArrowWidth(edgeWidth,scale),shapeImpl=r.arrowShapes[shape];if(usePaths){var cache=r.arrowPathCache=r.arrowPathCache||[],key=hashString(shape),cachedPath=cache[key];null!=cachedPath?(path=context=cachedPath,pathCacheHit=!0):(path=context=new Path2D,cache[key]=path)}pathCacheHit||(context.beginPath&&context.beginPath(),usePaths?shapeImpl.draw(context,1,0,{x:0,y:0},1):shapeImpl.draw(context,size,angle,translation,edgeWidth),context.closePath&&context.closePath()),context=canvasContext,usePaths&&(context.translate(x,y),context.rotate(angle),context.scale(size,size)),"filled"!==fill&&"both"!==fill||(usePaths?context.fill(path):context.fill()),"hollow"!==fill&&"both"!==fill||(context.lineWidth=shapeWidth/(usePaths?size:1),context.lineJoin="miter",usePaths?context.stroke(path):context.stroke()),usePaths&&(context.scale(1/size,1/size),context.rotate(-angle),context.translate(-x,-y))};var CRp$8={safeDrawImage:function(context,img,ix,iy,iw,ih,x,y,w,h){if(!(iw<=0||ih<=0||w<=0||h<=0))try{context.drawImage(img,ix,iy,iw,ih,x,y,w,h)}catch(e){warn(e)}},drawInscribedImage:function(context,img,node,index,nodeOpacity){var r=this,pos=node.position(),nodeX=pos.x,nodeY=pos.y,styleObj=node.cy().style(),getIndexedStyle=styleObj.getIndexedStyle.bind(styleObj),fit=getIndexedStyle(node,"background-fit","value",index),repeat=getIndexedStyle(node,"background-repeat","value",index),nodeW=node.width(),nodeH=node.height(),paddingX2=2*node.padding(),nodeTW=nodeW+("inner"===getIndexedStyle(node,"background-width-relative-to","value",index)?0:paddingX2),nodeTH=nodeH+("inner"===getIndexedStyle(node,"background-height-relative-to","value",index)?0:paddingX2),rs=node._private.rscratch,shouldClip="node"===getIndexedStyle(node,"background-clip","value",index),imgOpacity=getIndexedStyle(node,"background-image-opacity","value",index)*nodeOpacity,smooth=getIndexedStyle(node,"background-image-smoothing","value",index),cornerRadius=node.pstyle("corner-radius").value;"auto"!==cornerRadius&&(cornerRadius=node.pstyle("corner-radius").pfValue);var imgW=img.width||img.cachedW,imgH=img.height||img.cachedH;null!=imgW&&null!=imgH||(document.body.appendChild(img),imgW=img.cachedW=img.width||img.offsetWidth,imgH=img.cachedH=img.height||img.offsetHeight,document.body.removeChild(img));var w=imgW,h=imgH;if("auto"!==getIndexedStyle(node,"background-width","value",index)&&(w="%"===getIndexedStyle(node,"background-width","units",index)?getIndexedStyle(node,"background-width","pfValue",index)*nodeTW:getIndexedStyle(node,"background-width","pfValue",index)),"auto"!==getIndexedStyle(node,"background-height","value",index)&&(h="%"===getIndexedStyle(node,"background-height","units",index)?getIndexedStyle(node,"background-height","pfValue",index)*nodeTH:getIndexedStyle(node,"background-height","pfValue",index)),0!==w&&0!==h){if("contain"===fit)w*=scale=Math.min(nodeTW/w,nodeTH/h),h*=scale;else if("cover"===fit){var scale;w*=scale=Math.max(nodeTW/w,nodeTH/h),h*=scale}var x=nodeX-nodeTW/2,posXUnits=getIndexedStyle(node,"background-position-x","units",index),posXPfVal=getIndexedStyle(node,"background-position-x","pfValue",index);x+="%"===posXUnits?(nodeTW-w)*posXPfVal:posXPfVal;var offXUnits=getIndexedStyle(node,"background-offset-x","units",index),offXPfVal=getIndexedStyle(node,"background-offset-x","pfValue",index);x+="%"===offXUnits?(nodeTW-w)*offXPfVal:offXPfVal;var y=nodeY-nodeTH/2,posYUnits=getIndexedStyle(node,"background-position-y","units",index),posYPfVal=getIndexedStyle(node,"background-position-y","pfValue",index);y+="%"===posYUnits?(nodeTH-h)*posYPfVal:posYPfVal;var offYUnits=getIndexedStyle(node,"background-offset-y","units",index),offYPfVal=getIndexedStyle(node,"background-offset-y","pfValue",index);y+="%"===offYUnits?(nodeTH-h)*offYPfVal:offYPfVal,rs.pathCache&&(x-=nodeX,y-=nodeY,nodeX=0,nodeY=0);var gAlpha=context.globalAlpha;context.globalAlpha=imgOpacity;var smoothingEnabled=r.getImgSmoothing(context),isSmoothingSwitched=!1;if("no"===smooth&&smoothingEnabled?(r.setImgSmoothing(context,!1),isSmoothingSwitched=!0):"yes"!==smooth||smoothingEnabled||(r.setImgSmoothing(context,!0),isSmoothingSwitched=!0),"no-repeat"===repeat)shouldClip&&(context.save(),rs.pathCache?context.clip(rs.pathCache):(r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH,cornerRadius,rs),context.clip())),r.safeDrawImage(context,img,0,0,imgW,imgH,x,y,w,h),shouldClip&&context.restore();else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern,r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH,cornerRadius,rs),context.translate(x,y),context.fill(),context.translate(-x,-y)}context.globalAlpha=gAlpha,isSmoothingSwitched&&r.setImgSmoothing(context,smoothingEnabled)}}},CRp$7={};function roundRect(ctx,x,y,width,height){var radius=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,r=Math.min(radius,width/2,height/2);ctx.beginPath(),ctx.moveTo(x+r,y),ctx.lineTo(x+width-r,y),ctx.quadraticCurveTo(x+width,y,x+width,y+r),ctx.lineTo(x+width,y+height-r),ctx.quadraticCurveTo(x+width,y+height,x+width-r,y+height),ctx.lineTo(x+r,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-r),ctx.lineTo(x,y+r),ctx.quadraticCurveTo(x,y,x+r,y),ctx.closePath()}CRp$7.eleTextBiggerThanMin=function(ele,scale){if(!scale){var zoom=ele.cy().zoom(),pxRatio=this.getPixelRatio(),lvl=Math.ceil(log2(zoom*pxRatio));scale=Math.pow(2,lvl)}return!(ele.pstyle("font-size").pfValue*scale<ele.pstyle("min-zoomed-font-size").pfValue)},CRp$7.drawElementText=function(context,ele,shiftToOriginWithBb,force,prefix){var useEleOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this;if(null==force){if(useEleOpacity&&!r.eleTextBiggerThanMin(ele))return}else if(!1===force)return;if(ele.isNode()){var label=ele.pstyle("label");if(!label||!label.value)return;var justification=r.getLabelJustification(ele);context.textAlign=justification,context.textBaseline="bottom"}else{var badLine=ele.element()._private.rscratch.badLine,_label=ele.pstyle("label"),srcLabel=ele.pstyle("source-label"),tgtLabel=ele.pstyle("target-label");if(badLine||(!_label||!_label.value)&&(!srcLabel||!srcLabel.value)&&(!tgtLabel||!tgtLabel.value))return;context.textAlign="center",context.textBaseline="bottom"}var bb,applyRotation=!shiftToOriginWithBb;shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1)),null==prefix?(r.drawText(context,ele,null,applyRotation,useEleOpacity),ele.isEdge()&&(r.drawText(context,ele,"source",applyRotation,useEleOpacity),r.drawText(context,ele,"target",applyRotation,useEleOpacity))):r.drawText(context,ele,prefix,applyRotation,useEleOpacity),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)},CRp$7.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++)if((cache=this.fontCaches[i]).context===context)return cache;return cache={context},this.fontCaches.push(cache),cache},CRp$7.setupTextStyle=function(context,ele){var useEleOpacity=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],labelStyle=ele.pstyle("font-style").strValue,labelSize=ele.pstyle("font-size").pfValue+"px",labelFamily=ele.pstyle("font-family").strValue,labelWeight=ele.pstyle("font-weight").strValue,opacity=useEleOpacity?ele.effectiveOpacity()*ele.pstyle("text-opacity").value:1,outlineOpacity=ele.pstyle("text-outline-opacity").value*opacity,color=ele.pstyle("color").value,outlineColor=ele.pstyle("text-outline-color").value;context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily,context.lineJoin="round",this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.colorStrokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity)},CRp$7.getTextAngle=function(ele,prefix){var theta,rscratch=ele._private.rscratch,pdash=prefix?prefix+"-":"",rotation=ele.pstyle(pdash+"text-rotation");if("autorotate"===rotation.strValue){var textAngle=getPrefixedProperty(rscratch,"labelAngle",prefix);theta=ele.isEdge()?textAngle:0}else theta="none"===rotation.strValue?0:rotation.pfValue;return theta},CRp$7.drawText=function(context,ele,prefix){var applyRotation=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],useEleOpacity=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],rscratch=ele._private.rscratch,parentOpacity=useEleOpacity?ele.effectiveOpacity():1;if(!useEleOpacity||0!==parentOpacity&&0!==ele.pstyle("text-opacity").value){"main"===prefix&&(prefix=null);var orgTextX,orgTextY,textX=getPrefixedProperty(rscratch,"labelX",prefix),textY=getPrefixedProperty(rscratch,"labelY",prefix),text=this.getLabelText(ele,prefix);if(null!=text&&""!==text&&!isNaN(textX)&&!isNaN(textY)){this.setupTextStyle(context,ele,useEleOpacity);var theta,pdash=prefix?prefix+"-":"",textW=getPrefixedProperty(rscratch,"labelWidth",prefix),textH=getPrefixedProperty(rscratch,"labelHeight",prefix),marginX=ele.pstyle(pdash+"text-margin-x").pfValue,marginY=ele.pstyle(pdash+"text-margin-y").pfValue,isEdge=ele.isEdge(),halign=ele.pstyle("text-halign").value,valign=ele.pstyle("text-valign").value;switch(isEdge&&(halign="center",valign="center"),textX+=marginX,textY+=marginY,0!==(theta=applyRotation?this.getTextAngle(ele,prefix):0)&&(orgTextX=textX,orgTextY=textY,context.translate(orgTextX,orgTextY),context.rotate(theta),textX=0,textY=0),valign){case"top":break;case"center":textY+=textH/2;break;case"bottom":textY+=textH}var backgroundOpacity=ele.pstyle("text-background-opacity").value,borderOpacity=ele.pstyle("text-border-opacity").value,textBorderWidth=ele.pstyle("text-border-width").pfValue,backgroundPadding=ele.pstyle("text-background-padding").pfValue,styleShape=ele.pstyle("text-background-shape").strValue,rounded="round-rectangle"===styleShape||"roundrectangle"===styleShape,circled="circle"===styleShape;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var textFill=context.fillStyle,textStroke=context.strokeStyle,textLineWidth=context.lineWidth,textBackgroundColor=ele.pstyle("text-background-color").value,textBorderColor=ele.pstyle("text-border-color").value,textBorderStyle=ele.pstyle("text-border-style").value,doFill=backgroundOpacity>0,doStroke=textBorderWidth>0&&borderOpacity>0,bgX=textX-backgroundPadding;switch(halign){case"left":bgX-=textW;break;case"center":bgX-=textW/2}var bgY=textY-textH-backgroundPadding,bgW=textW+2*backgroundPadding,bgH=textH+2*backgroundPadding;if(doFill&&(context.fillStyle="rgba(".concat(textBackgroundColor[0],",").concat(textBackgroundColor[1],",").concat(textBackgroundColor[2],",").concat(backgroundOpacity*parentOpacity,")")),doStroke&&(context.strokeStyle="rgba(".concat(textBorderColor[0],",").concat(textBorderColor[1],",").concat(textBorderColor[2],",").concat(borderOpacity*parentOpacity,")"),context.lineWidth=textBorderWidth,context.setLineDash))switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4,context.setLineDash([]);break;default:context.setLineDash([])}if(rounded?(context.beginPath(),roundRect(context,bgX,bgY,bgW,bgH,2)):circled?(context.beginPath(),function circle(ctx,x,y,width,height){var radius=Math.min(width,height)/2,centerX=x+width/2,centerY=y+height/2;ctx.beginPath(),ctx.arc(centerX,centerY,radius,0,2*Math.PI),ctx.closePath()}(context,bgX,bgY,bgW,bgH)):(context.beginPath(),context.rect(bgX,bgY,bgW,bgH)),doFill&&context.fill(),doStroke&&context.stroke(),doStroke&&"double"===textBorderStyle){var whiteWidth=textBorderWidth/2;context.beginPath(),rounded?roundRect(context,bgX+whiteWidth,bgY+whiteWidth,bgW-2*whiteWidth,bgH-2*whiteWidth,2):context.rect(bgX+whiteWidth,bgY+whiteWidth,bgW-2*whiteWidth,bgH-2*whiteWidth),context.stroke()}context.fillStyle=textFill,context.strokeStyle=textStroke,context.lineWidth=textLineWidth,context.setLineDash&&context.setLineDash([])}var lineWidth=2*ele.pstyle("text-outline-width").pfValue;if(lineWidth>0&&(context.lineWidth=lineWidth),"wrap"===ele.pstyle("text-wrap").value){var lines=getPrefixedProperty(rscratch,"labelWrapCachedLines",prefix),lineHeight=getPrefixedProperty(rscratch,"labelLineHeight",prefix),halfTextW=textW/2,justification=this.getLabelJustification(ele);switch("auto"===justification||("left"===halign?"left"===justification?textX+=-textW:"center"===justification&&(textX+=-halfTextW):"center"===halign?"left"===justification?textX+=-halfTextW:"right"===justification&&(textX+=halfTextW):"right"===halign&&("center"===justification?textX+=halfTextW:"right"===justification&&(textX+=textW))),valign){case"top":case"center":case"bottom":textY-=(lines.length-1)*lineHeight}for(var l=0;l<lines.length;l++)lineWidth>0&&context.strokeText(lines[l],textX,textY),context.fillText(lines[l],textX,textY),textY+=lineHeight}else lineWidth>0&&context.strokeText(text,textX,textY),context.fillText(text,textX,textY);0!==theta&&(context.rotate(-theta),context.translate(-orgTextX,-orgTextY))}}};var CRp$6={drawNode:function(context,node,shiftToOriginWithBb){var nodeWidth,nodeHeight,drawLabel=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],shouldDrawOverlay=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],shouldDrawOpacity=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=this,_p=node._private,rs=_p.rscratch,pos=node.position();if(number$1(pos.x)&&number$1(pos.y)&&(!shouldDrawOpacity||node.visible())){var path,bb,eleOpacity=shouldDrawOpacity?node.effectiveOpacity():1,usePaths=r.usePaths(),pathCacheHit=!1,padding=node.padding();nodeWidth=node.width()+2*padding,nodeHeight=node.height()+2*padding,shiftToOriginWithBb&&(bb=shiftToOriginWithBb,context.translate(-bb.x1,-bb.y1));for(var urls=node.pstyle("background-image").value,urlDefined=new Array(urls.length),image=new Array(urls.length),numImages=0,i=0;i<urls.length;i++){var url=urls[i];if(urlDefined[i]=null!=url&&"none"!==url){var bgImgCrossOrigin=node.cy().style().getIndexedStyle(node,"background-image-crossorigin","value",i);numImages++,image[i]=r.getCachedImage(url,bgImgCrossOrigin,function(){_p.backgroundTimestamp=Date.now(),node.emitAndNotify("background")})}}var darkness=node.pstyle("background-blacken").value,borderWidth=node.pstyle("border-width").pfValue,bgOpacity=node.pstyle("background-opacity").value*eleOpacity,borderColor=node.pstyle("border-color").value,borderStyle=node.pstyle("border-style").value,borderJoin=node.pstyle("border-join").value,borderCap=node.pstyle("border-cap").value,borderPosition=node.pstyle("border-position").value,borderPattern=node.pstyle("border-dash-pattern").pfValue,borderOffset=node.pstyle("border-dash-offset").pfValue,borderOpacity=node.pstyle("border-opacity").value*eleOpacity,outlineWidth=node.pstyle("outline-width").pfValue,outlineColor=node.pstyle("outline-color").value,outlineStyle=node.pstyle("outline-style").value,outlineOpacity=node.pstyle("outline-opacity").value*eleOpacity,outlineOffset=node.pstyle("outline-offset").value,cornerRadius=node.pstyle("corner-radius").value;"auto"!==cornerRadius&&(cornerRadius=node.pstyle("corner-radius").pfValue);var setupShapeColor=function setupShapeColor(){var bgOpy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bgOpacity;r.eleFillStyle(context,node,bgOpy)},setupBorderColor=function setupBorderColor(){var bdrOpy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:borderOpacity;r.colorStrokeStyle(context,borderColor[0],borderColor[1],borderColor[2],bdrOpy)},setupOutlineColor=function setupOutlineColor(){var otlnOpy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:outlineOpacity;r.colorStrokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],otlnOpy)},getPath=function getPath(width,height,shape,points){var path,pathCache=r.nodePathCache=r.nodePathCache||[],key=hashStrings("polygon"===shape?shape+","+points.join(","):shape,""+height,""+width,""+cornerRadius),cachedPath=pathCache[key],cacheHit=!1;return null!=cachedPath?(path=cachedPath,cacheHit=!0,rs.pathCache=path):(path=new Path2D,pathCache[key]=rs.pathCache=path),{path,cacheHit}},styleShape=node.pstyle("shape").strValue,shapePts=node.pstyle("shape-polygon-points").pfValue;if(usePaths){context.translate(pos.x,pos.y);var shapePath=getPath(nodeWidth,nodeHeight,styleShape,shapePts);path=shapePath.path,pathCacheHit=shapePath.cacheHit}var drawShape=function drawShape(){if(!pathCacheHit){var npos=pos;usePaths&&(npos={x:0,y:0}),r.nodeShapes[r.getNodeShape(node)].draw(path||context,npos.x,npos.y,nodeWidth,nodeHeight,cornerRadius,rs)}usePaths?context.fill(path):context.fill()},drawImages=function drawImages(){for(var nodeOpacity=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eleOpacity,inside=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],prevBging=_p.backgrounding,totalCompleted=0,_i=0;_i<image.length;_i++){var bgContainment=node.cy().style().getIndexedStyle(node,"background-image-containment","value",_i);inside&&"over"===bgContainment||!inside&&"inside"===bgContainment?totalCompleted++:urlDefined[_i]&&image[_i].complete&&!image[_i].error&&(totalCompleted++,r.drawInscribedImage(context,image[_i],node,_i,nodeOpacity))}_p.backgrounding=!(totalCompleted===numImages),prevBging!==_p.backgrounding&&node.updateStyle(!1)},drawPie=function drawPie(){var redrawShape=arguments.length>0&&void 0!==arguments[0]&&arguments[0],pieOpacity=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eleOpacity;r.hasPie(node)&&(r.drawPie(context,node,pieOpacity),redrawShape&&(usePaths||r.nodeShapes[r.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight,cornerRadius,rs)))},drawStripe=function drawStripe(){var redrawShape=arguments.length>0&&void 0!==arguments[0]&&arguments[0],stripeOpacity=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eleOpacity;r.hasStripe(node)&&(context.save(),usePaths?context.clip(rs.pathCache):(r.nodeShapes[r.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight,cornerRadius,rs),context.clip()),r.drawStripe(context,node,stripeOpacity),context.restore(),redrawShape&&(usePaths||r.nodeShapes[r.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight,cornerRadius,rs)))},darken=function darken(){var opacity=(darkness>0?darkness:-darkness)*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:eleOpacity),c=darkness>0?0:255;0!==darkness&&(r.colorFillStyle(context,c,c,c,opacity),usePaths?context.fill(path):context.fill())},drawBorder=function drawBorder(){if(borderWidth>0){if(context.lineWidth=borderWidth,context.lineCap=borderCap,context.lineJoin=borderJoin,context.setLineDash)switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash(borderPattern),context.lineDashOffset=borderOffset;break;case"solid":case"double":context.setLineDash([])}if("center"!==borderPosition){if(context.save(),context.lineWidth*=2,"inside"===borderPosition)usePaths?context.clip(path):context.clip();else{var region=new Path2D;region.rect(-nodeWidth/2-borderWidth,-nodeHeight/2-borderWidth,nodeWidth+2*borderWidth,nodeHeight+2*borderWidth),region.addPath(path),context.clip(region,"evenodd")}usePaths?context.stroke(path):context.stroke(),context.restore()}else usePaths?context.stroke(path):context.stroke();if("double"===borderStyle){context.lineWidth=borderWidth/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",usePaths?context.stroke(path):context.stroke(),context.globalCompositeOperation=gco}context.setLineDash&&context.setLineDash([])}},drawOutline=function drawOutline(){if(outlineWidth>0){if(context.lineWidth=outlineWidth,context.lineCap="butt",context.setLineDash)switch(outlineStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([])}var npos=pos;usePaths&&(npos={x:0,y:0});var shape=r.getNodeShape(node),bWidth=borderWidth;"inside"===borderPosition&&(bWidth=0),"outside"===borderPosition&&(bWidth*=2);var _path,scaleX=(nodeWidth+bWidth+(outlineWidth+outlineOffset))/nodeWidth,scaleY=(nodeHeight+bWidth+(outlineWidth+outlineOffset))/nodeHeight,sWidth=nodeWidth*scaleX,sHeight=nodeHeight*scaleY,points=r.nodeShapes[shape].points;if(usePaths)_path=getPath(sWidth,sHeight,shape,points).path;if("ellipse"===shape)r.drawEllipsePath(_path||context,npos.x,npos.y,sWidth,sHeight);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(shape)){var sMult=0,offsetX=0,offsetY=0;"round-diamond"===shape?sMult=1.4*(bWidth+outlineOffset+outlineWidth):"round-heptagon"===shape?(sMult=1.075*(bWidth+outlineOffset+outlineWidth),offsetY=-(bWidth/2+outlineOffset+outlineWidth)/35):"round-hexagon"===shape?sMult=1.12*(bWidth+outlineOffset+outlineWidth):"round-pentagon"===shape?(sMult=1.13*(bWidth+outlineOffset+outlineWidth),offsetY=-(bWidth/2+outlineOffset+outlineWidth)/15):"round-tag"===shape?(sMult=1.12*(bWidth+outlineOffset+outlineWidth),offsetX=.07*(bWidth/2+outlineWidth+outlineOffset)):"round-triangle"===shape&&(sMult=(bWidth+outlineOffset+outlineWidth)*(Math.PI/2),offsetY=-(bWidth+outlineOffset/2+outlineWidth)/Math.PI),0!==sMult&&(sWidth=nodeWidth*(scaleX=(nodeWidth+sMult)/nodeWidth),["round-hexagon","round-tag"].includes(shape)||(sHeight=nodeHeight*(scaleY=(nodeHeight+sMult)/nodeHeight)));for(var halfW=sWidth/2,halfH=sHeight/2,radius=(cornerRadius="auto"===cornerRadius?getRoundPolygonRadius(sWidth,sHeight):cornerRadius)+(bWidth+outlineWidth+outlineOffset)/2,p=new Array(points.length/2),corners=new Array(points.length/2),_i2=0;_i2<points.length/2;_i2++)p[_i2]={x:npos.x+offsetX+halfW*points[2*_i2],y:npos.y+offsetY+halfH*points[2*_i2+1]};var _i3,p1,p2,p3,len=p.length;for(p1=p[len-1],_i3=0;_i3<len;_i3++)p2=p[_i3%len],p3=p[(_i3+1)%len],corners[_i3]=getRoundCorner(p1,p2,p3,radius),p1=p2,p2=p3;r.drawRoundPolygonPath(_path||context,npos.x+offsetX,npos.y+offsetY,nodeWidth*scaleX,nodeHeight*scaleY,points,corners)}else if(["roundrectangle","round-rectangle"].includes(shape))cornerRadius="auto"===cornerRadius?getRoundRectangleRadius(sWidth,sHeight):cornerRadius,r.drawRoundRectanglePath(_path||context,npos.x,npos.y,sWidth,sHeight,cornerRadius+(bWidth+outlineWidth+outlineOffset)/2);else if(["cutrectangle","cut-rectangle"].includes(shape))cornerRadius="auto"===cornerRadius?8:cornerRadius,r.drawCutRectanglePath(_path||context,npos.x,npos.y,sWidth,sHeight,null,cornerRadius+(bWidth+outlineWidth+outlineOffset)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(shape))cornerRadius="auto"===cornerRadius?getRoundRectangleRadius(sWidth,sHeight):cornerRadius,r.drawBottomRoundRectanglePath(_path||context,npos.x,npos.y,sWidth,sHeight,cornerRadius+(bWidth+outlineWidth+outlineOffset)/2);else if("barrel"===shape)r.drawBarrelPath(_path||context,npos.x,npos.y,sWidth,sHeight);else if(shape.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(shape)){points=joinLines(expandPolygon(points,(bWidth+outlineWidth+outlineOffset)/nodeWidth)),r.drawPolygonPath(_path||context,npos.x,npos.y,nodeWidth,nodeHeight,points)}else{points=joinLines(expandPolygon(points,-((bWidth+outlineWidth+outlineOffset)/nodeWidth))),r.drawPolygonPath(_path||context,npos.x,npos.y,nodeWidth,nodeHeight,points)}if(usePaths?context.stroke(_path):context.stroke(),"double"===outlineStyle){context.lineWidth=bWidth/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",usePaths?context.stroke(_path):context.stroke(),context.globalCompositeOperation=gco}context.setLineDash&&context.setLineDash([])}};if("yes"===node.pstyle("ghost").value){var gx=node.pstyle("ghost-offset-x").pfValue,gy=node.pstyle("ghost-offset-y").pfValue,ghostOpacity=node.pstyle("ghost-opacity").value,effGhostOpacity=ghostOpacity*eleOpacity;context.translate(gx,gy),setupOutlineColor(),drawOutline(),setupShapeColor(ghostOpacity*bgOpacity),drawShape(),drawImages(effGhostOpacity,!0),setupBorderColor(ghostOpacity*borderOpacity),drawBorder(),drawPie(0!==darkness||0!==borderWidth),drawStripe(0!==darkness||0!==borderWidth),drawImages(effGhostOpacity,!1),darken(effGhostOpacity),context.translate(-gx,-gy)}usePaths&&context.translate(-pos.x,-pos.y),function drawUnderlay(){shouldDrawOverlay&&r.drawNodeUnderlay(context,node,pos,nodeWidth,nodeHeight)}(),usePaths&&context.translate(pos.x,pos.y),setupOutlineColor(),drawOutline(),setupShapeColor(),drawShape(),drawImages(eleOpacity,!0),setupBorderColor(),drawBorder(),drawPie(0!==darkness||0!==borderWidth),drawStripe(0!==darkness||0!==borderWidth),drawImages(eleOpacity,!1),darken(),usePaths&&context.translate(-pos.x,-pos.y),function drawText(){r.drawElementText(context,node,null,drawLabel)}(),function drawOverlay(){shouldDrawOverlay&&r.drawNodeOverlay(context,node,pos,nodeWidth,nodeHeight)}(),shiftToOriginWithBb&&context.translate(bb.x1,bb.y1)}}},drawNodeOverlayUnderlay=function drawNodeOverlayUnderlay(overlayOrUnderlay){if(!["overlay","underlay"].includes(overlayOrUnderlay))throw new Error("Invalid state");return function(context,node,pos,nodeWidth,nodeHeight){if(node.visible()){var padding=node.pstyle("".concat(overlayOrUnderlay,"-padding")).pfValue,opacity=node.pstyle("".concat(overlayOrUnderlay,"-opacity")).value,color=node.pstyle("".concat(overlayOrUnderlay,"-color")).value,shape=node.pstyle("".concat(overlayOrUnderlay,"-shape")).value,radius=node.pstyle("".concat(overlayOrUnderlay,"-corner-radius")).value;if(opacity>0){if(pos=pos||node.position(),null==nodeWidth||null==nodeHeight){var _padding=node.padding();nodeWidth=node.width()+2*_padding,nodeHeight=node.height()+2*_padding}this.colorFillStyle(context,color[0],color[1],color[2],opacity),this.nodeShapes[shape].draw(context,pos.x,pos.y,nodeWidth+2*padding,nodeHeight+2*padding,radius),context.fill()}}}};CRp$6.drawNodeOverlay=drawNodeOverlayUnderlay("overlay"),CRp$6.drawNodeUnderlay=drawNodeOverlayUnderlay("underlay"),CRp$6.hasPie=function(node){return(node=node[0])._private.hasPie},CRp$6.hasStripe=function(node){return(node=node[0])._private.hasStripe},CRp$6.drawPie=function(context,node,nodeOpacity,pos){node=node[0],pos=pos||node.position();var holeRadius,cyStyle=node.cy().style(),pieSize=node.pstyle("pie-size"),hole=node.pstyle("pie-hole"),overallStartAngle=node.pstyle("pie-start-angle").pfValue,x=pos.x,y=pos.y,nodeW=node.width(),nodeH=node.height(),radius=Math.min(nodeW,nodeH)/2,lastPercent=0;if(this.usePaths()&&(x=0,y=0),"%"===pieSize.units?radius*=pieSize.pfValue:void 0!==pieSize.pfValue&&(radius=pieSize.pfValue/2),"%"===hole.units?holeRadius=radius*hole.pfValue:void 0!==hole.pfValue&&(holeRadius=hole.pfValue/2),!(holeRadius>=radius))for(var i=1;i<=cyStyle.pieBackgroundN;i++){var size=node.pstyle("pie-"+i+"-background-size").value,color=node.pstyle("pie-"+i+"-background-color").value,opacity=node.pstyle("pie-"+i+"-background-opacity").value*nodeOpacity,percent=size/100;percent+lastPercent>1&&(percent=1-lastPercent);var angleStart=1.5*Math.PI+2*Math.PI*lastPercent,angleEnd=(angleStart+=overallStartAngle)+2*Math.PI*percent;0===size||lastPercent>=1||lastPercent+percent>1||(0===holeRadius?(context.beginPath(),context.moveTo(x,y),context.arc(x,y,radius,angleStart,angleEnd),context.closePath()):(context.beginPath(),context.arc(x,y,radius,angleStart,angleEnd),context.arc(x,y,holeRadius,angleEnd,angleStart,!0),context.closePath()),this.colorFillStyle(context,color[0],color[1],color[2],opacity),context.fill(),lastPercent+=percent)}},CRp$6.drawStripe=function(context,node,nodeOpacity,pos){node=node[0],pos=pos||node.position();var cyStyle=node.cy().style(),x=pos.x,y=pos.y,nodeW=node.width(),nodeH=node.height(),lastPercent=0,usePaths=this.usePaths();context.save();var direction=node.pstyle("stripe-direction").value,stripeSize=node.pstyle("stripe-size");switch(direction){case"vertical":break;case"righward":context.rotate(-Math.PI/2)}var stripeW=nodeW,stripeH=nodeH;"%"===stripeSize.units?(stripeW*=stripeSize.pfValue,stripeH*=stripeSize.pfValue):void 0!==stripeSize.pfValue&&(stripeW=stripeSize.pfValue,stripeH=stripeSize.pfValue),usePaths&&(x=0,y=0),y-=stripeW/2,x-=stripeH/2;for(var i=1;i<=cyStyle.stripeBackgroundN;i++){var size=node.pstyle("stripe-"+i+"-background-size").value,color=node.pstyle("stripe-"+i+"-background-color").value,opacity=node.pstyle("stripe-"+i+"-background-opacity").value*nodeOpacity,percent=size/100;percent+lastPercent>1&&(percent=1-lastPercent),0===size||lastPercent>=1||lastPercent+percent>1||(context.beginPath(),context.rect(x,y+stripeH*lastPercent,stripeW,stripeH*percent),context.closePath(),this.colorFillStyle(context,color[0],color[1],color[2],opacity),context.fill(),lastPercent+=percent)}context.restore()};var fpsHeight,CRp$5={};function compileShader(gl,type,source){var shader=gl.createShader(type);if(gl.shaderSource(shader,source),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(shader));return shader}function createTextureCanvas(r,width,height){void 0===height&&(height=width);var canvas=r.makeOffscreenCanvas(width,height),ctx=canvas.context=canvas.getContext("2d");return canvas.clear=function(){return ctx.clearRect(0,0,canvas.width,canvas.height)},canvas.clear(),canvas}function getEffectivePanZoom(r){var pixelRatio=r.pixelRatio,zoom=r.cy.zoom(),pan=r.cy.pan();return{zoom:zoom*pixelRatio,pan:{x:pan.x*pixelRatio,y:pan.y*pixelRatio}}}function isSimpleShape(node){return"solid"===node.pstyle("background-fill").value&&("none"===node.pstyle("background-image").strValue&&(0===node.pstyle("border-width").value||(0===node.pstyle("border-opacity").value||"solid"===node.pstyle("border-style").value)))}function arrayEqual(a1,a2){if(a1.length!==a2.length)return!1;for(var i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}function toWebGLColor(color,opacity,outArray){var r=color[0]/255,g=color[1]/255,b=color[2]/255,a=opacity,arr=outArray||new Array(4);return arr[0]=r*a,arr[1]=g*a,arr[2]=b*a,arr[3]=a,arr}function indexToVec4(index,outArray){var arr=outArray||new Array(4);return arr[0]=(255&index)/255,arr[1]=(index>>8&255)/255,arr[2]=(index>>16&255)/255,arr[3]=(index>>24&255)/255,arr}function vec4ToIndex(vec4){return vec4[0]+(vec4[1]<<8)+(vec4[2]<<16)+(vec4[3]<<24)}function getTypeInfo(gl,glslType){switch(glslType){case"float":return[1,gl.FLOAT,4];case"vec2":return[2,gl.FLOAT,4];case"vec3":return[3,gl.FLOAT,4];case"vec4":return[4,gl.FLOAT,4];case"int":return[1,gl.INT,4];case"ivec2":return[2,gl.INT,4]}}function createTypedArray(gl,glType,dataOrSize){switch(glType){case gl.FLOAT:return new Float32Array(dataOrSize);case gl.INT:return new Int32Array(dataOrSize)}}function createTypedArrayView(gl,glType,array,stride,size,i){switch(glType){case gl.FLOAT:return new Float32Array(array.buffer,i*stride,size);case gl.INT:return new Int32Array(array.buffer,i*stride,size)}}function createBufferDynamicDraw(gl,instances,type,attributeLoc){var _getTypeInfo4=_slicedToArray(getTypeInfo(gl,type),3),size=_getTypeInfo4[0],glType=_getTypeInfo4[1],bytes=_getTypeInfo4[2],dataArray=createTypedArray(gl,glType,instances*size),stride=size*bytes,buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,instances*stride,gl.DYNAMIC_DRAW),gl.enableVertexAttribArray(attributeLoc),glType===gl.FLOAT?gl.vertexAttribPointer(attributeLoc,size,glType,!1,stride,0):glType===gl.INT&&gl.vertexAttribIPointer(attributeLoc,size,glType,stride,0),gl.vertexAttribDivisor(attributeLoc,1),gl.bindBuffer(gl.ARRAY_BUFFER,null);for(var views=new Array(instances),i=0;i<instances;i++)views[i]=createTypedArrayView(gl,glType,dataArray,stride,size,i);return buffer.dataArray=dataArray,buffer.stride=stride,buffer.size=size,buffer.getView=function(i){return views[i]},buffer.setPoint=function(i,x,y){var view=views[i];view[0]=x,view[1]=y},buffer.bufferSubData=function(count){gl.bindBuffer(gl.ARRAY_BUFFER,buffer),count?gl.bufferSubData(gl.ARRAY_BUFFER,0,dataArray,0,count*size):gl.bufferSubData(gl.ARRAY_BUFFER,0,dataArray)},buffer}CRp$5.getPixelRatio=function(){var context=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var containerWindow=this.cy.window(),backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(containerWindow.devicePixelRatio||1)/backingStore},CRp$5.paintCache=function(context){for(var cache,caches=this.paintCaches=this.paintCaches||[],needToCreateCache=!0,i=0;i<caches.length;i++)if((cache=caches[i]).context===context){needToCreateCache=!1;break}return needToCreateCache&&(cache={context},caches.push(cache)),cache},CRp$5.createGradientStyleFor=function(context,shapeStyleName,ele,fill,opacity){var gradientStyle,usePaths=this.usePaths(),colors=ele.pstyle(shapeStyleName+"-gradient-stop-colors").value,positions=ele.pstyle(shapeStyleName+"-gradient-stop-positions").pfValue;if("radial-gradient"===fill)if(ele.isEdge()){var start=ele.sourceEndpoint(),end=ele.targetEndpoint(),mid=ele.midpoint(),d1=dist(start,mid),d2=dist(end,mid);gradientStyle=context.createRadialGradient(mid.x,mid.y,0,mid.x,mid.y,Math.max(d1,d2))}else{var pos=usePaths?{x:0,y:0}:ele.position(),width=ele.paddedWidth(),height=ele.paddedHeight();gradientStyle=context.createRadialGradient(pos.x,pos.y,0,pos.x,pos.y,Math.max(width,height))}else if(ele.isEdge()){var _start=ele.sourceEndpoint(),_end=ele.targetEndpoint();gradientStyle=context.createLinearGradient(_start.x,_start.y,_end.x,_end.y)}else{var _pos=usePaths?{x:0,y:0}:ele.position(),halfWidth=ele.paddedWidth()/2,halfHeight=ele.paddedHeight()/2;switch(ele.pstyle("background-gradient-direction").value){case"to-bottom":gradientStyle=context.createLinearGradient(_pos.x,_pos.y-halfHeight,_pos.x,_pos.y+halfHeight);break;case"to-top":gradientStyle=context.createLinearGradient(_pos.x,_pos.y+halfHeight,_pos.x,_pos.y-halfHeight);break;case"to-left":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y,_pos.x-halfWidth,_pos.y);break;case"to-right":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y,_pos.x+halfWidth,_pos.y);break;case"to-bottom-right":case"to-right-bottom":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y-halfHeight,_pos.x+halfWidth,_pos.y+halfHeight);break;case"to-top-right":case"to-right-top":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y+halfHeight,_pos.x+halfWidth,_pos.y-halfHeight);break;case"to-bottom-left":case"to-left-bottom":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y-halfHeight,_pos.x-halfWidth,_pos.y+halfHeight);break;case"to-top-left":case"to-left-top":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y+halfHeight,_pos.x-halfWidth,_pos.y-halfHeight)}}if(!gradientStyle)return null;for(var hasPositions=positions.length===colors.length,length=colors.length,i=0;i<length;i++)gradientStyle.addColorStop(hasPositions?positions[i]:i/(length-1),"rgba("+colors[i][0]+","+colors[i][1]+","+colors[i][2]+","+opacity+")");return gradientStyle},CRp$5.gradientFillStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"background",ele,fill,opacity);if(!gradientStyle)return null;context.fillStyle=gradientStyle},CRp$5.colorFillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"},CRp$5.eleFillStyle=function(context,ele,opacity){var backgroundFill=ele.pstyle("background-fill").value;if("linear-gradient"===backgroundFill||"radial-gradient"===backgroundFill)this.gradientFillStyle(context,ele,backgroundFill,opacity);else{var backgroundColor=ele.pstyle("background-color").value;this.colorFillStyle(context,backgroundColor[0],backgroundColor[1],backgroundColor[2],opacity)}},CRp$5.gradientStrokeStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"line",ele,fill,opacity);if(!gradientStyle)return null;context.strokeStyle=gradientStyle},CRp$5.colorStrokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"},CRp$5.eleStrokeStyle=function(context,ele,opacity){var lineFill=ele.pstyle("line-fill").value;if("linear-gradient"===lineFill||"radial-gradient"===lineFill)this.gradientStrokeStyle(context,ele,lineFill,opacity);else{var lineColor=ele.pstyle("line-color").value;this.colorStrokeStyle(context,lineColor[0],lineColor[1],lineColor[2],opacity)}},CRp$5.matchCanvasSize=function(container){var r=this,data=r.data,bb=r.findContainerClientCoords(),width=bb[2],height=bb[3],pixelRatio=r.getPixelRatio(),mbPxRatio=r.motionBlurPxRatio;container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE]&&container!==r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG]||(pixelRatio=mbPxRatio);var canvas,canvasWidth=width*pixelRatio,canvasHeight=height*pixelRatio;if(canvasWidth!==r.canvasWidth||canvasHeight!==r.canvasHeight){r.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px",canvasContainer.style.height=height+"px";for(var i=0;i<r.CANVAS_LAYERS;i++)(canvas=data.canvases[i]).width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";for(i=0;i<r.BUFFER_COUNT;i++)(canvas=data.bufferCanvases[i]).width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px";r.textureMult=1,pixelRatio<=1&&(canvas=data.bufferCanvases[r.TEXTURE_BUFFER],r.textureMult=2,canvas.width=canvasWidth*r.textureMult,canvas.height=canvasHeight*r.textureMult),r.canvasWidth=canvasWidth,r.canvasHeight=canvasHeight,r.pixelRatio=pixelRatio}},CRp$5.renderTo=function(cxt,zoom,pan,pxRatio){this.render({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:!0,forcedPxRatio:pxRatio})},CRp$5.clearCanvas=function(){var r=this,data=r.data;function clear(context){context.clearRect(0,0,r.canvasWidth,r.canvasHeight)}clear(data.contexts[r.NODE]),clear(data.contexts[r.DRAG])},CRp$5.render=function(options){var r=this;options=options||staticEmptyObject();var cy=r.cy,forcedContext=options.forcedContext,drawAllLayers=options.drawAllLayers,drawOnlyNodeLayer=options.drawOnlyNodeLayer,forcedZoom=options.forcedZoom,forcedPan=options.forcedPan,pixelRatio=void 0===options.forcedPxRatio?this.getPixelRatio():options.forcedPxRatio,data=r.data,needDraw=data.canvasNeedsRedraw,textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming),motionBlur=void 0!==options.motionBlur?options.motionBlur:r.motionBlur,mbPxRatio=r.motionBlurPxRatio,hasCompoundNodes=cy.hasCompoundNodes(),inNodeDragGesture=r.hoverData.draggingEles,inBoxSelection=!(!r.hoverData.selecting&&!r.touchData.selecting),motionBlurFadeEffect=motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;forcedContext||(r.prevPxRatio!==pixelRatio&&(r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.container),r.redrawHint("eles",!0),r.redrawHint("drag",!0)),r.prevPxRatio=pixelRatio),!forcedContext&&r.motionBlurTimeout&&clearTimeout(r.motionBlurTimeout),motionBlur&&(null==r.mbFrames&&(r.mbFrames=0),r.mbFrames++,r.mbFrames<3&&(motionBlurFadeEffect=!1),r.mbFrames>r.minMbLowQualFrames&&(r.motionBlurPxRatio=r.mbPxRBlurry)),r.clearingMotionBlur&&(r.motionBlurPxRatio=1),r.textureDrawLastFrame&&!textureDraw&&(needDraw[r.NODE]=!0,needDraw[r.SELECT_BOX]=!0);var style=cy.style(),zoom=cy.zoom(),effectiveZoom=void 0!==forcedZoom?forcedZoom:zoom,pan=cy.pan(),effectivePan={x:pan.x,y:pan.y},vp={zoom,pan:{x:pan.x,y:pan.y}},prevVp=r.prevViewport;void 0===prevVp||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y||inNodeDragGesture&&!hasCompoundNodes||(r.motionBlurPxRatio=1),forcedPan&&(effectivePan=forcedPan),effectiveZoom*=pixelRatio,effectivePan.x*=pixelRatio,effectivePan.y*=pixelRatio;var eles=r.getCachedZSortedEles();function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",r.colorFillStyle(context,255,255,255,r.motionBlurTransparency),context.fillRect(x,y,w,h),context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;r.clearingMotionBlur||context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]&&context!==data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]?(ePan=effectivePan,eZoom=effectiveZoom,w=r.canvasWidth,h=r.canvasHeight):(ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio},eZoom=zoom*mbPxRatio,w=r.canvasWidth*mbPxRatio,h=r.canvasHeight*mbPxRatio),context.setTransform(1,0,0,1,0,0),"motionBlur"===clear?mbclear(context,0,0,w,h):forcedContext||void 0!==clear&&!clear||context.clearRect(0,0,w,h),drawAllLayers||(context.translate(ePan.x,ePan.y),context.scale(eZoom,eZoom)),forcedPan&&context.translate(forcedPan.x,forcedPan.y),forcedZoom&&context.scale(forcedZoom,forcedZoom)}if(textureDraw||(r.textureDrawLastFrame=!1),textureDraw){if(r.textureDrawLastFrame=!0,!r.textureCache){r.textureCache={},r.textureCache.bb=cy.mutableElements().boundingBox(),r.textureCache.texture=r.data.bufferCanvases[r.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[r.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0),cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult),r.render({forcedContext:cxt,drawOnlyNodeLayer:!0,forcedPxRatio:pixelRatio*r.textureMult}),(vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight}).mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[r.DRAG]=!1,needDraw[r.NODE]=!1;var context=data.contexts[r.NODE],texture=r.textureCache.texture;vp=r.textureCache.viewport;context.setTransform(1,0,0,1,0,0),motionBlur?mbclear(context,0,0,vp.width,vp.height):context.clearRect(0,0,vp.width,vp.height);var outsideBgColor=style.core("outside-texture-bg-color").value,outsideBgOpacity=style.core("outside-texture-bg-opacity").value;r.colorFillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity),context.fillRect(0,0,vp.width,vp.height);zoom=cy.zoom();setContextTransform(context,!1),context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio),context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else r.textureOnViewport&&!forcedContext&&(r.textureCache=null);var extent=cy.extent(),vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles||r.cy.animated(),hideEdges=r.hideEdgesOnViewport&&vpManip,needMbClear=[];if(needMbClear[r.NODE]=!needDraw[r.NODE]&&motionBlur&&!r.clearedForMotionBlur[r.NODE]||r.clearingMotionBlur,needMbClear[r.NODE]&&(r.clearedForMotionBlur[r.NODE]=!0),needMbClear[r.DRAG]=!needDraw[r.DRAG]&&motionBlur&&!r.clearedForMotionBlur[r.DRAG]||r.clearingMotionBlur,needMbClear[r.DRAG]&&(r.clearedForMotionBlur[r.DRAG]=!0),needDraw[r.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[r.NODE]){var useBuffer=motionBlur&&!needMbClear[r.NODE]&&1!==mbPxRatio;setContextTransform(context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]:data.contexts[r.NODE]),motionBlur&&!useBuffer?"motionBlur":void 0),hideEdges?r.drawCachedNodes(context,eles.nondrag,pixelRatio,extent):r.drawLayeredElements(context,eles.nondrag,pixelRatio,extent),r.debug&&r.drawDebugPoints(context,eles.nondrag),drawAllLayers||motionBlur||(needDraw[r.NODE]=!1)}if(!drawOnlyNodeLayer&&(needDraw[r.DRAG]||drawAllLayers||needMbClear[r.DRAG])){useBuffer=motionBlur&&!needMbClear[r.DRAG]&&1!==mbPxRatio;setContextTransform(context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]:data.contexts[r.DRAG]),motionBlur&&!useBuffer?"motionBlur":void 0),hideEdges?r.drawCachedNodes(context,eles.drag,pixelRatio,extent):r.drawCachedElements(context,eles.drag,pixelRatio,extent),r.debug&&r.drawDebugPoints(context,eles.drag),drawAllLayers||motionBlur||(needDraw[r.DRAG]=!1)}if(this.drawSelectionRectangle(options,setContextTransform),motionBlur&&1!==mbPxRatio){var cxtNode=data.contexts[r.NODE],txtNode=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE],cxtDrag=data.contexts[r.DRAG],txtDrag=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG],drawMotionBlur=function drawMotionBlur(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0),needClear||!motionBlurFadeEffect?cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight):mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight);var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};(needDraw[r.NODE]||needMbClear[r.NODE])&&(drawMotionBlur(cxtNode,txtNode,needMbClear[r.NODE]),needDraw[r.NODE]=!1),(needDraw[r.DRAG]||needMbClear[r.DRAG])&&(drawMotionBlur(cxtDrag,txtDrag,needMbClear[r.DRAG]),needDraw[r.DRAG]=!1)}r.prevViewport=vp,r.clearingMotionBlur&&(r.clearingMotionBlur=!1,r.motionBlurCleared=!0,r.motionBlur=!0),motionBlur&&(r.motionBlurTimeout=setTimeout(function(){r.motionBlurTimeout=null,r.clearedForMotionBlur[r.NODE]=!1,r.clearedForMotionBlur[r.DRAG]=!1,r.motionBlur=!1,r.clearingMotionBlur=!textureDraw,r.mbFrames=0,needDraw[r.NODE]=!0,needDraw[r.DRAG]=!0,r.redraw()},100)),forcedContext||cy.emit("render")},CRp$5.drawSelectionRectangle=function(options,setContextTransform){var r=this,cy=r.cy,data=r.data,style=cy.style(),drawOnlyNodeLayer=options.drawOnlyNodeLayer,drawAllLayers=options.drawAllLayers,needDraw=data.canvasNeedsRedraw,forcedContext=options.forcedContext;if(r.showFps||!drawOnlyNodeLayer&&needDraw[r.SELECT_BOX]&&!drawAllLayers){var context=forcedContext||data.contexts[r.SELECT_BOX];if(setContextTransform(context),1==r.selection[4]&&(r.hoverData.selecting||r.touchData.selecting)){var zoom=r.cy.zoom(),borderWidth=style.core("selection-box-border-width").value/zoom;context.lineWidth=borderWidth,context.fillStyle="rgba("+style.core("selection-box-color").value[0]+","+style.core("selection-box-color").value[1]+","+style.core("selection-box-color").value[2]+","+style.core("selection-box-opacity").value+")",context.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]),borderWidth>0&&(context.strokeStyle="rgba("+style.core("selection-box-border-color").value[0]+","+style.core("selection-box-border-color").value[1]+","+style.core("selection-box-border-color").value[2]+","+style.core("selection-box-opacity").value+")",context.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]))}if(data.bgActivePosistion&&!r.hoverData.selecting){zoom=r.cy.zoom();var pos=data.bgActivePosistion;context.fillStyle="rgba("+style.core("active-bg-color").value[0]+","+style.core("active-bg-color").value[1]+","+style.core("active-bg-color").value[2]+","+style.core("active-bg-opacity").value+")",context.beginPath(),context.arc(pos.x,pos.y,style.core("active-bg-size").pfValue/zoom,0,2*Math.PI),context.fill()}var timeToRender=r.lastRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender),text="1 frame = "+timeToRender+" ms = "+fps+" fps";if(context.setTransform(1,0,0,1,0,0),context.fillStyle="rgba(255, 0, 0, 0.75)",context.strokeStyle="rgba(255, 0, 0, 0.75)",context.font="30px Arial",!fpsHeight){var dims=context.measureText(text);fpsHeight=dims.actualBoundingBoxAscent}context.fillText(text,0,fpsHeight);context.strokeRect(0,fpsHeight+10,250,20),context.fillRect(0,fpsHeight+10,250*Math.min(fps/60,1),20)}drawAllLayers||(needDraw[r.SELECT_BOX]=!1)}};var ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;function create(){var out=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[5]=0,out[6]=0,out[7]=0),out[0]=1,out[4]=1,out[8]=1,out}function identity(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}function translate(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];return out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+y*a10+a20,out[7]=x*a01+y*a11+a21,out[8]=x*a02+y*a12+a22,out}function rotate(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);return out[0]=c*a00+s*a10,out[1]=c*a01+s*a11,out[2]=c*a02+s*a12,out[3]=c*a10-s*a00,out[4]=c*a11-s*a01,out[5]=c*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=a22,out}function scale(out,a,v){var x=v[0],y=v[1];return out[0]=x*a[0],out[1]=x*a[1],out[2]=x*a[2],out[3]=y*a[3],out[4]=y*a[4],out[5]=y*a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out}Math.hypot||(Math.hypot=function(){for(var y=0,i=arguments.length;i--;)y+=arguments[i]*arguments[i];return Math.sqrt(y)});var Atlas=function(){return _createClass(function Atlas(r,texSize,texRows,createTextureCanvas){_classCallCheck(this,Atlas),this.debugID=Math.floor(1e4*Math.random()),this.r=r,this.texSize=texSize,this.texRows=texRows,this.texHeight=Math.floor(texSize/texRows),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=createTextureCanvas(r,texSize,texSize),this.scratch=createTextureCanvas(r,texSize,this.texHeight,"scratch")},[{key:"lock",value:function lock(){this.locked=!0}},{key:"getKeys",value:function getKeys(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function getScale(_ref){var w=_ref.w,h=_ref.h,texHeight=this.texHeight,maxTexWidth=this.texSize,scale=texHeight/h,texW=w*scale,texH=h*scale;return texW>maxTexWidth&&(texW=w*(scale=maxTexWidth/w),texH=h*scale),{scale,texW,texH}}},{key:"draw",value:function draw(key,bb,doDrawing){var _this=this;if(this.locked)throw new Error("can't draw, atlas is locked");var texSize=this.texSize,texRows=this.texRows,texHeight=this.texHeight,_this$getScale=this.getScale(bb),scale=_this$getScale.scale,texW=_this$getScale.texW,texH=_this$getScale.texH,drawAt=function drawAt(location,canvas){if(doDrawing&&canvas){var context=canvas.context,x=location.x,row=location.row,xOffset=x,yOffset=texHeight*row;context.save(),context.translate(xOffset,yOffset),context.scale(scale,scale),doDrawing(context,bb),context.restore()}},locations=[null,null],drawNormal=function drawNormal(){drawAt(_this.freePointer,_this.canvas),locations[0]={x:_this.freePointer.x,y:_this.freePointer.row*texHeight,w:texW,h:texH},locations[1]={x:_this.freePointer.x+texW,y:_this.freePointer.row*texHeight,w:0,h:texH},_this.freePointer.x+=texW,_this.freePointer.x==texSize&&(_this.freePointer.x=0,_this.freePointer.row++)},moveToStartOfNextRow=function moveToStartOfNextRow(){_this.freePointer.x=0,_this.freePointer.row++};if(this.freePointer.x+texW<=texSize)drawNormal();else{if(this.freePointer.row>=texRows-1)return!1;this.freePointer.x===texSize?(moveToStartOfNextRow(),drawNormal()):this.enableWrapping?function drawWrapped(){var scratch=_this.scratch,canvas=_this.canvas;scratch.clear(),drawAt({x:0,row:0},scratch);var firstTexW=texSize-_this.freePointer.x,secondTexW=texW-firstTexW,h=texHeight,dx=_this.freePointer.x,dy=_this.freePointer.row*texHeight,w=firstTexW;canvas.context.drawImage(scratch,0,0,w,h,dx,dy,w,h),locations[0]={x:dx,y:dy,w,h:texH};var sx=firstTexW,_dy=(_this.freePointer.row+1)*texHeight,_w=secondTexW;canvas&&canvas.context.drawImage(scratch,sx,0,_w,h,0,_dy,_w,h),locations[1]={x:0,y:_dy,w:_w,h:texH},_this.freePointer.x=secondTexW,_this.freePointer.row++}():(moveToStartOfNextRow(),drawNormal())}return this.keyToLocation.set(key,locations),this.needsBuffer=!0,locations}},{key:"getOffsets",value:function getOffsets(key){return this.keyToLocation.get(key)}},{key:"isEmpty",value:function isEmpty(){return 0===this.freePointer.x&&0===this.freePointer.row}},{key:"canFit",value:function canFit(bb){if(this.locked)return!1;var texSize=this.texSize,texRows=this.texRows,texW=this.getScale(bb).texW;return!(this.freePointer.x+texW>texSize)||this.freePointer.row<texRows-1}},{key:"bufferIfNeeded",value:function bufferIfNeeded(gl){this.texture||(this.texture=function createTexture(gl,debugID){var texture=gl.createTexture();return texture.buffer=function(offscreenCanvas){gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,offscreenCanvas),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)},texture.deleteTexture=function(){gl.deleteTexture(texture)},texture}(gl,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function dispose(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])}(),AtlasCollection=function(){return _createClass(function AtlasCollection(r,texSize,texRows,createTextureCanvas){_classCallCheck(this,AtlasCollection),this.r=r,this.texSize=texSize,this.texRows=texRows,this.createTextureCanvas=createTextureCanvas,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set},[{key:"getKeys",value:function getKeys(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function _createAtlas(){var r=this.r,texSize=this.texSize,texRows=this.texRows,createTextureCanvas=this.createTextureCanvas;return new Atlas(r,texSize,texRows,createTextureCanvas)}},{key:"_getScratchCanvas",value:function _getScratchCanvas(){if(!this.scratch){var r=this.r,texSize=this.texSize,texRows=this.texRows,createTextureCanvas=this.createTextureCanvas,texHeight=Math.floor(texSize/texRows);this.scratch=createTextureCanvas(r,texSize,texHeight,"scratch")}return this.scratch}},{key:"draw",value:function draw(key,bb,doDrawing){var atlas=this.styleKeyToAtlas.get(key);return atlas||((atlas=this.atlases[this.atlases.length-1])&&atlas.canFit(bb)||(atlas&&atlas.lock(),atlas=this._createAtlas(),this.atlases.push(atlas)),atlas.draw(key,bb,doDrawing),this.styleKeyToAtlas.set(key,atlas)),atlas}},{key:"getAtlas",value:function getAtlas(key){return this.styleKeyToAtlas.get(key)}},{key:"hasAtlas",value:function hasAtlas(key){return this.styleKeyToAtlas.has(key)}},{key:"markKeyForGC",value:function markKeyForGC(key){this.markedKeys.add(key)}},{key:"gc",value:function gc(){var _this2=this,markedKeys=this.markedKeys;if(0!==markedKeys.size){var _step,newAtlases=[],newStyleKeyToAtlas=new Map,newAtlas=null,_iterator=_createForOfIteratorHelper(this.atlases);try{var _loop=function _loop(){var atlas=_step.value,keys=atlas.getKeys(),keysToCollect=function intersection(set1,set2){return set1.intersection?set1.intersection(set2):new Set(_toConsumableArray(set1).filter(function(x){return set2.has(x)}))}(markedKeys,keys);if(0===keysToCollect.size)return newAtlases.push(atlas),keys.forEach(function(k){return newStyleKeyToAtlas.set(k,atlas)}),1;newAtlas||(newAtlas=_this2._createAtlas(),newAtlases.push(newAtlas));var _step2,_iterator2=_createForOfIteratorHelper(keys);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var key=_step2.value;if(!keysToCollect.has(key)){var _atlas$getOffsets2=_slicedToArray(atlas.getOffsets(key),2),s1=_atlas$getOffsets2[0],s2=_atlas$getOffsets2[1];newAtlas.canFit({w:s1.w+s2.w,h:s1.h})||(newAtlas.lock(),newAtlas=_this2._createAtlas(),newAtlases.push(newAtlas)),atlas.canvas&&(_this2._copyTextureToNewAtlas(key,atlas,newAtlas),newStyleKeyToAtlas.set(key,newAtlas))}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}atlas.dispose()};for(_iterator.s();!(_step=_iterator.n()).done;)_loop()}catch(err){_iterator.e(err)}finally{_iterator.f()}this.atlases=newAtlases,this.styleKeyToAtlas=newStyleKeyToAtlas,this.markedKeys=new Set}else console.log("nothing to garbage collect")}},{key:"_copyTextureToNewAtlas",value:function _copyTextureToNewAtlas(key,oldAtlas,newAtlas){var _oldAtlas$getOffsets2=_slicedToArray(oldAtlas.getOffsets(key),2),s1=_oldAtlas$getOffsets2[0],s2=_oldAtlas$getOffsets2[1];if(0===s2.w)newAtlas.draw(key,s1,function(context){context.drawImage(oldAtlas.canvas,s1.x,s1.y,s1.w,s1.h,0,0,s1.w,s1.h)});else{var scratch=this._getScratchCanvas();scratch.clear(),scratch.context.drawImage(oldAtlas.canvas,s1.x,s1.y,s1.w,s1.h,0,0,s1.w,s1.h),scratch.context.drawImage(oldAtlas.canvas,s2.x,s2.y,s2.w,s2.h,s1.w,0,s2.w,s2.h);var w=s1.w+s2.w,h=s1.h;newAtlas.draw(key,{w,h},function(context){context.drawImage(scratch,0,0,w,h,0,0,w,h)})}}},{key:"getCounts",value:function getCounts(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])}();var AtlasManager=function(){return _createClass(function AtlasManager(r,globalOptions){_classCallCheck(this,AtlasManager),this.r=r,this.globalOptions=globalOptions,this.atlasSize=globalOptions.webglTexSize,this.maxAtlasesPerBatch=globalOptions.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map},[{key:"getAtlasSize",value:function getAtlasSize(){return this.atlasSize}},{key:"addAtlasCollection",value:function addAtlasCollection(collectionName,atlasCollectionOptions){var _this$globalOptions=this.globalOptions,webglTexSize=_this$globalOptions.webglTexSize,createTextureCanvas=_this$globalOptions.createTextureCanvas,texRows=atlasCollectionOptions.texRows,cachedCreateTextureCanvas=this._cacheScratchCanvas(createTextureCanvas),atlasCollection=new AtlasCollection(this.r,webglTexSize,texRows,cachedCreateTextureCanvas);this.collections.set(collectionName,atlasCollection)}},{key:"addRenderType",value:function addRenderType(type,renderTypeOptions){var collection=renderTypeOptions.collection;if(!this.collections.has(collection))throw new Error("invalid atlas collection name '".concat(collection,"'"));var atlasCollection=this.collections.get(collection),opts=extend({type,atlasCollection},renderTypeOptions);this.renderTypes.set(type,opts)}},{key:"getRenderTypeOpts",value:function getRenderTypeOpts(type){return this.renderTypes.get(type)}},{key:"getAtlasCollection",value:function getAtlasCollection(name){return this.collections.get(name)}},{key:"_cacheScratchCanvas",value:function _cacheScratchCanvas(createTextureCanvas){var prevW=-1,prevH=-1,scratchCanvas=null;return function(r,w,h,scratch){return scratch?(scratchCanvas&&w==prevW&&h==prevH||(prevW=w,prevH=h,scratchCanvas=createTextureCanvas(r,w,h)),scratchCanvas):createTextureCanvas(r,w,h)}}},{key:"_key",value:function _key(renderType,id){return"".concat(renderType,"-").concat(id)}},{key:"invalidate",value:function invalidate(eles){var _step3,_this3=this,_ref2=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref2$forceRedraw=_ref2.forceRedraw,forceRedraw=void 0!==_ref2$forceRedraw&&_ref2$forceRedraw,_ref2$filterEle=_ref2.filterEle,filterEle=void 0===_ref2$filterEle?function(){return!0}:_ref2$filterEle,_ref2$filterType=_ref2.filterType,filterType=void 0===_ref2$filterType?function(){return!0}:_ref2$filterType,needGC=!1,runGCNow=!1,_iterator3=_createForOfIteratorHelper(eles);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var ele=_step3.value;if(filterEle(ele)){var _step4,_iterator4=_createForOfIteratorHelper(this.renderTypes.values());try{var _loop2=function _loop2(){var opts=_step4.value,renderType=opts.type;if(filterType(renderType)){var atlasCollection=_this3.collections.get(opts.collection),key=opts.getKey(ele),keyArray=Array.isArray(key)?key:[key];if(forceRedraw)keyArray.forEach(function(key){return atlasCollection.markKeyForGC(key)}),runGCNow=!0;else{var id=opts.getID?opts.getID(ele):ele.id(),mapKey=_this3._key(renderType,id),oldKeyArray=_this3.typeAndIdToKey.get(mapKey);void 0===oldKeyArray||arrayEqual(keyArray,oldKeyArray)||(needGC=!0,_this3.typeAndIdToKey.delete(mapKey),oldKeyArray.forEach(function(oldKey){return atlasCollection.markKeyForGC(oldKey)}))}}};for(_iterator4.s();!(_step4=_iterator4.n()).done;)_loop2()}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return runGCNow&&(this.gc(),needGC=!1),needGC}},{key:"gc",value:function gc(){var _step5,_iterator5=_createForOfIteratorHelper(this.collections.values());try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){_step5.value.gc()}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}},{key:"getOrCreateAtlas",value:function getOrCreateAtlas(ele,type,bb,styleKey){var opts=this.renderTypes.get(type),atlasCollection=this.collections.get(opts.collection),drawn=!1,atlas=atlasCollection.draw(styleKey,bb,function(context){opts.drawClipped?(context.save(),context.beginPath(),context.rect(0,0,bb.w,bb.h),context.clip(),opts.drawElement(context,ele,bb,!0,!0),context.restore()):opts.drawElement(context,ele,bb,!0,!0),drawn=!0});if(drawn){var id=opts.getID?opts.getID(ele):ele.id(),mapKey=this._key(type,id);this.typeAndIdToKey.has(mapKey)?this.typeAndIdToKey.get(mapKey).push(styleKey):this.typeAndIdToKey.set(mapKey,[styleKey])}return atlas}},{key:"getAtlasInfo",value:function getAtlasInfo(ele,type){var _this4=this,opts=this.renderTypes.get(type),key=opts.getKey(ele);return(Array.isArray(key)?key:[key]).map(function(styleKey){var bb=opts.getBoundingBox(ele,styleKey),atlas=_this4.getOrCreateAtlas(ele,type,bb,styleKey),_atlas$getOffsets4=_slicedToArray(atlas.getOffsets(styleKey),2),tex1=_atlas$getOffsets4[0];return{atlas,tex:tex1,tex1,tex2:_atlas$getOffsets4[1],bb}})}},{key:"getDebugInfo",value:function getDebugInfo(){var _step6,debugInfo=[],_iterator6=_createForOfIteratorHelper(this.collections);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _step6$value=_slicedToArray(_step6.value,2),name=_step6$value[0],_collection$getCounts=_step6$value[1].getCounts(),keyCount=_collection$getCounts.keyCount,atlasCount=_collection$getCounts.atlasCount;debugInfo.push({type:name,keyCount,atlasCount})}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return debugInfo}}])}(),AtlasBatchManager=function(){return _createClass(function AtlasBatchManager(globalOptions){_classCallCheck(this,AtlasBatchManager),this.globalOptions=globalOptions,this.atlasSize=globalOptions.webglTexSize,this.maxAtlasesPerBatch=globalOptions.webglTexPerBatch,this.batchAtlases=[]},[{key:"getMaxAtlasesPerBatch",value:function getMaxAtlasesPerBatch(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function getAtlasSize(){return this.atlasSize}},{key:"getIndexArray",value:function getIndexArray(){return Array.from({length:this.maxAtlasesPerBatch},function(v,i){return i})}},{key:"startBatch",value:function startBatch(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function getAtlasCount(){return this.batchAtlases.length}},{key:"getAtlases",value:function getAtlases(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function canAddToCurrentBatch(atlas){return this.batchAtlases.length!==this.maxAtlasesPerBatch||this.batchAtlases.includes(atlas)}},{key:"getAtlasIndexForBatch",value:function getAtlasIndexForBatch(atlas){var atlasID=this.batchAtlases.indexOf(atlas);if(atlasID<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw new Error("cannot add more atlases to batch");this.batchAtlases.push(atlas),atlasID=this.batchAtlases.length-1}return atlasID}}])}(),RENDER_TARGET={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},TEX_PICKING_MODE_IGNORE=1,TEX_PICKING_MODE_USE_BB=2,ElementDrawingWebGL=function(){return _createClass(function ElementDrawingWebGL(r,gl,opts){_classCallCheck(this,ElementDrawingWebGL),this.r=r,this.gl=gl,this.maxInstances=opts.webglBatchSize,this.atlasSize=opts.webglTexSize,this.bgColor=opts.bgColor,this.debug=opts.webglDebug,this.batchDebugInfo=[],opts.enableWrapping=!0,opts.createTextureCanvas=createTextureCanvas,this.atlasManager=new AtlasManager(r,opts),this.batchManager=new AtlasBatchManager(opts),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(RENDER_TARGET.SCREEN),this.pickingProgram=this._createShaderProgram(RENDER_TARGET.PICKING),this.vao=this._createVAO()},[{key:"addAtlasCollection",value:function addAtlasCollection(collectionName,opts){this.atlasManager.addAtlasCollection(collectionName,opts)}},{key:"addTextureAtlasRenderType",value:function addTextureAtlasRenderType(typeName,opts){this.atlasManager.addRenderType(typeName,opts)}},{key:"addSimpleShapeRenderType",value:function addSimpleShapeRenderType(typeName,opts){this.simpleShapeOptions.set(typeName,opts)}},{key:"invalidate",value:function invalidate(eles){var type=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).type,atlasManager=this.atlasManager;return type?atlasManager.invalidate(eles,{filterType:function filterType(t){return t===type},forceRedraw:!0}):atlasManager.invalidate(eles)}},{key:"gc",value:function gc(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function _createShaderProgram(renderTarget){var gl=this.gl,vertexShaderSource="#version 300 es\n      precision highp float;\n\n      uniform mat3 uPanZoomMatrix;\n      uniform int  uAtlasSize;\n      \n      // instanced\n      in vec2 aPosition; // a vertex from the unit square\n      \n      in mat3 aTransform; // used to transform verticies, eg into a bounding box\n      in int aVertType; // the type of thing we are rendering\n\n      // the z-index that is output when using picking mode\n      in vec4 aIndex;\n      \n      // For textures\n      in int aAtlasId; // which shader unit/atlas to use\n      in vec4 aTex; // x/y/w/h of texture in atlas\n\n      // for edges\n      in vec4 aPointAPointB;\n      in vec4 aPointCPointD;\n      in vec2 aLineWidth; // also used for node border width\n\n      // simple shapes\n      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]\n      in vec4 aColor; // also used for edges\n      in vec4 aBorderColor; // aLineWidth is used for border width\n\n      // output values passed to the fragment shader\n      out vec2 vTexCoord;\n      out vec4 vColor;\n      out vec2 vPosition;\n      // flat values are not interpolated\n      flat out int vAtlasId; \n      flat out int vVertType;\n      flat out vec2 vTopRight;\n      flat out vec2 vBotLeft;\n      flat out vec4 vCornerRadius;\n      flat out vec4 vBorderColor;\n      flat out vec2 vBorderWidth;\n      flat out vec4 vIndex;\n      \n      void main(void) {\n        int vid = gl_VertexID;\n        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below\n\n        if(aVertType == ".concat(0,") {\n          float texX = aTex.x; // texture coordinates\n          float texY = aTex.y;\n          float texW = aTex.z;\n          float texH = aTex.w;\n\n          if(vid == 1 || vid == 2 || vid == 4) {\n            texX += texW;\n          }\n          if(vid == 2 || vid == 4 || vid == 5) {\n            texY += texH;\n          }\n\n          float d = float(uAtlasSize);\n          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(4," || aVertType == ").concat(7," \n             || aVertType == ").concat(5," || aVertType == ").concat(6,") { // simple shapes\n\n          // the bounding box is needed by the fragment shader\n          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat\n          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat\n          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated\n\n          // calculations are done in the fragment shader, just pass these along\n          vColor = aColor;\n          vCornerRadius = aCornerRadius;\n          vBorderColor = aBorderColor;\n          vBorderWidth = aLineWidth;\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(1,") {\n          vec2 source = aPointAPointB.xy;\n          vec2 target = aPointAPointB.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          // stretch the unit square into a long skinny rectangle\n          vec2 xBasis = target - source;\n          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;\n\n          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(2,") {\n          vec2 pointA = aPointAPointB.xy;\n          vec2 pointB = aPointAPointB.zw;\n          vec2 pointC = aPointCPointD.xy;\n          vec2 pointD = aPointCPointD.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          vec2 p0, p1, p2, pos;\n          if(position.x == 0.0) { // The left side of the unit square\n            p0 = pointA;\n            p1 = pointB;\n            p2 = pointC;\n            pos = position;\n          } else { // The right side of the unit square, use same approach but flip the geometry upside down\n            p0 = pointD;\n            p1 = pointC;\n            p2 = pointB;\n            pos = vec2(0.0, -position.y);\n          }\n\n          vec2 p01 = p1 - p0;\n          vec2 p12 = p2 - p1;\n          vec2 p21 = p1 - p2;\n\n          // Find the normal vector.\n          vec2 tangent = normalize(normalize(p12) + normalize(p01));\n          vec2 normal = vec2(-tangent.y, tangent.x);\n\n          // Find the vector perpendicular to p0 -> p1.\n          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));\n\n          // Determine the bend direction.\n          float sigma = sign(dot(p01 + p21, normal));\n          float width = aLineWidth[0];\n\n          if(sign(pos.y) == -sigma) {\n            // This is an intersecting vertex. Adjust the position so that there's no overlap.\n            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          } else {\n            // This is a non-intersecting vertex. Treat it like a mitre join.\n            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          }\n\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(3," && vid < 3) {\n          // massage the first triangle into an edge arrow\n          if(vid == 0)\n            position = vec2(-0.15, -0.3);\n          if(vid == 1)\n            position = vec2(  0.0,  0.0);\n          if(vid == 2)\n            position = vec2( 0.15, -0.3);\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n          vColor = aColor;\n        }\n        else {\n          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space\n        }\n\n        vAtlasId = aAtlasId;\n        vVertType = aVertType;\n        vIndex = aIndex;\n      }\n    "),idxs=this.batchManager.getIndexArray(),fragmentShaderSource="#version 300 es\n      precision highp float;\n\n      // declare texture unit for each texture atlas in the batch\n      ".concat(idxs.map(function(i){return"uniform sampler2D uTexture".concat(i,";")}).join("\n\t"),"\n\n      uniform vec4 uBGColor;\n      uniform float uZoom;\n\n      in vec2 vTexCoord;\n      in vec4 vColor;\n      in vec2 vPosition; // model coordinates\n\n      flat in int vAtlasId;\n      flat in vec4 vIndex;\n      flat in int vVertType;\n      flat in vec2 vTopRight;\n      flat in vec2 vBotLeft;\n      flat in vec4 vCornerRadius;\n      flat in vec4 vBorderColor;\n      flat in vec2 vBorderWidth;\n\n      out vec4 outColor;\n\n      ").concat("\n  float circleSD(vec2 p, float r) {\n    return distance(vec2(0), p) - r; // signed distance\n  }\n","\n      ").concat("\n  float rectangleSD(vec2 p, vec2 b) {\n    vec2 d = abs(p)-b;\n    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);\n  }\n","\n      ").concat("\n  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {\n    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;\n    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;\n    vec2 q = abs(p) - b + cr.x;\n    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;\n  }\n","\n      ").concat("\n  float ellipseSD(vec2 p, vec2 ab) {\n    p = abs( p ); // symmetry\n\n    // find root with Newton solver\n    vec2 q = ab*(p-ab);\n    float w = (q.x<q.y)? 1.570796327 : 0.0;\n    for( int i=0; i<5; i++ ) {\n      vec2 cs = vec2(cos(w),sin(w));\n      vec2 u = ab*vec2( cs.x,cs.y);\n      vec2 v = ab*vec2(-cs.y,cs.x);\n      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));\n    }\n    \n    // compute final point and distance\n    float d = length(p-ab*vec2(cos(w),sin(w)));\n    \n    // return signed distance\n    return (dot(p/ab,p/ab)>1.0) ? d : -d;\n  }\n","\n\n      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha\n        return vec4( \n          top.rgb + (bot.rgb * (1.0 - top.a)),\n          top.a   + (bot.a   * (1.0 - top.a)) \n        );\n      }\n\n      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance\n        // scale to the zoom level so that borders don't look blurry when zoomed in\n        // note 1.5 is an aribitrary value chosen because it looks good\n        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); \n      }\n\n      void main(void) {\n        if(vVertType == ").concat(0,") {\n          // look up the texel from the texture unit\n          ").concat(idxs.map(function(i){return"if(vAtlasId == ".concat(i,") outColor = texture(uTexture").concat(i,", vTexCoord);")}).join("\n\telse "),"\n        } \n        else if(vVertType == ").concat(3,") {\n          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';\n          outColor = blend(vColor, uBGColor);\n          outColor.a = 1.0; // make opaque, masks out line under arrow\n        }\n        else if(vVertType == ").concat(4," && vBorderWidth == vec2(0.0)) { // simple rectangle with no border\n          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done\n        }\n        else if(vVertType == ").concat(4," || vVertType == ").concat(7," \n          || vVertType == ").concat(5," || vVertType == ").concat(6,") { // use SDF\n\n          float outerBorder = vBorderWidth[0];\n          float innerBorder = vBorderWidth[1];\n          float borderPadding = outerBorder * 2.0;\n          float w = vTopRight.x - vBotLeft.x - borderPadding;\n          float h = vTopRight.y - vBotLeft.y - borderPadding;\n          vec2 b = vec2(w/2.0, h/2.0); // half width, half height\n          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center\n\n          float d; // signed distance\n          if(vVertType == ").concat(4,") {\n            d = rectangleSD(p, b);\n          } else if(vVertType == ").concat(7," && w == h) {\n            d = circleSD(p, b.x); // faster than ellipse\n          } else if(vVertType == ").concat(7,") {\n            d = ellipseSD(p, b);\n          } else {\n            d = roundRectangleSD(p, b, vCornerRadius.wzyx);\n          }\n\n          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling\n          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box\n          if(d > 0.0) {\n            if(d > outerBorder) {\n              discard;\n            } else {\n              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);\n            }\n          } else {\n            if(d > innerBorder) {\n              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;\n              vec4 innerBorderColor = blend(vBorderColor, vColor);\n              outColor = distInterp(innerBorderColor, outerColor, d);\n            } \n            else {\n              vec4 outerColor;\n              if(innerBorder == 0.0 && outerBorder == 0.0) {\n                outerColor = vec4(0);\n              } else if(innerBorder == 0.0) {\n                outerColor = vBorderColor;\n              } else {\n                outerColor = blend(vBorderColor, vColor);\n              }\n              outColor = distInterp(vColor, outerColor, d - innerBorder);\n            }\n          }\n        }\n        else {\n          outColor = vColor;\n        }\n\n        ").concat(renderTarget.picking?"if(outColor.a == 0.0) discard;\n             else outColor = vIndex;":"","\n      }\n    "),program=function createProgram(gl,vertexSource,fragementSource){var vertexShader=compileShader(gl,gl.VERTEX_SHADER,vertexSource),fragmentShader=compileShader(gl,gl.FRAGMENT_SHADER,fragementSource),program=gl.createProgram();if(gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),!gl.getProgramParameter(program,gl.LINK_STATUS))throw new Error("Could not initialize shaders");return program}(gl,vertexShaderSource,fragmentShaderSource);program.aPosition=gl.getAttribLocation(program,"aPosition"),program.aIndex=gl.getAttribLocation(program,"aIndex"),program.aVertType=gl.getAttribLocation(program,"aVertType"),program.aTransform=gl.getAttribLocation(program,"aTransform"),program.aAtlasId=gl.getAttribLocation(program,"aAtlasId"),program.aTex=gl.getAttribLocation(program,"aTex"),program.aPointAPointB=gl.getAttribLocation(program,"aPointAPointB"),program.aPointCPointD=gl.getAttribLocation(program,"aPointCPointD"),program.aLineWidth=gl.getAttribLocation(program,"aLineWidth"),program.aColor=gl.getAttribLocation(program,"aColor"),program.aCornerRadius=gl.getAttribLocation(program,"aCornerRadius"),program.aBorderColor=gl.getAttribLocation(program,"aBorderColor"),program.uPanZoomMatrix=gl.getUniformLocation(program,"uPanZoomMatrix"),program.uAtlasSize=gl.getUniformLocation(program,"uAtlasSize"),program.uBGColor=gl.getUniformLocation(program,"uBGColor"),program.uZoom=gl.getUniformLocation(program,"uZoom"),program.uTextures=[];for(var i=0;i<this.batchManager.getMaxAtlasesPerBatch();i++)program.uTextures.push(gl.getUniformLocation(program,"uTexture".concat(i)));return program}},{key:"_createVAO",value:function _createVAO(){var unitSquare=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=unitSquare.length/2;var n=this.maxInstances,gl=this.gl,program=this.program,vao=gl.createVertexArray();return gl.bindVertexArray(vao),function createBufferStaticDraw(gl,type,attributeLoc,dataArray){var _getTypeInfo2=_slicedToArray(getTypeInfo(gl,type),2),size=_getTypeInfo2[0],glType=_getTypeInfo2[1],data=createTypedArray(gl,glType,dataArray),buffer=gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW),glType===gl.FLOAT?gl.vertexAttribPointer(attributeLoc,size,glType,!1,0,0):glType===gl.INT&&gl.vertexAttribIPointer(attributeLoc,size,glType,0,0),gl.enableVertexAttribArray(attributeLoc),gl.bindBuffer(gl.ARRAY_BUFFER,null),buffer}(gl,"vec2",program.aPosition,unitSquare),this.transformBuffer=function create3x3MatrixBufferDynamicDraw(gl,instances,attributeLoc){for(var matrixData=new Float32Array(9*instances),matrixViews=new Array(instances),i=0;i<instances;i++){var byteOffset=9*i*4;matrixViews[i]=new Float32Array(matrixData.buffer,byteOffset,9)}var buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,matrixData.byteLength,gl.DYNAMIC_DRAW);for(var _i=0;_i<3;_i++){var loc=attributeLoc+_i;gl.enableVertexAttribArray(loc),gl.vertexAttribPointer(loc,3,gl.FLOAT,!1,36,12*_i),gl.vertexAttribDivisor(loc,1)}return gl.bindBuffer(gl.ARRAY_BUFFER,null),buffer.getMatrixView=function(i){return matrixViews[i]},buffer.setData=function(matrix,i){matrixViews[i].set(matrix,0)},buffer.bufferSubData=function(){gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,matrixData)},buffer}(gl,n,program.aTransform),this.indexBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aIndex),this.vertTypeBuffer=createBufferDynamicDraw(gl,n,"int",program.aVertType),this.atlasIdBuffer=createBufferDynamicDraw(gl,n,"int",program.aAtlasId),this.texBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aTex),this.pointAPointBBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aPointAPointB),this.pointCPointDBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aPointCPointD),this.lineWidthBuffer=createBufferDynamicDraw(gl,n,"vec2",program.aLineWidth),this.colorBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aColor),this.cornerRadiusBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aCornerRadius),this.borderColorBuffer=createBufferDynamicDraw(gl,n,"vec4",program.aBorderColor),gl.bindVertexArray(null),vao}},{key:"buffers",get:function get(){var _this=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(k){return endsWith(k,"Buffer")}).map(function(k){return _this[k]})),this._buffers}},{key:"startFrame",value:function startFrame(panZoomMatrix){var renderTarget=arguments.length>1&&void 0!==arguments[1]?arguments[1]:RENDER_TARGET.SCREEN;this.panZoomMatrix=panZoomMatrix,this.renderTarget=renderTarget,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function startBatch(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function endFrame(){this.endBatch()}},{key:"_isVisible",value:function _isVisible(ele,opts){return!!ele.visible()&&(!opts||!opts.isVisible||opts.isVisible(ele))}},{key:"drawTexture",value:function drawTexture(ele,eleIndex,type){var atlasManager=this.atlasManager,batchManager=this.batchManager,opts=atlasManager.getRenderTypeOpts(type);if(this._isVisible(ele,opts)&&(!ele.isEdge()||this._isValidEdge(ele))){if(this.renderTarget.picking&&opts.getTexPickingMode){var mode=opts.getTexPickingMode(ele);if(mode===TEX_PICKING_MODE_IGNORE)return;if(mode==TEX_PICKING_MODE_USE_BB)return void this.drawPickingRectangle(ele,eleIndex,type)}var _step,_iterator=_createForOfIteratorHelper(atlasManager.getAtlasInfo(ele,type));try{for(_iterator.s();!(_step=_iterator.n()).done;){var atlasInfo=_step.value,atlas=atlasInfo.atlas,tex1=atlasInfo.tex1,tex2=atlasInfo.tex2;batchManager.canAddToCurrentBatch(atlas)||this.endBatch();for(var atlasIndex=batchManager.getAtlasIndexForBatch(atlas),_i=0,_arr=[[tex1,!0],[tex2,!1]];_i<_arr.length;_i++){var _arr$_i=_slicedToArray(_arr[_i],2),tex=_arr$_i[0],first=_arr$_i[1];if(0!=tex.w){var instance=this.instanceCount;this.vertTypeBuffer.getView(instance)[0]=0,indexToVec4(eleIndex,this.indexBuffer.getView(instance)),this.atlasIdBuffer.getView(instance)[0]=atlasIndex;var texView=this.texBuffer.getView(instance);texView[0]=tex.x,texView[1]=tex.y,texView[2]=tex.w,texView[3]=tex.h;var matrixView=this.transformBuffer.getMatrixView(instance);this.setTransformMatrix(ele,matrixView,opts,atlasInfo,first),this.instanceCount++,first||this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}}},{key:"setTransformMatrix",value:function setTransformMatrix(ele,matrix,opts,atlasInfo){var first=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],padding=0;if(opts.shapeProps&&opts.shapeProps.padding&&(padding=ele.pstyle(opts.shapeProps.padding).pfValue),atlasInfo){var bb=atlasInfo.bb,tex1=atlasInfo.tex1,tex2=atlasInfo.tex2,ratio=tex1.w/(tex1.w+tex2.w);first||(ratio=1-ratio);var adjBB=this._getAdjustedBB(bb,padding,first,ratio);this._applyTransformMatrix(matrix,adjBB,opts,ele)}else{var _bb=opts.getBoundingBox(ele),_adjBB=this._getAdjustedBB(_bb,padding,!0,1);this._applyTransformMatrix(matrix,_adjBB,opts,ele)}}},{key:"_applyTransformMatrix",value:function _applyTransformMatrix(matrix,adjBB,opts,ele){var x,y;identity(matrix);var theta=opts.getRotation?opts.getRotation(ele):0;if(0!==theta){var _opts$getRotationPoin=opts.getRotationPoint(ele);translate(matrix,matrix,[_opts$getRotationPoin.x,_opts$getRotationPoin.y]),rotate(matrix,matrix,theta);var offset=opts.getRotationOffset(ele);x=offset.x+(adjBB.xOffset||0),y=offset.y+(adjBB.yOffset||0)}else x=adjBB.x1,y=adjBB.y1;translate(matrix,matrix,[x,y]),scale(matrix,matrix,[adjBB.w,adjBB.h])}},{key:"_getAdjustedBB",value:function _getAdjustedBB(bb,padding,first,ratio){var x1=bb.x1,y1=bb.y1,w=bb.w,h=bb.h;padding&&(x1-=padding,y1-=padding,w+=2*padding,h+=2*padding);var xOffset=0,adjW=w*ratio;return first&&ratio<1?w=adjW:!first&&ratio<1&&(x1+=xOffset=w-adjW,w=adjW),{x1,y1,w,h,xOffset,yOffset:bb.yOffset}}},{key:"drawPickingRectangle",value:function drawPickingRectangle(ele,eleIndex,type){var opts=this.atlasManager.getRenderTypeOpts(type),instance=this.instanceCount;this.vertTypeBuffer.getView(instance)[0]=4,indexToVec4(eleIndex,this.indexBuffer.getView(instance)),toWebGLColor([0,0,0],1,this.colorBuffer.getView(instance));var matrixView=this.transformBuffer.getMatrixView(instance);this.setTransformMatrix(ele,matrixView,opts),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function drawNode(node,eleIndex,type){var opts=this.simpleShapeOptions.get(type);if(this._isVisible(node,opts)){var props=opts.shapeProps,vertType=this._getVertTypeForShape(node,props.shape);if(void 0===vertType||opts.isSimple&&!opts.isSimple(node))this.drawTexture(node,eleIndex,type);else{var instance=this.instanceCount;if(this.vertTypeBuffer.getView(instance)[0]=vertType,5===vertType||6===vertType){var bb=opts.getBoundingBox(node),radius=this._getCornerRadius(node,props.radius,bb),radiusView=this.cornerRadiusBuffer.getView(instance);radiusView[0]=radius,radiusView[1]=radius,radiusView[2]=radius,radiusView[3]=radius,6===vertType&&(radiusView[0]=0,radiusView[2]=0)}indexToVec4(eleIndex,this.indexBuffer.getView(instance)),toWebGLColor(node.pstyle(props.color).value,node.pstyle(props.opacity).value,this.colorBuffer.getView(instance));var lineWidthView=this.lineWidthBuffer.getView(instance);if(lineWidthView[0]=0,lineWidthView[1]=0,props.border){var borderWidth=node.pstyle("border-width").value;if(borderWidth>0){toWebGLColor(node.pstyle("border-color").value,node.pstyle("border-opacity").value,this.borderColorBuffer.getView(instance));var borderPos=node.pstyle("border-position").value;if("inside"===borderPos)lineWidthView[0]=0,lineWidthView[1]=-borderWidth;else if("outside"===borderPos)lineWidthView[0]=borderWidth,lineWidthView[1]=0;else{var halfWidth=borderWidth/2;lineWidthView[0]=halfWidth,lineWidthView[1]=-halfWidth}}}var matrixView=this.transformBuffer.getMatrixView(instance);this.setTransformMatrix(node,matrixView,opts),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}},{key:"_getVertTypeForShape",value:function _getVertTypeForShape(node,shapeProp){switch(node.pstyle(shapeProp).value){case"rectangle":return 4;case"ellipse":return 7;case"roundrectangle":case"round-rectangle":return 5;case"bottom-round-rectangle":return 6;default:return}}},{key:"_getCornerRadius",value:function _getCornerRadius(node,radiusProp,_ref2){var w=_ref2.w,h=_ref2.h;if("auto"===node.pstyle(radiusProp).value)return getRoundRectangleRadius(w,h);var radius=node.pstyle(radiusProp).pfValue,halfWidth=w/2,halfHeight=h/2;return Math.min(radius,halfHeight,halfWidth)}},{key:"drawEdgeArrow",value:function drawEdgeArrow(edge,eleIndex,prefix){if(edge.visible()){var x,y,angle,rs=edge._private.rscratch;if("source"===prefix?(x=rs.arrowStartX,y=rs.arrowStartY,angle=rs.srcArrowAngle):(x=rs.arrowEndX,y=rs.arrowEndY,angle=rs.tgtArrowAngle),!(isNaN(x)||null==x||isNaN(y)||null==y||isNaN(angle)||null==angle))if("none"!==edge.pstyle(prefix+"-arrow-shape").value){var color=edge.pstyle(prefix+"-arrow-color").value,opacity=edge.pstyle("opacity").value*edge.pstyle("line-opacity").value,lineWidth=edge.pstyle("width").pfValue,scale$1=edge.pstyle("arrow-scale").value,size=this.r.getArrowWidth(lineWidth,scale$1),instance=this.instanceCount,transform=this.transformBuffer.getMatrixView(instance);identity(transform),translate(transform,transform,[x,y]),scale(transform,transform,[size,size]),rotate(transform,transform,angle),this.vertTypeBuffer.getView(instance)[0]=3,indexToVec4(eleIndex,this.indexBuffer.getView(instance)),toWebGLColor(color,opacity,this.colorBuffer.getView(instance)),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}},{key:"drawEdgeLine",value:function drawEdgeLine(edge,eleIndex){if(edge.visible()){var points=this._getEdgePoints(edge);if(points){var baseOpacity=edge.pstyle("opacity").value,lineOpacity=edge.pstyle("line-opacity").value,width=edge.pstyle("width").pfValue,color=edge.pstyle("line-color").value,opacity=baseOpacity*lineOpacity;if(points.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),4==points.length){var instance=this.instanceCount;this.vertTypeBuffer.getView(instance)[0]=1,indexToVec4(eleIndex,this.indexBuffer.getView(instance)),toWebGLColor(color,opacity,this.colorBuffer.getView(instance)),this.lineWidthBuffer.getView(instance)[0]=width;var sourceTargetView=this.pointAPointBBuffer.getView(instance);sourceTargetView[0]=points[0],sourceTargetView[1]=points[1],sourceTargetView[2]=points[2],sourceTargetView[3]=points[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var i=0;i<points.length-2;i+=2){var _instance=this.instanceCount;this.vertTypeBuffer.getView(_instance)[0]=2,indexToVec4(eleIndex,this.indexBuffer.getView(_instance)),toWebGLColor(color,opacity,this.colorBuffer.getView(_instance)),this.lineWidthBuffer.getView(_instance)[0]=width;var pAx=points[i-2],pAy=points[i-1],pBx=points[i],pBy=points[i+1],pCx=points[i+2],pCy=points[i+3],pDx=points[i+4],pDy=points[i+5];0==i&&(pAx=2*pBx-pCx+.001,pAy=2*pBy-pCy+.001),i==points.length-4&&(pDx=2*pCx-pBx+.001,pDy=2*pCy-pBy+.001);var pointABView=this.pointAPointBBuffer.getView(_instance);pointABView[0]=pAx,pointABView[1]=pAy,pointABView[2]=pBx,pointABView[3]=pBy;var pointCDView=this.pointCPointDBuffer.getView(_instance);pointCDView[0]=pCx,pointCDView[1]=pCy,pointCDView[2]=pDx,pointCDView[3]=pDy,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function _isValidEdge(edge){var rs=edge._private.rscratch;return!rs.badLine&&null!=rs.allpts&&!isNaN(rs.allpts[0])}},{key:"_getEdgePoints",value:function _getEdgePoints(edge){var rs=edge._private.rscratch;if(this._isValidEdge(edge)){var controlPoints=rs.allpts;if(4==controlPoints.length)return controlPoints;var numSegments=this._getNumSegments(edge);return this._getCurveSegmentPoints(controlPoints,numSegments)}}},{key:"_getNumSegments",value:function _getNumSegments(edge){return Math.min(Math.max(15,5),this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function _getCurveSegmentPoints(controlPoints,segments){if(4==controlPoints.length)return controlPoints;for(var curvePoints=Array(2*(segments+1)),i=0;i<=segments;i++)if(0==i)curvePoints[0]=controlPoints[0],curvePoints[1]=controlPoints[1];else if(i==segments)curvePoints[2*i]=controlPoints[controlPoints.length-2],curvePoints[2*i+1]=controlPoints[controlPoints.length-1];else{var t=i/segments;this._setCurvePoint(controlPoints,t,curvePoints,2*i)}return curvePoints}},{key:"_setCurvePoint",value:function _setCurvePoint(points,t,curvePoints,cpi){if(!(points.length<=2)){for(var newpoints=Array(points.length-2),i=0;i<newpoints.length;i+=2){var x=(1-t)*points[i]+t*points[i+2],y=(1-t)*points[i+1]+t*points[i+3];newpoints[i]=x,newpoints[i+1]=y}return this._setCurvePoint(newpoints,t,curvePoints,cpi)}curvePoints[cpi]=points[0],curvePoints[cpi+1]=points[1]}},{key:"endBatch",value:function endBatch(){var gl=this.gl,vao=this.vao,vertexCount=this.vertexCount,count=this.instanceCount;if(0!==count){var program=this.renderTarget.picking?this.pickingProgram:this.program;gl.useProgram(program),gl.bindVertexArray(vao);var _step2,_iterator2=_createForOfIteratorHelper(this.buffers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){_step2.value.bufferSubData(count)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}for(var atlases=this.batchManager.getAtlases(),i=0;i<atlases.length;i++)atlases[i].bufferIfNeeded(gl);for(var _i2=0;_i2<atlases.length;_i2++)gl.activeTexture(gl.TEXTURE0+_i2),gl.bindTexture(gl.TEXTURE_2D,atlases[_i2].texture),gl.uniform1i(program.uTextures[_i2],_i2);gl.uniform1f(program.uZoom,function getEffectiveZoom(r){var pixelRatio=r.pixelRatio;return r.cy.zoom()*pixelRatio}(this.r)),gl.uniformMatrix3fv(program.uPanZoomMatrix,!1,this.panZoomMatrix),gl.uniform1i(program.uAtlasSize,this.batchManager.getAtlasSize());var webglBgColor=toWebGLColor(this.bgColor,1);gl.uniform4fv(program.uBGColor,webglBgColor),gl.drawArraysInstanced(gl.TRIANGLES,0,vertexCount,count),gl.bindVertexArray(null),gl.bindTexture(gl.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count,atlasCount:atlases.length}),this.startBatch()}}},{key:"getDebugInfo",value:function getDebugInfo(){var atlasInfo=this.atlasManager.getDebugInfo(),totalAtlases=atlasInfo.reduce(function(count,info){return count+info.atlasCount},0),batchInfo=this.batchDebugInfo,totalInstances=batchInfo.reduce(function(count,info){return count+info.count},0);return{atlasInfo,totalAtlases,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:batchInfo.length,batchInfo,totalInstances}}}])}(),CRp$4={};function getLabelLines(ele,prefix){var rs=ele._private.rscratch;return getPrefixedProperty(rs,"labelWrapCachedLines",prefix)||[]}CRp$4.initWebgl=function(opts,fns){var r=this,gl=r.data.contexts[r.WEBGL];opts.bgColor=function getBGColor(r){var container=r.cy.container(),cssColor=container&&container.style&&container.style.backgroundColor||"white";return color2tuple(cssColor)}(r),opts.webglTexSize=Math.min(opts.webglTexSize,gl.getParameter(gl.MAX_TEXTURE_SIZE)),opts.webglTexRows=Math.min(opts.webglTexRows,54),opts.webglTexRowsNodes=Math.min(opts.webglTexRowsNodes,54),opts.webglBatchSize=Math.min(opts.webglBatchSize,16384),opts.webglTexPerBatch=Math.min(opts.webglTexPerBatch,gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)),r.webglDebug=opts.webglDebug,r.webglDebugShowAtlases=opts.webglDebugShowAtlases,r.pickingFrameBuffer=function createPickingFrameBuffer(gl){var fb=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,fb);var targetTexture=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,targetTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,targetTexture,0),gl.bindFramebuffer(gl.FRAMEBUFFER,null),fb.setFramebufferAttachmentSizes=function(width,height){gl.bindTexture(gl.TEXTURE_2D,targetTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null)},fb}(gl),r.pickingFrameBuffer.needsDraw=!0,r.drawing=new ElementDrawingWebGL(r,gl,opts);var getLabelRotation=function getLabelRotation(prop){return function(ele){return r.getTextAngle(ele,prop)}},isLabelVisible=function isLabelVisible(prop){return function(ele){var label=ele.pstyle(prop);return label&&label.value}},isLayerVisible=function isLayerVisible(prefix){return function(node){return node.pstyle("".concat(prefix,"-opacity")).value>0}},getTexPickingMode=function getTexPickingMode(ele){return"yes"===ele.pstyle("text-events").strValue?TEX_PICKING_MODE_USE_BB:TEX_PICKING_MODE_IGNORE},getBBForSimpleShape=function getBBForSimpleShape(node){var _node$position=node.position(),x=_node$position.x,y=_node$position.y,w=node.outerWidth(),h=node.outerHeight();return{w,h,x1:x-w/2,y1:y-h/2}};r.drawing.addAtlasCollection("node",{texRows:opts.webglTexRowsNodes}),r.drawing.addAtlasCollection("label",{texRows:opts.webglTexRows}),r.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:fns.getStyleKey,getBoundingBox:fns.getElementBox,drawElement:fns.drawElement}),r.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:getBBForSimpleShape,isSimple:isSimpleShape,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),r.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:getBBForSimpleShape,isVisible:isLayerVisible("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),r.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:getBBForSimpleShape,isVisible:isLayerVisible("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),r.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode,getKey:getStyleKeysForLabel(fns.getLabelKey,null),getBoundingBox:getBoundingBoxForLabel(fns.getLabelBox,null),drawClipped:!0,drawElement:fns.drawLabel,getRotation:getLabelRotation(null),getRotationPoint:fns.getLabelRotationPoint,getRotationOffset:fns.getLabelRotationOffset,isVisible:isLabelVisible("label")}),r.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode,getKey:getStyleKeysForLabel(fns.getSourceLabelKey,"source"),getBoundingBox:getBoundingBoxForLabel(fns.getSourceLabelBox,"source"),drawClipped:!0,drawElement:fns.drawSourceLabel,getRotation:getLabelRotation("source"),getRotationPoint:fns.getSourceLabelRotationPoint,getRotationOffset:fns.getSourceLabelRotationOffset,isVisible:isLabelVisible("source-label")}),r.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode,getKey:getStyleKeysForLabel(fns.getTargetLabelKey,"target"),getBoundingBox:getBoundingBoxForLabel(fns.getTargetLabelBox,"target"),drawClipped:!0,drawElement:fns.drawTargetLabel,getRotation:getLabelRotation("target"),getRotationPoint:fns.getTargetLabelRotationPoint,getRotationOffset:fns.getTargetLabelRotationOffset,isVisible:isLabelVisible("target-label")});var setGCFlag=debounce(function(){console.log("garbage collect flag set"),r.data.gc=!0},1e4);r.onUpdateEleCalcs(function(willDraw,eles){var gcNeeded=!1;eles&&eles.length>0&&(gcNeeded|=r.drawing.invalidate(eles)),gcNeeded&&setGCFlag()}),function overrideCanvasRendererFunctions(r){var renderCanvas=r.render;r.render=function(options){options=options||{};var cy=r.cy;r.webgl&&(cy.zoom()>7.99?(!function clearWebgl(r){var gl=r.data.contexts[r.WEBGL];gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}(r),renderCanvas.call(r,options)):(!function clearCanvas(r){var clear=function clear(context){context.save(),context.setTransform(1,0,0,1,0,0),context.clearRect(0,0,r.canvasWidth,r.canvasHeight),context.restore()};clear(r.data.contexts[r.NODE]),clear(r.data.contexts[r.DRAG])}(r),renderWebgl(r,options,RENDER_TARGET.SCREEN)))};var baseFunc=r.matchCanvasSize;r.matchCanvasSize=function(container){baseFunc.call(r,container),r.pickingFrameBuffer.setFramebufferAttachmentSizes(r.canvasWidth,r.canvasHeight),r.pickingFrameBuffer.needsDraw=!0},r.findNearestElements=function(x,y,interactiveElementsOnly,isTouch){return function findNearestElementsWebgl(r,x,y){var node,edge,_step,indexes=function getPickingIndexes(r,mX1,mY1,mX2,mY2){var x,y,w,h,_util$getEffectivePan3=getEffectivePanZoom(r),pan=_util$getEffectivePan3.pan,zoom=_util$getEffectivePan3.zoom,_util$modelToRendered=function modelToRenderedPosition(r,pan,zoom,x,y){var rx=x*zoom+pan.x,ry=y*zoom+pan.y;return[rx,ry=Math.round(r.canvasHeight-ry)]}(r,pan,zoom,mX1,mY1),_util$modelToRendered2=_slicedToArray(_util$modelToRendered,2),cX1=_util$modelToRendered2[0],cY1=_util$modelToRendered2[1],t=6;if(x=cX1-t/2,y=cY1-t/2,h=t,0===(w=t)||0===h)return[];var gl=r.data.contexts[r.WEBGL];gl.bindFramebuffer(gl.FRAMEBUFFER,r.pickingFrameBuffer),r.pickingFrameBuffer.needsDraw&&(gl.viewport(0,0,gl.canvas.width,gl.canvas.height),renderWebgl(r,null,RENDER_TARGET.PICKING),r.pickingFrameBuffer.needsDraw=!1);var n=w*h,data=new Uint8Array(4*n);gl.readPixels(x,y,w,h,gl.RGBA,gl.UNSIGNED_BYTE,data),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var indexes=new Set,i=0;i<n;i++){var index=vec4ToIndex(data.slice(4*i,4*i+4))-1;index>=0&&indexes.add(index)}return indexes}(r,x,y),eles=r.getCachedZSortedEles(),_iterator=_createForOfIteratorHelper(indexes);try{for(_iterator.s();!(_step=_iterator.n()).done;){var ele=eles[_step.value];if(!node&&ele.isNode()&&(node=ele),!edge&&ele.isEdge()&&(edge=ele),node&&edge)break}}catch(err){_iterator.e(err)}finally{_iterator.f()}return[node,edge].filter(Boolean)}(r,x,y)};var _baseFunc=r.invalidateCachedZSortedEles;r.invalidateCachedZSortedEles=function(){_baseFunc.call(r),r.pickingFrameBuffer.needsDraw=!0};var _baseFunc2=r.notify;r.notify=function(eventName,eles){_baseFunc2.call(r,eventName,eles),"viewport"===eventName||"bounds"===eventName?r.pickingFrameBuffer.needsDraw=!0:"background"===eventName&&r.drawing.invalidate(eles,{type:"node-body"})}}(r)};var getStyleKeysForLabel=function getStyleKeysForLabel(getKey,prefix){return function(ele){var key=getKey(ele),lines=getLabelLines(ele,prefix);return lines.length>1?lines.map(function(line,index){return"".concat(key,"_").concat(index)}):key}},getBoundingBoxForLabel=function getBoundingBoxForLabel(getBoundingBox,prefix){return function(ele,styleKey){var bb=getBoundingBox(ele);if("string"==typeof styleKey){var ui=styleKey.indexOf("_");if(ui>0){var lineIndex=Number(styleKey.substring(ui+1)),lines=getLabelLines(ele,prefix),h=bb.h/lines.length,yOffset=h*lineIndex,y1=bb.y1+yOffset;return{x1:bb.x1,w:bb.w,y1,h,yOffset}}}return bb}};function setContextTransform(r,context){var width=r.canvasWidth,height=r.canvasHeight,_util$getEffectivePan2=getEffectivePanZoom(r),pan=_util$getEffectivePan2.pan,zoom=_util$getEffectivePan2.zoom;context.setTransform(1,0,0,1,0,0),context.clearRect(0,0,width,height),context.translate(pan.x,pan.y),context.scale(zoom,zoom)}function drawEle(r,index,ele){var drawing=r.drawing;index+=1,ele.isNode()?(drawing.drawNode(ele,index,"node-underlay"),drawing.drawNode(ele,index,"node-body"),drawing.drawTexture(ele,index,"label"),drawing.drawNode(ele,index,"node-overlay")):(drawing.drawEdgeLine(ele,index),drawing.drawEdgeArrow(ele,index,"source"),drawing.drawEdgeArrow(ele,index,"target"),drawing.drawTexture(ele,index,"label"),drawing.drawTexture(ele,index,"edge-source-label"),drawing.drawTexture(ele,index,"edge-target-label"))}function renderWebgl(r,options,renderTarget){var start;r.webglDebug&&(start=performance.now());var drawing=r.drawing,eleCount=0;if(renderTarget.screen&&r.data.canvasNeedsRedraw[r.SELECT_BOX]&&function drawSelectionRectangle(r,options){r.drawSelectionRectangle(options,function(context){return setContextTransform(r,context)})}(r,options),r.data.canvasNeedsRedraw[r.NODE]||renderTarget.picking){var gl=r.data.contexts[r.WEBGL];renderTarget.screen?(gl.clearColor(0,0,0,0),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)):gl.disable(gl.BLEND),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.viewport(0,0,gl.canvas.width,gl.canvas.height);var panZoomMatrix=function createPanZoomMatrix(r){var width=r.canvasWidth,height=r.canvasHeight,_util$getEffectivePan=getEffectivePanZoom(r),pan=_util$getEffectivePan.pan,zoom=_util$getEffectivePan.zoom,transform=create();translate(transform,transform,[pan.x,pan.y]),scale(transform,transform,[zoom,zoom]);var projection$1=create();!function projection(out,width,height){out[0]=2/width,out[1]=0,out[2]=0,out[3]=0,out[4]=-2/height,out[5]=0,out[6]=-1,out[7]=1,out[8]=1}(projection$1,width,height);var product=create();return function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22}(product,projection$1,transform),product}(r),eles=r.getCachedZSortedEles();if(eleCount=eles.length,drawing.startFrame(panZoomMatrix,renderTarget),renderTarget.screen){for(var i=0;i<eles.nondrag.length;i++)drawEle(r,i,eles.nondrag[i]);for(var _i2=0;_i2<eles.drag.length;_i2++)drawEle(r,_i2,eles.drag[_i2])}else if(renderTarget.picking)for(var _i3=0;_i3<eles.length;_i3++)drawEle(r,_i3,eles[_i3]);drawing.endFrame(),renderTarget.screen&&r.webglDebugShowAtlases&&(!function drawAxes(r){var context=r.data.contexts[r.NODE];context.save(),setContextTransform(r,context),context.strokeStyle="rgba(0, 0, 0, 0.3)",context.beginPath(),context.moveTo(-1e3,0),context.lineTo(1e3,0),context.stroke(),context.beginPath(),context.moveTo(0,-1e3),context.lineTo(0,1e3),context.stroke(),context.restore()}(r),function drawAtlases(r){var draw=function draw(drawing,name,row){for(var collection=drawing.atlasManager.getAtlasCollection(name),context=r.data.contexts[r.NODE],atlases=collection.atlases,_i=0;_i<atlases.length;_i++){var canvas=atlases[_i].canvas;if(canvas){var w=canvas.width,h=canvas.height,x=w*_i,y=canvas.height*row;context.save(),context.scale(.4,.4),context.drawImage(canvas,x,y),context.strokeStyle="black",context.rect(x,y,w,h),context.stroke(),context.restore()}}},i=0;draw(r.drawing,"node",i++),draw(r.drawing,"label",i++)}(r)),r.data.canvasNeedsRedraw[r.NODE]=!1,r.data.canvasNeedsRedraw[r.DRAG]=!1}if(r.webglDebug){var end=performance.now(),time=Math.ceil(end-start),debugInfo=drawing.getDebugInfo(),report=["".concat(eleCount," elements"),"".concat(debugInfo.totalInstances," instances"),"".concat(debugInfo.batchCount," batches"),"".concat(debugInfo.totalAtlases," atlases"),"".concat(debugInfo.wrappedCount," wrapped textures"),"".concat(debugInfo.simpleCount," simple shapes")].join(", ");console.log("WebGL (".concat(renderTarget.name,") - frame time ").concat(time,"ms")),console.log("Totals:"),console.log("  ".concat(report)),console.log("Texture Atlases Used:");var _step2,_iterator2=_createForOfIteratorHelper(debugInfo.atlasInfo);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var info=_step2.value;console.log("  ".concat(info.type,": ").concat(info.keyCount," keys, ").concat(info.atlasCount," atlases"))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}console.log("")}r.data.gc&&(console.log("Garbage Collect!"),r.data.gc=!1,drawing.gc())}for(var CRp$3={drawPolygonPath:function(context,x,y,width,height,points){var halfW=width/2,halfH=height/2;context.beginPath&&context.beginPath(),context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++)context.lineTo(x+halfW*points[2*i],y+halfH*points[2*i+1]);context.closePath()},drawRoundPolygonPath:function(context,x,y,width,height,points,corners){corners.forEach(function(corner){return drawPreparedRoundCorner(context,corner)}),context.closePath()},drawRoundRectanglePath:function(context,x,y,width,height,radius){var halfWidth=width/2,halfHeight=height/2,cornerRadius="auto"===radius?getRoundRectangleRadius(width,height):Math.min(radius,halfHeight,halfWidth);context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius),context.lineTo(x,y-halfHeight),context.closePath()},drawBottomRoundRectanglePath:function(context,x,y,width,height,radius){var halfWidth=width/2,halfHeight=height/2,cornerRadius="auto"===radius?getRoundRectangleRadius(width,height):radius;context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.lineTo(x+halfWidth,y-halfHeight),context.lineTo(x+halfWidth,y),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.lineTo(x-halfWidth,y-halfHeight),context.lineTo(x,y-halfHeight),context.closePath()},drawCutRectanglePath:function(context,x,y,width,height,points,corners){var halfWidth=width/2,halfHeight=height/2,cornerLength="auto"===corners?8:corners;context.beginPath&&context.beginPath(),context.moveTo(x-halfWidth+cornerLength,y-halfHeight),context.lineTo(x+halfWidth-cornerLength,y-halfHeight),context.lineTo(x+halfWidth,y-halfHeight+cornerLength),context.lineTo(x+halfWidth,y+halfHeight-cornerLength),context.lineTo(x+halfWidth-cornerLength,y+halfHeight),context.lineTo(x-halfWidth+cornerLength,y+halfHeight),context.lineTo(x-halfWidth,y+halfHeight-cornerLength),context.lineTo(x-halfWidth,y-halfHeight+cornerLength),context.closePath()},drawBarrelPath:function(context,x,y,width,height){var halfWidth=width/2,halfHeight=height/2,xBegin=x-halfWidth,xEnd=x+halfWidth,yBegin=y-halfHeight,yEnd=y+halfHeight,barrelCurveConstants=getBarrelCurveConstants(width,height),wOffset=barrelCurveConstants.widthOffset,hOffset=barrelCurveConstants.heightOffset,ctrlPtXOffset=barrelCurveConstants.ctrlPtOffsetPct*wOffset;context.beginPath&&context.beginPath(),context.moveTo(xBegin,yBegin+hOffset),context.lineTo(xBegin,yEnd-hOffset),context.quadraticCurveTo(xBegin+ctrlPtXOffset,yEnd,xBegin+wOffset,yEnd),context.lineTo(xEnd-wOffset,yEnd),context.quadraticCurveTo(xEnd-ctrlPtXOffset,yEnd,xEnd,yEnd-hOffset),context.lineTo(xEnd,yBegin+hOffset),context.quadraticCurveTo(xEnd-ctrlPtXOffset,yBegin,xEnd-wOffset,yBegin),context.lineTo(xBegin+wOffset,yBegin),context.quadraticCurveTo(xBegin+ctrlPtXOffset,yBegin,xBegin,yBegin+hOffset),context.closePath()}},sin0=Math.sin(0),cos0=Math.cos(0),sin={},cos={},ellipseStepSize=Math.PI/40,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)sin[i]=Math.sin(i),cos[i]=Math.cos(i);CRp$3.drawEllipsePath=function(context,centerX,centerY,width,height){if(context.beginPath&&context.beginPath(),context.ellipse)context.ellipse(centerX,centerY,width/2,height/2,0,0,2*Math.PI);else for(var xPos,yPos,rw=width/2,rh=height/2,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0,yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0,0===i?context.moveTo(xPos,yPos):context.lineTo(xPos,yPos);context.closePath()};var CRp$2={};function b64UriToB64(b64uri){var i=b64uri.indexOf(",");return b64uri.substr(i+1)}function output(options,canvas,mimeType){var getB64Uri=function getB64Uri(){return canvas.toDataURL(mimeType,options.quality)};switch(options.output){case"blob-promise":return new Promise$1(function(resolve,reject){try{canvas.toBlob(function(blob){null!=blob?resolve(blob):reject(new Error("`canvas.toBlob()` sent a null value in its callback"))},mimeType,options.quality)}catch(err){reject(err)}});case"blob":return function b64ToBlob(b64,mimeType){for(var bytes=atob(b64),buff=new ArrayBuffer(bytes.length),buffUint8=new Uint8Array(buff),i=0;i<bytes.length;i++)buffUint8[i]=bytes.charCodeAt(i);return new Blob([buff],{type:mimeType})}(b64UriToB64(getB64Uri()),mimeType);case"base64":return b64UriToB64(getB64Uri());default:return getB64Uri()}}CRp$2.createBuffer=function(w,h){var buffer=document.createElement("canvas");return buffer.width=w,buffer.height=h,[buffer,buffer.getContext("2d")]},CRp$2.bufferCanvasImage=function(options){var cy=this.cy,bb=cy.mutableElements().boundingBox(),ctrRect=this.findContainerClientCoords(),width=options.full?Math.ceil(bb.w):ctrRect[2],height=options.full?Math.ceil(bb.h):ctrRect[3],specdMaxDims=number$1(options.maxWidth)||number$1(options.maxHeight),pxRatio=this.getPixelRatio(),scale=1;if(void 0!==options.scale)width*=options.scale,height*=options.scale,scale=options.scale;else if(specdMaxDims){var maxScaleW=1/0,maxScaleH=1/0;number$1(options.maxWidth)&&(maxScaleW=scale*options.maxWidth/width),number$1(options.maxHeight)&&(maxScaleH=scale*options.maxHeight/height),width*=scale=Math.min(maxScaleW,maxScaleH),height*=scale}specdMaxDims||(width*=pxRatio,height*=pxRatio,scale*=pxRatio);var buffCanvas=document.createElement("canvas");buffCanvas.width=width,buffCanvas.height=height,buffCanvas.style.width=width+"px",buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0){buffCxt.clearRect(0,0,width,height),buffCxt.globalCompositeOperation="source-over";var zsortedEles=this.getCachedZSortedEles();if(options.full)buffCxt.translate(-bb.x1*scale,-bb.y1*scale),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles),buffCxt.scale(1/scale,1/scale),buffCxt.translate(bb.x1*scale,bb.y1*scale);else{var pan=cy.pan(),translation={x:pan.x*scale,y:pan.y*scale};scale*=cy.zoom(),buffCxt.translate(translation.x,translation.y),buffCxt.scale(scale,scale),this.drawElements(buffCxt,zsortedEles),buffCxt.scale(1/scale,1/scale),buffCxt.translate(-translation.x,-translation.y)}options.bg&&(buffCxt.globalCompositeOperation="destination-over",buffCxt.fillStyle=options.bg,buffCxt.rect(0,0,width,height),buffCxt.fill())}return buffCanvas},CRp$2.png=function(options){return output(options,this.bufferCanvasImage(options),"image/png")},CRp$2.jpg=function(options){return output(options,this.bufferCanvasImage(options),"image/jpeg")};var CRp$1={nodeShapeImpl:function(name,context,centerX,centerY,width,height,points,corners){switch(name){case"ellipse":return this.drawEllipsePath(context,centerX,centerY,width,height);case"polygon":return this.drawPolygonPath(context,centerX,centerY,width,height,points);case"round-polygon":return this.drawRoundPolygonPath(context,centerX,centerY,width,height,points,corners);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(context,centerX,centerY,width,height,corners);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(context,centerX,centerY,width,height,points,corners);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(context,centerX,centerY,width,height,corners);case"barrel":return this.drawBarrelPath(context,centerX,centerY,width,height)}}},CR=CanvasRenderer,CRp=CanvasRenderer.prototype;function CanvasRenderer(options){var r=this,document=r.cy.window().document;options.webgl&&(CRp.CANVAS_LAYERS=r.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),r.data={canvases:new Array(CRp.CANVAS_LAYERS),contexts:new Array(CRp.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CRp.CANVAS_LAYERS),bufferCanvases:new Array(CRp.BUFFER_COUNT),bufferContexts:new Array(CRp.CANVAS_LAYERS)};r.data.canvasContainer=document.createElement("div");var containerStyle=r.data.canvasContainer.style;r.data.canvasContainer.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",containerStyle.position="relative",containerStyle.zIndex="0",containerStyle.overflow="hidden";var container=options.cy.container();container.appendChild(r.data.canvasContainer),container.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)";var styleMap={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};(function ms(){return navigator&&navigator.userAgent.match(/msie|trident|edge/i)})()&&(styleMap["-ms-touch-action"]="none",styleMap["touch-action"]="none");for(var i=0;i<CRp.CANVAS_LAYERS;i++){var canvas=r.data.canvases[i]=document.createElement("canvas"),type=CRp.CANVAS_TYPES[i];r.data.contexts[i]=canvas.getContext(type),r.data.contexts[i]||error("Could not create canvas of type "+type),Object.keys(styleMap).forEach(function(k){canvas.style[k]=styleMap[k]}),canvas.style.position="absolute",canvas.setAttribute("data-id","layer"+i),canvas.style.zIndex=String(CRp.CANVAS_LAYERS-i),r.data.canvasContainer.appendChild(canvas),r.data.canvasNeedsRedraw[i]=!1}r.data.topCanvas=r.data.canvases[0],r.data.canvases[CRp.NODE].setAttribute("data-id","layer"+CRp.NODE+"-node"),r.data.canvases[CRp.SELECT_BOX].setAttribute("data-id","layer"+CRp.SELECT_BOX+"-selectbox"),r.data.canvases[CRp.DRAG].setAttribute("data-id","layer"+CRp.DRAG+"-drag"),r.data.canvases[CRp.WEBGL]&&r.data.canvases[CRp.WEBGL].setAttribute("data-id","layer"+CRp.WEBGL+"-webgl");for(i=0;i<CRp.BUFFER_COUNT;i++)r.data.bufferCanvases[i]=document.createElement("canvas"),r.data.bufferContexts[i]=r.data.bufferCanvases[i].getContext("2d"),r.data.bufferCanvases[i].style.position="absolute",r.data.bufferCanvases[i].setAttribute("data-id","buffer"+i),r.data.bufferCanvases[i].style.zIndex=String(-i-1),r.data.bufferCanvases[i].style.visibility="hidden";r.pathsEnabled=!0;var emptyBb=makeBoundingBox(),getCenterOffset=function getCenterOffset(bb){return{x:-bb.w/2,y:-bb.h/2}},getStyleKey=function getStyleKey(ele){return ele[0]._private.nodeKey},getLabelKey=function getLabelKey(ele){return ele[0]._private.labelStyleKey},getSourceLabelKey=function getSourceLabelKey(ele){return ele[0]._private.sourceLabelStyleKey},getTargetLabelKey=function getTargetLabelKey(ele){return ele[0]._private.targetLabelStyleKey},drawElement=function drawElement(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElement(context,ele,bb,!1,!1,useEleOpacity)},drawLabel=function drawLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"main",useEleOpacity)},drawSourceLabel=function drawSourceLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"source",useEleOpacity)},drawTargetLabel=function drawTargetLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"target",useEleOpacity)},getElementBox=function getElementBox(ele){return ele.boundingBox(),ele[0]._private.bodyBounds},getLabelBox=function getLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.main||emptyBb},getSourceLabelBox=function getSourceLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.source||emptyBb},getTargetLabelBox=function getTargetLabelBox(ele){return ele.boundingBox(),ele[0]._private.labelBounds.target||emptyBb},isLabelVisibleAtScale=function isLabelVisibleAtScale(ele,scaledLabelShown){return scaledLabelShown},getElementRotationPoint=function getElementRotationPoint(ele){return function getBoxCenter(bb){return{x:(bb.x1+bb.x2)/2,y:(bb.y1+bb.y2)/2}}(getElementBox(ele))},addTextMargin=function addTextMargin(prefix,pt,ele){var pre=prefix?prefix+"-":"";return{x:pt.x+ele.pstyle(pre+"text-margin-x").pfValue,y:pt.y+ele.pstyle(pre+"text-margin-y").pfValue}},getRsPt=function getRsPt(ele,x,y){var rs=ele[0]._private.rscratch;return{x:rs[x],y:rs[y]}},getLabelRotationPoint=function getLabelRotationPoint(ele){return addTextMargin("",getRsPt(ele,"labelX","labelY"),ele)},getSourceLabelRotationPoint=function getSourceLabelRotationPoint(ele){return addTextMargin("source",getRsPt(ele,"sourceLabelX","sourceLabelY"),ele)},getTargetLabelRotationPoint=function getTargetLabelRotationPoint(ele){return addTextMargin("target",getRsPt(ele,"targetLabelX","targetLabelY"),ele)},getElementRotationOffset=function getElementRotationOffset(ele){return getCenterOffset(getElementBox(ele))},getSourceLabelRotationOffset=function getSourceLabelRotationOffset(ele){return getCenterOffset(getSourceLabelBox(ele))},getTargetLabelRotationOffset=function getTargetLabelRotationOffset(ele){return getCenterOffset(getTargetLabelBox(ele))},getLabelRotationOffset=function getLabelRotationOffset(ele){var bb=getLabelBox(ele),p=getCenterOffset(getLabelBox(ele));if(ele.isNode()){switch(ele.pstyle("text-halign").value){case"left":p.x=-bb.w-(bb.leftPad||0);break;case"right":p.x=-(bb.rightPad||0)}switch(ele.pstyle("text-valign").value){case"top":p.y=-bb.h-(bb.topPad||0);break;case"bottom":p.y=-(bb.botPad||0)}}return p},eleTxrCache=r.data.eleTxrCache=new ElementTextureCache(r,{getKey:getStyleKey,doesEleInvalidateKey:function backgroundTimestampHasChanged(ele){var _p=ele[0]._private;return!(_p.oldBackgroundTimestamp===_p.backgroundTimestamp)},drawElement,getBoundingBox:getElementBox,getRotationPoint:getElementRotationPoint,getRotationOffset:getElementRotationOffset,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),lblTxrCache=r.data.lblTxrCache=new ElementTextureCache(r,{getKey:getLabelKey,drawElement:drawLabel,getBoundingBox:getLabelBox,getRotationPoint:getLabelRotationPoint,getRotationOffset:getLabelRotationOffset,isVisible:isLabelVisibleAtScale}),slbTxrCache=r.data.slbTxrCache=new ElementTextureCache(r,{getKey:getSourceLabelKey,drawElement:drawSourceLabel,getBoundingBox:getSourceLabelBox,getRotationPoint:getSourceLabelRotationPoint,getRotationOffset:getSourceLabelRotationOffset,isVisible:isLabelVisibleAtScale}),tlbTxrCache=r.data.tlbTxrCache=new ElementTextureCache(r,{getKey:getTargetLabelKey,drawElement:drawTargetLabel,getBoundingBox:getTargetLabelBox,getRotationPoint:getTargetLabelRotationPoint,getRotationOffset:getTargetLabelRotationOffset,isVisible:isLabelVisibleAtScale}),lyrTxrCache=r.data.lyrTxrCache=new LayeredTextureCache(r);r.onUpdateEleCalcs(function invalidateTextureCaches(willDraw,eles){eleTxrCache.invalidateElements(eles),lblTxrCache.invalidateElements(eles),slbTxrCache.invalidateElements(eles),tlbTxrCache.invalidateElements(eles),lyrTxrCache.invalidateElements(eles);for(var _i=0;_i<eles.length;_i++){var _p=eles[_i]._private;_p.oldBackgroundTimestamp=_p.backgroundTimestamp}});var refineInLayers=function refineInLayers(reqs){for(var i=0;i<reqs.length;i++)lyrTxrCache.enqueueElementRefinement(reqs[i].ele)};eleTxrCache.onDequeue(refineInLayers),lblTxrCache.onDequeue(refineInLayers),slbTxrCache.onDequeue(refineInLayers),tlbTxrCache.onDequeue(refineInLayers),options.webgl&&r.initWebgl(options,{getStyleKey,getLabelKey,getSourceLabelKey,getTargetLabelKey,drawElement,drawLabel,drawSourceLabel,drawTargetLabel,getElementBox,getLabelBox,getSourceLabelBox,getTargetLabelBox,getElementRotationPoint,getElementRotationOffset,getLabelRotationPoint,getSourceLabelRotationPoint,getTargetLabelRotationPoint,getLabelRotationOffset,getSourceLabelRotationOffset,getTargetLabelRotationOffset})}CRp.CANVAS_LAYERS=3,CRp.SELECT_BOX=0,CRp.DRAG=1,CRp.NODE=2,CRp.WEBGL=3,CRp.CANVAS_TYPES=["2d","2d","2d","webgl2"],CRp.BUFFER_COUNT=3,CRp.TEXTURE_BUFFER=0,CRp.MOTIONBLUR_BUFFER_NODE=1,CRp.MOTIONBLUR_BUFFER_DRAG=2,CRp.redrawHint=function(group,bool){var r=this;switch(group){case"eles":r.data.canvasNeedsRedraw[CRp.NODE]=bool;break;case"drag":r.data.canvasNeedsRedraw[CRp.DRAG]=bool;break;case"select":r.data.canvasNeedsRedraw[CRp.SELECT_BOX]=bool;break;case"gc":r.data.gc=!0}};var pathsImpld="undefined"!=typeof Path2D;CRp.path2dEnabled=function(on){if(void 0===on)return this.pathsEnabled;this.pathsEnabled=!!on},CRp.usePaths=function(){return pathsImpld&&this.pathsEnabled},CRp.setImgSmoothing=function(context,bool){null!=context.imageSmoothingEnabled?context.imageSmoothingEnabled=bool:(context.webkitImageSmoothingEnabled=bool,context.mozImageSmoothingEnabled=bool,context.msImageSmoothingEnabled=bool)},CRp.getImgSmoothing=function(context){return null!=context.imageSmoothingEnabled?context.imageSmoothingEnabled:context.webkitImageSmoothingEnabled||context.mozImageSmoothingEnabled||context.msImageSmoothingEnabled},CRp.makeOffscreenCanvas=function(width,height){var canvas;"undefined"!==("undefined"==typeof OffscreenCanvas?"undefined":_typeof(OffscreenCanvas))?canvas=new OffscreenCanvas(width,height):((canvas=this.cy.window().document.createElement("canvas")).width=width,canvas.height=height);return canvas},[CRp$b,CRp$a,CRp$9,CRp$8,CRp$7,CRp$6,CRp$5,CRp$4,CRp$3,CRp$2,CRp$1].forEach(function(props){extend(CRp,props)});var incExts=[{type:"layout",extensions:layout},{type:"renderer",extensions:[{name:"null",impl:NullRenderer},{name:"base",impl:BR},{name:"canvas",impl:CR}]}],extensions={},modules={};function setExtension(type,name,registrant){var ext=registrant,overrideErr=function overrideErr(field){warn("Can not register `"+name+"` for `"+type+"` since `"+field+"` already exists in the prototype and can not be overridden")};if("core"===type){if(Core.prototype[name])return overrideErr(name);Core.prototype[name]=registrant}else if("collection"===type){if(Collection.prototype[name])return overrideErr(name);Collection.prototype[name]=registrant}else if("layout"===type){for(var Layout=function Layout(options){this.options=options,registrant.call(this,options),plainObject(this._private)||(this._private={}),this._private.cy=options.cy,this._private.listeners=[],this.createEmitter()},layoutProto=Layout.prototype=Object.create(registrant.prototype),optLayoutFns=[],i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}layoutProto.start&&!layoutProto.run?layoutProto.run=function(){return this.start(),this}:!layoutProto.start&&layoutProto.run&&(layoutProto.start=function(){return this.run(),this});var regStop=registrant.prototype.stop;layoutProto.stop=function(){var opts=this.options;if(opts&&opts.animate){var anis=this.animations;if(anis)for(var _i=0;_i<anis.length;_i++)anis[_i].stop()}return regStop?regStop.call(this):this.emit("layoutstop"),this},layoutProto.destroy||(layoutProto.destroy=function(){return this}),layoutProto.cy=function(){return this._private.cy};var getCy=function getCy(layout){return layout._private.cy},emitterOpts={addEventFields:function addEventFields(layout,evt){evt.layout=layout,evt.cy=getCy(layout),evt.target=layout},bubble:function bubble(){return!0},parent:function parent(layout){return getCy(layout)}};extend(layoutProto,{createEmitter:function createEmitter(){return this._private.emitter=new Emitter(emitterOpts,this),this},emitter:function emitter(){return this._private.emitter},on:function on(evt,cb){return this.emitter().on(evt,cb),this},one:function one(evt,cb){return this.emitter().one(evt,cb),this},once:function once(evt,cb){return this.emitter().one(evt,cb),this},removeListener:function removeListener(evt,cb){return this.emitter().removeListener(evt,cb),this},removeAllListeners:function removeAllListeners(){return this.emitter().removeAllListeners(),this},emit:function emit(evt,params){return this.emitter().emit(evt,params),this}}),define.eventAliasesOn(layoutProto),ext=Layout}else if("renderer"===type&&"null"!==name&&"base"!==name){var BaseRenderer=getExtension("renderer","base"),bProto=BaseRenderer.prototype,RegistrantRenderer=registrant,rProto=registrant.prototype,Renderer=function Renderer(){BaseRenderer.apply(this,arguments),RegistrantRenderer.apply(this,arguments)},proto=Renderer.prototype;for(var pName in bProto){var pVal=bProto[pName];if(null!=rProto[pName])return overrideErr(pName);proto[pName]=pVal}for(var _pName in rProto)proto[_pName]=rProto[_pName];bProto.clientFunctions.forEach(function(name){proto[name]=proto[name]||function(){error("Renderer does not implement `renderer."+name+"()` on its prototype")}}),ext=Renderer}else if("__proto__"===type||"constructor"===type||"prototype"===type)return error(type+" is an illegal type to be registered, possibly lead to prototype pollutions");return setMap({map:extensions,keys:[type,name],value:ext})}function getExtension(type,name){return getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var extension=function extension(){return 2===arguments.length?getExtension.apply(null,arguments):3===arguments.length?setExtension.apply(null,arguments):4===arguments.length?getModule.apply(null,arguments):5===arguments.length?setModule.apply(null,arguments):void error("Invalid extension access syntax")};Core.prototype.extension=extension,incExts.forEach(function(group){group.extensions.forEach(function(ext){setExtension(group.type,ext.name,ext.impl)})});var _Stylesheet=function Stylesheet(){if(!(this instanceof _Stylesheet))return new _Stylesheet;this.length=0},sheetfn=_Stylesheet.prototype;sheetfn.instanceString=function(){return"stylesheet"},sheetfn.selector=function(selector){return this[this.length++]={selector,properties:[]},this},sheetfn.css=function(name,value){var i=this.length-1;if(string(name))this[i].properties.push({name,value});else if(plainObject(name))for(var map=name,propNames=Object.keys(map),j=0;j<propNames.length;j++){var key=propNames[j],mapVal=map[key];if(null!=mapVal){var prop=_Style.properties[key]||_Style.properties[dash2camel(key)];if(null!=prop){var _name=prop.name,_value=mapVal;this[i].properties.push({name:_name,value:_value})}}}return this},sheetfn.style=sheetfn.css,sheetfn.generateStyle=function(cy){var style=new _Style(cy);return this.appendToStyle(style)},sheetfn.appendToStyle=function(style){for(var i=0;i<this.length;i++){var context=this[i],selector=context.selector,props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style};var cytoscape=function cytoscape(options){return void 0===options&&(options={}),plainObject(options)?new Core(options):string(options)?extension.apply(extension,arguments):void 0};cytoscape.use=function(ext){var args=Array.prototype.slice.call(arguments,1);return args.unshift(cytoscape),ext.apply(null,args),this},cytoscape.warnings=function(bool){return warnings(bool)},cytoscape.version="3.33.1",cytoscape.stylesheet=cytoscape.Stylesheet=_Stylesheet}}]);