"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[14357,92245],{"./src/components/organisms/ImageUploader/ImageUploaderModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ImageUploaderModal:()=>ImageUploaderModal});var react=__webpack_require__("./node_modules/react/index.js"),atoms=__webpack_require__("./src/components/atoms/index.tsx"),molecules=__webpack_require__("./src/components/molecules/index.tsx"),server=__webpack_require__("./src/components/server/index.ts"),settings=__webpack_require__("./src/settings/index.ts"),helpers=__webpack_require__("./src/helpers/index.ts"),useJukiNotification=__webpack_require__("./src/hooks/useJukiNotification.tsx"),types=__webpack_require__("./src/types/index.ts");const PublicImages=props=>{const{copyButtons,onPickImageUrl,publicImages}=props,{addNotification}=(0,useJukiNotification.E)();return react.createElement("div",{className:"public-images-tab jk-row"},publicImages.map((publicImage,index)=>react.createElement("div",{className:"thumbnail",key:publicImage.imageUrl},react.createElement("img",{src:publicImage.imageThumbnailUrl+"?v=".concat((new Date).getTime()),alt:"image "+index}),react.createElement(molecules.GK,{actionButtons:[...copyButtons?[{icon:react.createElement(server.c8I,null),buttons:[{icon:react.createElement(server.c8I,{size:"small"}),label:react.createElement(atoms.T,null,"URL"),onClick:()=>{(0,helpers.C)(publicImage.imageUrl),addNotification({type:types.NotificationType.QUIET,message:react.createElement(atoms.T,null,"copied")})}},{icon:react.createElement(server.c8I,null),label:react.createElement(atoms.T,null,"MD"),onClick:()=>{(0,helpers.C)("![image alt](".concat(publicImage.imageUrl,")")),addNotification({type:types.NotificationType.QUIET,message:react.createElement(atoms.T,null,"copied")})}}]}]:[],...onPickImageUrl?[{icon:react.createElement(server.Srz,null),buttons:[{icon:react.createElement(server.Srz,{size:"small"}),label:react.createElement(atoms.T,null,"pick"),onClick:()=>{onPickImageUrl(publicImage),addNotification({type:types.NotificationType.QUIET,message:react.createElement(atoms.T,null,"picked")})}}]}]:[]]}))))};PublicImages.__docgenInfo={description:"",methods:[],displayName:"PublicImages",props:{copyButtons:{required:!1,tsType:{name:"boolean"},description:""},onPickImageUrl:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { imageThumbnailUrl: string, imageUrl: string }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ imageThumbnailUrl: string, imageUrl: string }",signature:{properties:[{key:"imageThumbnailUrl",value:{name:"string",required:!0}},{key:"imageUrl",value:{name:"string",required:!0}}]}},name:"props"}],return:{name:"void"}}},description:""},publicImages:{required:!0,tsType:{name:"Array",elements:[{name:"ImageSummaryResponseDTO"}],raw:"ImageSummaryResponseDTO[]"},description:""}}};const PublicImagesTab=props=>react.createElement(molecules.pW,{url:settings.Z.API_V1.image.getPublicList().url,triggerFetch:props.trigger},_ref=>{let{data:{contents}}=_ref;return react.createElement(PublicImages,{publicImages:contents,copyButtons:props.copyButtons,onPickImageUrl:props.onPickImageUrl})});PublicImagesTab.__docgenInfo={description:"",methods:[],displayName:"PublicImagesTab",props:{trigger:{required:!0,tsType:{name:"number"},description:""},copyButtons:{required:!1,tsType:{name:"boolean"},description:""},onPickImageUrl:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { imageThumbnailUrl: string, imageUrl: string }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ imageThumbnailUrl: string, imageUrl: string }",signature:{properties:[{key:"imageThumbnailUrl",value:{name:"string",required:!0}},{key:"imageUrl",value:{name:"string",required:!0}}]}},name:"props"}],return:{name:"void"}}},description:""}}};var esm=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js");const UploadNewImageTab=(0,react.memo)(_ref=>{let{copyButtons,onPickImageUrl,onUploadedImage}=_ref;const[imagePublicUrl,setImagePublicUrl]=(0,react.useState)(""),[cropImage,setCropImage]=(0,react.useState)(),[isPublic,setIsPublic]=(0,react.useState)(!1),{addNotification}=(0,useJukiNotification.E)();return react.createElement("div",{className:"upload-new-image-tab jk-col top gap"},imagePublicUrl&&react.createElement("div",{className:"jk-col left"},copyButtons&&react.createElement(react.Fragment,null,react.createElement("div",{className:"jk-row gap left fw-bd"},react.createElement(atoms.T,null,"public url"),":",react.createElement("div",{className:"copyable jk-row"},react.createElement("a",{href:imagePublicUrl,className:"link",target:"_blank",rel:"noreferrer"},imagePublicUrl),react.createElement(atoms.$r,{text:imagePublicUrl,size:"small"}))),react.createElement("div",{className:"jk-row gap left fw-bd"},react.createElement(atoms.T,null,"markdown use"),":",react.createElement("div",{className:"copyable jk-row"},react.createElement("span",{className:"tx-t fw-bd"},"![image alt](",imagePublicUrl,")"),react.createElement(atoms.$r,{text:"![image alt](".concat(imagePublicUrl,")"),size:"small"})))),onPickImageUrl&&react.createElement(atoms.$n,{onClick:()=>onPickImageUrl({imageUrl:imagePublicUrl,imageThumbnailUrl:imagePublicUrl.replace("https://images.juki.pub/o/","https://images.juki.pub/t/")}),size:"small",expand:!0},react.createElement(atoms.T,null,"pick"))),react.createElement(atoms.JN,{checked:isPublic,leftLabel:react.createElement(atoms.T,{className:(0,helpers.xW)("tt-se",{"fw-bd":!isPublic})},"not public"),rightLabel:react.createElement(atoms.T,{className:(0,helpers.xW)("tt-se",{"fw-bd":isPublic})},"public"),onChange:setIsPublic}),react.createElement(molecules.mT,{onClick:async setLoader=>{if(null!=cropImage&&cropImage.previewCanvasRef.current){const blob=await(0,helpers.ZR)(cropImage.previewCanvasRef.current);if(blob){null==setLoader||setLoader(esm.nW6.LOADING);const{status,message,content}=await(0,helpers.XO)(blob,isPublic);status===esm.nW6.SUCCESS?(addNotification({type:types.NotificationType.SUCCESS,message:react.createElement(atoms.T,null,message)}),null==setLoader||setLoader(esm.nW6.SUCCESS),setImagePublicUrl(content.imageUrl),onUploadedImage()):(addNotification({type:types.NotificationType.ERROR,message:react.createElement(atoms.T,null,message)}),null==setLoader||setLoader(esm.nW6.ERROR))}}},disabled:!cropImage||!(null!=cropImage&&cropImage.previewCanvasRef.current),size:"small"},react.createElement(atoms.T,null,"upload image")),react.createElement(molecules.MI,{onCropChange:setCropImage,withAspect:!0,withRotate:!0,withScale:!0}))});UploadNewImageTab.__docgenInfo={description:"",methods:[],displayName:"UploadNewImageTab",props:{copyButtons:{required:!1,tsType:{name:"boolean"},description:""},onPickImageUrl:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { imageThumbnailUrl: string, imageUrl: string }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ imageThumbnailUrl: string, imageUrl: string }",signature:{properties:[{key:"imageThumbnailUrl",value:{name:"string",required:!0}},{key:"imageUrl",value:{name:"string",required:!0}}]}},name:"props"}],return:{name:"void"}}},description:""},onUploadedImage:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const ImageUploaderModal=props=>{const{isOpen,onClose,withPublicImagesTab=!0,copyButtons,onPickImageUrl}=props,[count,setCount]=(0,react.useState)(0),tabHeaders=[];return withPublicImagesTab&&tabHeaders.push({key:"public-images",header:react.createElement(react.Fragment,null,react.createElement(atoms.T,{className:"tt-se"},"public images"),react.createElement(atoms.$n,{icon:react.createElement(server.fNY,null),size:"small",type:"light",onClick:()=>setCount(count+1)})),body:react.createElement(PublicImagesTab,{trigger:count,key:"public-images-tab",copyButtons,onPickImageUrl})}),tabHeaders.push({key:"upload-new-image",header:react.createElement(atoms.T,{className:"tt-se"},"upload new image"),body:react.createElement(UploadNewImageTab,{key:"upload-new-image-tab",copyButtons,onPickImageUrl,onUploadedImage:()=>setCount(count+1)})}),react.createElement(atoms.aF,{isOpen,onClose,className:"modal-upload-image"},react.createElement("div",null,react.createElement(molecules.tU,{tabs:tabHeaders})))};ImageUploaderModal.__docgenInfo={description:"",methods:[],displayName:"ImageUploaderModal",props:{withPublicImagesTab:{required:!1,tsType:{name:"boolean"},description:""},copyButtons:{required:!1,tsType:{name:"boolean"},description:""},onPickImageUrl:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { imageThumbnailUrl: string, imageUrl: string }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ imageThumbnailUrl: string, imageUrl: string }",signature:{properties:[{key:"imageThumbnailUrl",value:{name:"string",required:!0}},{key:"imageUrl",value:{name:"string",required:!0}}]}},name:"props"}],return:{name:"void"}}},description:""}},composes:["ModalProps"]}},"./src/components/organisms/mdMath/MdMathEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MdMathEditor:()=>MdMathEditor});var esm=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js"),lib=__webpack_require__("./node_modules/@milkdown/utils/lib/index.js"),react_lib=__webpack_require__("./node_modules/@milkdown/react/lib/index.js"),react=__webpack_require__("./node_modules/react/index.js"),helpers=__webpack_require__("./src/helpers/index.ts"),settings=__webpack_require__("./src/settings/index.ts"),useI18nStore=__webpack_require__("./src/stores/i18n/useI18nStore.ts"),useUserStore=__webpack_require__("./src/stores/user/useUserStore.ts"),useWebsocketStore=__webpack_require__("./src/stores/websocket/useWebsocketStore.ts"),atoms=__webpack_require__("./src/components/atoms/index.tsx"),server=__webpack_require__("./src/components/atoms/server/index.ts"),molecules=__webpack_require__("./src/components/molecules/index.tsx"),ImageUploaderModal=__webpack_require__("./src/components/organisms/ImageUploader/ImageUploaderModal.tsx"),dist=__webpack_require__("./node_modules/@codemirror/language/dist/index.js"),language_data_dist=__webpack_require__("./node_modules/@codemirror/language-data/dist/index.js"),stex=__webpack_require__("./node_modules/@codemirror/legacy-modes/mode/stex.js"),theme_one_dark_dist=__webpack_require__("./node_modules/@codemirror/theme-one-dark/dist/index.js"),view_dist=__webpack_require__("./node_modules/@codemirror/view/dist/index.js"),code_block=__webpack_require__("./node_modules/@milkdown/components/lib/code-block/index.js"),lib_esm=__webpack_require__("./node_modules/@milkdown/crepe/lib/esm/index.js"),core_lib=__webpack_require__("./node_modules/@milkdown/core/lib/index.js"),plugin_cursor_lib=__webpack_require__("./node_modules/@milkdown/plugin-cursor/lib/index.js"),plugin_listener_lib=__webpack_require__("./node_modules/@milkdown/plugin-listener/lib/index.js"),plugin_trailing_lib=__webpack_require__("./node_modules/@milkdown/plugin-trailing/lib/index.js"),plugin_upload_lib=__webpack_require__("./node_modules/@milkdown/plugin-upload/lib/index.js"),react_codemirror_esm=__webpack_require__("./node_modules/@uiw/react-codemirror/esm/index.js"),viz=__webpack_require__("./node_modules/@viz-js/viz/dist/viz.js"),katex=__webpack_require__("./node_modules/katex/dist/katex.mjs"),mermaid_core=__webpack_require__("./node_modules/mermaid/dist/mermaid.core.mjs"),prosemirror_view_dist=__webpack_require__("./node_modules/prosemirror-view/dist/index.js"),v4=__webpack_require__("./node_modules/uuid/dist/v4.js"),hooks=__webpack_require__("./src/hooks/index.ts"),types=__webpack_require__("./src/types/index.ts");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const defaultLightThemeOption=view_dist.Lz.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),uploader=(setLoader,addNotification)=>async(files,schema)=>{const images=[];for(let i=0;i<files.length;i++){const file=files.item(i);file&&(file.type.includes("image/")&&images.push(file))}setLoader(esm.nW6.LOADING);const nodes=await Promise.all(images.map(async image=>{const{status,message,content}=await(0,helpers.XO)(image,!1);if(status===esm.nW6.SUCCESS){addNotification({type:types.NotificationType.SUCCESS,message:react.createElement(atoms.T,null,message)});const alt=image.name;return schema.nodes.image.createAndFill({src:content.imageUrl,alt})}return addNotification({type:types.NotificationType.ERROR,message:react.createElement(atoms.T,null,message)}),null}));return setLoader(esm.nW6.SUCCESS),nodes},plainText=dist.Tg.define({token:stream=>(stream.skipToEnd(),null)}),plainTextSupport=new dist.Yy(plainText),myLanguages=[dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"C"===language.name)),{},{name:esm.aFm.C,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-cpp/dist/index.js")).then(m=>m.cpp())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"C"===language.name)),{},{name:esm.aFm.C+" asCodeEditor",load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-cpp/dist/index.js")).then(m=>m.cpp())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"C++"===language.name)),{},{name:esm.aFm.CPP,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-cpp/dist/index.js")).then(m=>m.cpp())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"C++"===language.name)),{},{name:esm.aFm.CPP+" asCodeEditor",load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-cpp/dist/index.js")).then(m=>m.cpp())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"Java"===language.name)),{},{name:esm.aFm.JAVA,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-java/dist/index.js")).then(m=>m.java())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"Java"===language.name)),{},{name:esm.aFm.JAVA+" asCodeEditor",load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-java/dist/index.js")).then(m=>m.java())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"Python"===language.name)),{},{name:esm.aFm.PYTHON,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-python/dist/index.js")).then(m=>m.python())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"Python"===language.name)),{},{name:esm.aFm.PYTHON+" asCodeEditor",load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-python/dist/index.js")).then(m=>m.python())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"JavaScript"===language.name)),{},{name:esm.aFm.JAVASCRIPT,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-javascript/dist/index.js")).then(m=>m.javascript())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"JavaScript"===language.name)),{},{name:esm.aFm.JAVASCRIPT+" asCodeEditor",load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-javascript/dist/index.js")).then(m=>m.javascript())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"HTML"===language.name)),{},{name:esm.aFm.HTML,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-html/dist/index.js")).then(m=>m.html())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"JSON"===language.name)),{},{name:esm.aFm.JSON,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-json/dist/index.js")).then(m=>m.json())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"Markdown"===language.name)),{},{name:esm.aFm.MARKDOWN,load:()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,"./node_modules/@codemirror/lang-markdown/dist/index.js")).then(m=>m.markdown())})),dist.t$.of(_objectSpread(_objectSpread({},language_data_dist.e.find(language=>"LaTeX"===language.name)),{},{name:esm.aFm.LATEX,support:new dist.Yy(dist.Tg.define(stex.stex))})),dist.t$.of({name:esm.aFm.MERMAID,alias:["mermaid"],extensions:["mmd","mermaid"],support:plainTextSupport}),dist.t$.of({name:esm.aFm.MERMAID+" asImage",alias:["mermaid"],extensions:["mmd","mermaid"],support:plainTextSupport}),dist.t$.of({name:esm.aFm.DOT,alias:["dot"],extensions:["dot"],load:()=>__webpack_require__.e(75880).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@viz-js/lang-dot/dist/index.js")).then(m=>m.dot())}),dist.t$.of({name:esm.aFm.DOT+" asImage",alias:["dot"],extensions:["dot"],load:()=>__webpack_require__.e(75880).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@viz-js/lang-dot/dist/index.js")).then(m=>m.dot())}),dist.t$.of({name:esm.aFm.TEXT,alias:["plaintext"],extensions:["txt","text"],support:plainTextSupport})];function normalizeNewlines(text){let normalized=text.replace(/\n{3,}/g,"\n\n");return normalized=normalized.replace(/&#x20;/gi," "),normalized.replace(/\n+$/g,"")+"\n"}const MilkdownEditorContent=_ref=>{let{value,onChange,setLoader}=_ref;const onChangeRef=(0,hooks.mU)(onChange),{addNotification}=(0,hooks.Eq)(),theme=(0,hooks.kH)(store=>store.user.settings[esm.mZ_.THEME]),currentMd=(0,react.useRef)(value),triggerRender=(0,react.useMemo)(()=>value===currentMd.current?0:Date.now(),[value]),t=(0,hooks.TH)(store=>store.i18n.t);return(0,react_lib.hG)(root=>new lib_esm.mA({root,defaultValue:value.replace(/```C asCodeEditor/g,"```C&#x20;asCodeEditor").replace(/```CPP asCodeEditor/g,"```CPP&#x20;asCodeEditor").replace(/```JAVA asCodeEditor/g,"```JAVA&#x20;asCodeEditor").replace(/```PYTHON asCodeEditor/g,"```PYTHON&#x20;asCodeEditor").replace(/```JAVASCRIPT asCodeEditor/g,"```JAVASCRIPT&#x20;asCodeEditor").replace(/```MERMAID asImage/g,"```MERMAID&#x20;asImage").replace(/```DOT asImage/g,"```DOT&#x20;asImage"),featureConfigs:{[lib_esm.mA.Feature.CodeMirror]:{renderLanguage(lang,selected){var _CODE_LANGUAGE$label,_CODE_LANGUAGE;const[language,as]=lang.split(" ");return(selected?"✔ ":"")+(null!==(_CODE_LANGUAGE$label=null===(_CODE_LANGUAGE=esm.fO_[language])||void 0===_CODE_LANGUAGE?void 0:_CODE_LANGUAGE.label)&&void 0!==_CODE_LANGUAGE$label?_CODE_LANGUAGE$label:language)+t("asCodeEditor"===as?" (render as code editor)":"asImage"===as?" (render as image)":"")},searchPlaceholder:"Find a language...",noResultText:"No language found"},[lib_esm.mA.Feature.ImageBlock]:{async onUpload(file){setLoader(esm.nW6.LOADING);const{status,message,content}=await(0,helpers.XO)(file,!1);return status===esm.nW6.SUCCESS?(addNotification({type:types.NotificationType.SUCCESS,message:react.createElement(atoms.T,null,message)}),setLoader(esm.nW6.SUCCESS),content.imageUrl):(addNotification({type:types.NotificationType.ERROR,message:react.createElement(atoms.T,null,message)}),setLoader(esm.nW6.ERROR),"")},inlineUploadPlaceholderText:"???"}}}).editor.use(plugin_listener_lib.F_).use(plugin_upload_lib.Se).use(plugin_cursor_lib.Dy).use(plugin_trailing_lib.ZY).config(ctx=>{ctx.get(plugin_listener_lib.Ob).markdownUpdated((_,markdown,prevMarkdown)=>{const fixedMarkdown=normalizeNewlines(markdown);var _onChangeRef$current;fixedMarkdown!==normalizeNewlines(prevMarkdown)&&(null===(_onChangeRef$current=onChangeRef.current)||void 0===_onChangeRef$current||_onChangeRef$current.call(onChangeRef,fixedMarkdown),currentMd.current=fixedMarkdown)}),ctx.update(plugin_upload_lib.wu.key,prev=>_objectSpread(_objectSpread({},prev),{},{uploader:uploader(setLoader,addNotification),uploadWidgetFactory:(pos,spec)=>{const dom=document.createElement("span");return prosemirror_view_dist.NZ.widget(pos,dom,spec)}})),ctx.update(code_block.T4.key,defaultConfig=>_objectSpread(_objectSpread({},defaultConfig),{},{languages:myLanguages,extensions:[(0,react_codemirror_esm.oQ)(),...theme===esm.Sxu.DARK?[theme_one_dark_dist.bM]:[defaultLightThemeOption]],previewToggleButton:()=>"edit",renderPreview:(language,content)=>"latex"===language.toLowerCase()&&content.length>0?function renderLatex(content,options){return katex.default.renderToString(content,_objectSpread(_objectSpread({},options),{},{throwOnError:!1,displayMode:!0}))}(content,{}):"mermaid asimage"===language.toLowerCase()&&content.length>0?function renderMermaid(content){const container=document.createElement("div");return container.className="mermaid",container.innerHTML=content,setTimeout(()=>mermaid_core.A.run({querySelector:".mermaid"}),0),container}(content):"dot asimage"===language.toLowerCase()&&content.length>0?function renderDot(content,t){const container=document.createElement("div"),newId=(0,v4.A)();container.id=newId;const loader=document.createElement("div");return loader.textContent=t("loading graph"),loader.style.fontStyle="italic",container.appendChild(loader),viz.KJ().then(viz=>{try{const container=document.getElementById(newId);container&&(container.innerHTML="",content.split("---").map(content=>{const svg=viz.renderSVGElement(content,{});container.appendChild(svg)}))}catch(error){const container=document.getElementById(newId);if(container){container.innerHTML="";const errorDiv=document.createElement("div");errorDiv.textContent="".concat(t("error rendering graph"),": ").concat((null==error?void 0:error.message)||error),errorDiv.style.color="red",errorDiv.style.whiteSpace="pre-wrap",container.appendChild(errorDiv)}}}).catch(error=>{const container=document.getElementById(newId);if(container){container.innerHTML="";const errorDiv=document.createElement("div");errorDiv.textContent="".concat(t("error initializing Viz.js"),": ").concat((null==error?void 0:error.message)||error),errorDiv.style.color="red",container.appendChild(errorDiv)}}),container}(content,t):null})),ctx.set(core_lib.P5,{bullet:"-"}),ctx.update(plugin_trailing_lib.N9.key,prev=>_objectSpread(_objectSpread({},prev),{},{shouldAppend:()=>!1}))}),[triggerRender,theme,t]),react.createElement("div",{className:"jk-input-milkdown jk-md-math-milkdown-editor jk-md-math wh-100 pn-re jk-br-ie"},react.createElement(react_lib.y5,null))};MilkdownEditorContent.__docgenInfo={description:"",methods:[],displayName:"MilkdownEditorContent",props:{onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(md: string) => void",signature:{arguments:[{type:{name:"string"},name:"md"}],return:{name:"void"}}},description:""},value:{required:!0,tsType:{name:"string"},description:""},setLoader:{required:!0,tsType:{name:"Dispatch",elements:[{name:"SetStateAction",elements:[{name:"Status"}],raw:"SetStateAction<Status>"}],raw:"Dispatch<SetStateAction<Status>>"},description:""},enableImageUpload:{required:!0,tsType:{name:"boolean"},description:""}}};var useJukiNotification=__webpack_require__("./src/hooks/useJukiNotification.tsx");const TextPlainEditorContent=props=>{const{value,onChange,setLoader,enableImageUpload}=props,textareaRef=(0,react.useRef)(null),{addNotification}=(0,useJukiNotification.E)();return react.createElement("div",{className:(0,helpers.xW)("jk-md-math-textarea-editor jk-border-radius-inline"),onPaste:enableImageUpload?async event=>{var _event$clipboardData;const items=null===(_event$clipboardData=event.clipboardData)||void 0===_event$clipboardData?void 0:_event$clipboardData.items;if(items){const imageFiles=[];for(const item of items)if("file"===item.kind){const file=item.getAsFile();file&&file.type.startsWith("image/")&&imageFiles.push(file)}if(imageFiles.length>0){event.stopPropagation(),event.preventDefault();let extraText="";setLoader(esm.nW6.LOADING);for(const imageFile of imageFiles){const{status,message,content}=await(0,helpers.XO)(imageFile,!1);status===esm.nW6.SUCCESS?(addNotification({type:types.NotificationType.SUCCESS,message:react.createElement(atoms.T,null,message)}),extraText+=(extraText?"\n\n":"")+"![image alt](".concat(content.imageUrl,")")):addNotification({type:types.NotificationType.ERROR,message:react.createElement(atoms.T,null,message)})}setLoader(esm.nW6.NONE),(insertText=>{var _textareaRef$current$,_textareaRef$current;const textarea=textareaRef.current;if(!textarea)return;const start=textarea.selectionStart,end=textarea.selectionEnd,text=null!==(_textareaRef$current$=null===(_textareaRef$current=textareaRef.current)||void 0===_textareaRef$current?void 0:_textareaRef$current.value)&&void 0!==_textareaRef$current$?_textareaRef$current$:"",newText=text.substring(0,start)+insertText+text.substring(end);null==onChange||onChange(newText),setTimeout(()=>{textarea.selectionStart=textarea.selectionEnd=start+insertText.length},0)})(extraText)}}}:void 0},react.createElement(atoms.fs,{ref:textareaRef,value,onChange:value=>{null==onChange||onChange(value)}}))};TextPlainEditorContent.__docgenInfo={description:"",methods:[],displayName:"TextPlainEditorContent",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},setLoader:{required:!0,tsType:{name:"Dispatch",elements:[{name:"SetStateAction",elements:[{name:"Status"}],raw:"SetStateAction<Status>"}],raw:"Dispatch<SetStateAction<Status>>"},description:""},enableImageUpload:{required:!0,tsType:{name:"boolean"},description:""}}};const _excluded=["url"];var Mode=function(Mode){return Mode.WYSIWYG="WYSIWYG",Mode.TEXT_PLAIN="TEXT_PLAIN",Mode}(Mode||{}),ChatRole=function(ChatRole){return ChatRole.IA="IA",ChatRole.USER="USER",ChatRole}(ChatRole||{});const IAModalContent=()=>{const[value,setValue]=(0,react.useState)(""),[chat,setChat]=(0,react.useState)([]),websocket=(0,useWebsocketStore.q)(store=>store.websocket),connectionId=(0,useWebsocketStore.q)(store=>store.connectionId),sessionId=(0,useUserStore.k)(store=>store.user.sessionId),t=(0,useI18nStore.T)(store=>store.i18n.t);return(0,react.useEffect)(()=>{const event={event:esm.ad3.SUBSCRIBE_CHAT_COMPLETIONS_DATA,sessionId};return websocket.subscribe(event,data=>{(0,esm.AK0)(data)&&setChat(prevState=>[...prevState,...data.content.choices.map(_ref=>{let{message}=_ref;return{content:message.content,user:ChatRole.IA}})])}),()=>{websocket.unsubscribeAll(event)}},[sessionId,websocket]),react.createElement("div",{className:"jk-pg jk-col gap stretch"},react.createElement("h3",null,react.createElement(atoms.T,null,"Juki Redactor Agent")),react.createElement("div",{className:"jk-col gap"},chat.map(chat=>react.createElement("div",{className:"jk-pg-sm bc-hl jk-br-ie",style:{maxWidth:"60%",whiteSpace:"break-spaces",alignSelf:chat.user===ChatRole.IA?"start":"end"}},chat.content))),react.createElement("div",{className:"jk-row gap nowrap wh-100 sticky-bottom jk-pg-sm bc-we jk-br-ie stretch"},react.createElement(atoms.fs,{value,onChange:setValue,placeholder:(0,helpers.Zb)(t("ask something"))}),react.createElement(molecules.mT,{icon:react.createElement(server.qxZ,null),onClick:async setLoader=>{setLoader(esm.nW6.LOADING);try{const _jukiApiManager$API_V=settings.Z.API_V1.ia.chatCompletions({body:{content:value,connectionId}}),{url}=_jukiApiManager$API_V,options=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==e.indexOf(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],-1===t.indexOf(o)&&{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_jukiApiManager$API_V,_excluded),request=(0,helpers.Hu)(await(0,helpers.zb)(url,options));null!=request&&request.success?(setChat(prevState=>[...prevState,{content:value,user:ChatRole.USER}]),setValue(""),setLoader(esm.nW6.SUCCESS)):((0,esm.OPF)("run code request failed",{request}),setLoader(esm.nW6.ERROR))}catch(error){(0,esm.OPF)("error on run code",{error}),setLoader(esm.nW6.ERROR)}}})))},Toolbar=_ref2=>{let{enableDownload,enableTextPlain,setMode,mode,enableIA}=_ref2;const[_,getInstance]=(0,react_lib.Nj)(),[openModalIA,setOpenModalIA]=(0,react.useState)(!1);return react.createElement(react.Fragment,null,react.createElement(atoms.aF,{isOpen:openModalIA,onClose:()=>setOpenModalIA(!1),closeIcon:!0},react.createElement(IAModalContent,null)),react.createElement(molecules.GK,{actionButtons:[...enableTextPlain?[{icon:mode===Mode.TEXT_PLAIN?react.createElement(server.WkB,null):react.createElement(server.loI,null),buttons:[{icon:mode===Mode.TEXT_PLAIN?react.createElement(server.WkB,null):react.createElement(server.loI,null),label:mode===Mode.TEXT_PLAIN?react.createElement(atoms.T,null,"WYSIWYG"):react.createElement(atoms.T,null,"view as text plain"),onClick:()=>setMode(mode===Mode.TEXT_PLAIN?Mode.WYSIWYG:Mode.TEXT_PLAIN)}]}]:[],...enableDownload?[{icon:react.createElement(server.s3U,null),buttons:[{icon:react.createElement(server.s3U,null),label:react.createElement(atoms.T,null,"md"),onClick:()=>{var _getInstance$action,_getInstance;return(0,helpers.IZ)(new Blob([null!==(_getInstance$action=null===(_getInstance=getInstance())||void 0===_getInstance?void 0:_getInstance.action((0,lib.up)()))&&void 0!==_getInstance$action?_getInstance$action:""],{type:"text/plain"}),"file.md")}}]}]:[],...enableIA?[{icon:react.createElement(server.myb,null),buttons:[{icon:react.createElement(server.myb,null),label:react.createElement(atoms.T,null,"Juki Redactor Agent"),onClick:()=>setOpenModalIA(!openModalIA)}]}]:[]],placement:"rightTop"}))},ImageUploader=_ref3=>{let{mode}=_ref3;const[isLoading,getInstance]=(0,react_lib.Nj)(),[openImageModal,setOpenImageModal]=(0,react.useState)(!1);return react.createElement(ImageUploaderModal.ImageUploaderModal,{isOpen:openImageModal,onClose:()=>setOpenImageModal(!1),copyButtons:!0,onPickImageUrl:_ref4=>{let{imageUrl}=_ref4;if(mode===Mode.TEXT_PLAIN);else if(mode===Mode.WYSIWYG){if(isLoading)return;const editor=getInstance();if(!editor)return;editor.action((0,lib.Yr)("![image](".concat(imageUrl,")"))),setOpenImageModal(!1)}}})},MdMathEditor=_ref5=>{let{value,onChange,className,enableTextPlain=!1,enableDownload=!1,enableImageUpload=!1,enableIA=!1}=_ref5;const[loader,setLoader]=(0,react.useState)(esm.nW6.NONE),[mode,setMode]=(0,react.useState)(Mode.WYSIWYG);return react.createElement(react_lib.pb,null,react.createElement("div",{className:(0,helpers.xW)("jk-md-math-editor wh-100 pn-re",className)},loader===esm.nW6.LOADING&&react.createElement(server.QdK,null),loader===esm.nW6.LOADING&&react.createElement("div",{className:"jk-loader-layer pn-ae jk-col"},react.createElement("div",{className:"jk-loader-layer pn-ae jk-overlay-backdrop",style:{opacity:.8,zIndex:1}}),react.createElement("div",{className:"jk-row",style:{zIndex:1,position:"sticky",margin:"0 auto",top:0,bottom:"50%",transform:"translate(0, 100%)"}},react.createElement("div",{className:"jk-row bc-we jk-pg-sm jk-br-ie",style:{alignItems:"baseline"}},react.createElement(atoms.T,{className:"tt-se"},"uploading images"),"  ",react.createElement("div",{className:"dot-flashing"})))),react.createElement(Toolbar,{enableTextPlain,enableDownload,enableIA,setMode,mode}),react.createElement(ImageUploader,{mode}),mode===Mode.WYSIWYG&&react.createElement(MilkdownEditorContent,{value,onChange,setLoader,enableImageUpload}),mode===Mode.TEXT_PLAIN&&react.createElement(TextPlainEditorContent,{value,onChange,setLoader,enableImageUpload})))};MdMathEditor.__docgenInfo={description:"",methods:[],displayName:"MdMathEditor",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},informationButton:{required:!1,tsType:{name:"boolean"},description:""},enableTextPlain:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},enableImageUpload:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},enableDownload:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},enableIA:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:""}}}}}]);