"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[57995],{"./src/components/organisms/worksheet/WorksheetEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WorksheetEditor:()=>WorksheetEditor});var _juki_team_commons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_hooks_useStableState__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/hooks/useStableState.ts"),_stores_router_useRouterStore__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/stores/router/useRouterStore.ts"),_ContentsSectionHeader__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/organisms/worksheet/ContentsSectionHeader.tsx"),_sheets_WorksheetBodies__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/organisms/worksheet/sheets/WorksheetBodies.tsx");const WorksheetEditor=props=>{const{worksheet:{content,quiz:{enable:quizEnable},key:worksheetKey,user:{isManager}},setContent,page:initialPage,subPage:initialSubPage,onPageChange:initialOnPageChange,lastPageChildren,readOnly=!1}=props,setSearchParams=(0,_stores_router_useRouterStore__WEBPACK_IMPORTED_MODULE_3__.I)(state=>state.setSearchParams),[page,_setPage]=(0,_hooks_useStableState__WEBPACK_IMPORTED_MODULE_2__.I)(null!=initialPage?initialPage:1),[subPage,_setSubPage]=(0,_hooks_useStableState__WEBPACK_IMPORTED_MODULE_2__.I)(null!=initialSubPage?initialSubPage:1),onPageChange=null!=initialOnPageChange?initialOnPageChange:(page,subPage,entries)=>{_setPage(page),_setSubPage(subPage),setSearchParams(entries)},sheetsInPages=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>(0,_juki_team_commons__WEBPACK_IMPORTED_MODULE_0__.bs0)(content),[content]);return react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",{className:"jk-col gap nowrap worksheet-editor-container center top"},react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",{className:"jk-row"},react__WEBPACK_IMPORTED_MODULE_1__.createElement(_ContentsSectionHeader__WEBPACK_IMPORTED_MODULE_4__.ContentsSectionHeader,{page,subPage,onPageChange,sheetsInPages})),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_sheets_WorksheetBodies__WEBPACK_IMPORTED_MODULE_5__.t,{sheetsInPages,setSheets:setContent,isSolvable:quizEnable,readOnly,isEditor:isManager,worksheetKey,page,subPage,onPageChange,lastPageChildren}))};WorksheetEditor.__docgenInfo={description:"",methods:[],displayName:"WorksheetEditor",props:{setContent:{required:!0,tsType:{name:"signature",type:"function",raw:"(content: BodyWorksheetType[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"BodyWorksheetType[]"},name:"content"}],return:{name:"void"}}},description:""}},composes:["Omit"]}},"./src/components/organisms/worksheet/sheets/WorksheetBodies.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>WorksheetBodies});var esm=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js"),react=__webpack_require__("./node_modules/react/index.js"),helpers=__webpack_require__("./src/helpers/index.ts"),types=__webpack_require__("./src/types/index.ts"),atoms=__webpack_require__("./src/components/atoms/index.tsx"),server=__webpack_require__("./src/components/atoms/server/index.ts"),MdMathEditor=__webpack_require__("./src/components/organisms/mdMath/MdMathEditor.tsx"),EditSheetModal=__webpack_require__("./src/components/organisms/worksheet/sheets/EditSheetModal.tsx"),AddNewChild=__webpack_require__("./src/components/organisms/worksheet/sheets/AddNewChild.tsx"),WorksheetNode=__webpack_require__("./src/components/organisms/worksheet/sheets/WorksheetNode.tsx");const WorksheetBody=(0,react.forwardRef)(function Cmp(props,ref){const{sheet=[],setSheet,userResults,readOnly,isSolvable,worksheetKey,children,asSlides}=props;return react.createElement("div",{className:"jk-col gap center nowrap wh-100",id:"jk-worksheet-body",ref},react.Children.toArray(sheet.map((chunk,index)=>react.createElement(WorksheetNode.B,{key:chunk.id,sheet,setSheet,userResults,readOnly,isSolvable,worksheetKey,asSlides,index,length:sheet.length}))),!sheet.length&&setSheet&&react.createElement("div",{className:"jk-row gap extend nowrap center jk-divider tiny"},react.createElement(AddNewChild.Y,{index:0,setSheet,mdSheet:!0,codeEditorSheet:!0,graphSheet:!0,quizProblemSheet:!0,quizOptionsSheetType:!0,pageDivider:!0,compacted:!0,floatToolbarPlacement:"center bottom"})),children)});function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}WorksheetBody.__docgenInfo={description:"",methods:[],displayName:"WorksheetBody",props:{sheet:{required:!0,tsType:{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"BodyWorksheetType[]"},description:""},setSheet:{required:!1,tsType:{name:"Dispatch",elements:[{name:"SetStateAction",elements:[{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"T[]"}],raw:"SetStateAction<T[]>"}],raw:"Dispatch<SetStateAction<T[]>>"},description:""},userResults:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  data?: WorksheetUserSubmissionsResponseDTO,\n  isLoading?: boolean,\n  validating?: boolean,\n  mutate?: KeyedMutator<any>,\n}",signature:{properties:[{key:"data",value:{name:"WorksheetUserSubmissionsResponseDTO",required:!1}},{key:"isLoading",value:{name:"boolean",required:!1}},{key:"validating",value:{name:"boolean",required:!1}},{key:"mutate",value:{name:"KeyedMutator",elements:[{name:"any"}],raw:"KeyedMutator<any>",required:!1}}]}},description:""},readOnly:{required:!0,tsType:{name:"boolean"},description:""},isSolvable:{required:!0,tsType:{name:"boolean"},description:""},isEditor:{required:!1,tsType:{name:"boolean"},description:""},worksheetKey:{required:!0,tsType:{name:"string"},description:""},asSlides:{required:!1,tsType:{name:"boolean"},description:""}}};const WorksheetBodies=props=>{var _sheetsInPages,_sheetsInPages2;const{sheetsInPages,isEditor,setSheets,userResults,isSolvable,worksheetKey,page,onPageChange,lastPageChildren,readOnly}=props,containerRef=(0,react.useRef)(null),[modal,setModal]=(0,react.useState)(!1),setPageSheets=(0,react.useCallback)((newPageHeader,newPageSheetContent)=>{const newSheetsInPages=[...sheetsInPages];newSheetsInPages[page-1]={header:null!=newPageHeader?newPageHeader:newSheetsInPages[page-1].header,content:newPageSheetContent};const newSheets=[];for(const{header,content}of newSheetsInPages)newSheets.push(header,...content);null==setSheets||setSheets(newSheets)},[page,setSheets,sheetsInPages]),setSheet=(0,react.useCallback)(value=>{const newPageSheetContent="function"==typeof value?value(sheetsInPages[page-1].content):value;setPageSheets(null,newPageSheetContent)},[page,setPageSheets,sheetsInPages]),pages=sheetsInPages.length;return react.createElement("div",{className:(0,helpers.xW)("jk-col gap nowrap top stretch extend worksheet-bodies wh-100",{"is-solvable":isSolvable})},setSheets&&react.createElement("div",{className:"jk-row gap extend nowrap",key:"".concat(page)},react.createElement(atoms.T,{className:"tt-se"},"page title"),react.createElement(MdMathEditor.MdMathEditor,{value:null===(_sheetsInPages=sheetsInPages[page-1])||void 0===_sheetsInPages?void 0:_sheetsInPages.header.title,onChange:title=>{setPageSheets(_objectSpread(_objectSpread({},sheetsInPages[page-1].header),{},{title}),sheetsInPages[page-1].content)}}),react.createElement(atoms.$n,{"data-tooltip-id":"jk-tooltip","data-tooltip-content":"remove page divider",icon:react.createElement(server.d7y,null),onClick:()=>{const newSheetsInPages=[...sheetsInPages],newSheets=[];if(page===pages){let i=0;for(const{header,content}of newSheetsInPages)i!==page-1&&newSheets.push(header),newSheets.push(...content),i++;setSheets(newSheets)}else{let i=0,contentDeleted=null;for(const{header,content}of newSheetsInPages)i===page-1?contentDeleted=content:(newSheets.push(header),null!==contentDeleted&&(newSheets.push(...contentDeleted),contentDeleted=null),newSheets.push(...content)),i++;setSheets(newSheets)}page>1&&page===pages&&onPageChange(Math.max(page,1),1,{name:types.QueryParamKey.PAGE_FOCUS,value:"jk-worksheet-viewer-container"})},disabled:pages<=1}),react.createElement(atoms.$n,{icon:react.createElement(server.Zes,{size:"small"}),onClick:()=>setModal(!0)})),setSheets&&react.createElement(EditSheetModal.j,{isOpen:modal,onClose:()=>setModal(!1),content:sheetsInPages[page-1].content,setContent:setSheet,isValid:value=>{if((0,esm.UWh)(value)){const values=JSON.parse(value);if(Array.isArray(values))return values.every(value=>(0,esm.A1h)(value)||(0,esm.c0Y)(value)||(0,esm.FKY)(value)||(0,esm.kS$)(value))}return!1}}),react.createElement(WorksheetBody,{sheet:null===(_sheetsInPages2=sheetsInPages[page-1])||void 0===_sheetsInPages2?void 0:_sheetsInPages2.content,setSheet:setSheets?setSheet:void 0,userResults,readOnly:!!readOnly,isSolvable,isEditor,worksheetKey,ref:containerRef}),page<pages?react.createElement(atoms.$n,{className:"next-button",type:"light",onClick:()=>onPageChange(page+1,1,{name:types.QueryParamKey.PAGE_FOCUS,value:"jk-worksheet-viewer-container"}),expand:!0},react.createElement(atoms.T,{className:"tt-se"},"next page")):lastPageChildren)};WorksheetBodies.__docgenInfo={description:"",methods:[],displayName:"WorksheetBodies",props:{sheetsInPages:{required:!0,tsType:{name:"WorksheetsInPages"},description:""},setSheets:{required:!1,tsType:{name:"Dispatch",elements:[{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"BodyWorksheetType[]"}],raw:"Dispatch<BodyWorksheetType[]>"},description:""},userResults:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  data?: WorksheetUserSubmissionsResponseDTO,\n  isLoading?: boolean,\n  validating?: boolean,\n  mutate?: KeyedMutator<any>,\n}",signature:{properties:[{key:"data",value:{name:"WorksheetUserSubmissionsResponseDTO",required:!1}},{key:"isLoading",value:{name:"boolean",required:!1}},{key:"validating",value:{name:"boolean",required:!1}},{key:"mutate",value:{name:"KeyedMutator",elements:[{name:"any"}],raw:"KeyedMutator<any>",required:!1}}]}},description:""},isSolvable:{required:!0,tsType:{name:"boolean"},description:""},isEditor:{required:!0,tsType:{name:"boolean"},description:""},worksheetKey:{required:!0,tsType:{name:"string"},description:""},page:{required:!0,tsType:{name:"number"},description:""},subPage:{required:!0,tsType:{name:"number"},description:""},onPageChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newPage: number, newSubPage: number, entries: Parameters<SetSearchParamsType>[0]) => void",signature:{arguments:[{type:{name:"number"},name:"newPage"},{type:{name:"number"},name:"newSubPage"},{type:{name:"Parameters[0]",raw:"Parameters<SetSearchParamsType>[0]"},name:"entries"}],return:{name:"void"}}},description:""},lastPageChildren:{required:!1,tsType:{name:"ReactNode"},description:""},readOnly:{required:!0,tsType:{name:"boolean"},description:""}}}}}]);