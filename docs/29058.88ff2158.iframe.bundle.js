"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[29058],{"./src/components/templates/submission/SubmitView.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SubmitView:()=>SubmitView});var react=__webpack_require__("./node_modules/react/index.js"),settings=__webpack_require__("./src/settings/index.ts"),atoms=__webpack_require__("./src/components/atoms/index.tsx"),molecules=__webpack_require__("./src/components/molecules/index.tsx"),server=__webpack_require__("./src/components/server/index.ts"),esm=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js"),helpers=__webpack_require__("./src/helpers/index.ts"),submission=__webpack_require__("./src/helpers/submission.ts"),hooks=__webpack_require__("./src/hooks/index.ts"),useUserStore=__webpack_require__("./src/stores/user/useUserStore.ts"),types=__webpack_require__("./src/types/index.ts"),organisms=__webpack_require__("./src/components/organisms/index.tsx"),SubmissionRejudgeButton=__webpack_require__("./src/components/templates/submission/SubmissionRejudgeButton.tsx"),diff2html=__webpack_require__("./node_modules/diff2html/lib-esm/diff2html.js"),lib_types=__webpack_require__("./node_modules/diff2html/lib/types.js"),useJukiUI=__webpack_require__("./src/hooks/useJukiUI.tsx"),useI18nStore=__webpack_require__("./src/stores/i18n/useI18nStore.ts"),SubmissionMemory=__webpack_require__("./src/components/templates/submission/commons/SubmissionMemory.tsx"),SubmissionTime=__webpack_require__("./src/components/templates/submission/commons/SubmissionTime.tsx"),SubmissionVerdict=__webpack_require__("./src/components/templates/submission/commons/SubmissionVerdict.tsx");const DiffViewButton=_ref=>{let{diffInput,croppedDiff,isProblemEditor}=_ref;const[isOpen,setIsOpen]=(0,react.useState)(!1),[diff,setDiff]=(0,react.useState)(""),userPreferredTheme=(0,useUserStore.k)(state=>state.user.settings[esm.mZ_.THEME]),t=(0,useI18nStore.T)(state=>state.i18n.t);(0,react.useEffect)(()=>{if(isOpen)if(/\$\/.*\.out/.test(diffInput)||/\$\/.*\.judge.out/.test(diffInput)){let diff=diffInput;isProblemEditor||(diff=function hideTestKey(input,text){return input.replace(/\$\S+\.out/,"$/".concat(text,".out")).replace(/\$\S+\.judge\.out/g,"$/".concat(text,".judge.out"))}(diffInput,t("file")));const diffHtml=diff2html.qy(diff,{drawFileList:!1,matching:"words",renderNothingWhenEmpty:!1,colorScheme:userPreferredTheme===esm.Sxu.DARK?lib_types.d7.DARK:lib_types.d7.LIGHT,outputFormat:"side-by-side"});setDiff(diffHtml)}else setDiff(diffInput)},[diffInput,userPreferredTheme,isOpen,isProblemEditor,t]);const left=diffInput.length-diffInput.indexOf("No newline at end of file")>26;return react.createElement(react.Fragment,null,react.createElement(atoms.$n,{"data-tooltip-id":"jk-tooltip","data-tooltip-content":"view diff",icon:react.createElement(server.ITR,null),size:"tiny",type:"light",onClick:()=>setIsOpen(!0)}),react.createElement(atoms.aF,{isOpen,onClose:()=>setIsOpen(!1),closeIcon:!0,expand:!0},react.createElement("div",{className:"jk-col stretch gap jk-pg-lg diff-body-modal"},react.createElement("div",null,croppedDiff&&react.createElement(atoms.T,{className:"tt-se cr-er fw-bd"},"only the first 1000 characters of the difference are being displayed")),react.createElement("div",{className:"wh-100",dangerouslySetInnerHTML:{__html:diff}}),diffInput.includes("No newline at end of file")&&react.createElement("div",{className:"jk-row block center"},react.createElement("div",{className:"bc-er cr-we"},left&&react.createElement(atoms.T,null,"no newline at end of file")),react.createElement("div",{className:"bc-er cr-we"},!left&&react.createElement(atoms.T,null,"no newline at end of file"))))))},SubmissionGroupInfo=props=>{const{groupKey,problemScoringMode,timeUsed,memoryUsed,verdict,points,testCases,submitId,isProblemEditor}=props,{viewPortSize}=(0,useJukiUI.p)(),rowHeight="sm"===viewPortSize||"md"===viewPortSize?70:40,testCasesString=JSON.stringify(testCases),renderRow=(0,react.useCallback)(index=>{var _testCase$points;const testCase=JSON.parse(testCasesString)[index];return react.createElement("div",{className:"jk-row extend block gap jk-table-inline-row",key:index,style:{borderBottom:"1px solid var(--t-color-gray-5)",height:"100%",padding:0}},isProblemEditor?react.createElement("div",{"data-tooltip-id":"jk-tooltip","data-tooltip-content":testCase.testCaseKey,"data-tooltip-t-class-name":"ws-np",className:"jk-row",style:{flex:.4}},index+1):react.createElement("div",{className:"jk-row",style:{flex:.4}},index+1),react.createElement("div",{className:"jk-row gap center nowrap",style:{flex:2}},react.createElement(SubmissionVerdict.y,{verdict:testCase.verdict,submitId}),testCase.diff&&react.createElement(DiffViewButton,{croppedDiff:testCase.croppedDiff,diffInput:testCase.diff.replaceAll(testCase.testCaseKey+".judge.out","A").replaceAll(testCase.testCaseKey+".out","B"),isProblemEditor})),problemScoringMode===esm.MEM.PARTIAL&&react.createElement("div",{className:"jk-row"},null===(_testCase$points=testCase.points)||void 0===_testCase$points?void 0:_testCase$points.toFixed(3)),react.createElement("div",{className:"jk-row center ws-np nowrap"},react.createElement(SubmissionTime.u,{verdict:testCase.verdict,timeUsed:testCase.timeUsed})),react.createElement("div",{className:"jk-row center ws-np nowrap"},react.createElement(SubmissionMemory.m,{verdict:testCase.verdict,memoryUsed:testCase.memoryUsed})),react.createElement("div",{className:(0,helpers.xW)("jk-row center gap",{"cr-er fw-bd":0!==(null==testCase?void 0:testCase.exitCode)})},testCase.exitCode))},[isProblemEditor,problemScoringMode,submitId,testCasesString]);return react.createElement(atoms.SD,{header:_ref2=>{let{isOpen,toggle}=_ref2;return react.createElement("div",{className:(0,helpers.xW)("jk-row extend block gap jk-table-inline-row jk-pg-md group-info",{"fw-br":isOpen})},react.createElement("div",{className:"jk-row left nowrap"},!!testCases.length&&react.createElement(react.Fragment,null,react.createElement(server.Hd_,{onClick:toggle,rotate:isOpen?0:180,className:"link"})," "),+groupKey?problemScoringMode===esm.MEM.SUBTASK?react.createElement(react.Fragment,null,react.createElement(atoms.T,{className:"tt-se ws-np"},"subtask")," ",groupKey):problemScoringMode===esm.MEM.PARTIAL?react.createElement(react.Fragment,null,react.createElement(atoms.T,{className:"tt-se ws-np"},"group")," ",groupKey):react.createElement(atoms.T,{className:"tt-se"},"test cases"):react.createElement(atoms.T,{className:"tt-se"},"sample cases")),react.createElement("div",{className:"jk-row center gap nowrap",style:{flex:3}},react.createElement(SubmissionVerdict.y,{verdict,points,submitId})),(problemScoringMode===esm.MEM.SUBTASK||problemScoringMode===esm.MEM.PARTIAL)&&react.createElement("div",{className:"jk-row center"},+points.toFixed(4)),react.createElement("div",{className:"jk-row center"},react.createElement(SubmissionTime.u,{timeUsed,verdict})),react.createElement("div",{className:"jk-row center"},react.createElement(SubmissionMemory.m,{verdict,memoryUsed})))},className:"wh-100 tx-s"},react.createElement("div",{className:(0,helpers.xW)("jk-row extend group-info-details")},react.createElement("div",{className:(0,helpers.xW)("jk-row extend block gap jk-table-inline-row fw-bd")},react.createElement("div",{className:"jk-row",style:{flex:.4}},react.createElement(atoms.T,null,"#")),react.createElement("div",{className:"jk-row center gap",style:{flex:2}},react.createElement(atoms.T,{className:"tt-se"},"verdict")),problemScoringMode===esm.MEM.PARTIAL&&react.createElement("div",{className:"jk-row center gap"},react.createElement(atoms.T,{className:"tt-se"},"points")),react.createElement("div",{className:"jk-row center gap"},react.createElement(atoms.T,{className:"tt-se"},"time")),react.createElement("div",{className:"jk-row center gap"},react.createElement(atoms.T,{className:"tt-se"},"memory")),react.createElement("div",{className:"jk-row center gap"},react.createElement(atoms.T,{className:"tt-se"},"exit code"))),react.createElement("div",{style:{width:"100%",height:rowHeight*Math.min(testCases.length,3)+1},className:(0,helpers.xW)({"top-bottom-inset-shadow":testCases.length>3})},react.createElement(atoms.$0,{size:testCases.length,rowHeight,renderRow}))))};SubmissionGroupInfo.__docgenInfo={description:"",methods:[],displayName:"SubmissionGroupInfo",props:{isProblemEditor:{required:!0,tsType:{name:"boolean"},description:""},groupKey:{required:!0,tsType:{name:"number"},description:""},problemScoringMode:{required:!0,tsType:{name:"ProblemScoringMode"},description:""},timeUsed:{required:!0,tsType:{name:"number"},description:""},memoryUsed:{required:!0,tsType:{name:"number"},description:""},verdict:{required:!0,tsType:{name:"ProblemVerdict"},description:""},points:{required:!0,tsType:{name:"number"},description:""},testCases:{required:!0,tsType:{name:"Array",elements:[{name:"TestCaseResultType"}],raw:"TestCaseResultType[]"},description:""},submitId:{required:!0,tsType:{name:"string"},description:""}}};var SubmissionListenerVerdict=__webpack_require__("./src/components/templates/submission/commons/SubmissionListenerVerdict.tsx");const DisplayGridData=_ref=>{let{data}=_ref;return react.createElement("div",{className:"jk-table-grid wh-100"},data.map(_ref2=>{let{title,content}=_ref2;return react.createElement("div",{className:"jk-col bc-we jk-pg-xsm jk-br-ie"},react.createElement("div",null,title),react.createElement("div",null,content))}))},SubmitViewContent=_ref3=>{var _data$contents$find;let{submit}=_ref3;const{runId,submitId,problem:{isManager,isAdministrator,scoringMode:problemScoringMode,key:problemKey},user:{nickname,canViewSourceCode},language,sourceCode,memoryUsed,timeUsed,verdict,points,status,timestamp,testCaseResults,verdictByGroups,compilationResult,judgmentTime,contest}=submit,isProblemEditor=isManager||isAdministrator,date=new Date(timestamp),testCasesByGroup={};(testCaseResults||[]).forEach(testCase=>{const group=testCase.group?problemScoringMode===esm.MEM.SUBTASK?testCase.group:1:0;testCasesByGroup[group]?testCasesByGroup[group].push(testCase):testCasesByGroup[group]=[testCase]});const compilationFailed=verdict!==esm.npq.NONE&&verdict!==esm.npq.PENDING&&!1===(null==compilationResult?void 0:compilationResult.success),{components:{Link}}=(0,hooks.p1)(),userCompanyKey=(0,useUserStore.k)(state=>state.company.key),origin=(0,helpers._0)(submit.problem.company.key,userCompanyKey),isLeetCode=submit.problem.judge.key===esm.IhU.LEETCODE,{data}=(0,hooks.Ls)(settings.Z.API_V1.judge.getSummaryList().url),getSubmissionUrl=null!=data&&data.success?null===(_data$contents$find=data.contents.find(_ref4=>{let{key}=_ref4;return key===esm.IhU.LEETCODE}))||void 0===_data$contents$find?void 0:_data$contents$find.getSubmissionUrl:"",externalUrl=new Function("problemKey","submissionId","username","submissionRunId",getSubmissionUrl||"return ''")(problemKey,submitId,nickname,runId);return react.createElement("div",{className:"jk-col stretch gap wh-100"},react.createElement(atoms.SD,{header:_ref5=>{var _CODE_LANGUAGE$langua;let{isOpen,toggle}=_ref5;return react.createElement(DisplayGridData,{data:[{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"nickname"),content:react.createElement(organisms.A1,{imageUrl:submit.user.imageUrl,nickname:submit.user.nickname})},{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"problem"),content:contest?react.createElement(Link,{href:settings.L.JUDGE(origin).contests.view({key:contest.key,tab:types.ContestTab.PROBLEMS,subTab:contest.problemIndex}),target:origin?"_blank":void 0,className:"link"},react.createElement("div",null,submit.problem.key)):react.createElement(Link,{href:settings.L.JUDGE(origin).problems.view({key:submit.problem.key}),target:origin?"_blank":void 0,className:"link"},react.createElement("div",null,submit.problem.key))},{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"language"),content:react.createElement("div",{className:"jk-row"},(null===(_CODE_LANGUAGE$langua=esm.fO_[language])||void 0===_CODE_LANGUAGE$langua?void 0:_CODE_LANGUAGE$langua.label)||language)},{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"verdict"),content:react.createElement("div",{className:"jk-row gap center"},react.createElement(SubmissionListenerVerdict.g,{verdict,points,status,submitId}),compilationFailed&&react.createElement(server.Hd_,{onClick:toggle,rotate:isOpen?0:180,className:"link"}))},...(0,submission.J)(verdict)?[{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"time used"),content:react.createElement(SubmissionTime.u,{timeUsed,verdict})},{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"memory used"),content:react.createElement(SubmissionMemory.m,{memoryUsed,verdict})}]:[],{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"date"),content:react.createElement(atoms.cL,{date,twoLines:!0})},...isProblemEditor?[{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},judgmentTime>0?"judgment time":"judging"),content:react.createElement("div",{className:"jk-row"},"~ ",judgmentTime>0?react.createElement(molecules.M4,{currentTimestamp:judgmentTime,interval:0,literal:!0,type:"seconds"}):react.createElement(molecules.M4,{currentTimestamp:Date.now()- -judgmentTime,interval:1e3,literal:!0,type:"seconds"}))},{title:react.createElement(atoms.T,{className:"fw-bd tt-se"},"actions"),content:react.createElement(SubmissionRejudgeButton.SubmissionRejudgeButton,{submissionId:submit.submitId})}]:[]]})},startsShowing:compilationFailed,className:"wh-100"},!(null==compilationResult||!compilationResult.err)&&react.createElement("div",{className:"submission-stderr-content jk-text-stderr tx-t bc-er cr-we jk-pg-xsm"},null==compilationResult?void 0:compilationResult.err)),(verdictByGroups&&!!Object.keys(verdictByGroups).length||testCasesByGroup&&!!Object.keys(testCasesByGroup).length)&&react.createElement("div",{className:"wh-100"},react.createElement("div",{className:"tx-l fw-bd cr-pd"},react.createElement(atoms.T,{className:"tt-se"},problemScoringMode===esm.MEM.SUBTASK?"information by subtasks":problemScoringMode===esm.MEM.PARTIAL?"information by groups":"sample and test case information")),react.createElement("div",{className:"jk-col gap"},react.createElement("div",{className:"jk-row extend block gap jk-table-inline-header"},react.createElement("div",{className:"jk-row"},react.createElement(atoms.T,{className:"tt-se"},problemScoringMode===esm.MEM.SUBTASK?"groups":"")),react.createElement("div",{className:"jk-row",style:{flex:3}},react.createElement(atoms.T,{className:"tt-se"},"verdict")),(problemScoringMode===esm.MEM.SUBTASK||problemScoringMode===esm.MEM.PARTIAL)&&react.createElement("div",{className:"jk-row"},react.createElement(atoms.T,{className:"tt-se"},"points")),react.createElement("div",{className:"jk-row"},react.createElement(atoms.T,{className:"tt-se"},"time")),react.createElement("div",{className:"jk-row"},react.createElement(atoms.T,{className:"tt-se"},"memory")))),verdictByGroups&&Object.keys(verdictByGroups).length?react.createElement("div",{className:"jk-col jk-border-radius-inline"},Object.entries(verdictByGroups).map(_ref6=>{let[groupKey,result]=_ref6;return react.createElement(SubmissionGroupInfo,{key:groupKey,groupKey:+groupKey,isProblemEditor,problemScoringMode,memoryUsed:result.memoryUsed,verdict:result.verdict,timeUsed:result.timeUsed,points:result.points,testCases:testCasesByGroup[result.group]||[],submitId})})):react.createElement("div",{className:"jk-col jk-border-radius-inline"},Object.entries(testCasesByGroup).map(_ref7=>{let[groupKey,result]=_ref7;return react.createElement(SubmissionGroupInfo,{key:groupKey,groupKey:+groupKey,isProblemEditor,problemScoringMode,memoryUsed:0,verdict,timeUsed:0,points:problemScoringMode===esm.MEM.PARTIAL?+result.reduce((sum,testCase)=>sum+testCase.points,0).toFixed(3):0,testCases:result,submitId})}))),!!canViewSourceCode&&!isLeetCode&&react.createElement("div",{className:"jk-col stretch wh-100"},react.createElement("div",{className:"tx-l fw-bd cr-pd"},react.createElement(atoms.T,{className:"tt-se"},"source code")),react.createElement("div",{className:"submission-info-code-source"},react.createElement(molecules.Cv,{code:sourceCode,language,lineNumbers:!0}))),isLeetCode&&react.createElement("div",{className:"jk-row wh-100"},react.createElement(Link,{href:externalUrl,target:"_blank"},react.createElement(atoms.$n,null,react.createElement(atoms.T,{className:"tt-se"},"view submission on LeetCode"),react.createElement(server.PHA,null)))))};SubmitViewContent.__docgenInfo={description:"",methods:[],displayName:"SubmitViewContent",props:{submit:{required:!0,tsType:{name:"SubmissionDataResponseDTO"},description:""}}};const SubmitView=_ref=>{let{submitId,triggerFetch}=_ref;return react.createElement(molecules.pW,{url:settings.Z.API_V1.submission.getData({params:{id:submitId}}).url,errorView:()=>react.createElement("div",{className:"jk-col extend jk-pg-md"},react.createElement("div",{className:"jk-col gap center"},react.createElement("div",{className:"image-404"},react.createElement(server.CZe,null)),react.createElement("h3",null,react.createElement(atoms.T,{className:"tt-ue"},"submission not found")),react.createElement("p",null,react.createElement(atoms.T,{className:"tt-se"},"the submission does not exist or you do not have permissions to view it")))),triggerFetch},_ref2=>{let{data}=_ref2;return react.createElement(SubmitViewContent,{submit:data.content})})};SubmitView.__docgenInfo={description:"",methods:[],displayName:"SubmitView",props:{submitId:{required:!0,tsType:{name:"string"},description:""},triggerFetch:{required:!1,tsType:{name:"number"},description:""}}}}}]);