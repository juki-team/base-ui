"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[8568],{"./src/components/molecules/_lazy_/ImageLoaderCropper/ImageLoaderCropper.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>ImageLoaderCropper});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/react-image-crop/dist/index.js"),atoms=__webpack_require__("./src/components/atoms/index.tsx");var useHandleState=__webpack_require__("./src/components/hooks/useHandleState.ts");function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _ts_generator(thisArg,body){var f,y,t,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var TO_RADIANS=Math.PI/180;function canvasPreview(image,canvas,crop){var scale=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,rotate=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(function(){var ctx,scaleX,scaleY,pixelRatio,cropX,cropY,rotateRads,centerX,centerY;return _ts_generator(this,function(_state){if(!(ctx=canvas.getContext("2d")))throw new Error("No 2d context");return scaleX=image.naturalWidth/image.width,scaleY=image.naturalHeight/image.height,pixelRatio=window.devicePixelRatio,canvas.width=Math.floor(crop.width*scaleX*pixelRatio),canvas.height=Math.floor(crop.height*scaleY*pixelRatio),ctx.scale(pixelRatio,pixelRatio),ctx.imageSmoothingQuality="high",cropX=crop.x*scaleX,cropY=crop.y*scaleY,rotateRads=rotate*TO_RADIANS,centerX=image.naturalWidth/2,centerY=image.naturalHeight/2,ctx.save(),ctx.translate(-cropX,-cropY),ctx.translate(centerX,centerY),ctx.rotate(rotateRads),ctx.scale(scale,scale),ctx.translate(-centerX,-centerY),ctx.drawImage(image,0,0,image.naturalWidth,image.naturalHeight,0,0,image.naturalWidth,image.naturalHeight),ctx.globalCompositeOperation="destination-in",ctx.beginPath(),ctx.restore(),[2]})})()}function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ImageLoaderCropper_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _sliced_to_array(arr,i){return function _array_with_holes(arr){if(Array.isArray(arr))return arr}(arr)||function _iterable_to_array_limit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,i)||function _unsupported_iterable_to_array(o,minLen){if(!o)return;if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}(arr,i)||function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ImageLoaderCropper_ts_generator(thisArg,body){var f,y,t,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function centerAspectCrop(mediaWidth,mediaHeight,aspect){return(0,dist.ge)((0,dist.dS)({unit:"%",width:90},aspect,mediaWidth,mediaHeight),mediaWidth,mediaHeight)}function ImageLoaderCropper(props){var defaultCrop=props.defaultCrop,onCropChange=props.onCropChange,initialAspect=props.aspect,initialScale=props.scale,initialRotate=props.rotate,circularCrop=props.circularCrop,withAspect=props.withAspect,withRotate=props.withRotate,withScale=props.withScale,_useState=_sliced_to_array((0,react.useState)(""),2),imgSrc=_useState[0],setImgSrc=_useState[1],previewCanvasRef=(0,react.useRef)(null),imgRef=(0,react.useRef)(null),_useState1=_sliced_to_array((0,react.useState)(defaultCrop),2),crop=_useState1[0],setCrop=_useState1[1],_useState2=_sliced_to_array((0,react.useState)(),2),completedCrop=_useState2[0],setCompletedCrop=_useState2[1],_useHandleState=_sliced_to_array((0,useHandleState.X)(1,initialScale),2),scale=_useHandleState[0],setScale=_useHandleState[1],_useHandleState1=_sliced_to_array((0,useHandleState.X)(0,initialRotate),2),rotate=_useHandleState1[0],setRotate=_useHandleState1[1],_useState3=_sliced_to_array((0,react.useState)(initialAspect||void 0),2),aspect=_useState3[0],setAspect=_useState3[1],_useState4=_sliced_to_array((0,react.useState)((aspect||"")+""),2),aspectText=_useState4[0],setAspectText=_useState4[1],updateAspect=function(aspect){if(aspect){if(imgRef.current){var _imgRef_current=imgRef.current,width=_imgRef_current.width,height=_imgRef_current.height;setAspect(aspect);var crop=centerAspectCrop(width,height,aspect);setCrop(crop),setCompletedCrop((0,dist.$P)(crop,width,height))}}else setAspect(void 0)};return(0,react.useEffect)(function(){updateAspect(initialAspect),setAspectText((initialAspect||"")+"")},[initialAspect]),(0,react.useEffect)(function(){return updateAspect(aspect)},[aspect]),function useDebounceEffect(fn,waitTime,deps){(0,react.useEffect)(function(){var t=setTimeout(function(){fn.apply(void 0,deps)},waitTime);return function(){clearTimeout(t)}},deps)}(function(){return function ImageLoaderCropper_async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){ImageLoaderCropper_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){ImageLoaderCropper_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(function(){return ImageLoaderCropper_ts_generator(this,function(_state){switch(_state.label){case 0:return(null==completedCrop?void 0:completedCrop.width)&&(null==completedCrop?void 0:completedCrop.height)&&imgRef.current&&previewCanvasRef.current?[4,canvasPreview(imgRef.current,previewCanvasRef.current,completedCrop,scale,rotate)]:[3,2];case 1:_state.sent(),_state.label=2;case 2:return[2]}})})()},100,[completedCrop,scale,rotate]),(0,react.useEffect)(function(){if(previewCanvasRef.current&&completedCrop&&imgRef.current){var _imgRef_current=imgRef.current,width=_imgRef_current.width,height=_imgRef_current.height;null==onCropChange||onCropChange({percentCrop:(0,dist.Et)(completedCrop,width,height),pixelCrop:completedCrop,previewCanvasRef,scale,rotate,circularCrop:!!circularCrop,aspect})}},[completedCrop,scale,rotate,onCropChange,circularCrop,aspect]),(0,jsx_runtime.jsxs)("div",{className:"image-loader-cropper-layout jk-col gap",children:[(0,jsx_runtime.jsxs)("div",{className:"jk-row space-between gap nowrap",children:[(0,jsx_runtime.jsx)(atoms.pd,{type:"file",accept:"image/*",onChange:function onSelectFile(files){if((null==files?void 0:files.length)>0&&files[0]){setCrop(void 0);var reader=new FileReader;reader.addEventListener("load",function(){var _reader_result;return setImgSrc((null===(_reader_result=reader.result)||void 0===_reader_result?void 0:_reader_result.toString())||"")}),reader.readAsDataURL(files[0])}}}),withScale&&(0,jsx_runtime.jsx)(atoms.pd,{labelPlacement:"left",label:(0,jsx_runtime.jsx)(atoms.T,{className:"tt-se",children:"scale"}),type:"number",step:.1,value:scale,disabled:!imgSrc,size:"auto",onChange:setScale}),withRotate&&(0,jsx_runtime.jsx)(atoms.pd,{labelPlacement:"left",label:(0,jsx_runtime.jsx)(atoms.T,{className:"tt-se",children:"rotate"}),type:"number",value:rotate,disabled:!imgSrc,size:"auto",onChange:function(value){return setRotate(Math.min(180,Math.max(-180,value)))}}),withAspect&&(0,jsx_runtime.jsx)(atoms.pd,{labelPlacement:"left",label:(0,jsx_runtime.jsx)(atoms.T,{className:"tt-se",children:"aspect"}),type:"text",value:aspectText,disabled:!imgSrc,size:"auto",onChange:function(value){setAspectText(value);var _values_,_values_1,values=null==value?void 0:value.split("/"),aspect=+(null!==(_values_=values[0])&&void 0!==_values_?_values_:0)/+(null!==(_values_1=values[1])&&void 0!==_values_1?_values_1:1);Number.isNaN(aspect)||setAspect(aspect)}})]}),Boolean(imgSrc)&&(0,jsx_runtime.jsx)(dist.Ay,{crop,onChange:function(_,percentCrop){return setCrop(percentCrop)},onComplete:function(c){return setCompletedCrop(c)},aspect,circularCrop,children:(0,jsx_runtime.jsx)("img",{ref:imgRef,alt:"Crop me",src:imgSrc,style:{transform:"scale(".concat(scale,") rotate(").concat(rotate,"deg)")},onLoad:function onImageLoad(e){var _e_currentTarget=e.currentTarget,width=_e_currentTarget.width,height=_e_currentTarget.height;setCrop(aspect?centerAspectCrop(width,height,aspect):{width:100,height:100,y:0,x:0,unit:"%"})}})}),(0,jsx_runtime.jsx)("div",{style:{display:"none"},children:!!completedCrop&&(0,jsx_runtime.jsx)("canvas",{ref:previewCanvasRef})})]})}ImageLoaderCropper.__docgenInfo={description:"",methods:[],displayName:"ImageLoaderCropper",props:{onCropChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: CropImageType) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n  percentCrop: PercentCrop,\n  pixelCrop: PixelCrop,\n  previewCanvasRef: RefObject<HTMLCanvasElement | null>,\n  scale: number,\n  rotate: number,\n  aspect: number | undefined,\n  circularCrop: boolean,\n}",signature:{properties:[{key:"percentCrop",value:{name:"PercentCrop",required:!0}},{key:"pixelCrop",value:{name:"PixelCrop",required:!0}},{key:"previewCanvasRef",value:{name:"RefObject",elements:[{name:"union",raw:"HTMLCanvasElement | null",elements:[{name:"HTMLCanvasElement"},{name:"null"}]}],raw:"RefObject<HTMLCanvasElement | null>",required:!0}},{key:"scale",value:{name:"number",required:!0}},{key:"rotate",value:{name:"number",required:!0}},{key:"aspect",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"circularCrop",value:{name:"boolean",required:!0}}]}},name:"props"}],return:{name:"void"}}},description:""},defaultCrop:{required:!1,tsType:{name:"Crop"},description:""},scale:{required:!1,tsType:{name:"number"},description:""},rotate:{required:!1,tsType:{name:"number"},description:""},aspect:{required:!1,tsType:{name:"number"},description:""},circularCrop:{required:!1,tsType:{name:"boolean"},description:""},withScale:{required:!1,tsType:{name:"boolean"},description:""},withRotate:{required:!1,tsType:{name:"boolean"},description:""},withAspect:{required:!1,tsType:{name:"boolean"},description:""}}}}}]);