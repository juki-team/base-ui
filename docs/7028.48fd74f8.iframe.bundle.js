"use strict";(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[1402,7028],{"./src/components/organisms/worksheet/WorksheetBodies.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WorksheetBodies:()=>WorksheetBodies});var _Users_oscargauss_Documents_JUKI_base_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/helpers/index.ts"),_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/types/index.ts"),_atoms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/atoms/index.tsx"),_atoms_server__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/atoms/server/index.ts"),_WorksheetBody__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/organisms/worksheet/WorksheetBody.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react/jsx-runtime.js");const WorksheetBodies=props=>{var _sheetsInPages,_sheetsInPages2;const{sheetsInPages,isEditor,setSheets,userResults,isSolvable,worksheetKey,page,onPageChange,lastPageChildren,readOnly}=props,containerRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),setPageSheets=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((newPageHeader,newPageSheetContent)=>{const newSheetsInPages=[...sheetsInPages];newSheetsInPages[page-1]={header:null!=newPageHeader?newPageHeader:newSheetsInPages[page-1].header,content:newPageSheetContent};const newSheets=[];for(const{header,content}of newSheetsInPages)newSheets.push(header,...content);null==setSheets||setSheets(newSheets)},[page,setSheets,sheetsInPages]),setSheet=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(value=>{const newPageSheetContent="function"==typeof value?value(sheetsInPages[page-1].content):value;setPageSheets(null,newPageSheetContent)},[page,setPageSheets,sheetsInPages]),pages=sheetsInPages.length;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:(0,_helpers__WEBPACK_IMPORTED_MODULE_1__.xW)("jk-col gap nowrap top stretch extend worksheet-bodies",{"is-solvable":isSolvable}),children:[setSheets&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"jk-row gap extend nowrap",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_3__.pd,{label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_3__.T,{className:"tt-se",children:"page title"}),value:null===(_sheetsInPages=sheetsInPages[page-1])||void 0===_sheetsInPages?void 0:_sheetsInPages.header.title,onChange:title=>{setPageSheets((0,_Users_oscargauss_Documents_JUKI_base_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.A)((0,_Users_oscargauss_Documents_JUKI_base_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.A)({},sheetsInPages[page-1].header),{},{title}),sheetsInPages[page-1].content)},expand:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_3__.$n,{"data-tooltip-id":"jk-tooltip","data-tooltip-content":"remove page divider",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms_server__WEBPACK_IMPORTED_MODULE_4__.d7y,{}),onClick:()=>{const newSheetsInPages=[...sheetsInPages],newSheets=[];if(page===pages){let i=0;for(const{header,content}of newSheetsInPages)i!==page-1&&newSheets.push(header),newSheets.push(...content),i++;setSheets(newSheets)}else{let i=0,contentDeleted=null;for(const{header,content}of newSheetsInPages)i===page-1?contentDeleted=content:(newSheets.push(header),null!==contentDeleted&&(newSheets.push(...contentDeleted),contentDeleted=null),newSheets.push(...content)),i++;setSheets(newSheets)}page>1&&page===pages&&onPageChange(Math.max(page,1),1,{name:_types__WEBPACK_IMPORTED_MODULE_2__.QueryParamKey.PAGE_FOCUS,value:"jk-worksheet-viewer-container"})},disabled:pages<=1})]},"".concat(page)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_WorksheetBody__WEBPACK_IMPORTED_MODULE_5__.WorksheetBody,{sheet:null===(_sheetsInPages2=sheetsInPages[page-1])||void 0===_sheetsInPages2?void 0:_sheetsInPages2.content,setSheet:setSheets?setSheet:void 0,userResults,readOnly:!!readOnly,isSolvable,isEditor,worksheetKey,ref:containerRef}),page<pages?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_3__.$n,{className:"next-button",type:"light",onClick:()=>onPageChange(page+1,1,{name:_types__WEBPACK_IMPORTED_MODULE_2__.QueryParamKey.PAGE_FOCUS,value:"jk-worksheet-viewer-container"}),expand:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_3__.T,{className:"tt-se",children:"next page"})}):lastPageChildren]})};WorksheetBodies.__docgenInfo={description:"",methods:[],displayName:"WorksheetBodies",props:{sheetsInPages:{required:!0,tsType:{name:"WorksheetsInPages"},description:""},setSheets:{required:!1,tsType:{name:"Dispatch",elements:[{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"BodyWorksheetType[]"}],raw:"Dispatch<BodyWorksheetType[]>"},description:""},userResults:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n  data?: WorksheetUserSubmissionsResponseDTO,\n  isLoading?: boolean,\n  validating?: boolean,\n  mutate?: KeyedMutator<any>,\n}",signature:{properties:[{key:"data",value:{name:"WorksheetUserSubmissionsResponseDTO",required:!1}},{key:"isLoading",value:{name:"boolean",required:!1}},{key:"validating",value:{name:"boolean",required:!1}},{key:"mutate",value:{name:"KeyedMutator",elements:[{name:"any"}],raw:"KeyedMutator<any>",required:!1}}]}},description:""},isSolvable:{required:!0,tsType:{name:"boolean"},description:""},isEditor:{required:!0,tsType:{name:"boolean"},description:""},worksheetKey:{required:!0,tsType:{name:"string"},description:""},page:{required:!0,tsType:{name:"number"},description:""},subPage:{required:!0,tsType:{name:"number"},description:""},onPageChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newPage: number, newSubPage: number, entries: Parameters<SetSearchParamsType>[0]) => void",signature:{arguments:[{type:{name:"number"},name:"newPage"},{type:{name:"number"},name:"newSubPage"},{type:{name:"Parameters[0]",raw:"Parameters<SetSearchParamsType>[0]"},name:"entries"}],return:{name:"void"}}},description:""},lastPageChildren:{required:!1,tsType:{name:"ReactNode"},description:""},readOnly:{required:!0,tsType:{name:"boolean"},description:""}}}},"./src/components/organisms/worksheet/WorksheetViewer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WorksheetViewer:()=>WorksheetViewer});var _juki_team_commons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@juki-team/commons/dist/esm/index.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/helpers/index.ts"),_hooks_useFetcher__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/hooks/useFetcher.ts"),_hooks_useJukiUI__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/hooks/useJukiUI.tsx"),_hooks_useStableState__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/hooks/useStableState.ts"),_settings__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/settings/index.ts"),_stores_router_useRouterStore__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/stores/router/useRouterStore.ts"),_stores_user_useUserStore__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/stores/user/useUserStore.ts"),_atoms__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/components/atoms/index.tsx"),_ContentsSectionHeader__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/components/organisms/worksheet/ContentsSectionHeader.tsx"),_sheets_TableOfContents__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/components/organisms/worksheet/sheets/TableOfContents.tsx"),_WorksheetBodies__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/components/organisms/worksheet/WorksheetBodies.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/react/jsx-runtime.js");const WorksheetViewer=props=>{const{content,worksheetKey,isSolvable=!1,isEditor=!1,resultsUserKey,page:initialPage,subPage:initialSubPage,onPageChange:initialOnPageChange,lastPageChildren,readOnly:initialReadOnly=!1,withoutTableOfContents=!1}=props,{viewPortSize}=(0,_hooks_useJukiUI__WEBPACK_IMPORTED_MODULE_4__.p)(),userNickname=(0,_stores_user_useUserStore__WEBPACK_IMPORTED_MODULE_8__.k)(state=>state.user.nickname),companyKey=(0,_stores_user_useUserStore__WEBPACK_IMPORTED_MODULE_8__.k)(state=>state.company.key),userIsLogged=(0,_stores_user_useUserStore__WEBPACK_IMPORTED_MODULE_8__.k)(state=>state.user.isLogged),setSearchParams=(0,_stores_router_useRouterStore__WEBPACK_IMPORTED_MODULE_7__.I)(state=>state.setSearchParams),[page,_setPage]=(0,_hooks_useStableState__WEBPACK_IMPORTED_MODULE_5__.I)(null!=initialPage?initialPage:1),[subPage,_setSubPage]=(0,_hooks_useStableState__WEBPACK_IMPORTED_MODULE_5__.I)(null!=initialSubPage?initialSubPage:1),onPageChange=null!=initialOnPageChange?initialOnPageChange:(page,subPage,entries)=>{_setPage(page),_setSubPage(subPage),setSearchParams(entries)},{data:userResultsData,mutate:userResultsMutate,isLoading:userResultsIsLoading,isValidating:userResultsIsValidating}=(0,_hooks_useFetcher__WEBPACK_IMPORTED_MODULE_3__.L)(worksheetKey&&isSolvable&&userIsLogged?_settings__WEBPACK_IMPORTED_MODULE_6__.u.API_V1.worksheet.getSubmissionsUser({params:{key:worksheetKey,userKey:resultsUserKey||(0,_juki_team_commons__WEBPACK_IMPORTED_MODULE_0__.Lwn)(userNickname,companyKey)}}).url:null),userResults=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>({data:null!=userResultsData&&userResultsData.success?userResultsData.content:void 0,isLoading:userResultsIsLoading,isValidating:userResultsIsValidating,mutate:userResultsMutate}),[userResultsData,userResultsIsLoading,userResultsIsValidating,userResultsMutate]),sheetsInPages=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>(0,_juki_team_commons__WEBPACK_IMPORTED_MODULE_0__.bs0)(content),[content]),isSmallPortSize="sm"===viewPortSize,readOnly=initialReadOnly||!(null==userResults||!userResults.data)&&userNickname!==userResults.data.user.nickname,pages=sheetsInPages.length;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{id:"jk-worksheet-viewer-container",className:(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.xW)("gap nowrap worksheet-viewer-container center top",{"jk-col":isSmallPortSize,"jk-row":!isSmallPortSize}),children:[!withoutTableOfContents&&(isSmallPortSize?pages>1&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"jk-row",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ContentsSectionHeader__WEBPACK_IMPORTED_MODULE_10__.ContentsSectionHeader,{page,subPage,onPageChange,sheetsInPages})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"jk-col gap bc-we jk-pg-xsm jk-br-ie left worksheet-content sticky-top",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_atoms__WEBPACK_IMPORTED_MODULE_9__.T,{className:"tt-se fw-bd cr-py",children:"table of content"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_sheets_TableOfContents__WEBPACK_IMPORTED_MODULE_11__.M,{sheetsInPages,page,subPage,onPageChange})]})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_WorksheetBodies__WEBPACK_IMPORTED_MODULE_12__.WorksheetBodies,{sheetsInPages,isSolvable:isSolvable&&userIsLogged,userResults,readOnly,isEditor,worksheetKey,page,onPageChange,subPage,lastPageChildren})]})};WorksheetViewer.__docgenInfo={description:"",methods:[],displayName:"WorksheetViewer",props:{resultsUserKey:{required:!1,tsType:{name:"string"},description:""},content:{required:!0,tsType:{name:"Array",elements:[{name:"BodyWorksheetType"}],raw:"BodyWorksheetType[]"},description:""},worksheetKey:{required:!0,tsType:{name:"string"},description:""},isSolvable:{required:!1,tsType:{name:"boolean"},description:""},isEditor:{required:!1,tsType:{name:"boolean"},description:""},page:{required:!1,tsType:{name:"number"},description:""},subPage:{required:!1,tsType:{name:"number"},description:""},onPageChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(newPage: number, newSubPage: number, entries: Parameters<SetSearchParamsType>[0]) => void",signature:{arguments:[{type:{name:"number"},name:"newPage"},{type:{name:"number"},name:"newSubPage"},{type:{name:"Parameters[0]",raw:"Parameters<SetSearchParamsType>[0]"},name:"entries"}],return:{name:"void"}}},description:""},lastPageChildren:{required:!1,tsType:{name:"ReactNode"},description:""},readOnly:{required:!1,tsType:{name:"boolean"},description:""},withoutTableOfContents:{required:!1,tsType:{name:"boolean"},description:""}}}}}]);