/*! For license information please see 5244.470fecd6.iframe.bundle.js.LICENSE.txt */
(self.webpackChunk_juki_team_base_ui=self.webpackChunk_juki_team_base_ui||[]).push([[5244],{"./node_modules/pica/dist/pica.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){if(!f&&__webpack_require__("./node_modules/pica/dist sync recursive"))return require(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=void 0,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(_dereq_,module,exports){"use strict";var inherits=_dereq_("inherits"),Multimath=_dereq_("multimath"),mm_unsharp_mask=_dereq_("./mm_unsharp_mask"),mm_resize=_dereq_("./mm_resize");function MathLib(requested_features){var __requested_features=requested_features||[],features={js:__requested_features.indexOf("js")>=0,wasm:__requested_features.indexOf("wasm")>=0};Multimath.call(this,features),this.features={js:features.js,wasm:features.wasm&&this.has_wasm()},this.use(mm_unsharp_mask),this.use(mm_resize)}inherits(MathLib,Multimath),MathLib.prototype.resizeAndUnsharp=function resizeAndUnsharp(options,cache){var result=this.resize(options,cache);return options.unsharpAmount&&this.unsharp_mask(result,options.toWidth,options.toHeight,options.unsharpAmount,options.unsharpRadius,options.unsharpThreshold),result},module.exports=MathLib},{"./mm_resize":4,"./mm_unsharp_mask":9,inherits:19,multimath:20}],2:[function(_dereq_,module,exports){"use strict";function clampTo8(i){return i<0?0:i>255?255:i}function convolveHorizontally(src,dest,srcW,srcH,destW,filters){var r,g,b,a,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(filterPtr=0,destX=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*src[srcPtr+3]|0,b=b+filterVal*src[srcPtr+2]|0,g=g+filterVal*src[srcPtr+1]|0,r=r+filterVal*src[srcPtr]|0,srcPtr=srcPtr+4|0;dest[destOffset+3]=clampTo8(a+8192>>14),dest[destOffset+2]=clampTo8(b+8192>>14),dest[destOffset+1]=clampTo8(g+8192>>14),dest[destOffset]=clampTo8(r+8192>>14),destOffset=destOffset+4*srcH|0}destOffset=4*(srcY+1)|0,srcOffset=(srcY+1)*srcW*4|0}}function convolveVertically(src,dest,srcW,srcH,destW,filters){var r,g,b,a,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(filterPtr=0,destX=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*src[srcPtr+3]|0,b=b+filterVal*src[srcPtr+2]|0,g=g+filterVal*src[srcPtr+1]|0,r=r+filterVal*src[srcPtr]|0,srcPtr=srcPtr+4|0;dest[destOffset+3]=clampTo8(a+8192>>14),dest[destOffset+2]=clampTo8(b+8192>>14),dest[destOffset+1]=clampTo8(g+8192>>14),dest[destOffset]=clampTo8(r+8192>>14),destOffset=destOffset+4*srcH|0}destOffset=4*(srcY+1)|0,srcOffset=(srcY+1)*srcW*4|0}}module.exports={convolveHorizontally,convolveVertically}},{}],3:[function(_dereq_,module,exports){"use strict";module.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs="},{}],4:[function(_dereq_,module,exports){"use strict";module.exports={name:"resize",fn:_dereq_("./resize"),wasm_fn:_dereq_("./resize_wasm"),wasm_src:_dereq_("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(_dereq_,module,exports){"use strict";var createFilters=_dereq_("./resize_filter_gen"),convolveHorizontally=_dereq_("./convolve").convolveHorizontally,convolveVertically=_dereq_("./convolve").convolveVertically;function resetAlpha(dst,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;)dst[ptr]=255,ptr=ptr+4|0}module.exports=function resize(options){var src=options.src,srcW=options.width,srcH=options.height,destW=options.toWidth,destH=options.toHeight,scaleX=options.scaleX||options.toWidth/options.width,scaleY=options.scaleY||options.toHeight/options.height,offsetX=options.offsetX||0,offsetY=options.offsetY||0,dest=options.dest||new Uint8Array(destW*destH*4),quality=void 0===options.quality?3:options.quality,alpha=options.alpha||!1,filtersX=createFilters(quality,srcW,destW,scaleX,offsetX),filtersY=createFilters(quality,srcH,destH,scaleY,offsetY),tmp=new Uint8Array(destW*srcH*4);return convolveHorizontally(src,tmp,srcW,srcH,destW,filtersX),convolveVertically(tmp,dest,srcH,destW,destH,filtersY),alpha||resetAlpha(dest,destW,destH),dest}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(_dereq_,module,exports){"use strict";var FILTER_INFO=_dereq_("./resize_filter_info"),FIXED_FRAC_BITS=14;function toFixedPoint(num){return Math.round(num*((1<<FIXED_FRAC_BITS)-1))}module.exports=function resizeFilterGen(quality,srcSize,destSize,scale,offset){var destPixel,srcPixel,srcFirst,srcLast,filterElementSize,floatFilter,fxpFilter,total,pxl,idx,floatVal,filterTotal,filterVal,leftNotEmpty,rightNotEmpty,filterShift,filterSize,filterFunction=FILTER_INFO[quality].filter,scaleInverted=1/scale,scaleClamped=Math.min(1,scale),srcWindow=FILTER_INFO[quality].win/scaleClamped,maxFilterElementSize=Math.floor(2*(srcWindow+1)),packedFilter=new Int16Array((maxFilterElementSize+2)*destSize),packedFilterPtr=0,slowCopy=!packedFilter.subarray||!packedFilter.set;for(destPixel=0;destPixel<destSize;destPixel++){for(srcPixel=(destPixel+.5)*scaleInverted+offset,srcFirst=Math.max(0,Math.floor(srcPixel-srcWindow)),filterElementSize=(srcLast=Math.min(srcSize-1,Math.ceil(srcPixel+srcWindow)))-srcFirst+1,floatFilter=new Float32Array(filterElementSize),fxpFilter=new Int16Array(filterElementSize),total=0,pxl=srcFirst,idx=0;pxl<=srcLast;pxl++,idx++)total+=floatVal=filterFunction((pxl+.5-srcPixel)*scaleClamped),floatFilter[idx]=floatVal;for(filterTotal=0,idx=0;idx<floatFilter.length;idx++)filterTotal+=filterVal=floatFilter[idx]/total,fxpFilter[idx]=toFixedPoint(filterVal);for(fxpFilter[destSize>>1]+=toFixedPoint(1-filterTotal),leftNotEmpty=0;leftNotEmpty<fxpFilter.length&&0===fxpFilter[leftNotEmpty];)leftNotEmpty++;if(leftNotEmpty<fxpFilter.length){for(rightNotEmpty=fxpFilter.length-1;rightNotEmpty>0&&0===fxpFilter[rightNotEmpty];)rightNotEmpty--;if(filterShift=srcFirst+leftNotEmpty,filterSize=rightNotEmpty-leftNotEmpty+1,packedFilter[packedFilterPtr++]=filterShift,packedFilter[packedFilterPtr++]=filterSize,slowCopy)for(idx=leftNotEmpty;idx<=rightNotEmpty;idx++)packedFilter[packedFilterPtr++]=fxpFilter[idx];else packedFilter.set(fxpFilter.subarray(leftNotEmpty,rightNotEmpty+1),packedFilterPtr),packedFilterPtr+=filterSize}else packedFilter[packedFilterPtr++]=0,packedFilter[packedFilterPtr++]=0}return packedFilter}},{"./resize_filter_info":7}],7:[function(_dereq_,module,exports){"use strict";module.exports=[{win:.5,filter:function filter(x){return x>=-.5&&x<.5?1:0}},{win:1,filter:function filter(x){if(x<=-1||x>=1)return 0;if(x>-1.1920929e-7&&x<1.1920929e-7)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*(.54+.46*Math.cos(xpi/1))}},{win:2,filter:function filter(x){if(x<=-2||x>=2)return 0;if(x>-1.1920929e-7&&x<1.1920929e-7)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/2)/(xpi/2)}},{win:3,filter:function filter(x){if(x<=-3||x>=3)return 0;if(x>-1.1920929e-7&&x<1.1920929e-7)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/3)/(xpi/3)}}]},{}],8:[function(_dereq_,module,exports){"use strict";var createFilters=_dereq_("./resize_filter_gen");function resetAlpha(dst,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;)dst[ptr]=255,ptr=ptr+4|0}function asUint8Array(src){return new Uint8Array(src.buffer,0,src.byteLength)}var IS_LE=!0;try{IS_LE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(__){}function copyInt16asLE(src,target,target_offset){if(IS_LE)target.set(asUint8Array(src),target_offset);else for(var ptr=target_offset,i=0;i<src.length;i++){var data=src[i];target[ptr++]=255&data,target[ptr++]=data>>8&255}}module.exports=function resize_wasm(options){var src=options.src,srcW=options.width,srcH=options.height,destW=options.toWidth,destH=options.toHeight,scaleX=options.scaleX||options.toWidth/options.width,scaleY=options.scaleY||options.toHeight/options.height,offsetX=options.offsetX||0,offsetY=options.offsetY||0,dest=options.dest||new Uint8Array(destW*destH*4),quality=void 0===options.quality?3:options.quality,alpha=options.alpha||!1,filtersX=createFilters(quality,srcW,destW,scaleX,offsetX),filtersY=createFilters(quality,srcH,destH,scaleY,offsetY),src_offset=0,tmp_offset=this.__align(src_offset+Math.max(src.byteLength,dest.byteLength)),filtersX_offset=this.__align(tmp_offset+srcH*destW*4),filtersY_offset=this.__align(filtersX_offset+filtersX.byteLength),alloc_bytes=filtersY_offset+filtersY.byteLength,instance=this.__instance("resize",alloc_bytes),mem=new Uint8Array(this.__memory.buffer),mem32=new Uint32Array(this.__memory.buffer),src32=new Uint32Array(src.buffer);return mem32.set(src32),copyInt16asLE(filtersX,mem,filtersX_offset),copyInt16asLE(filtersY,mem,filtersY_offset),(instance.exports.convolveHV||instance.exports._convolveHV)(filtersX_offset,filtersY_offset,tmp_offset,srcW,srcH,destW,destH),new Uint32Array(dest.buffer).set(new Uint32Array(this.__memory.buffer,0,destH*destW)),alpha||resetAlpha(dest,destW,destH),dest}},{"./resize_filter_gen":6}],9:[function(_dereq_,module,exports){"use strict";module.exports={name:"unsharp_mask",fn:_dereq_("./unsharp_mask"),wasm_fn:_dereq_("./unsharp_mask_wasm"),wasm_src:_dereq_("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(_dereq_,module,exports){"use strict";var glur_mono16=_dereq_("glur/mono16");function hsv_v16(img,width,height){for(var r,g,b,max,size=width*height,out=new Uint16Array(size),i=0;i<size;i++)r=img[4*i],g=img[4*i+1],b=img[4*i+2],max=r>=g&&r>=b?r:g>=b&&g>=r?g:b,out[i]=max<<8;return out}module.exports=function unsharp(img,width,height,amount,radius,threshold){var v1,v2,vmul,diff,iTimes4;if(!(0===amount||radius<.5)){radius>2&&(radius=2);var brightness=hsv_v16(img,width,height),blured=new Uint16Array(brightness);glur_mono16(blured,width,height,radius);for(var amountFp=amount/100*4096+.5|0,thresholdFp=threshold<<8,size=width*height,i=0;i<size;i++)diff=(v1=brightness[i])-blured[i],Math.abs(diff)>=thresholdFp&&(vmul=((v2=(v2=(v2=v1+(amountFp*diff+2048>>12))>65280?65280:v2)<0?0:v2)<<12)/(v1=0!==v1?v1:1)|0,img[iTimes4=4*i]=img[iTimes4]*vmul+2048>>12,img[iTimes4+1]=img[iTimes4+1]*vmul+2048>>12,img[iTimes4+2]=img[iTimes4+2]*vmul+2048>>12)}}},{"glur/mono16":18}],11:[function(_dereq_,module,exports){"use strict";module.exports=function unsharp(img,width,height,amount,radius,threshold){if(!(0===amount||radius<.5)){radius>2&&(radius=2);var pixels=width*height,img_bytes_cnt=4*pixels,hsv_bytes_cnt=2*pixels,blur_bytes_cnt=2*pixels,blur_line_byte_cnt=4*Math.max(width,height),blur_coeffs_byte_cnt=32,img_offset=0,hsv_offset=img_bytes_cnt,blur_offset=hsv_offset+hsv_bytes_cnt,blur_tmp_offset=blur_offset+blur_bytes_cnt,blur_line_offset=blur_tmp_offset+blur_bytes_cnt,blur_coeffs_offset=blur_line_offset+blur_line_byte_cnt,instance=this.__instance("unsharp_mask",img_bytes_cnt+hsv_bytes_cnt+2*blur_bytes_cnt+blur_line_byte_cnt+blur_coeffs_byte_cnt,{exp:Math.exp}),img32=new Uint32Array(img.buffer);new Uint32Array(this.__memory.buffer).set(img32);var fn=instance.exports.hsv_v16||instance.exports._hsv_v16;fn(img_offset,hsv_offset,width,height),(fn=instance.exports.blurMono16||instance.exports._blurMono16)(hsv_offset,blur_offset,blur_tmp_offset,blur_line_offset,blur_coeffs_offset,width,height,radius),(fn=instance.exports.unsharp||instance.exports._unsharp)(img_offset,img_offset,hsv_offset,blur_offset,width,height,amount,threshold),img32.set(new Uint32Array(this.__memory.buffer,0,pixels))}}},{}],12:[function(_dereq_,module,exports){"use strict";module.exports="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"},{}],13:[function(_dereq_,module,exports){"use strict";var GC_INTERVAL=100;function Pool(create,idle){this.create=create,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=idle||2e3}Pool.prototype.acquire=function(){var resource,_this=this;return 0!==this.available.length?resource=this.available.pop():((resource=this.create()).id=this.lastId++,resource.release=function(){return _this.release(resource)}),this.acquired[resource.id]=resource,resource},Pool.prototype.release=function(resource){var _this2=this;delete this.acquired[resource.id],resource.lastUsed=Date.now(),this.available.push(resource),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return _this2.gc()},GC_INTERVAL))},Pool.prototype.gc=function(){var _this3=this,now=Date.now();this.available=this.available.filter(function(resource){return!(now-resource.lastUsed>_this3.idle&&(resource.destroy(),1))}),0!==this.available.length?this.timeoutId=setTimeout(function(){return _this3.gc()},GC_INTERVAL):this.timeoutId=0},module.exports=Pool},{}],14:[function(_dereq_,module,exports){"use strict";var MIN_INNER_TILE_SIZE=2;module.exports=function createStages(fromWidth,fromHeight,toWidth,toHeight,srcTileSize,destTileBorder){var scaleX=toWidth/fromWidth,scaleY=toHeight/fromHeight,minScale=(2*destTileBorder+MIN_INNER_TILE_SIZE+1)/srcTileSize;if(minScale>.5)return[[toWidth,toHeight]];var stageCount=Math.ceil(Math.log(Math.min(scaleX,scaleY))/Math.log(minScale));if(stageCount<=1)return[[toWidth,toHeight]];for(var result=[],i=0;i<stageCount;i++){var width=Math.round(Math.pow(Math.pow(fromWidth,stageCount-i-1)*Math.pow(toWidth,i+1),1/stageCount)),height=Math.round(Math.pow(Math.pow(fromHeight,stageCount-i-1)*Math.pow(toHeight,i+1),1/stageCount));result.push([width,height])}return result}},{}],15:[function(_dereq_,module,exports){"use strict";var PIXEL_EPSILON=1e-5;function pixelFloor(x){var nearest=Math.round(x);return Math.abs(x-nearest)<PIXEL_EPSILON?nearest:Math.floor(x)}function pixelCeil(x){var nearest=Math.round(x);return Math.abs(x-nearest)<PIXEL_EPSILON?nearest:Math.ceil(x)}module.exports=function createRegions(options){var x,y,innerX,innerY,toTileWidth,toTileHeight,scaleX=options.toWidth/options.width,scaleY=options.toHeight/options.height,innerTileWidth=pixelFloor(options.srcTileSize*scaleX)-2*options.destTileBorder,innerTileHeight=pixelFloor(options.srcTileSize*scaleY)-2*options.destTileBorder;if(innerTileWidth<1||innerTileHeight<1)throw new Error("Internal error in pica: target tile width/height is too small.");var tile,tiles=[];for(innerY=0;innerY<options.toHeight;innerY+=innerTileHeight)for(innerX=0;innerX<options.toWidth;innerX+=innerTileWidth)(x=innerX-options.destTileBorder)<0&&(x=0),x+(toTileWidth=innerX+innerTileWidth+options.destTileBorder-x)>=options.toWidth&&(toTileWidth=options.toWidth-x),(y=innerY-options.destTileBorder)<0&&(y=0),y+(toTileHeight=innerY+innerTileHeight+options.destTileBorder-y)>=options.toHeight&&(toTileHeight=options.toHeight-y),tile={toX:x,toY:y,toWidth:toTileWidth,toHeight:toTileHeight,toInnerX:innerX,toInnerY:innerY,toInnerWidth:innerTileWidth,toInnerHeight:innerTileHeight,offsetX:x/scaleX-pixelFloor(x/scaleX),offsetY:y/scaleY-pixelFloor(y/scaleY),scaleX,scaleY,x:pixelFloor(x/scaleX),y:pixelFloor(y/scaleY),width:pixelCeil(toTileWidth/scaleX),height:pixelCeil(toTileHeight/scaleY)},tiles.push(tile);return tiles}},{}],16:[function(_dereq_,module,exports){"use strict";function objClass(obj){return Object.prototype.toString.call(obj)}module.exports.isCanvas=function isCanvas(element){var cname=objClass(element);return"[object HTMLCanvasElement]"===cname||"[object OffscreenCanvas]"===cname||"[object Canvas]"===cname},module.exports.isImage=function isImage(element){return"[object HTMLImageElement]"===objClass(element)},module.exports.isImageBitmap=function isImageBitmap(element){return"[object ImageBitmap]"===objClass(element)},module.exports.limiter=function limiter(concurrency){var active=0,queue=[];function roll(){active<concurrency&&queue.length&&(active++,queue.shift()())}return function limit(fn){return new Promise(function(resolve,reject){queue.push(function(){fn().then(function(result){resolve(result),active--,roll()},function(err){reject(err),active--,roll()})}),roll()})}},module.exports.cib_quality_name=function cib_quality_name(num){switch(num){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},module.exports.cib_support=function cib_support(createCanvas){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap)return!1;var c=createCanvas(100,100);return createImageBitmap(c,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(bitmap){var status=10===bitmap.width;return bitmap.close(),c=null,status})}).catch(function(){return!1})},module.exports.worker_offscreen_canvas_support=function worker_offscreen_canvas_support(){return new Promise(function(resolve,reject){if("undefined"!=typeof OffscreenCanvas){var code=btoa("(".concat(workerPayload.toString(),")(self);")),w=new Worker("data:text/javascript;base64,".concat(code));w.onmessage=function(ev){return resolve(ev.data)},w.onerror=reject}else resolve(!1);function workerPayload(self){"undefined"!=typeof createImageBitmap?Promise.resolve().then(function(){var canvas=new OffscreenCanvas(10,10);return canvas.getContext("2d").rect(0,0,1,1),createImageBitmap(canvas,0,0,1,1)}).then(function(){return self.postMessage(!0)},function(){return self.postMessage(!1)}):self.postMessage(!1)}}).then(function(result){return result},function(){return!1})},module.exports.can_use_canvas=function can_use_canvas(createCanvas){var usable=!1;try{var ctx=createCanvas(2,1).getContext("2d"),d=ctx.createImageData(2,1);d.data[0]=12,d.data[1]=23,d.data[2]=34,d.data[3]=255,d.data[4]=45,d.data[5]=56,d.data[6]=67,d.data[7]=255,ctx.putImageData(d,0,0),d=null,12===(d=ctx.getImageData(0,0,2,1)).data[0]&&23===d.data[1]&&34===d.data[2]&&255===d.data[3]&&45===d.data[4]&&56===d.data[5]&&67===d.data[6]&&255===d.data[7]&&(usable=!0)}catch(err){}return usable},module.exports.cib_can_use_region=function cib_can_use_region(){return new Promise(function(resolve){if("undefined"!=typeof createImageBitmap){var image=new Image;image.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",image.onload=function(){createImageBitmap(image,0,0,image.width,image.height).then(function(bitmap){bitmap.width===image.width&&bitmap.height===image.height?resolve(!0):resolve(!1)},function(){return resolve(!1)})},image.onerror=function(){return resolve(!1)}}else resolve(!1)})}},{}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(){var mathLib,MathLib=_dereq_("./mathlib");onmessage=function onmessage(ev){var tileOpts=ev.data.opts,returnBitmap=!1;if(!tileOpts.src&&tileOpts.srcBitmap){var canvas=new OffscreenCanvas(tileOpts.width,tileOpts.height),ctx=canvas.getContext("2d",{alpha:Boolean(tileOpts.alpha)});ctx.drawImage(tileOpts.srcBitmap,0,0),tileOpts.src=ctx.getImageData(0,0,tileOpts.width,tileOpts.height).data,canvas.width=canvas.height=0,canvas=null,tileOpts.srcBitmap.close(),tileOpts.srcBitmap=null}mathLib||(mathLib=new MathLib(ev.data.features));var data=mathLib.resizeAndUnsharp(tileOpts);if(returnBitmap){var toImageData=new ImageData(new Uint8ClampedArray(data),tileOpts.toWidth,tileOpts.toHeight),_canvas=new OffscreenCanvas(tileOpts.toWidth,tileOpts.toHeight);_canvas.getContext("2d",{alpha:Boolean(tileOpts.alpha)}).putImageData(toImageData,0,0),createImageBitmap(_canvas).then(function(bitmap){postMessage({bitmap},[bitmap])})}else postMessage({data},[data.buffer])}}},{"./mathlib":1}],18:[function(_dereq_,module,exports){var a0,a1,a2,a3,b1,b2;function gaussCoef(sigma){sigma<.5&&(sigma=.5);var a=Math.exp(.527076)/sigma,g1=Math.exp(-a),g2=Math.exp(-2*a),k=(1-g1)*(1-g1)/(1+2*a*g1-g2);return a0=k,a1=k*(a-1)*g1,a2=k*(a+1)*g1,a3=-k*g2,b1=2*g1,b2=-g2,new Float32Array([a0,a1,a2,a3,b1,b2,(a0+a1)/(1-b1-b2),(a2+a3)/(1-b1-b2)])}function convolveMono16(src,out,line,coeff,width,height){var prev_src,curr_src,curr_out,prev_out,prev_prev_out,src_index,out_index,line_index,i,j,coeff_a0,coeff_a1,coeff_b1,coeff_b2;for(i=0;i<height;i++){for(out_index=i,line_index=0,prev_out=prev_prev_out=(prev_src=src[src_index=i*width])*coeff[6],coeff_a0=coeff[0],coeff_a1=coeff[1],coeff_b1=coeff[4],coeff_b2=coeff[5],j=0;j<width;j++)curr_out=(curr_src=src[src_index])*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2,prev_prev_out=prev_out,prev_out=curr_out,prev_src=curr_src,line[line_index]=prev_out,line_index++,src_index++;for(line_index--,out_index+=height*(width-1),prev_out=prev_prev_out=(prev_src=src[--src_index])*coeff[7],curr_src=prev_src,coeff_a0=coeff[2],coeff_a1=coeff[3],j=width-1;j>=0;j--)curr_out=curr_src*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2,prev_prev_out=prev_out,prev_out=curr_out,prev_src=curr_src,curr_src=src[src_index],out[out_index]=line[line_index]+prev_out,src_index--,line_index--,out_index-=height}}function blurMono16(src,width,height,radius){if(radius){var out=new Uint16Array(src.length),tmp_line=new Float32Array(Math.max(width,height)),coeff=gaussCoef(radius);convolveMono16(src,out,tmp_line,coeff,width,height,radius),convolveMono16(out,src,tmp_line,coeff,height,width,radius)}}module.exports=blurMono16},{}],19:[function(_dereq_,module,exports){"function"==typeof Object.create?module.exports=function inherits(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},{}],20:[function(_dereq_,module,exports){"use strict";var assign=_dereq_("object-assign"),base64decode=_dereq_("./lib/base64decode"),hasWebAssembly=_dereq_("./lib/wa_detect"),DEFAULT_OPTIONS={js:!0,wasm:!0};function MultiMath(options){if(!(this instanceof MultiMath))return new MultiMath(options);var opts=assign({},DEFAULT_OPTIONS,options||{});if(this.options=opts,this.__cache={},this.__init_promise=null,this.__modules=opts.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}MultiMath.prototype.has_wasm=hasWebAssembly,MultiMath.prototype.use=function(module){return this.__modules[module.name]=module,this.options.wasm&&this.has_wasm()&&module.wasm_fn?this[module.name]=module.wasm_fn:this[module.name]=module.fn,this},MultiMath.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var self=this;return this.__init_promise=Promise.all(Object.keys(self.__modules).map(function(name){var module=self.__modules[name];return self.options.wasm&&self.has_wasm()&&module.wasm_fn?self.__wasm[name]?null:WebAssembly.compile(self.__base64decode(module.wasm_src)).then(function(m){self.__wasm[name]=m}):null})).then(function(){return self}),this.__init_promise},MultiMath.prototype.__base64decode=base64decode,MultiMath.prototype.__reallocate=function mem_grow_to(bytes){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(bytes/65536)}),this.__memory;var mem_size=this.__memory.buffer.byteLength;return mem_size<bytes&&this.__memory.grow(Math.ceil((bytes-mem_size)/65536)),this.__memory},MultiMath.prototype.__instance=function instance(name,memsize,env_extra){if(memsize&&this.__reallocate(memsize),!this.__wasm[name]){var module=this.__modules[name];this.__wasm[name]=new WebAssembly.Module(this.__base64decode(module.wasm_src))}if(!this.__cache[name]){var env_base={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[name]=new WebAssembly.Instance(this.__wasm[name],{env:assign(env_base,env_extra||{})})}return this.__cache[name]},MultiMath.prototype.__align=function align(number,base){var reminder=number%(base=base||8);return number+(reminder?base-reminder:0)},module.exports=MultiMath},{"./lib/base64decode":21,"./lib/wa_detect":22,"object-assign":23}],21:[function(_dereq_,module,exports){"use strict";var BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";module.exports=function base64decode(str){for(var input=str.replace(/[\r\n=]/g,""),max=input.length,out=new Uint8Array(3*max>>2),bits=0,ptr=0,idx=0;idx<max;idx++)idx%4==0&&idx&&(out[ptr++]=bits>>16&255,out[ptr++]=bits>>8&255,out[ptr++]=255&bits),bits=bits<<6|BASE64_MAP.indexOf(input.charAt(idx));var tailbits=max%4*6;return 0===tailbits?(out[ptr++]=bits>>16&255,out[ptr++]=bits>>8&255,out[ptr++]=255&bits):18===tailbits?(out[ptr++]=bits>>10&255,out[ptr++]=bits>>2&255):12===tailbits&&(out[ptr++]=bits>>4&255),out}},{}],22:[function(_dereq_,module,exports){"use strict";var wa;module.exports=function hasWebAssembly(){if(void 0!==wa)return wa;if(wa=!1,"undefined"==typeof WebAssembly)return wa;try{var bin=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),module=new WebAssembly.Module(bin);return 0!==new WebAssembly.Instance(module,{}).exports.test(4)&&(wa=!0),wa}catch(__){}return wa}},{}],23:[function(_dereq_,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map(function(n){return test2[n]}).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}module.exports=shouldUseNative()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],24:[function(_dereq_,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(fn,options){for(var wkey,cacheKeys=Object.keys(cache),i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i],exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(i=0,l=cacheKeys.length;i<l;i++)wcache[key=cacheKeys[i]]=key;sources[wkey]=["function(require,module,exports){"+fn+"(self); }",wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16),scache={};scache[wkey]=wkey,sources[skey]=["function(require,module,exports){var f = require("+stringify(wkey)+");(f.default ? f.default : f)(self);}",scache];var workerSources={};function resolveSources(key){for(var depPath in workerSources[key]=!0,sources[key][1]){var depKey=sources[key][1][depPath];workerSources[depKey]||resolveSources(depKey)}}resolveSources(skey);var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])",URL=window.URL||window.webkitURL||window.mozURL||window.msURL,blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare)return blob;var workerUrl=URL.createObjectURL(blob),worker=new Worker(workerUrl);return worker.objectURL=workerUrl,worker}},{}],"/index.js":[function(_dereq_,module,exports){"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var assign=_dereq_("object-assign"),webworkify=_dereq_("webworkify"),MathLib=_dereq_("./lib/mathlib"),Pool=_dereq_("./lib/pool"),utils=_dereq_("./lib/utils"),worker=_dereq_("./lib/worker"),createStages=_dereq_("./lib/stepper"),createRegions=_dereq_("./lib/tiler"),singletones={},NEED_SAFARI_FIX=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(NEED_SAFARI_FIX=navigator.userAgent.indexOf("Safari")>=0)}catch(e){}var concurrency=1;"undefined"!=typeof navigator&&(concurrency=Math.min(navigator.hardwareConcurrency||1,4));var DEFAULT_PICA_OPTS={tile:1024,concurrency,features:["js","wasm","ww"],idle:2e3,createCanvas:function createCanvas(width,height){var tmpCanvas=document.createElement("canvas");return tmpCanvas.width=width,tmpCanvas.height=height,tmpCanvas}},DEFAULT_RESIZE_OPTS={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},CAN_NEW_IMAGE_DATA=!1,CAN_CREATE_IMAGE_BITMAP=!1,CAN_USE_CANVAS_GET_IMAGE_DATA=!1,CAN_USE_OFFSCREEN_CANVAS=!1,CAN_USE_CIB_REGION_FOR_IMAGE=!1;function workerFabric(){return{value:webworkify(worker),destroy:function destroy(){if(this.value.terminate(),"undefined"!=typeof window){var url=window.URL||window.webkitURL||window.mozURL||window.msURL;url&&url.revokeObjectURL&&this.value.objectURL&&url.revokeObjectURL(this.value.objectURL)}}}}function Pica(options){if(!(this instanceof Pica))return new Pica(options);this.options=assign({},DEFAULT_PICA_OPTS,options||{});var limiter_key="lk_".concat(this.options.concurrency);this.__limit=singletones[limiter_key]||utils.limiter(this.options.concurrency),singletones[limiter_key]||(singletones[limiter_key]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}Pica.prototype.init=function(){var _this=this;if(this.__initPromise)return this.__initPromise;if("undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray)try{new ImageData(new Uint8ClampedArray(400),10,10),CAN_NEW_IMAGE_DATA=!0}catch(__){}"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?CAN_CREATE_IMAGE_BITMAP=!0:this.debug("ImageBitmap does not support .close(), disabled"));var features=this.options.features.slice();if(features.indexOf("all")>=0&&(features=["cib","wasm","js","ww"]),this.__requested_features=features,this.__mathlib=new MathLib(features),features.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{_dereq_("webworkify")(function(){}).terminate(),this.features.ww=!0;var wpool_key="wp_".concat(JSON.stringify(this.options));singletones[wpool_key]?this.__workersPool=singletones[wpool_key]:(this.__workersPool=new Pool(workerFabric,this.options.idle),singletones[wpool_key]=this.__workersPool)}catch(__){}var checkCibResize,checkOffscreenCanvas,initMath=this.__mathlib.init().then(function(mathlib){assign(_this.features,mathlib.features)});checkCibResize=CAN_CREATE_IMAGE_BITMAP?utils.cib_support(this.options.createCanvas).then(function(status){_this.features.cib&&features.indexOf("cib")<0?_this.debug("createImageBitmap() resize supported, but disabled by config"):features.indexOf("cib")>=0&&(_this.features.cib=status)}):Promise.resolve(!1),CAN_USE_CANVAS_GET_IMAGE_DATA=utils.can_use_canvas(this.options.createCanvas),checkOffscreenCanvas=(checkOffscreenCanvas=CAN_CREATE_IMAGE_BITMAP&&CAN_NEW_IMAGE_DATA&&-1!==features.indexOf("ww")?utils.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(result){CAN_USE_OFFSCREEN_CANVAS=result});var checkCibRegion=utils.cib_can_use_region().then(function(result){CAN_USE_CIB_REGION_FOR_IMAGE=result});return this.__initPromise=Promise.all([initMath,checkCibResize,checkOffscreenCanvas,checkCibRegion]).then(function(){return _this}),this.__initPromise},Pica.prototype.__invokeResize=function(tileOpts,opts){var _this2=this;return opts.__mathCache=opts.__mathCache||{},Promise.resolve().then(function(){return _this2.features.ww?new Promise(function(resolve,reject){var w=_this2.__workersPool.acquire();opts.cancelToken&&opts.cancelToken.catch(function(err){return reject(err)}),w.value.onmessage=function(ev){w.release(),ev.data.err?reject(ev.data.err):resolve(ev.data)};var transfer=[];tileOpts.src&&transfer.push(tileOpts.src.buffer),tileOpts.srcBitmap&&transfer.push(tileOpts.srcBitmap),w.value.postMessage({opts:tileOpts,features:_this2.__requested_features,preload:{wasm_nodule:_this2.__mathlib.__}},transfer)}):{data:_this2.__mathlib.resizeAndUnsharp(tileOpts,opts.__mathCache)}})},Pica.prototype.__extractTileData=function(tile,from,opts,stageEnv,extractTo){if(this.features.ww&&CAN_USE_OFFSCREEN_CANVAS&&(utils.isCanvas(from)||CAN_USE_CIB_REGION_FOR_IMAGE))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height).then(function(bitmap){return extractTo.srcBitmap=bitmap,extractTo});if(utils.isCanvas(from))return stageEnv.srcCtx||(stageEnv.srcCtx=from.getContext("2d",{alpha:Boolean(opts.alpha)})),this.debug("Get tile pixel data"),extractTo.src=stageEnv.srcCtx.getImageData(tile.x,tile.y,tile.width,tile.height).data,extractTo;this.debug("Draw tile imageBitmap/image to temporary canvas");var tmpCanvas=this.options.createCanvas(tile.width,tile.height),tmpCtx=tmpCanvas.getContext("2d",{alpha:Boolean(opts.alpha)});return tmpCtx.globalCompositeOperation="copy",tmpCtx.drawImage(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height,0,0,tile.width,tile.height),this.debug("Get tile pixel data"),extractTo.src=tmpCtx.getImageData(0,0,tile.width,tile.height).data,tmpCanvas.width=tmpCanvas.height=0,extractTo},Pica.prototype.__landTileData=function(tile,result,stageEnv){var toImageData;if(this.debug("Convert raw rgba tile result to ImageData"),result.bitmap)return stageEnv.toCtx.drawImage(result.bitmap,tile.toX,tile.toY),null;if(CAN_NEW_IMAGE_DATA)toImageData=new ImageData(new Uint8ClampedArray(result.data),tile.toWidth,tile.toHeight);else if((toImageData=stageEnv.toCtx.createImageData(tile.toWidth,tile.toHeight)).data.set)toImageData.data.set(result.data);else for(var i=toImageData.data.length-1;i>=0;i--)toImageData.data[i]=result.data[i];return this.debug("Draw tile"),NEED_SAFARI_FIX?stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth+1e-5,tile.toInnerHeight+1e-5):stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth,tile.toInnerHeight),null},Pica.prototype.__tileAndResize=function(from,to,opts){var _this3=this,stageEnv={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},processTile=function processTile(tile){return _this3.__limit(function(){if(opts.canceled)return opts.cancelToken;var tileOpts={width:tile.width,height:tile.height,toWidth:tile.toWidth,toHeight:tile.toHeight,scaleX:tile.scaleX,scaleY:tile.scaleY,offsetX:tile.offsetX,offsetY:tile.offsetY,quality:opts.quality,alpha:opts.alpha,unsharpAmount:opts.unsharpAmount,unsharpRadius:opts.unsharpRadius,unsharpThreshold:opts.unsharpThreshold};return _this3.debug("Invoke resize math"),Promise.resolve(tileOpts).then(function(tileOpts){return _this3.__extractTileData(tile,from,opts,stageEnv,tileOpts)}).then(function(tileOpts){return _this3.debug("Invoke resize math"),_this3.__invokeResize(tileOpts,opts)}).then(function(result){return opts.canceled?opts.cancelToken:(stageEnv.srcImageData=null,_this3.__landTileData(tile,result,stageEnv))})})};return Promise.resolve().then(function(){if(stageEnv.toCtx=to.getContext("2d",{alpha:Boolean(opts.alpha)}),utils.isCanvas(from))return null;if(utils.isImageBitmap(from))return stageEnv.srcImageBitmap=from,stageEnv.isImageBitmapReused=!0,null;if(utils.isImage(from))return CAN_CREATE_IMAGE_BITMAP?(_this3.debug("Decode image via createImageBitmap"),createImageBitmap(from).then(function(imageBitmap){stageEnv.srcImageBitmap=imageBitmap}).catch(function(e){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(opts.canceled)return opts.cancelToken;_this3.debug("Calculate tiles");var jobs=createRegions({width:opts.width,height:opts.height,srcTileSize:_this3.options.tile,toWidth:opts.toWidth,toHeight:opts.toHeight,destTileBorder:opts.__destTileBorder}).map(function(tile){return processTile(tile)});function cleanup(stageEnv){stageEnv.srcImageBitmap&&(stageEnv.isImageBitmapReused||stageEnv.srcImageBitmap.close(),stageEnv.srcImageBitmap=null)}return _this3.debug("Process tiles"),Promise.all(jobs).then(function(){return _this3.debug("Finished!"),cleanup(stageEnv),to},function(err){throw cleanup(stageEnv),err})})},Pica.prototype.__processStages=function(stages,from,to,opts){var _this4=this;if(opts.canceled)return opts.cancelToken;var tmpCanvas,_stages$shift2=_slicedToArray(stages.shift(),2),toWidth=_stages$shift2[0],toHeight=_stages$shift2[1],isLastStage=0===stages.length;return opts=assign({},opts,{toWidth,toHeight,quality:isLastStage?opts.quality:Math.min(1,opts.quality)}),isLastStage||(tmpCanvas=this.options.createCanvas(toWidth,toHeight)),this.__tileAndResize(from,isLastStage?to:tmpCanvas,opts).then(function(){return isLastStage?to:(opts.width=toWidth,opts.height=toHeight,_this4.__processStages(stages,tmpCanvas,to,opts))}).then(function(res){return tmpCanvas&&(tmpCanvas.width=tmpCanvas.height=0),res})},Pica.prototype.__resizeViaCreateImageBitmap=function(from,to,opts){var _this5=this,toCtx=to.getContext("2d",{alpha:Boolean(opts.alpha)});return this.debug("Resize via createImageBitmap()"),createImageBitmap(from,{resizeWidth:opts.toWidth,resizeHeight:opts.toHeight,resizeQuality:utils.cib_quality_name(opts.quality)}).then(function(imageBitmap){if(opts.canceled)return opts.cancelToken;if(!opts.unsharpAmount)return toCtx.drawImage(imageBitmap,0,0),imageBitmap.close(),toCtx=null,_this5.debug("Finished!"),to;_this5.debug("Unsharp result");var tmpCanvas=_this5.options.createCanvas(opts.toWidth,opts.toHeight),tmpCtx=tmpCanvas.getContext("2d",{alpha:Boolean(opts.alpha)});tmpCtx.drawImage(imageBitmap,0,0),imageBitmap.close();var iData=tmpCtx.getImageData(0,0,opts.toWidth,opts.toHeight);return _this5.__mathlib.unsharp_mask(iData.data,opts.toWidth,opts.toHeight,opts.unsharpAmount,opts.unsharpRadius,opts.unsharpThreshold),toCtx.putImageData(iData,0,0),tmpCanvas.width=tmpCanvas.height=0,iData=tmpCtx=tmpCanvas=toCtx=null,_this5.debug("Finished!"),to})},Pica.prototype.resize=function(from,to,options){var _this6=this;this.debug("Start resize...");var opts=assign({},DEFAULT_RESIZE_OPTS);if(isNaN(options)?options&&(opts=assign(opts,options)):opts=assign(opts,{quality:options}),opts.toWidth=to.width,opts.toHeight=to.height,opts.width=from.naturalWidth||from.width,opts.height=from.naturalHeight||from.height,0===to.width||0===to.height)return Promise.reject(new Error("Invalid output size: ".concat(to.width,"x").concat(to.height)));opts.unsharpRadius>2&&(opts.unsharpRadius=2),opts.canceled=!1,opts.cancelToken&&(opts.cancelToken=opts.cancelToken.then(function(data){throw opts.canceled=!0,data},function(err){throw opts.canceled=!0,err}));var DEST_TILE_BORDER=3;return opts.__destTileBorder=Math.ceil(Math.max(DEST_TILE_BORDER,2.5*opts.unsharpRadius|0)),this.init().then(function(){if(opts.canceled)return opts.cancelToken;if(_this6.features.cib)return _this6.__resizeViaCreateImageBitmap(from,to,opts);if(!CAN_USE_CANVAS_GET_IMAGE_DATA){var err=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw err.code="ERR_GET_IMAGE_DATA",err}var stages=createStages(opts.width,opts.height,opts.toWidth,opts.toHeight,_this6.options.tile,opts.__destTileBorder);return _this6.__processStages(stages,from,to,opts)})},Pica.prototype.resizeBuffer=function(options){var _this7=this,opts=assign({},DEFAULT_RESIZE_OPTS,options);return this.init().then(function(){return _this7.__mathlib.resizeAndUnsharp(opts)})},Pica.prototype.toBlob=function(canvas,mimeType,quality){return mimeType=mimeType||"image/png",new Promise(function(resolve){if(canvas.toBlob)canvas.toBlob(function(blob){return resolve(blob)},mimeType,quality);else if(canvas.convertToBlob)resolve(canvas.convertToBlob({type:mimeType,quality}));else{for(var asString=atob(canvas.toDataURL(mimeType,quality).split(",")[1]),len=asString.length,asBuffer=new Uint8Array(len),i=0;i<len;i++)asBuffer[i]=asString.charCodeAt(i);resolve(new Blob([asBuffer],{type:mimeType}))}})},Pica.prototype.debug=function(){},module.exports=Pica},{"./lib/mathlib":1,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":23,webworkify:24}]},{},[])("/index.js")}}]);